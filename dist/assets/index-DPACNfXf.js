function TP(t,e){for(var i=0;i<e.length;i++){const l=e[i];if(typeof l!="string"&&!Array.isArray(l)){for(const f in l)if(f!=="default"&&!(f in t)){const v=Object.getOwnPropertyDescriptor(l,f);v&&Object.defineProperty(t,f,v.get?v:{enumerable:!0,get:()=>l[f]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))l(f);new MutationObserver(f=>{for(const v of f)if(v.type==="childList")for(const g of v.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function i(f){const v={};return f.integrity&&(v.integrity=f.integrity),f.referrerPolicy&&(v.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?v.credentials="include":f.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function l(f){if(f.ep)return;f.ep=!0;const v=i(f);fetch(f.href,v)}})();var SP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var PP={exports:{}},D_={},EP={exports:{}},bn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var em=Symbol.for("react.element"),GA=Symbol.for("react.portal"),qA=Symbol.for("react.fragment"),WA=Symbol.for("react.strict_mode"),HA=Symbol.for("react.profiler"),KA=Symbol.for("react.provider"),XA=Symbol.for("react.context"),YA=Symbol.for("react.forward_ref"),JA=Symbol.for("react.suspense"),QA=Symbol.for("react.memo"),eR=Symbol.for("react.lazy"),$1=Symbol.iterator;function tR(t){return t===null||typeof t!="object"?null:(t=$1&&t[$1]||t["@@iterator"],typeof t=="function"?t:null)}var CP={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},IP=Object.assign,kP={};function Yd(t,e,i){this.props=t,this.context=e,this.refs=kP,this.updater=i||CP}Yd.prototype.isReactComponent={};Yd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Yd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function MP(){}MP.prototype=Yd.prototype;function k0(t,e,i){this.props=t,this.context=e,this.refs=kP,this.updater=i||CP}var M0=k0.prototype=new MP;M0.constructor=k0;IP(M0,Yd.prototype);M0.isPureReactComponent=!0;var Z1=Array.isArray,AP=Object.prototype.hasOwnProperty,A0={current:null},RP={key:!0,ref:!0,__self:!0,__source:!0};function LP(t,e,i){var l,f={},v=null,g=null;if(e!=null)for(l in e.ref!==void 0&&(g=e.ref),e.key!==void 0&&(v=""+e.key),e)AP.call(e,l)&&!RP.hasOwnProperty(l)&&(f[l]=e[l]);var c=arguments.length-2;if(c===1)f.children=i;else if(1<c){for(var A=Array(c),N=0;N<c;N++)A[N]=arguments[N+2];f.children=A}if(t&&t.defaultProps)for(l in c=t.defaultProps,c)f[l]===void 0&&(f[l]=c[l]);return{$$typeof:em,type:t,key:v,ref:g,props:f,_owner:A0.current}}function nR(t,e){return{$$typeof:em,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function R0(t){return typeof t=="object"&&t!==null&&t.$$typeof===em}function rR(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var G1=/\/+/g;function iv(t,e){return typeof t=="object"&&t!==null&&t.key!=null?rR(""+t.key):e.toString(36)}function Ig(t,e,i,l,f){var v=typeof t;(v==="undefined"||v==="boolean")&&(t=null);var g=!1;if(t===null)g=!0;else switch(v){case"string":case"number":g=!0;break;case"object":switch(t.$$typeof){case em:case GA:g=!0}}if(g)return g=t,f=f(g),t=l===""?"."+iv(g,0):l,Z1(f)?(i="",t!=null&&(i=t.replace(G1,"$&/")+"/"),Ig(f,e,i,"",function(N){return N})):f!=null&&(R0(f)&&(f=nR(f,i+(!f.key||g&&g.key===f.key?"":(""+f.key).replace(G1,"$&/")+"/")+t)),e.push(f)),1;if(g=0,l=l===""?".":l+":",Z1(t))for(var c=0;c<t.length;c++){v=t[c];var A=l+iv(v,c);g+=Ig(v,e,i,A,f)}else if(A=tR(t),typeof A=="function")for(t=A.call(t),c=0;!(v=t.next()).done;)v=v.value,A=l+iv(v,c++),g+=Ig(v,e,i,A,f);else if(v==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return g}function rg(t,e,i){if(t==null)return t;var l=[],f=0;return Ig(t,l,"","",function(v){return e.call(i,v,f++)}),l}function iR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var xs={current:null},kg={transition:null},sR={ReactCurrentDispatcher:xs,ReactCurrentBatchConfig:kg,ReactCurrentOwner:A0};function zP(){throw Error("act(...) is not supported in production builds of React.")}bn.Children={map:rg,forEach:function(t,e,i){rg(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return rg(t,function(){e++}),e},toArray:function(t){return rg(t,function(e){return e})||[]},only:function(t){if(!R0(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};bn.Component=Yd;bn.Fragment=qA;bn.Profiler=HA;bn.PureComponent=k0;bn.StrictMode=WA;bn.Suspense=JA;bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sR;bn.act=zP;bn.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var l=IP({},t.props),f=t.key,v=t.ref,g=t._owner;if(e!=null){if(e.ref!==void 0&&(v=e.ref,g=A0.current),e.key!==void 0&&(f=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(A in e)AP.call(e,A)&&!RP.hasOwnProperty(A)&&(l[A]=e[A]===void 0&&c!==void 0?c[A]:e[A])}var A=arguments.length-2;if(A===1)l.children=i;else if(1<A){c=Array(A);for(var N=0;N<A;N++)c[N]=arguments[N+2];l.children=c}return{$$typeof:em,type:t.type,key:f,ref:v,props:l,_owner:g}};bn.createContext=function(t){return t={$$typeof:XA,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:KA,_context:t},t.Consumer=t};bn.createElement=LP;bn.createFactory=function(t){var e=LP.bind(null,t);return e.type=t,e};bn.createRef=function(){return{current:null}};bn.forwardRef=function(t){return{$$typeof:YA,render:t}};bn.isValidElement=R0;bn.lazy=function(t){return{$$typeof:eR,_payload:{_status:-1,_result:t},_init:iR}};bn.memo=function(t,e){return{$$typeof:QA,type:t,compare:e===void 0?null:e}};bn.startTransition=function(t){var e=kg.transition;kg.transition={};try{t()}finally{kg.transition=e}};bn.unstable_act=zP;bn.useCallback=function(t,e){return xs.current.useCallback(t,e)};bn.useContext=function(t){return xs.current.useContext(t)};bn.useDebugValue=function(){};bn.useDeferredValue=function(t){return xs.current.useDeferredValue(t)};bn.useEffect=function(t,e){return xs.current.useEffect(t,e)};bn.useId=function(){return xs.current.useId()};bn.useImperativeHandle=function(t,e,i){return xs.current.useImperativeHandle(t,e,i)};bn.useInsertionEffect=function(t,e){return xs.current.useInsertionEffect(t,e)};bn.useLayoutEffect=function(t,e){return xs.current.useLayoutEffect(t,e)};bn.useMemo=function(t,e){return xs.current.useMemo(t,e)};bn.useReducer=function(t,e,i){return xs.current.useReducer(t,e,i)};bn.useRef=function(t){return xs.current.useRef(t)};bn.useState=function(t){return xs.current.useState(t)};bn.useSyncExternalStore=function(t,e,i){return xs.current.useSyncExternalStore(t,e,i)};bn.useTransition=function(){return xs.current.useTransition()};bn.version="18.3.1";EP.exports=bn;var se=EP.exports;const pa=z_(se),L0=TP({__proto__:null,default:pa},[se]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oR=se,aR=Symbol.for("react.element"),lR=Symbol.for("react.fragment"),cR=Object.prototype.hasOwnProperty,uR=oR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hR={key:!0,ref:!0,__self:!0,__source:!0};function DP(t,e,i){var l,f={},v=null,g=null;i!==void 0&&(v=""+i),e.key!==void 0&&(v=""+e.key),e.ref!==void 0&&(g=e.ref);for(l in e)cR.call(e,l)&&!hR.hasOwnProperty(l)&&(f[l]=e[l]);if(t&&t.defaultProps)for(l in e=t.defaultProps,e)f[l]===void 0&&(f[l]=e[l]);return{$$typeof:aR,type:t,key:v,ref:g,props:f,_owner:uR.current}}D_.Fragment=lR;D_.jsx=DP;D_.jsxs=DP;PP.exports=D_;var I=PP.exports,NP={exports:{}},fo={},OP={exports:{}},jP={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Ne,Oe){var We=Ne.length;Ne.push(Oe);e:for(;0<We;){var nt=We-1>>>1,_t=Ne[nt];if(0<f(_t,Oe))Ne[nt]=Oe,Ne[We]=_t,We=nt;else break e}}function i(Ne){return Ne.length===0?null:Ne[0]}function l(Ne){if(Ne.length===0)return null;var Oe=Ne[0],We=Ne.pop();if(We!==Oe){Ne[0]=We;e:for(var nt=0,_t=Ne.length,Bt=_t>>>1;nt<Bt;){var Ft=2*(nt+1)-1,Ut=Ne[Ft],Pt=Ft+1,Un=Ne[Pt];if(0>f(Ut,We))Pt<_t&&0>f(Un,Ut)?(Ne[nt]=Un,Ne[Pt]=We,nt=Pt):(Ne[nt]=Ut,Ne[Ft]=We,nt=Ft);else if(Pt<_t&&0>f(Un,We))Ne[nt]=Un,Ne[Pt]=We,nt=Pt;else break e}}return Oe}function f(Ne,Oe){var We=Ne.sortIndex-Oe.sortIndex;return We!==0?We:Ne.id-Oe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;t.unstable_now=function(){return v.now()}}else{var g=Date,c=g.now();t.unstable_now=function(){return g.now()-c}}var A=[],N=[],Z=1,W=null,K=3,J=!1,ce=!1,ie=!1,oe=typeof setTimeout=="function"?setTimeout:null,re=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function te(Ne){for(var Oe=i(N);Oe!==null;){if(Oe.callback===null)l(N);else if(Oe.startTime<=Ne)l(N),Oe.sortIndex=Oe.expirationTime,e(A,Oe);else break;Oe=i(N)}}function fe(Ne){if(ie=!1,te(Ne),!ce)if(i(A)!==null)ce=!0,wt(pe);else{var Oe=i(N);Oe!==null&&jt(fe,Oe.startTime-Ne)}}function pe(Ne,Oe){ce=!1,ie&&(ie=!1,re(Le),Le=-1),J=!0;var We=K;try{for(te(Oe),W=i(A);W!==null&&(!(W.expirationTime>Oe)||Ne&&!ht());){var nt=W.callback;if(typeof nt=="function"){W.callback=null,K=W.priorityLevel;var _t=nt(W.expirationTime<=Oe);Oe=t.unstable_now(),typeof _t=="function"?W.callback=_t:W===i(A)&&l(A),te(Oe)}else l(A);W=i(A)}if(W!==null)var Bt=!0;else{var Ft=i(N);Ft!==null&&jt(fe,Ft.startTime-Oe),Bt=!1}return Bt}finally{W=null,K=We,J=!1}}var Ie=!1,Ge=null,Le=-1,xt=5,ct=-1;function ht(){return!(t.unstable_now()-ct<xt)}function ze(){if(Ge!==null){var Ne=t.unstable_now();ct=Ne;var Oe=!0;try{Oe=Ge(!0,Ne)}finally{Oe?vt():(Ie=!1,Ge=null)}}else Ie=!1}var vt;if(typeof $=="function")vt=function(){$(ze)};else if(typeof MessageChannel<"u"){var at=new MessageChannel,Mt=at.port2;at.port1.onmessage=ze,vt=function(){Mt.postMessage(null)}}else vt=function(){oe(ze,0)};function wt(Ne){Ge=Ne,Ie||(Ie=!0,vt())}function jt(Ne,Oe){Le=oe(function(){Ne(t.unstable_now())},Oe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ne){Ne.callback=null},t.unstable_continueExecution=function(){ce||J||(ce=!0,wt(pe))},t.unstable_forceFrameRate=function(Ne){0>Ne||125<Ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xt=0<Ne?Math.floor(1e3/Ne):5},t.unstable_getCurrentPriorityLevel=function(){return K},t.unstable_getFirstCallbackNode=function(){return i(A)},t.unstable_next=function(Ne){switch(K){case 1:case 2:case 3:var Oe=3;break;default:Oe=K}var We=K;K=Oe;try{return Ne()}finally{K=We}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ne,Oe){switch(Ne){case 1:case 2:case 3:case 4:case 5:break;default:Ne=3}var We=K;K=Ne;try{return Oe()}finally{K=We}},t.unstable_scheduleCallback=function(Ne,Oe,We){var nt=t.unstable_now();switch(typeof We=="object"&&We!==null?(We=We.delay,We=typeof We=="number"&&0<We?nt+We:nt):We=nt,Ne){case 1:var _t=-1;break;case 2:_t=250;break;case 5:_t=1073741823;break;case 4:_t=1e4;break;default:_t=5e3}return _t=We+_t,Ne={id:Z++,callback:Oe,priorityLevel:Ne,startTime:We,expirationTime:_t,sortIndex:-1},We>nt?(Ne.sortIndex=We,e(N,Ne),i(A)===null&&Ne===i(N)&&(ie?(re(Le),Le=-1):ie=!0,jt(fe,We-nt))):(Ne.sortIndex=_t,e(A,Ne),ce||J||(ce=!0,wt(pe))),Ne},t.unstable_shouldYield=ht,t.unstable_wrapCallback=function(Ne){var Oe=K;return function(){var We=K;K=Oe;try{return Ne.apply(this,arguments)}finally{K=We}}}})(jP);OP.exports=jP;var dR=OP.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fR=se,ho=dR;function mt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var BP=new Set,kp={};function gh(t,e){Bd(t,e),Bd(t+"Capture",e)}function Bd(t,e){for(kp[t]=e,t=0;t<e.length;t++)BP.add(e[t])}var Yl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ox=Object.prototype.hasOwnProperty,pR=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,q1={},W1={};function mR(t){return ox.call(W1,t)?!0:ox.call(q1,t)?!1:pR.test(t)?W1[t]=!0:(q1[t]=!0,!1)}function gR(t,e,i,l){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return l?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function _R(t,e,i,l){if(e===null||typeof e>"u"||gR(t,e,i,l))return!0;if(l)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function bs(t,e,i,l,f,v,g){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=l,this.attributeNamespace=f,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=v,this.removeEmptyString=g}var Zi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Zi[t]=new bs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Zi[e]=new bs(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Zi[t]=new bs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Zi[t]=new bs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Zi[t]=new bs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Zi[t]=new bs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Zi[t]=new bs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Zi[t]=new bs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Zi[t]=new bs(t,5,!1,t.toLowerCase(),null,!1,!1)});var z0=/[\-:]([a-z])/g;function D0(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(z0,D0);Zi[e]=new bs(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(z0,D0);Zi[e]=new bs(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(z0,D0);Zi[e]=new bs(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Zi[t]=new bs(t,1,!1,t.toLowerCase(),null,!1,!1)});Zi.xlinkHref=new bs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Zi[t]=new bs(t,1,!1,t.toLowerCase(),null,!0,!0)});function N0(t,e,i,l){var f=Zi.hasOwnProperty(e)?Zi[e]:null;(f!==null?f.type!==0:l||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(_R(e,i,f,l)&&(i=null),l||f===null?mR(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):f.mustUseProperty?t[f.propertyName]=i===null?f.type===3?!1:"":i:(e=f.attributeName,l=f.attributeNamespace,i===null?t.removeAttribute(e):(f=f.type,i=f===3||f===4&&i===!0?"":""+i,l?t.setAttributeNS(l,e,i):t.setAttribute(e,i))))}var ic=fR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ig=Symbol.for("react.element"),pd=Symbol.for("react.portal"),md=Symbol.for("react.fragment"),O0=Symbol.for("react.strict_mode"),ax=Symbol.for("react.profiler"),FP=Symbol.for("react.provider"),UP=Symbol.for("react.context"),j0=Symbol.for("react.forward_ref"),lx=Symbol.for("react.suspense"),cx=Symbol.for("react.suspense_list"),B0=Symbol.for("react.memo"),Fc=Symbol.for("react.lazy"),VP=Symbol.for("react.offscreen"),H1=Symbol.iterator;function qf(t){return t===null||typeof t!="object"?null:(t=H1&&t[H1]||t["@@iterator"],typeof t=="function"?t:null)}var zr=Object.assign,sv;function sp(t){if(sv===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);sv=e&&e[1]||""}return`
`+sv+t}var ov=!1;function av(t,e){if(!t||ov)return"";ov=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(N){var l=N}Reflect.construct(t,[],e)}else{try{e.call()}catch(N){l=N}t.call(e.prototype)}else{try{throw Error()}catch(N){l=N}t()}}catch(N){if(N&&l&&typeof N.stack=="string"){for(var f=N.stack.split(`
`),v=l.stack.split(`
`),g=f.length-1,c=v.length-1;1<=g&&0<=c&&f[g]!==v[c];)c--;for(;1<=g&&0<=c;g--,c--)if(f[g]!==v[c]){if(g!==1||c!==1)do if(g--,c--,0>c||f[g]!==v[c]){var A=`
`+f[g].replace(" at new "," at ");return t.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",t.displayName)),A}while(1<=g&&0<=c);break}}}finally{ov=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?sp(t):""}function yR(t){switch(t.tag){case 5:return sp(t.type);case 16:return sp("Lazy");case 13:return sp("Suspense");case 19:return sp("SuspenseList");case 0:case 2:case 15:return t=av(t.type,!1),t;case 11:return t=av(t.type.render,!1),t;case 1:return t=av(t.type,!0),t;default:return""}}function ux(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case md:return"Fragment";case pd:return"Portal";case ax:return"Profiler";case O0:return"StrictMode";case lx:return"Suspense";case cx:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case UP:return(t.displayName||"Context")+".Consumer";case FP:return(t._context.displayName||"Context")+".Provider";case j0:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case B0:return e=t.displayName||null,e!==null?e:ux(t.type)||"Memo";case Fc:e=t._payload,t=t._init;try{return ux(t(e))}catch{}}return null}function vR(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ux(e);case 8:return e===O0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function fu(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function $P(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function xR(t){var e=$P(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),l=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var f=i.get,v=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return f.call(this)},set:function(g){l=""+g,v.call(this,g)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(g){l=""+g},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function sg(t){t._valueTracker||(t._valueTracker=xR(t))}function ZP(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),l="";return t&&(l=$P(t)?t.checked?"true":"false":t.value),t=l,t!==i?(e.setValue(t),!0):!1}function e_(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function hx(t,e){var i=e.checked;return zr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function K1(t,e){var i=e.defaultValue==null?"":e.defaultValue,l=e.checked!=null?e.checked:e.defaultChecked;i=fu(e.value!=null?e.value:i),t._wrapperState={initialChecked:l,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function GP(t,e){e=e.checked,e!=null&&N0(t,"checked",e,!1)}function dx(t,e){GP(t,e);var i=fu(e.value),l=e.type;if(i!=null)l==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(l==="submit"||l==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?fx(t,e.type,i):e.hasOwnProperty("defaultValue")&&fx(t,e.type,fu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function X1(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var l=e.type;if(!(l!=="submit"&&l!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function fx(t,e,i){(e!=="number"||e_(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var op=Array.isArray;function Cd(t,e,i,l){if(t=t.options,e){e={};for(var f=0;f<i.length;f++)e["$"+i[f]]=!0;for(i=0;i<t.length;i++)f=e.hasOwnProperty("$"+t[i].value),t[i].selected!==f&&(t[i].selected=f),f&&l&&(t[i].defaultSelected=!0)}else{for(i=""+fu(i),e=null,f=0;f<t.length;f++){if(t[f].value===i){t[f].selected=!0,l&&(t[f].defaultSelected=!0);return}e!==null||t[f].disabled||(e=t[f])}e!==null&&(e.selected=!0)}}function px(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(mt(91));return zr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Y1(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(mt(92));if(op(i)){if(1<i.length)throw Error(mt(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:fu(i)}}function qP(t,e){var i=fu(e.value),l=fu(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),l!=null&&(t.defaultValue=""+l)}function J1(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function WP(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mx(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?WP(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var og,HP=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,l,f){MSApp.execUnsafeLocalFunction(function(){return t(e,i,l,f)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(og=og||document.createElement("div"),og.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=og.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Mp(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var dp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bR=["Webkit","ms","Moz","O"];Object.keys(dp).forEach(function(t){bR.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),dp[e]=dp[t]})});function KP(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||dp.hasOwnProperty(t)&&dp[t]?(""+e).trim():e+"px"}function XP(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var l=i.indexOf("--")===0,f=KP(i,e[i],l);i==="float"&&(i="cssFloat"),l?t.setProperty(i,f):t[i]=f}}var wR=zr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gx(t,e){if(e){if(wR[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(mt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(mt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(mt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(mt(62))}}function _x(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yx=null;function F0(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var vx=null,Id=null,kd=null;function Q1(t){if(t=rm(t)){if(typeof vx!="function")throw Error(mt(280));var e=t.stateNode;e&&(e=F_(e),vx(t.stateNode,t.type,e))}}function YP(t){Id?kd?kd.push(t):kd=[t]:Id=t}function JP(){if(Id){var t=Id,e=kd;if(kd=Id=null,Q1(t),e)for(t=0;t<e.length;t++)Q1(e[t])}}function QP(t,e){return t(e)}function e2(){}var lv=!1;function t2(t,e,i){if(lv)return t(e,i);lv=!0;try{return QP(t,e,i)}finally{lv=!1,(Id!==null||kd!==null)&&(e2(),JP())}}function Ap(t,e){var i=t.stateNode;if(i===null)return null;var l=F_(i);if(l===null)return null;i=l[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(mt(231,e,typeof i));return i}var xx=!1;if(Yl)try{var Wf={};Object.defineProperty(Wf,"passive",{get:function(){xx=!0}}),window.addEventListener("test",Wf,Wf),window.removeEventListener("test",Wf,Wf)}catch{xx=!1}function TR(t,e,i,l,f,v,g,c,A){var N=Array.prototype.slice.call(arguments,3);try{e.apply(i,N)}catch(Z){this.onError(Z)}}var fp=!1,t_=null,n_=!1,bx=null,SR={onError:function(t){fp=!0,t_=t}};function PR(t,e,i,l,f,v,g,c,A){fp=!1,t_=null,TR.apply(SR,arguments)}function ER(t,e,i,l,f,v,g,c,A){if(PR.apply(this,arguments),fp){if(fp){var N=t_;fp=!1,t_=null}else throw Error(mt(198));n_||(n_=!0,bx=N)}}function _h(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function n2(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function eT(t){if(_h(t)!==t)throw Error(mt(188))}function CR(t){var e=t.alternate;if(!e){if(e=_h(t),e===null)throw Error(mt(188));return e!==t?null:t}for(var i=t,l=e;;){var f=i.return;if(f===null)break;var v=f.alternate;if(v===null){if(l=f.return,l!==null){i=l;continue}break}if(f.child===v.child){for(v=f.child;v;){if(v===i)return eT(f),t;if(v===l)return eT(f),e;v=v.sibling}throw Error(mt(188))}if(i.return!==l.return)i=f,l=v;else{for(var g=!1,c=f.child;c;){if(c===i){g=!0,i=f,l=v;break}if(c===l){g=!0,l=f,i=v;break}c=c.sibling}if(!g){for(c=v.child;c;){if(c===i){g=!0,i=v,l=f;break}if(c===l){g=!0,l=v,i=f;break}c=c.sibling}if(!g)throw Error(mt(189))}}if(i.alternate!==l)throw Error(mt(190))}if(i.tag!==3)throw Error(mt(188));return i.stateNode.current===i?t:e}function r2(t){return t=CR(t),t!==null?i2(t):null}function i2(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=i2(t);if(e!==null)return e;t=t.sibling}return null}var s2=ho.unstable_scheduleCallback,tT=ho.unstable_cancelCallback,IR=ho.unstable_shouldYield,kR=ho.unstable_requestPaint,Hr=ho.unstable_now,MR=ho.unstable_getCurrentPriorityLevel,U0=ho.unstable_ImmediatePriority,o2=ho.unstable_UserBlockingPriority,r_=ho.unstable_NormalPriority,AR=ho.unstable_LowPriority,a2=ho.unstable_IdlePriority,N_=null,fl=null;function RR(t){if(fl&&typeof fl.onCommitFiberRoot=="function")try{fl.onCommitFiberRoot(N_,t,void 0,(t.current.flags&128)===128)}catch{}}var xa=Math.clz32?Math.clz32:DR,LR=Math.log,zR=Math.LN2;function DR(t){return t>>>=0,t===0?32:31-(LR(t)/zR|0)|0}var ag=64,lg=4194304;function ap(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function i_(t,e){var i=t.pendingLanes;if(i===0)return 0;var l=0,f=t.suspendedLanes,v=t.pingedLanes,g=i&268435455;if(g!==0){var c=g&~f;c!==0?l=ap(c):(v&=g,v!==0&&(l=ap(v)))}else g=i&~f,g!==0?l=ap(g):v!==0&&(l=ap(v));if(l===0)return 0;if(e!==0&&e!==l&&!(e&f)&&(f=l&-l,v=e&-e,f>=v||f===16&&(v&4194240)!==0))return e;if(l&4&&(l|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=l;0<e;)i=31-xa(e),f=1<<i,l|=t[i],e&=~f;return l}function NR(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OR(t,e){for(var i=t.suspendedLanes,l=t.pingedLanes,f=t.expirationTimes,v=t.pendingLanes;0<v;){var g=31-xa(v),c=1<<g,A=f[g];A===-1?(!(c&i)||c&l)&&(f[g]=NR(c,e)):A<=e&&(t.expiredLanes|=c),v&=~c}}function wx(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function l2(){var t=ag;return ag<<=1,!(ag&4194240)&&(ag=64),t}function cv(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function tm(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-xa(e),t[e]=i}function jR(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var l=t.eventTimes;for(t=t.expirationTimes;0<i;){var f=31-xa(i),v=1<<f;e[f]=0,l[f]=-1,t[f]=-1,i&=~v}}function V0(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var l=31-xa(i),f=1<<l;f&e|t[l]&e&&(t[l]|=e),i&=~f}}var Bn=0;function c2(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var u2,$0,h2,d2,f2,Tx=!1,cg=[],eu=null,tu=null,nu=null,Rp=new Map,Lp=new Map,Vc=[],BR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nT(t,e){switch(t){case"focusin":case"focusout":eu=null;break;case"dragenter":case"dragleave":tu=null;break;case"mouseover":case"mouseout":nu=null;break;case"pointerover":case"pointerout":Rp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lp.delete(e.pointerId)}}function Hf(t,e,i,l,f,v){return t===null||t.nativeEvent!==v?(t={blockedOn:e,domEventName:i,eventSystemFlags:l,nativeEvent:v,targetContainers:[f]},e!==null&&(e=rm(e),e!==null&&$0(e)),t):(t.eventSystemFlags|=l,e=t.targetContainers,f!==null&&e.indexOf(f)===-1&&e.push(f),t)}function FR(t,e,i,l,f){switch(e){case"focusin":return eu=Hf(eu,t,e,i,l,f),!0;case"dragenter":return tu=Hf(tu,t,e,i,l,f),!0;case"mouseover":return nu=Hf(nu,t,e,i,l,f),!0;case"pointerover":var v=f.pointerId;return Rp.set(v,Hf(Rp.get(v)||null,t,e,i,l,f)),!0;case"gotpointercapture":return v=f.pointerId,Lp.set(v,Hf(Lp.get(v)||null,t,e,i,l,f)),!0}return!1}function p2(t){var e=eh(t.target);if(e!==null){var i=_h(e);if(i!==null){if(e=i.tag,e===13){if(e=n2(i),e!==null){t.blockedOn=e,f2(t.priority,function(){h2(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Mg(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=Sx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var l=new i.constructor(i.type,i);yx=l,i.target.dispatchEvent(l),yx=null}else return e=rm(i),e!==null&&$0(e),t.blockedOn=i,!1;e.shift()}return!0}function rT(t,e,i){Mg(t)&&i.delete(e)}function UR(){Tx=!1,eu!==null&&Mg(eu)&&(eu=null),tu!==null&&Mg(tu)&&(tu=null),nu!==null&&Mg(nu)&&(nu=null),Rp.forEach(rT),Lp.forEach(rT)}function Kf(t,e){t.blockedOn===e&&(t.blockedOn=null,Tx||(Tx=!0,ho.unstable_scheduleCallback(ho.unstable_NormalPriority,UR)))}function zp(t){function e(f){return Kf(f,t)}if(0<cg.length){Kf(cg[0],t);for(var i=1;i<cg.length;i++){var l=cg[i];l.blockedOn===t&&(l.blockedOn=null)}}for(eu!==null&&Kf(eu,t),tu!==null&&Kf(tu,t),nu!==null&&Kf(nu,t),Rp.forEach(e),Lp.forEach(e),i=0;i<Vc.length;i++)l=Vc[i],l.blockedOn===t&&(l.blockedOn=null);for(;0<Vc.length&&(i=Vc[0],i.blockedOn===null);)p2(i),i.blockedOn===null&&Vc.shift()}var Md=ic.ReactCurrentBatchConfig,s_=!0;function VR(t,e,i,l){var f=Bn,v=Md.transition;Md.transition=null;try{Bn=1,Z0(t,e,i,l)}finally{Bn=f,Md.transition=v}}function $R(t,e,i,l){var f=Bn,v=Md.transition;Md.transition=null;try{Bn=4,Z0(t,e,i,l)}finally{Bn=f,Md.transition=v}}function Z0(t,e,i,l){if(s_){var f=Sx(t,e,i,l);if(f===null)vv(t,e,l,o_,i),nT(t,l);else if(FR(f,t,e,i,l))l.stopPropagation();else if(nT(t,l),e&4&&-1<BR.indexOf(t)){for(;f!==null;){var v=rm(f);if(v!==null&&u2(v),v=Sx(t,e,i,l),v===null&&vv(t,e,l,o_,i),v===f)break;f=v}f!==null&&l.stopPropagation()}else vv(t,e,l,null,i)}}var o_=null;function Sx(t,e,i,l){if(o_=null,t=F0(l),t=eh(t),t!==null)if(e=_h(t),e===null)t=null;else if(i=e.tag,i===13){if(t=n2(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return o_=t,null}function m2(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(MR()){case U0:return 1;case o2:return 4;case r_:case AR:return 16;case a2:return 536870912;default:return 16}default:return 16}}var Hc=null,G0=null,Ag=null;function g2(){if(Ag)return Ag;var t,e=G0,i=e.length,l,f="value"in Hc?Hc.value:Hc.textContent,v=f.length;for(t=0;t<i&&e[t]===f[t];t++);var g=i-t;for(l=1;l<=g&&e[i-l]===f[v-l];l++);return Ag=f.slice(t,1<l?1-l:void 0)}function Rg(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ug(){return!0}function iT(){return!1}function po(t){function e(i,l,f,v,g){this._reactName=i,this._targetInst=f,this.type=l,this.nativeEvent=v,this.target=g,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(i=t[c],this[c]=i?i(v):v[c]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?ug:iT,this.isPropagationStopped=iT,this}return zr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=ug)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=ug)},persist:function(){},isPersistent:ug}),e}var Jd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},q0=po(Jd),nm=zr({},Jd,{view:0,detail:0}),ZR=po(nm),uv,hv,Xf,O_=zr({},nm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:W0,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Xf&&(Xf&&t.type==="mousemove"?(uv=t.screenX-Xf.screenX,hv=t.screenY-Xf.screenY):hv=uv=0,Xf=t),uv)},movementY:function(t){return"movementY"in t?t.movementY:hv}}),sT=po(O_),GR=zr({},O_,{dataTransfer:0}),qR=po(GR),WR=zr({},nm,{relatedTarget:0}),dv=po(WR),HR=zr({},Jd,{animationName:0,elapsedTime:0,pseudoElement:0}),KR=po(HR),XR=zr({},Jd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),YR=po(XR),JR=zr({},Jd,{data:0}),oT=po(JR),QR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nL(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=tL[t])?!!e[t]:!1}function W0(){return nL}var rL=zr({},nm,{key:function(t){if(t.key){var e=QR[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Rg(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?eL[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:W0,charCode:function(t){return t.type==="keypress"?Rg(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Rg(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),iL=po(rL),sL=zr({},O_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),aT=po(sL),oL=zr({},nm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:W0}),aL=po(oL),lL=zr({},Jd,{propertyName:0,elapsedTime:0,pseudoElement:0}),cL=po(lL),uL=zr({},O_,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),hL=po(uL),dL=[9,13,27,32],H0=Yl&&"CompositionEvent"in window,pp=null;Yl&&"documentMode"in document&&(pp=document.documentMode);var fL=Yl&&"TextEvent"in window&&!pp,_2=Yl&&(!H0||pp&&8<pp&&11>=pp),lT=" ",cT=!1;function y2(t,e){switch(t){case"keyup":return dL.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function v2(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var gd=!1;function pL(t,e){switch(t){case"compositionend":return v2(e);case"keypress":return e.which!==32?null:(cT=!0,lT);case"textInput":return t=e.data,t===lT&&cT?null:t;default:return null}}function mL(t,e){if(gd)return t==="compositionend"||!H0&&y2(t,e)?(t=g2(),Ag=G0=Hc=null,gd=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return _2&&e.locale!=="ko"?null:e.data;default:return null}}var gL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!gL[t.type]:e==="textarea"}function x2(t,e,i,l){YP(l),e=a_(e,"onChange"),0<e.length&&(i=new q0("onChange","change",null,i,l),t.push({event:i,listeners:e}))}var mp=null,Dp=null;function _L(t){A2(t,0)}function j_(t){var e=vd(t);if(ZP(e))return t}function yL(t,e){if(t==="change")return e}var b2=!1;if(Yl){var fv;if(Yl){var pv="oninput"in document;if(!pv){var hT=document.createElement("div");hT.setAttribute("oninput","return;"),pv=typeof hT.oninput=="function"}fv=pv}else fv=!1;b2=fv&&(!document.documentMode||9<document.documentMode)}function dT(){mp&&(mp.detachEvent("onpropertychange",w2),Dp=mp=null)}function w2(t){if(t.propertyName==="value"&&j_(Dp)){var e=[];x2(e,Dp,t,F0(t)),t2(_L,e)}}function vL(t,e,i){t==="focusin"?(dT(),mp=e,Dp=i,mp.attachEvent("onpropertychange",w2)):t==="focusout"&&dT()}function xL(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return j_(Dp)}function bL(t,e){if(t==="click")return j_(e)}function wL(t,e){if(t==="input"||t==="change")return j_(e)}function TL(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var wa=typeof Object.is=="function"?Object.is:TL;function Np(t,e){if(wa(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),l=Object.keys(e);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var f=i[l];if(!ox.call(e,f)||!wa(t[f],e[f]))return!1}return!0}function fT(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function pT(t,e){var i=fT(t);t=0;for(var l;i;){if(i.nodeType===3){if(l=t+i.textContent.length,t<=e&&l>=e)return{node:i,offset:e-t};t=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=fT(i)}}function T2(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?T2(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function S2(){for(var t=window,e=e_();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=e_(t.document)}return e}function K0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function SL(t){var e=S2(),i=t.focusedElem,l=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&T2(i.ownerDocument.documentElement,i)){if(l!==null&&K0(i)){if(e=l.start,t=l.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var f=i.textContent.length,v=Math.min(l.start,f);l=l.end===void 0?v:Math.min(l.end,f),!t.extend&&v>l&&(f=l,l=v,v=f),f=pT(i,v);var g=pT(i,l);f&&g&&(t.rangeCount!==1||t.anchorNode!==f.node||t.anchorOffset!==f.offset||t.focusNode!==g.node||t.focusOffset!==g.offset)&&(e=e.createRange(),e.setStart(f.node,f.offset),t.removeAllRanges(),v>l?(t.addRange(e),t.extend(g.node,g.offset)):(e.setEnd(g.node,g.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var PL=Yl&&"documentMode"in document&&11>=document.documentMode,_d=null,Px=null,gp=null,Ex=!1;function mT(t,e,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Ex||_d==null||_d!==e_(l)||(l=_d,"selectionStart"in l&&K0(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),gp&&Np(gp,l)||(gp=l,l=a_(Px,"onSelect"),0<l.length&&(e=new q0("onSelect","select",null,e,i),t.push({event:e,listeners:l}),e.target=_d)))}function hg(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var yd={animationend:hg("Animation","AnimationEnd"),animationiteration:hg("Animation","AnimationIteration"),animationstart:hg("Animation","AnimationStart"),transitionend:hg("Transition","TransitionEnd")},mv={},P2={};Yl&&(P2=document.createElement("div").style,"AnimationEvent"in window||(delete yd.animationend.animation,delete yd.animationiteration.animation,delete yd.animationstart.animation),"TransitionEvent"in window||delete yd.transitionend.transition);function B_(t){if(mv[t])return mv[t];if(!yd[t])return t;var e=yd[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in P2)return mv[t]=e[i];return t}var E2=B_("animationend"),C2=B_("animationiteration"),I2=B_("animationstart"),k2=B_("transitionend"),M2=new Map,gT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _u(t,e){M2.set(t,e),gh(e,[t])}for(var gv=0;gv<gT.length;gv++){var _v=gT[gv],EL=_v.toLowerCase(),CL=_v[0].toUpperCase()+_v.slice(1);_u(EL,"on"+CL)}_u(E2,"onAnimationEnd");_u(C2,"onAnimationIteration");_u(I2,"onAnimationStart");_u("dblclick","onDoubleClick");_u("focusin","onFocus");_u("focusout","onBlur");_u(k2,"onTransitionEnd");Bd("onMouseEnter",["mouseout","mouseover"]);Bd("onMouseLeave",["mouseout","mouseover"]);Bd("onPointerEnter",["pointerout","pointerover"]);Bd("onPointerLeave",["pointerout","pointerover"]);gh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));gh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));gh("onBeforeInput",["compositionend","keypress","textInput","paste"]);gh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));gh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));gh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),IL=new Set("cancel close invalid load scroll toggle".split(" ").concat(lp));function _T(t,e,i){var l=t.type||"unknown-event";t.currentTarget=i,ER(l,e,void 0,t),t.currentTarget=null}function A2(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var l=t[i],f=l.event;l=l.listeners;e:{var v=void 0;if(e)for(var g=l.length-1;0<=g;g--){var c=l[g],A=c.instance,N=c.currentTarget;if(c=c.listener,A!==v&&f.isPropagationStopped())break e;_T(f,c,N),v=A}else for(g=0;g<l.length;g++){if(c=l[g],A=c.instance,N=c.currentTarget,c=c.listener,A!==v&&f.isPropagationStopped())break e;_T(f,c,N),v=A}}}if(n_)throw t=bx,n_=!1,bx=null,t}function ur(t,e){var i=e[Ax];i===void 0&&(i=e[Ax]=new Set);var l=t+"__bubble";i.has(l)||(R2(e,t,2,!1),i.add(l))}function yv(t,e,i){var l=0;e&&(l|=4),R2(i,t,l,e)}var dg="_reactListening"+Math.random().toString(36).slice(2);function Op(t){if(!t[dg]){t[dg]=!0,BP.forEach(function(i){i!=="selectionchange"&&(IL.has(i)||yv(i,!1,t),yv(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[dg]||(e[dg]=!0,yv("selectionchange",!1,e))}}function R2(t,e,i,l){switch(m2(e)){case 1:var f=VR;break;case 4:f=$R;break;default:f=Z0}i=f.bind(null,e,i,t),f=void 0,!xx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(f=!0),l?f!==void 0?t.addEventListener(e,i,{capture:!0,passive:f}):t.addEventListener(e,i,!0):f!==void 0?t.addEventListener(e,i,{passive:f}):t.addEventListener(e,i,!1)}function vv(t,e,i,l,f){var v=l;if(!(e&1)&&!(e&2)&&l!==null)e:for(;;){if(l===null)return;var g=l.tag;if(g===3||g===4){var c=l.stateNode.containerInfo;if(c===f||c.nodeType===8&&c.parentNode===f)break;if(g===4)for(g=l.return;g!==null;){var A=g.tag;if((A===3||A===4)&&(A=g.stateNode.containerInfo,A===f||A.nodeType===8&&A.parentNode===f))return;g=g.return}for(;c!==null;){if(g=eh(c),g===null)return;if(A=g.tag,A===5||A===6){l=v=g;continue e}c=c.parentNode}}l=l.return}t2(function(){var N=v,Z=F0(i),W=[];e:{var K=M2.get(t);if(K!==void 0){var J=q0,ce=t;switch(t){case"keypress":if(Rg(i)===0)break e;case"keydown":case"keyup":J=iL;break;case"focusin":ce="focus",J=dv;break;case"focusout":ce="blur",J=dv;break;case"beforeblur":case"afterblur":J=dv;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":J=sT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":J=qR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":J=aL;break;case E2:case C2:case I2:J=KR;break;case k2:J=cL;break;case"scroll":J=ZR;break;case"wheel":J=hL;break;case"copy":case"cut":case"paste":J=YR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":J=aT}var ie=(e&4)!==0,oe=!ie&&t==="scroll",re=ie?K!==null?K+"Capture":null:K;ie=[];for(var $=N,te;$!==null;){te=$;var fe=te.stateNode;if(te.tag===5&&fe!==null&&(te=fe,re!==null&&(fe=Ap($,re),fe!=null&&ie.push(jp($,fe,te)))),oe)break;$=$.return}0<ie.length&&(K=new J(K,ce,null,i,Z),W.push({event:K,listeners:ie}))}}if(!(e&7)){e:{if(K=t==="mouseover"||t==="pointerover",J=t==="mouseout"||t==="pointerout",K&&i!==yx&&(ce=i.relatedTarget||i.fromElement)&&(eh(ce)||ce[Jl]))break e;if((J||K)&&(K=Z.window===Z?Z:(K=Z.ownerDocument)?K.defaultView||K.parentWindow:window,J?(ce=i.relatedTarget||i.toElement,J=N,ce=ce?eh(ce):null,ce!==null&&(oe=_h(ce),ce!==oe||ce.tag!==5&&ce.tag!==6)&&(ce=null)):(J=null,ce=N),J!==ce)){if(ie=sT,fe="onMouseLeave",re="onMouseEnter",$="mouse",(t==="pointerout"||t==="pointerover")&&(ie=aT,fe="onPointerLeave",re="onPointerEnter",$="pointer"),oe=J==null?K:vd(J),te=ce==null?K:vd(ce),K=new ie(fe,$+"leave",J,i,Z),K.target=oe,K.relatedTarget=te,fe=null,eh(Z)===N&&(ie=new ie(re,$+"enter",ce,i,Z),ie.target=te,ie.relatedTarget=oe,fe=ie),oe=fe,J&&ce)t:{for(ie=J,re=ce,$=0,te=ie;te;te=dd(te))$++;for(te=0,fe=re;fe;fe=dd(fe))te++;for(;0<$-te;)ie=dd(ie),$--;for(;0<te-$;)re=dd(re),te--;for(;$--;){if(ie===re||re!==null&&ie===re.alternate)break t;ie=dd(ie),re=dd(re)}ie=null}else ie=null;J!==null&&yT(W,K,J,ie,!1),ce!==null&&oe!==null&&yT(W,oe,ce,ie,!0)}}e:{if(K=N?vd(N):window,J=K.nodeName&&K.nodeName.toLowerCase(),J==="select"||J==="input"&&K.type==="file")var pe=yL;else if(uT(K))if(b2)pe=wL;else{pe=xL;var Ie=vL}else(J=K.nodeName)&&J.toLowerCase()==="input"&&(K.type==="checkbox"||K.type==="radio")&&(pe=bL);if(pe&&(pe=pe(t,N))){x2(W,pe,i,Z);break e}Ie&&Ie(t,K,N),t==="focusout"&&(Ie=K._wrapperState)&&Ie.controlled&&K.type==="number"&&fx(K,"number",K.value)}switch(Ie=N?vd(N):window,t){case"focusin":(uT(Ie)||Ie.contentEditable==="true")&&(_d=Ie,Px=N,gp=null);break;case"focusout":gp=Px=_d=null;break;case"mousedown":Ex=!0;break;case"contextmenu":case"mouseup":case"dragend":Ex=!1,mT(W,i,Z);break;case"selectionchange":if(PL)break;case"keydown":case"keyup":mT(W,i,Z)}var Ge;if(H0)e:{switch(t){case"compositionstart":var Le="onCompositionStart";break e;case"compositionend":Le="onCompositionEnd";break e;case"compositionupdate":Le="onCompositionUpdate";break e}Le=void 0}else gd?y2(t,i)&&(Le="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(Le="onCompositionStart");Le&&(_2&&i.locale!=="ko"&&(gd||Le!=="onCompositionStart"?Le==="onCompositionEnd"&&gd&&(Ge=g2()):(Hc=Z,G0="value"in Hc?Hc.value:Hc.textContent,gd=!0)),Ie=a_(N,Le),0<Ie.length&&(Le=new oT(Le,t,null,i,Z),W.push({event:Le,listeners:Ie}),Ge?Le.data=Ge:(Ge=v2(i),Ge!==null&&(Le.data=Ge)))),(Ge=fL?pL(t,i):mL(t,i))&&(N=a_(N,"onBeforeInput"),0<N.length&&(Z=new oT("onBeforeInput","beforeinput",null,i,Z),W.push({event:Z,listeners:N}),Z.data=Ge))}A2(W,e)})}function jp(t,e,i){return{instance:t,listener:e,currentTarget:i}}function a_(t,e){for(var i=e+"Capture",l=[];t!==null;){var f=t,v=f.stateNode;f.tag===5&&v!==null&&(f=v,v=Ap(t,i),v!=null&&l.unshift(jp(t,v,f)),v=Ap(t,e),v!=null&&l.push(jp(t,v,f))),t=t.return}return l}function dd(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function yT(t,e,i,l,f){for(var v=e._reactName,g=[];i!==null&&i!==l;){var c=i,A=c.alternate,N=c.stateNode;if(A!==null&&A===l)break;c.tag===5&&N!==null&&(c=N,f?(A=Ap(i,v),A!=null&&g.unshift(jp(i,A,c))):f||(A=Ap(i,v),A!=null&&g.push(jp(i,A,c)))),i=i.return}g.length!==0&&t.push({event:e,listeners:g})}var kL=/\r\n?/g,ML=/\u0000|\uFFFD/g;function vT(t){return(typeof t=="string"?t:""+t).replace(kL,`
`).replace(ML,"")}function fg(t,e,i){if(e=vT(e),vT(t)!==e&&i)throw Error(mt(425))}function l_(){}var Cx=null,Ix=null;function kx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Mx=typeof setTimeout=="function"?setTimeout:void 0,AL=typeof clearTimeout=="function"?clearTimeout:void 0,xT=typeof Promise=="function"?Promise:void 0,RL=typeof queueMicrotask=="function"?queueMicrotask:typeof xT<"u"?function(t){return xT.resolve(null).then(t).catch(LL)}:Mx;function LL(t){setTimeout(function(){throw t})}function xv(t,e){var i=e,l=0;do{var f=i.nextSibling;if(t.removeChild(i),f&&f.nodeType===8)if(i=f.data,i==="/$"){if(l===0){t.removeChild(f),zp(e);return}l--}else i!=="$"&&i!=="$?"&&i!=="$!"||l++;i=f}while(i);zp(e)}function ru(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function bT(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var Qd=Math.random().toString(36).slice(2),ul="__reactFiber$"+Qd,Bp="__reactProps$"+Qd,Jl="__reactContainer$"+Qd,Ax="__reactEvents$"+Qd,zL="__reactListeners$"+Qd,DL="__reactHandles$"+Qd;function eh(t){var e=t[ul];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Jl]||i[ul]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=bT(t);t!==null;){if(i=t[ul])return i;t=bT(t)}return e}t=i,i=t.parentNode}return null}function rm(t){return t=t[ul]||t[Jl],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function vd(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(mt(33))}function F_(t){return t[Bp]||null}var Rx=[],xd=-1;function yu(t){return{current:t}}function hr(t){0>xd||(t.current=Rx[xd],Rx[xd]=null,xd--)}function rr(t,e){xd++,Rx[xd]=t.current,t.current=e}var pu={},ns=yu(pu),Bs=yu(!1),ch=pu;function Fd(t,e){var i=t.type.contextTypes;if(!i)return pu;var l=t.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===e)return l.__reactInternalMemoizedMaskedChildContext;var f={},v;for(v in i)f[v]=e[v];return l&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=f),f}function Fs(t){return t=t.childContextTypes,t!=null}function c_(){hr(Bs),hr(ns)}function wT(t,e,i){if(ns.current!==pu)throw Error(mt(168));rr(ns,e),rr(Bs,i)}function L2(t,e,i){var l=t.stateNode;if(e=e.childContextTypes,typeof l.getChildContext!="function")return i;l=l.getChildContext();for(var f in l)if(!(f in e))throw Error(mt(108,vR(t)||"Unknown",f));return zr({},i,l)}function u_(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||pu,ch=ns.current,rr(ns,t),rr(Bs,Bs.current),!0}function TT(t,e,i){var l=t.stateNode;if(!l)throw Error(mt(169));i?(t=L2(t,e,ch),l.__reactInternalMemoizedMergedChildContext=t,hr(Bs),hr(ns),rr(ns,t)):hr(Bs),rr(Bs,i)}var $l=null,U_=!1,bv=!1;function z2(t){$l===null?$l=[t]:$l.push(t)}function NL(t){U_=!0,z2(t)}function vu(){if(!bv&&$l!==null){bv=!0;var t=0,e=Bn;try{var i=$l;for(Bn=1;t<i.length;t++){var l=i[t];do l=l(!0);while(l!==null)}$l=null,U_=!1}catch(f){throw $l!==null&&($l=$l.slice(t+1)),s2(U0,vu),f}finally{Bn=e,bv=!1}}return null}var bd=[],wd=0,h_=null,d_=0,Mo=[],Ao=0,uh=null,Gl=1,ql="";function Yu(t,e){bd[wd++]=d_,bd[wd++]=h_,h_=t,d_=e}function D2(t,e,i){Mo[Ao++]=Gl,Mo[Ao++]=ql,Mo[Ao++]=uh,uh=t;var l=Gl;t=ql;var f=32-xa(l)-1;l&=~(1<<f),i+=1;var v=32-xa(e)+f;if(30<v){var g=f-f%5;v=(l&(1<<g)-1).toString(32),l>>=g,f-=g,Gl=1<<32-xa(e)+f|i<<f|l,ql=v+t}else Gl=1<<v|i<<f|l,ql=t}function X0(t){t.return!==null&&(Yu(t,1),D2(t,1,0))}function Y0(t){for(;t===h_;)h_=bd[--wd],bd[wd]=null,d_=bd[--wd],bd[wd]=null;for(;t===uh;)uh=Mo[--Ao],Mo[Ao]=null,ql=Mo[--Ao],Mo[Ao]=null,Gl=Mo[--Ao],Mo[Ao]=null}var co=null,lo=null,vr=!1,_a=null;function N2(t,e){var i=Lo(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function ST(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,co=t,lo=ru(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,co=t,lo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=uh!==null?{id:Gl,overflow:ql}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=Lo(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,co=t,lo=null,!0):!1;default:return!1}}function Lx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function zx(t){if(vr){var e=lo;if(e){var i=e;if(!ST(t,e)){if(Lx(t))throw Error(mt(418));e=ru(i.nextSibling);var l=co;e&&ST(t,e)?N2(l,i):(t.flags=t.flags&-4097|2,vr=!1,co=t)}}else{if(Lx(t))throw Error(mt(418));t.flags=t.flags&-4097|2,vr=!1,co=t}}}function PT(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;co=t}function pg(t){if(t!==co)return!1;if(!vr)return PT(t),vr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!kx(t.type,t.memoizedProps)),e&&(e=lo)){if(Lx(t))throw O2(),Error(mt(418));for(;e;)N2(t,e),e=ru(e.nextSibling)}if(PT(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(mt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){lo=ru(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}lo=null}}else lo=co?ru(t.stateNode.nextSibling):null;return!0}function O2(){for(var t=lo;t;)t=ru(t.nextSibling)}function Ud(){lo=co=null,vr=!1}function J0(t){_a===null?_a=[t]:_a.push(t)}var OL=ic.ReactCurrentBatchConfig;function Yf(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(mt(309));var l=i.stateNode}if(!l)throw Error(mt(147,t));var f=l,v=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===v?e.ref:(e=function(g){var c=f.refs;g===null?delete c[v]:c[v]=g},e._stringRef=v,e)}if(typeof t!="string")throw Error(mt(284));if(!i._owner)throw Error(mt(290,t))}return t}function mg(t,e){throw t=Object.prototype.toString.call(e),Error(mt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ET(t){var e=t._init;return e(t._payload)}function j2(t){function e(re,$){if(t){var te=re.deletions;te===null?(re.deletions=[$],re.flags|=16):te.push($)}}function i(re,$){if(!t)return null;for(;$!==null;)e(re,$),$=$.sibling;return null}function l(re,$){for(re=new Map;$!==null;)$.key!==null?re.set($.key,$):re.set($.index,$),$=$.sibling;return re}function f(re,$){return re=au(re,$),re.index=0,re.sibling=null,re}function v(re,$,te){return re.index=te,t?(te=re.alternate,te!==null?(te=te.index,te<$?(re.flags|=2,$):te):(re.flags|=2,$)):(re.flags|=1048576,$)}function g(re){return t&&re.alternate===null&&(re.flags|=2),re}function c(re,$,te,fe){return $===null||$.tag!==6?($=Iv(te,re.mode,fe),$.return=re,$):($=f($,te),$.return=re,$)}function A(re,$,te,fe){var pe=te.type;return pe===md?Z(re,$,te.props.children,fe,te.key):$!==null&&($.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===Fc&&ET(pe)===$.type)?(fe=f($,te.props),fe.ref=Yf(re,$,te),fe.return=re,fe):(fe=Bg(te.type,te.key,te.props,null,re.mode,fe),fe.ref=Yf(re,$,te),fe.return=re,fe)}function N(re,$,te,fe){return $===null||$.tag!==4||$.stateNode.containerInfo!==te.containerInfo||$.stateNode.implementation!==te.implementation?($=kv(te,re.mode,fe),$.return=re,$):($=f($,te.children||[]),$.return=re,$)}function Z(re,$,te,fe,pe){return $===null||$.tag!==7?($=sh(te,re.mode,fe,pe),$.return=re,$):($=f($,te),$.return=re,$)}function W(re,$,te){if(typeof $=="string"&&$!==""||typeof $=="number")return $=Iv(""+$,re.mode,te),$.return=re,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case ig:return te=Bg($.type,$.key,$.props,null,re.mode,te),te.ref=Yf(re,null,$),te.return=re,te;case pd:return $=kv($,re.mode,te),$.return=re,$;case Fc:var fe=$._init;return W(re,fe($._payload),te)}if(op($)||qf($))return $=sh($,re.mode,te,null),$.return=re,$;mg(re,$)}return null}function K(re,$,te,fe){var pe=$!==null?$.key:null;if(typeof te=="string"&&te!==""||typeof te=="number")return pe!==null?null:c(re,$,""+te,fe);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case ig:return te.key===pe?A(re,$,te,fe):null;case pd:return te.key===pe?N(re,$,te,fe):null;case Fc:return pe=te._init,K(re,$,pe(te._payload),fe)}if(op(te)||qf(te))return pe!==null?null:Z(re,$,te,fe,null);mg(re,te)}return null}function J(re,$,te,fe,pe){if(typeof fe=="string"&&fe!==""||typeof fe=="number")return re=re.get(te)||null,c($,re,""+fe,pe);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case ig:return re=re.get(fe.key===null?te:fe.key)||null,A($,re,fe,pe);case pd:return re=re.get(fe.key===null?te:fe.key)||null,N($,re,fe,pe);case Fc:var Ie=fe._init;return J(re,$,te,Ie(fe._payload),pe)}if(op(fe)||qf(fe))return re=re.get(te)||null,Z($,re,fe,pe,null);mg($,fe)}return null}function ce(re,$,te,fe){for(var pe=null,Ie=null,Ge=$,Le=$=0,xt=null;Ge!==null&&Le<te.length;Le++){Ge.index>Le?(xt=Ge,Ge=null):xt=Ge.sibling;var ct=K(re,Ge,te[Le],fe);if(ct===null){Ge===null&&(Ge=xt);break}t&&Ge&&ct.alternate===null&&e(re,Ge),$=v(ct,$,Le),Ie===null?pe=ct:Ie.sibling=ct,Ie=ct,Ge=xt}if(Le===te.length)return i(re,Ge),vr&&Yu(re,Le),pe;if(Ge===null){for(;Le<te.length;Le++)Ge=W(re,te[Le],fe),Ge!==null&&($=v(Ge,$,Le),Ie===null?pe=Ge:Ie.sibling=Ge,Ie=Ge);return vr&&Yu(re,Le),pe}for(Ge=l(re,Ge);Le<te.length;Le++)xt=J(Ge,re,Le,te[Le],fe),xt!==null&&(t&&xt.alternate!==null&&Ge.delete(xt.key===null?Le:xt.key),$=v(xt,$,Le),Ie===null?pe=xt:Ie.sibling=xt,Ie=xt);return t&&Ge.forEach(function(ht){return e(re,ht)}),vr&&Yu(re,Le),pe}function ie(re,$,te,fe){var pe=qf(te);if(typeof pe!="function")throw Error(mt(150));if(te=pe.call(te),te==null)throw Error(mt(151));for(var Ie=pe=null,Ge=$,Le=$=0,xt=null,ct=te.next();Ge!==null&&!ct.done;Le++,ct=te.next()){Ge.index>Le?(xt=Ge,Ge=null):xt=Ge.sibling;var ht=K(re,Ge,ct.value,fe);if(ht===null){Ge===null&&(Ge=xt);break}t&&Ge&&ht.alternate===null&&e(re,Ge),$=v(ht,$,Le),Ie===null?pe=ht:Ie.sibling=ht,Ie=ht,Ge=xt}if(ct.done)return i(re,Ge),vr&&Yu(re,Le),pe;if(Ge===null){for(;!ct.done;Le++,ct=te.next())ct=W(re,ct.value,fe),ct!==null&&($=v(ct,$,Le),Ie===null?pe=ct:Ie.sibling=ct,Ie=ct);return vr&&Yu(re,Le),pe}for(Ge=l(re,Ge);!ct.done;Le++,ct=te.next())ct=J(Ge,re,Le,ct.value,fe),ct!==null&&(t&&ct.alternate!==null&&Ge.delete(ct.key===null?Le:ct.key),$=v(ct,$,Le),Ie===null?pe=ct:Ie.sibling=ct,Ie=ct);return t&&Ge.forEach(function(ze){return e(re,ze)}),vr&&Yu(re,Le),pe}function oe(re,$,te,fe){if(typeof te=="object"&&te!==null&&te.type===md&&te.key===null&&(te=te.props.children),typeof te=="object"&&te!==null){switch(te.$$typeof){case ig:e:{for(var pe=te.key,Ie=$;Ie!==null;){if(Ie.key===pe){if(pe=te.type,pe===md){if(Ie.tag===7){i(re,Ie.sibling),$=f(Ie,te.props.children),$.return=re,re=$;break e}}else if(Ie.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===Fc&&ET(pe)===Ie.type){i(re,Ie.sibling),$=f(Ie,te.props),$.ref=Yf(re,Ie,te),$.return=re,re=$;break e}i(re,Ie);break}else e(re,Ie);Ie=Ie.sibling}te.type===md?($=sh(te.props.children,re.mode,fe,te.key),$.return=re,re=$):(fe=Bg(te.type,te.key,te.props,null,re.mode,fe),fe.ref=Yf(re,$,te),fe.return=re,re=fe)}return g(re);case pd:e:{for(Ie=te.key;$!==null;){if($.key===Ie)if($.tag===4&&$.stateNode.containerInfo===te.containerInfo&&$.stateNode.implementation===te.implementation){i(re,$.sibling),$=f($,te.children||[]),$.return=re,re=$;break e}else{i(re,$);break}else e(re,$);$=$.sibling}$=kv(te,re.mode,fe),$.return=re,re=$}return g(re);case Fc:return Ie=te._init,oe(re,$,Ie(te._payload),fe)}if(op(te))return ce(re,$,te,fe);if(qf(te))return ie(re,$,te,fe);mg(re,te)}return typeof te=="string"&&te!==""||typeof te=="number"?(te=""+te,$!==null&&$.tag===6?(i(re,$.sibling),$=f($,te),$.return=re,re=$):(i(re,$),$=Iv(te,re.mode,fe),$.return=re,re=$),g(re)):i(re,$)}return oe}var Vd=j2(!0),B2=j2(!1),f_=yu(null),p_=null,Td=null,Q0=null;function eb(){Q0=Td=p_=null}function tb(t){var e=f_.current;hr(f_),t._currentValue=e}function Dx(t,e,i){for(;t!==null;){var l=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,l!==null&&(l.childLanes|=e)):l!==null&&(l.childLanes&e)!==e&&(l.childLanes|=e),t===i)break;t=t.return}}function Ad(t,e){p_=t,Q0=Td=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(js=!0),t.firstContext=null)}function No(t){var e=t._currentValue;if(Q0!==t)if(t={context:t,memoizedValue:e,next:null},Td===null){if(p_===null)throw Error(mt(308));Td=t,p_.dependencies={lanes:0,firstContext:t}}else Td=Td.next=t;return e}var th=null;function nb(t){th===null?th=[t]:th.push(t)}function F2(t,e,i,l){var f=e.interleaved;return f===null?(i.next=i,nb(e)):(i.next=f.next,f.next=i),e.interleaved=i,Ql(t,l)}function Ql(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var Uc=!1;function rb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function U2(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Kl(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function iu(t,e,i){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,Pn&2){var f=l.pending;return f===null?e.next=e:(e.next=f.next,f.next=e),l.pending=e,Ql(t,i)}return f=l.interleaved,f===null?(e.next=e,nb(l)):(e.next=f.next,f.next=e),l.interleaved=e,Ql(t,i)}function Lg(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var l=e.lanes;l&=t.pendingLanes,i|=l,e.lanes=i,V0(t,i)}}function CT(t,e){var i=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var f=null,v=null;if(i=i.firstBaseUpdate,i!==null){do{var g={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};v===null?f=v=g:v=v.next=g,i=i.next}while(i!==null);v===null?f=v=e:v=v.next=e}else f=v=e;i={baseState:l.baseState,firstBaseUpdate:f,lastBaseUpdate:v,shared:l.shared,effects:l.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function m_(t,e,i,l){var f=t.updateQueue;Uc=!1;var v=f.firstBaseUpdate,g=f.lastBaseUpdate,c=f.shared.pending;if(c!==null){f.shared.pending=null;var A=c,N=A.next;A.next=null,g===null?v=N:g.next=N,g=A;var Z=t.alternate;Z!==null&&(Z=Z.updateQueue,c=Z.lastBaseUpdate,c!==g&&(c===null?Z.firstBaseUpdate=N:c.next=N,Z.lastBaseUpdate=A))}if(v!==null){var W=f.baseState;g=0,Z=N=A=null,c=v;do{var K=c.lane,J=c.eventTime;if((l&K)===K){Z!==null&&(Z=Z.next={eventTime:J,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var ce=t,ie=c;switch(K=e,J=i,ie.tag){case 1:if(ce=ie.payload,typeof ce=="function"){W=ce.call(J,W,K);break e}W=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=ie.payload,K=typeof ce=="function"?ce.call(J,W,K):ce,K==null)break e;W=zr({},W,K);break e;case 2:Uc=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,K=f.effects,K===null?f.effects=[c]:K.push(c))}else J={eventTime:J,lane:K,tag:c.tag,payload:c.payload,callback:c.callback,next:null},Z===null?(N=Z=J,A=W):Z=Z.next=J,g|=K;if(c=c.next,c===null){if(c=f.shared.pending,c===null)break;K=c,c=K.next,K.next=null,f.lastBaseUpdate=K,f.shared.pending=null}}while(!0);if(Z===null&&(A=W),f.baseState=A,f.firstBaseUpdate=N,f.lastBaseUpdate=Z,e=f.shared.interleaved,e!==null){f=e;do g|=f.lane,f=f.next;while(f!==e)}else v===null&&(f.shared.lanes=0);dh|=g,t.lanes=g,t.memoizedState=W}}function IT(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var l=t[e],f=l.callback;if(f!==null){if(l.callback=null,l=i,typeof f!="function")throw Error(mt(191,f));f.call(l)}}}var im={},pl=yu(im),Fp=yu(im),Up=yu(im);function nh(t){if(t===im)throw Error(mt(174));return t}function ib(t,e){switch(rr(Up,e),rr(Fp,t),rr(pl,im),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:mx(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=mx(e,t)}hr(pl),rr(pl,e)}function $d(){hr(pl),hr(Fp),hr(Up)}function V2(t){nh(Up.current);var e=nh(pl.current),i=mx(e,t.type);e!==i&&(rr(Fp,t),rr(pl,i))}function sb(t){Fp.current===t&&(hr(pl),hr(Fp))}var kr=yu(0);function g_(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var wv=[];function ob(){for(var t=0;t<wv.length;t++)wv[t]._workInProgressVersionPrimary=null;wv.length=0}var zg=ic.ReactCurrentDispatcher,Tv=ic.ReactCurrentBatchConfig,hh=0,Lr=null,gi=null,Ii=null,__=!1,_p=!1,Vp=0,jL=0;function Ji(){throw Error(mt(321))}function ab(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!wa(t[i],e[i]))return!1;return!0}function lb(t,e,i,l,f,v){if(hh=v,Lr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,zg.current=t===null||t.memoizedState===null?VL:$L,t=i(l,f),_p){v=0;do{if(_p=!1,Vp=0,25<=v)throw Error(mt(301));v+=1,Ii=gi=null,e.updateQueue=null,zg.current=ZL,t=i(l,f)}while(_p)}if(zg.current=y_,e=gi!==null&&gi.next!==null,hh=0,Ii=gi=Lr=null,__=!1,e)throw Error(mt(300));return t}function cb(){var t=Vp!==0;return Vp=0,t}function cl(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ii===null?Lr.memoizedState=Ii=t:Ii=Ii.next=t,Ii}function Oo(){if(gi===null){var t=Lr.alternate;t=t!==null?t.memoizedState:null}else t=gi.next;var e=Ii===null?Lr.memoizedState:Ii.next;if(e!==null)Ii=e,gi=t;else{if(t===null)throw Error(mt(310));gi=t,t={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},Ii===null?Lr.memoizedState=Ii=t:Ii=Ii.next=t}return Ii}function $p(t,e){return typeof e=="function"?e(t):e}function Sv(t){var e=Oo(),i=e.queue;if(i===null)throw Error(mt(311));i.lastRenderedReducer=t;var l=gi,f=l.baseQueue,v=i.pending;if(v!==null){if(f!==null){var g=f.next;f.next=v.next,v.next=g}l.baseQueue=f=v,i.pending=null}if(f!==null){v=f.next,l=l.baseState;var c=g=null,A=null,N=v;do{var Z=N.lane;if((hh&Z)===Z)A!==null&&(A=A.next={lane:0,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),l=N.hasEagerState?N.eagerState:t(l,N.action);else{var W={lane:Z,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null};A===null?(c=A=W,g=l):A=A.next=W,Lr.lanes|=Z,dh|=Z}N=N.next}while(N!==null&&N!==v);A===null?g=l:A.next=c,wa(l,e.memoizedState)||(js=!0),e.memoizedState=l,e.baseState=g,e.baseQueue=A,i.lastRenderedState=l}if(t=i.interleaved,t!==null){f=t;do v=f.lane,Lr.lanes|=v,dh|=v,f=f.next;while(f!==t)}else f===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function Pv(t){var e=Oo(),i=e.queue;if(i===null)throw Error(mt(311));i.lastRenderedReducer=t;var l=i.dispatch,f=i.pending,v=e.memoizedState;if(f!==null){i.pending=null;var g=f=f.next;do v=t(v,g.action),g=g.next;while(g!==f);wa(v,e.memoizedState)||(js=!0),e.memoizedState=v,e.baseQueue===null&&(e.baseState=v),i.lastRenderedState=v}return[v,l]}function $2(){}function Z2(t,e){var i=Lr,l=Oo(),f=e(),v=!wa(l.memoizedState,f);if(v&&(l.memoizedState=f,js=!0),l=l.queue,ub(W2.bind(null,i,l,t),[t]),l.getSnapshot!==e||v||Ii!==null&&Ii.memoizedState.tag&1){if(i.flags|=2048,Zp(9,q2.bind(null,i,l,f,e),void 0,null),ki===null)throw Error(mt(349));hh&30||G2(i,e,f)}return f}function G2(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=Lr.updateQueue,e===null?(e={lastEffect:null,stores:null},Lr.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function q2(t,e,i,l){e.value=i,e.getSnapshot=l,H2(e)&&K2(t)}function W2(t,e,i){return i(function(){H2(e)&&K2(t)})}function H2(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!wa(t,i)}catch{return!0}}function K2(t){var e=Ql(t,1);e!==null&&ba(e,t,1,-1)}function kT(t){var e=cl();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$p,lastRenderedState:t},e.queue=t,t=t.dispatch=UL.bind(null,Lr,t),[e.memoizedState,t]}function Zp(t,e,i,l){return t={tag:t,create:e,destroy:i,deps:l,next:null},e=Lr.updateQueue,e===null?(e={lastEffect:null,stores:null},Lr.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(l=i.next,i.next=t,t.next=l,e.lastEffect=t)),t}function X2(){return Oo().memoizedState}function Dg(t,e,i,l){var f=cl();Lr.flags|=t,f.memoizedState=Zp(1|e,i,void 0,l===void 0?null:l)}function V_(t,e,i,l){var f=Oo();l=l===void 0?null:l;var v=void 0;if(gi!==null){var g=gi.memoizedState;if(v=g.destroy,l!==null&&ab(l,g.deps)){f.memoizedState=Zp(e,i,v,l);return}}Lr.flags|=t,f.memoizedState=Zp(1|e,i,v,l)}function MT(t,e){return Dg(8390656,8,t,e)}function ub(t,e){return V_(2048,8,t,e)}function Y2(t,e){return V_(4,2,t,e)}function J2(t,e){return V_(4,4,t,e)}function Q2(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function eE(t,e,i){return i=i!=null?i.concat([t]):null,V_(4,4,Q2.bind(null,e,t),i)}function hb(){}function tE(t,e){var i=Oo();e=e===void 0?null:e;var l=i.memoizedState;return l!==null&&e!==null&&ab(e,l[1])?l[0]:(i.memoizedState=[t,e],t)}function nE(t,e){var i=Oo();e=e===void 0?null:e;var l=i.memoizedState;return l!==null&&e!==null&&ab(e,l[1])?l[0]:(t=t(),i.memoizedState=[t,e],t)}function rE(t,e,i){return hh&21?(wa(i,e)||(i=l2(),Lr.lanes|=i,dh|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,js=!0),t.memoizedState=i)}function BL(t,e){var i=Bn;Bn=i!==0&&4>i?i:4,t(!0);var l=Tv.transition;Tv.transition={};try{t(!1),e()}finally{Bn=i,Tv.transition=l}}function iE(){return Oo().memoizedState}function FL(t,e,i){var l=ou(t);if(i={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null},sE(t))oE(e,i);else if(i=F2(t,e,i,l),i!==null){var f=ys();ba(i,t,l,f),aE(i,e,l)}}function UL(t,e,i){var l=ou(t),f={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null};if(sE(t))oE(e,f);else{var v=t.alternate;if(t.lanes===0&&(v===null||v.lanes===0)&&(v=e.lastRenderedReducer,v!==null))try{var g=e.lastRenderedState,c=v(g,i);if(f.hasEagerState=!0,f.eagerState=c,wa(c,g)){var A=e.interleaved;A===null?(f.next=f,nb(e)):(f.next=A.next,A.next=f),e.interleaved=f;return}}catch{}finally{}i=F2(t,e,f,l),i!==null&&(f=ys(),ba(i,t,l,f),aE(i,e,l))}}function sE(t){var e=t.alternate;return t===Lr||e!==null&&e===Lr}function oE(t,e){_p=__=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function aE(t,e,i){if(i&4194240){var l=e.lanes;l&=t.pendingLanes,i|=l,e.lanes=i,V0(t,i)}}var y_={readContext:No,useCallback:Ji,useContext:Ji,useEffect:Ji,useImperativeHandle:Ji,useInsertionEffect:Ji,useLayoutEffect:Ji,useMemo:Ji,useReducer:Ji,useRef:Ji,useState:Ji,useDebugValue:Ji,useDeferredValue:Ji,useTransition:Ji,useMutableSource:Ji,useSyncExternalStore:Ji,useId:Ji,unstable_isNewReconciler:!1},VL={readContext:No,useCallback:function(t,e){return cl().memoizedState=[t,e===void 0?null:e],t},useContext:No,useEffect:MT,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,Dg(4194308,4,Q2.bind(null,e,t),i)},useLayoutEffect:function(t,e){return Dg(4194308,4,t,e)},useInsertionEffect:function(t,e){return Dg(4,2,t,e)},useMemo:function(t,e){var i=cl();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var l=cl();return e=i!==void 0?i(e):e,l.memoizedState=l.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},l.queue=t,t=t.dispatch=FL.bind(null,Lr,t),[l.memoizedState,t]},useRef:function(t){var e=cl();return t={current:t},e.memoizedState=t},useState:kT,useDebugValue:hb,useDeferredValue:function(t){return cl().memoizedState=t},useTransition:function(){var t=kT(!1),e=t[0];return t=BL.bind(null,t[1]),cl().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var l=Lr,f=cl();if(vr){if(i===void 0)throw Error(mt(407));i=i()}else{if(i=e(),ki===null)throw Error(mt(349));hh&30||G2(l,e,i)}f.memoizedState=i;var v={value:i,getSnapshot:e};return f.queue=v,MT(W2.bind(null,l,v,t),[t]),l.flags|=2048,Zp(9,q2.bind(null,l,v,i,e),void 0,null),i},useId:function(){var t=cl(),e=ki.identifierPrefix;if(vr){var i=ql,l=Gl;i=(l&~(1<<32-xa(l)-1)).toString(32)+i,e=":"+e+"R"+i,i=Vp++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=jL++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},$L={readContext:No,useCallback:tE,useContext:No,useEffect:ub,useImperativeHandle:eE,useInsertionEffect:Y2,useLayoutEffect:J2,useMemo:nE,useReducer:Sv,useRef:X2,useState:function(){return Sv($p)},useDebugValue:hb,useDeferredValue:function(t){var e=Oo();return rE(e,gi.memoizedState,t)},useTransition:function(){var t=Sv($p)[0],e=Oo().memoizedState;return[t,e]},useMutableSource:$2,useSyncExternalStore:Z2,useId:iE,unstable_isNewReconciler:!1},ZL={readContext:No,useCallback:tE,useContext:No,useEffect:ub,useImperativeHandle:eE,useInsertionEffect:Y2,useLayoutEffect:J2,useMemo:nE,useReducer:Pv,useRef:X2,useState:function(){return Pv($p)},useDebugValue:hb,useDeferredValue:function(t){var e=Oo();return gi===null?e.memoizedState=t:rE(e,gi.memoizedState,t)},useTransition:function(){var t=Pv($p)[0],e=Oo().memoizedState;return[t,e]},useMutableSource:$2,useSyncExternalStore:Z2,useId:iE,unstable_isNewReconciler:!1};function fa(t,e){if(t&&t.defaultProps){e=zr({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}function Nx(t,e,i,l){e=t.memoizedState,i=i(l,e),i=i==null?e:zr({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var $_={isMounted:function(t){return(t=t._reactInternals)?_h(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var l=ys(),f=ou(t),v=Kl(l,f);v.payload=e,i!=null&&(v.callback=i),e=iu(t,v,f),e!==null&&(ba(e,t,f,l),Lg(e,t,f))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var l=ys(),f=ou(t),v=Kl(l,f);v.tag=1,v.payload=e,i!=null&&(v.callback=i),e=iu(t,v,f),e!==null&&(ba(e,t,f,l),Lg(e,t,f))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=ys(),l=ou(t),f=Kl(i,l);f.tag=2,e!=null&&(f.callback=e),e=iu(t,f,l),e!==null&&(ba(e,t,l,i),Lg(e,t,l))}};function AT(t,e,i,l,f,v,g){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,v,g):e.prototype&&e.prototype.isPureReactComponent?!Np(i,l)||!Np(f,v):!0}function lE(t,e,i){var l=!1,f=pu,v=e.contextType;return typeof v=="object"&&v!==null?v=No(v):(f=Fs(e)?ch:ns.current,l=e.contextTypes,v=(l=l!=null)?Fd(t,f):pu),e=new e(i,v),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$_,t.stateNode=e,e._reactInternals=t,l&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=f,t.__reactInternalMemoizedMaskedChildContext=v),e}function RT(t,e,i,l){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,l),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,l),e.state!==t&&$_.enqueueReplaceState(e,e.state,null)}function Ox(t,e,i,l){var f=t.stateNode;f.props=i,f.state=t.memoizedState,f.refs={},rb(t);var v=e.contextType;typeof v=="object"&&v!==null?f.context=No(v):(v=Fs(e)?ch:ns.current,f.context=Fd(t,v)),f.state=t.memoizedState,v=e.getDerivedStateFromProps,typeof v=="function"&&(Nx(t,e,v,i),f.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(e=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),e!==f.state&&$_.enqueueReplaceState(f,f.state,null),m_(t,i,f,l),f.state=t.memoizedState),typeof f.componentDidMount=="function"&&(t.flags|=4194308)}function Zd(t,e){try{var i="",l=e;do i+=yR(l),l=l.return;while(l);var f=i}catch(v){f=`
Error generating stack: `+v.message+`
`+v.stack}return{value:t,source:e,stack:f,digest:null}}function Ev(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function jx(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var GL=typeof WeakMap=="function"?WeakMap:Map;function cE(t,e,i){i=Kl(-1,i),i.tag=3,i.payload={element:null};var l=e.value;return i.callback=function(){x_||(x_=!0,Hx=l),jx(t,e)},i}function uE(t,e,i){i=Kl(-1,i),i.tag=3;var l=t.type.getDerivedStateFromError;if(typeof l=="function"){var f=e.value;i.payload=function(){return l(f)},i.callback=function(){jx(t,e)}}var v=t.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(i.callback=function(){jx(t,e),typeof l!="function"&&(su===null?su=new Set([this]):su.add(this));var g=e.stack;this.componentDidCatch(e.value,{componentStack:g!==null?g:""})}),i}function LT(t,e,i){var l=t.pingCache;if(l===null){l=t.pingCache=new GL;var f=new Set;l.set(e,f)}else f=l.get(e),f===void 0&&(f=new Set,l.set(e,f));f.has(i)||(f.add(i),t=sz.bind(null,t,e,i),e.then(t,t))}function zT(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function DT(t,e,i,l,f){return t.mode&1?(t.flags|=65536,t.lanes=f,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=Kl(-1,1),e.tag=2,iu(i,e,1))),i.lanes|=1),t)}var qL=ic.ReactCurrentOwner,js=!1;function gs(t,e,i,l){e.child=t===null?B2(e,null,i,l):Vd(e,t.child,i,l)}function NT(t,e,i,l,f){i=i.render;var v=e.ref;return Ad(e,f),l=lb(t,e,i,l,v,f),i=cb(),t!==null&&!js?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~f,ec(t,e,f)):(vr&&i&&X0(e),e.flags|=1,gs(t,e,l,f),e.child)}function OT(t,e,i,l,f){if(t===null){var v=i.type;return typeof v=="function"&&!vb(v)&&v.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=v,hE(t,e,v,l,f)):(t=Bg(i.type,null,l,e,e.mode,f),t.ref=e.ref,t.return=e,e.child=t)}if(v=t.child,!(t.lanes&f)){var g=v.memoizedProps;if(i=i.compare,i=i!==null?i:Np,i(g,l)&&t.ref===e.ref)return ec(t,e,f)}return e.flags|=1,t=au(v,l),t.ref=e.ref,t.return=e,e.child=t}function hE(t,e,i,l,f){if(t!==null){var v=t.memoizedProps;if(Np(v,l)&&t.ref===e.ref)if(js=!1,e.pendingProps=l=v,(t.lanes&f)!==0)t.flags&131072&&(js=!0);else return e.lanes=t.lanes,ec(t,e,f)}return Bx(t,e,i,l,f)}function dE(t,e,i){var l=e.pendingProps,f=l.children,v=t!==null?t.memoizedState:null;if(l.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},rr(Pd,ao),ao|=i;else{if(!(i&1073741824))return t=v!==null?v.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,rr(Pd,ao),ao|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=v!==null?v.baseLanes:i,rr(Pd,ao),ao|=l}else v!==null?(l=v.baseLanes|i,e.memoizedState=null):l=i,rr(Pd,ao),ao|=l;return gs(t,e,f,i),e.child}function fE(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function Bx(t,e,i,l,f){var v=Fs(i)?ch:ns.current;return v=Fd(e,v),Ad(e,f),i=lb(t,e,i,l,v,f),l=cb(),t!==null&&!js?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~f,ec(t,e,f)):(vr&&l&&X0(e),e.flags|=1,gs(t,e,i,f),e.child)}function jT(t,e,i,l,f){if(Fs(i)){var v=!0;u_(e)}else v=!1;if(Ad(e,f),e.stateNode===null)Ng(t,e),lE(e,i,l),Ox(e,i,l,f),l=!0;else if(t===null){var g=e.stateNode,c=e.memoizedProps;g.props=c;var A=g.context,N=i.contextType;typeof N=="object"&&N!==null?N=No(N):(N=Fs(i)?ch:ns.current,N=Fd(e,N));var Z=i.getDerivedStateFromProps,W=typeof Z=="function"||typeof g.getSnapshotBeforeUpdate=="function";W||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(c!==l||A!==N)&&RT(e,g,l,N),Uc=!1;var K=e.memoizedState;g.state=K,m_(e,l,g,f),A=e.memoizedState,c!==l||K!==A||Bs.current||Uc?(typeof Z=="function"&&(Nx(e,i,Z,l),A=e.memoizedState),(c=Uc||AT(e,i,c,l,K,A,N))?(W||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(e.flags|=4194308)):(typeof g.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=l,e.memoizedState=A),g.props=l,g.state=A,g.context=N,l=c):(typeof g.componentDidMount=="function"&&(e.flags|=4194308),l=!1)}else{g=e.stateNode,U2(t,e),c=e.memoizedProps,N=e.type===e.elementType?c:fa(e.type,c),g.props=N,W=e.pendingProps,K=g.context,A=i.contextType,typeof A=="object"&&A!==null?A=No(A):(A=Fs(i)?ch:ns.current,A=Fd(e,A));var J=i.getDerivedStateFromProps;(Z=typeof J=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(c!==W||K!==A)&&RT(e,g,l,A),Uc=!1,K=e.memoizedState,g.state=K,m_(e,l,g,f);var ce=e.memoizedState;c!==W||K!==ce||Bs.current||Uc?(typeof J=="function"&&(Nx(e,i,J,l),ce=e.memoizedState),(N=Uc||AT(e,i,N,l,K,ce,A)||!1)?(Z||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(l,ce,A),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(l,ce,A)),typeof g.componentDidUpdate=="function"&&(e.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof g.componentDidUpdate!="function"||c===t.memoizedProps&&K===t.memoizedState||(e.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&K===t.memoizedState||(e.flags|=1024),e.memoizedProps=l,e.memoizedState=ce),g.props=l,g.state=ce,g.context=A,l=N):(typeof g.componentDidUpdate!="function"||c===t.memoizedProps&&K===t.memoizedState||(e.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&K===t.memoizedState||(e.flags|=1024),l=!1)}return Fx(t,e,i,l,v,f)}function Fx(t,e,i,l,f,v){fE(t,e);var g=(e.flags&128)!==0;if(!l&&!g)return f&&TT(e,i,!1),ec(t,e,v);l=e.stateNode,qL.current=e;var c=g&&typeof i.getDerivedStateFromError!="function"?null:l.render();return e.flags|=1,t!==null&&g?(e.child=Vd(e,t.child,null,v),e.child=Vd(e,null,c,v)):gs(t,e,c,v),e.memoizedState=l.state,f&&TT(e,i,!0),e.child}function pE(t){var e=t.stateNode;e.pendingContext?wT(t,e.pendingContext,e.pendingContext!==e.context):e.context&&wT(t,e.context,!1),ib(t,e.containerInfo)}function BT(t,e,i,l,f){return Ud(),J0(f),e.flags|=256,gs(t,e,i,l),e.child}var Ux={dehydrated:null,treeContext:null,retryLane:0};function Vx(t){return{baseLanes:t,cachePool:null,transitions:null}}function mE(t,e,i){var l=e.pendingProps,f=kr.current,v=!1,g=(e.flags&128)!==0,c;if((c=g)||(c=t!==null&&t.memoizedState===null?!1:(f&2)!==0),c?(v=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(f|=1),rr(kr,f&1),t===null)return zx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(g=l.children,t=l.fallback,v?(l=e.mode,v=e.child,g={mode:"hidden",children:g},!(l&1)&&v!==null?(v.childLanes=0,v.pendingProps=g):v=q_(g,l,0,null),t=sh(t,l,i,null),v.return=e,t.return=e,v.sibling=t,e.child=v,e.child.memoizedState=Vx(i),e.memoizedState=Ux,t):db(e,g));if(f=t.memoizedState,f!==null&&(c=f.dehydrated,c!==null))return WL(t,e,g,l,c,f,i);if(v){v=l.fallback,g=e.mode,f=t.child,c=f.sibling;var A={mode:"hidden",children:l.children};return!(g&1)&&e.child!==f?(l=e.child,l.childLanes=0,l.pendingProps=A,e.deletions=null):(l=au(f,A),l.subtreeFlags=f.subtreeFlags&14680064),c!==null?v=au(c,v):(v=sh(v,g,i,null),v.flags|=2),v.return=e,l.return=e,l.sibling=v,e.child=l,l=v,v=e.child,g=t.child.memoizedState,g=g===null?Vx(i):{baseLanes:g.baseLanes|i,cachePool:null,transitions:g.transitions},v.memoizedState=g,v.childLanes=t.childLanes&~i,e.memoizedState=Ux,l}return v=t.child,t=v.sibling,l=au(v,{mode:"visible",children:l.children}),!(e.mode&1)&&(l.lanes=i),l.return=e,l.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=l,e.memoizedState=null,l}function db(t,e){return e=q_({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function gg(t,e,i,l){return l!==null&&J0(l),Vd(e,t.child,null,i),t=db(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function WL(t,e,i,l,f,v,g){if(i)return e.flags&256?(e.flags&=-257,l=Ev(Error(mt(422))),gg(t,e,g,l)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(v=l.fallback,f=e.mode,l=q_({mode:"visible",children:l.children},f,0,null),v=sh(v,f,g,null),v.flags|=2,l.return=e,v.return=e,l.sibling=v,e.child=l,e.mode&1&&Vd(e,t.child,null,g),e.child.memoizedState=Vx(g),e.memoizedState=Ux,v);if(!(e.mode&1))return gg(t,e,g,null);if(f.data==="$!"){if(l=f.nextSibling&&f.nextSibling.dataset,l)var c=l.dgst;return l=c,v=Error(mt(419)),l=Ev(v,l,void 0),gg(t,e,g,l)}if(c=(g&t.childLanes)!==0,js||c){if(l=ki,l!==null){switch(g&-g){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=f&(l.suspendedLanes|g)?0:f,f!==0&&f!==v.retryLane&&(v.retryLane=f,Ql(t,f),ba(l,t,f,-1))}return yb(),l=Ev(Error(mt(421))),gg(t,e,g,l)}return f.data==="$?"?(e.flags|=128,e.child=t.child,e=oz.bind(null,t),f._reactRetry=e,null):(t=v.treeContext,lo=ru(f.nextSibling),co=e,vr=!0,_a=null,t!==null&&(Mo[Ao++]=Gl,Mo[Ao++]=ql,Mo[Ao++]=uh,Gl=t.id,ql=t.overflow,uh=e),e=db(e,l.children),e.flags|=4096,e)}function FT(t,e,i){t.lanes|=e;var l=t.alternate;l!==null&&(l.lanes|=e),Dx(t.return,e,i)}function Cv(t,e,i,l,f){var v=t.memoizedState;v===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:f}:(v.isBackwards=e,v.rendering=null,v.renderingStartTime=0,v.last=l,v.tail=i,v.tailMode=f)}function gE(t,e,i){var l=e.pendingProps,f=l.revealOrder,v=l.tail;if(gs(t,e,l.children,i),l=kr.current,l&2)l=l&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&FT(t,i,e);else if(t.tag===19)FT(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}l&=1}if(rr(kr,l),!(e.mode&1))e.memoizedState=null;else switch(f){case"forwards":for(i=e.child,f=null;i!==null;)t=i.alternate,t!==null&&g_(t)===null&&(f=i),i=i.sibling;i=f,i===null?(f=e.child,e.child=null):(f=i.sibling,i.sibling=null),Cv(e,!1,f,i,v);break;case"backwards":for(i=null,f=e.child,e.child=null;f!==null;){if(t=f.alternate,t!==null&&g_(t)===null){e.child=f;break}t=f.sibling,f.sibling=i,i=f,f=t}Cv(e,!0,i,null,v);break;case"together":Cv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ng(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ec(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),dh|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(mt(153));if(e.child!==null){for(t=e.child,i=au(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=au(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function HL(t,e,i){switch(e.tag){case 3:pE(e),Ud();break;case 5:V2(e);break;case 1:Fs(e.type)&&u_(e);break;case 4:ib(e,e.stateNode.containerInfo);break;case 10:var l=e.type._context,f=e.memoizedProps.value;rr(f_,l._currentValue),l._currentValue=f;break;case 13:if(l=e.memoizedState,l!==null)return l.dehydrated!==null?(rr(kr,kr.current&1),e.flags|=128,null):i&e.child.childLanes?mE(t,e,i):(rr(kr,kr.current&1),t=ec(t,e,i),t!==null?t.sibling:null);rr(kr,kr.current&1);break;case 19:if(l=(i&e.childLanes)!==0,t.flags&128){if(l)return gE(t,e,i);e.flags|=128}if(f=e.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),rr(kr,kr.current),l)break;return null;case 22:case 23:return e.lanes=0,dE(t,e,i)}return ec(t,e,i)}var _E,$x,yE,vE;_E=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};$x=function(){};yE=function(t,e,i,l){var f=t.memoizedProps;if(f!==l){t=e.stateNode,nh(pl.current);var v=null;switch(i){case"input":f=hx(t,f),l=hx(t,l),v=[];break;case"select":f=zr({},f,{value:void 0}),l=zr({},l,{value:void 0}),v=[];break;case"textarea":f=px(t,f),l=px(t,l),v=[];break;default:typeof f.onClick!="function"&&typeof l.onClick=="function"&&(t.onclick=l_)}gx(i,l);var g;i=null;for(N in f)if(!l.hasOwnProperty(N)&&f.hasOwnProperty(N)&&f[N]!=null)if(N==="style"){var c=f[N];for(g in c)c.hasOwnProperty(g)&&(i||(i={}),i[g]="")}else N!=="dangerouslySetInnerHTML"&&N!=="children"&&N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&N!=="autoFocus"&&(kp.hasOwnProperty(N)?v||(v=[]):(v=v||[]).push(N,null));for(N in l){var A=l[N];if(c=f!=null?f[N]:void 0,l.hasOwnProperty(N)&&A!==c&&(A!=null||c!=null))if(N==="style")if(c){for(g in c)!c.hasOwnProperty(g)||A&&A.hasOwnProperty(g)||(i||(i={}),i[g]="");for(g in A)A.hasOwnProperty(g)&&c[g]!==A[g]&&(i||(i={}),i[g]=A[g])}else i||(v||(v=[]),v.push(N,i)),i=A;else N==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,c=c?c.__html:void 0,A!=null&&c!==A&&(v=v||[]).push(N,A)):N==="children"?typeof A!="string"&&typeof A!="number"||(v=v||[]).push(N,""+A):N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&(kp.hasOwnProperty(N)?(A!=null&&N==="onScroll"&&ur("scroll",t),v||c===A||(v=[])):(v=v||[]).push(N,A))}i&&(v=v||[]).push("style",i);var N=v;(e.updateQueue=N)&&(e.flags|=4)}};vE=function(t,e,i,l){i!==l&&(e.flags|=4)};function Jf(t,e){if(!vr)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function Qi(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,l=0;if(e)for(var f=t.child;f!==null;)i|=f.lanes|f.childLanes,l|=f.subtreeFlags&14680064,l|=f.flags&14680064,f.return=t,f=f.sibling;else for(f=t.child;f!==null;)i|=f.lanes|f.childLanes,l|=f.subtreeFlags,l|=f.flags,f.return=t,f=f.sibling;return t.subtreeFlags|=l,t.childLanes=i,e}function KL(t,e,i){var l=e.pendingProps;switch(Y0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qi(e),null;case 1:return Fs(e.type)&&c_(),Qi(e),null;case 3:return l=e.stateNode,$d(),hr(Bs),hr(ns),ob(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(t===null||t.child===null)&&(pg(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,_a!==null&&(Yx(_a),_a=null))),$x(t,e),Qi(e),null;case 5:sb(e);var f=nh(Up.current);if(i=e.type,t!==null&&e.stateNode!=null)yE(t,e,i,l,f),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!l){if(e.stateNode===null)throw Error(mt(166));return Qi(e),null}if(t=nh(pl.current),pg(e)){l=e.stateNode,i=e.type;var v=e.memoizedProps;switch(l[ul]=e,l[Bp]=v,t=(e.mode&1)!==0,i){case"dialog":ur("cancel",l),ur("close",l);break;case"iframe":case"object":case"embed":ur("load",l);break;case"video":case"audio":for(f=0;f<lp.length;f++)ur(lp[f],l);break;case"source":ur("error",l);break;case"img":case"image":case"link":ur("error",l),ur("load",l);break;case"details":ur("toggle",l);break;case"input":K1(l,v),ur("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!v.multiple},ur("invalid",l);break;case"textarea":Y1(l,v),ur("invalid",l)}gx(i,v),f=null;for(var g in v)if(v.hasOwnProperty(g)){var c=v[g];g==="children"?typeof c=="string"?l.textContent!==c&&(v.suppressHydrationWarning!==!0&&fg(l.textContent,c,t),f=["children",c]):typeof c=="number"&&l.textContent!==""+c&&(v.suppressHydrationWarning!==!0&&fg(l.textContent,c,t),f=["children",""+c]):kp.hasOwnProperty(g)&&c!=null&&g==="onScroll"&&ur("scroll",l)}switch(i){case"input":sg(l),X1(l,v,!0);break;case"textarea":sg(l),J1(l);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(l.onclick=l_)}l=f,e.updateQueue=l,l!==null&&(e.flags|=4)}else{g=f.nodeType===9?f:f.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=WP(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=g.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof l.is=="string"?t=g.createElement(i,{is:l.is}):(t=g.createElement(i),i==="select"&&(g=t,l.multiple?g.multiple=!0:l.size&&(g.size=l.size))):t=g.createElementNS(t,i),t[ul]=e,t[Bp]=l,_E(t,e,!1,!1),e.stateNode=t;e:{switch(g=_x(i,l),i){case"dialog":ur("cancel",t),ur("close",t),f=l;break;case"iframe":case"object":case"embed":ur("load",t),f=l;break;case"video":case"audio":for(f=0;f<lp.length;f++)ur(lp[f],t);f=l;break;case"source":ur("error",t),f=l;break;case"img":case"image":case"link":ur("error",t),ur("load",t),f=l;break;case"details":ur("toggle",t),f=l;break;case"input":K1(t,l),f=hx(t,l),ur("invalid",t);break;case"option":f=l;break;case"select":t._wrapperState={wasMultiple:!!l.multiple},f=zr({},l,{value:void 0}),ur("invalid",t);break;case"textarea":Y1(t,l),f=px(t,l),ur("invalid",t);break;default:f=l}gx(i,f),c=f;for(v in c)if(c.hasOwnProperty(v)){var A=c[v];v==="style"?XP(t,A):v==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&HP(t,A)):v==="children"?typeof A=="string"?(i!=="textarea"||A!=="")&&Mp(t,A):typeof A=="number"&&Mp(t,""+A):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(kp.hasOwnProperty(v)?A!=null&&v==="onScroll"&&ur("scroll",t):A!=null&&N0(t,v,A,g))}switch(i){case"input":sg(t),X1(t,l,!1);break;case"textarea":sg(t),J1(t);break;case"option":l.value!=null&&t.setAttribute("value",""+fu(l.value));break;case"select":t.multiple=!!l.multiple,v=l.value,v!=null?Cd(t,!!l.multiple,v,!1):l.defaultValue!=null&&Cd(t,!!l.multiple,l.defaultValue,!0);break;default:typeof f.onClick=="function"&&(t.onclick=l_)}switch(i){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Qi(e),null;case 6:if(t&&e.stateNode!=null)vE(t,e,t.memoizedProps,l);else{if(typeof l!="string"&&e.stateNode===null)throw Error(mt(166));if(i=nh(Up.current),nh(pl.current),pg(e)){if(l=e.stateNode,i=e.memoizedProps,l[ul]=e,(v=l.nodeValue!==i)&&(t=co,t!==null))switch(t.tag){case 3:fg(l.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&fg(l.nodeValue,i,(t.mode&1)!==0)}v&&(e.flags|=4)}else l=(i.nodeType===9?i:i.ownerDocument).createTextNode(l),l[ul]=e,e.stateNode=l}return Qi(e),null;case 13:if(hr(kr),l=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(vr&&lo!==null&&e.mode&1&&!(e.flags&128))O2(),Ud(),e.flags|=98560,v=!1;else if(v=pg(e),l!==null&&l.dehydrated!==null){if(t===null){if(!v)throw Error(mt(318));if(v=e.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(mt(317));v[ul]=e}else Ud(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Qi(e),v=!1}else _a!==null&&(Yx(_a),_a=null),v=!0;if(!v)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(l=l!==null,l!==(t!==null&&t.memoizedState!==null)&&l&&(e.child.flags|=8192,e.mode&1&&(t===null||kr.current&1?_i===0&&(_i=3):yb())),e.updateQueue!==null&&(e.flags|=4),Qi(e),null);case 4:return $d(),$x(t,e),t===null&&Op(e.stateNode.containerInfo),Qi(e),null;case 10:return tb(e.type._context),Qi(e),null;case 17:return Fs(e.type)&&c_(),Qi(e),null;case 19:if(hr(kr),v=e.memoizedState,v===null)return Qi(e),null;if(l=(e.flags&128)!==0,g=v.rendering,g===null)if(l)Jf(v,!1);else{if(_i!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(g=g_(t),g!==null){for(e.flags|=128,Jf(v,!1),l=g.updateQueue,l!==null&&(e.updateQueue=l,e.flags|=4),e.subtreeFlags=0,l=i,i=e.child;i!==null;)v=i,t=l,v.flags&=14680066,g=v.alternate,g===null?(v.childLanes=0,v.lanes=t,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=g.childLanes,v.lanes=g.lanes,v.child=g.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=g.memoizedProps,v.memoizedState=g.memoizedState,v.updateQueue=g.updateQueue,v.type=g.type,t=g.dependencies,v.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return rr(kr,kr.current&1|2),e.child}t=t.sibling}v.tail!==null&&Hr()>Gd&&(e.flags|=128,l=!0,Jf(v,!1),e.lanes=4194304)}else{if(!l)if(t=g_(g),t!==null){if(e.flags|=128,l=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),Jf(v,!0),v.tail===null&&v.tailMode==="hidden"&&!g.alternate&&!vr)return Qi(e),null}else 2*Hr()-v.renderingStartTime>Gd&&i!==1073741824&&(e.flags|=128,l=!0,Jf(v,!1),e.lanes=4194304);v.isBackwards?(g.sibling=e.child,e.child=g):(i=v.last,i!==null?i.sibling=g:e.child=g,v.last=g)}return v.tail!==null?(e=v.tail,v.rendering=e,v.tail=e.sibling,v.renderingStartTime=Hr(),e.sibling=null,i=kr.current,rr(kr,l?i&1|2:i&1),e):(Qi(e),null);case 22:case 23:return _b(),l=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==l&&(e.flags|=8192),l&&e.mode&1?ao&1073741824&&(Qi(e),e.subtreeFlags&6&&(e.flags|=8192)):Qi(e),null;case 24:return null;case 25:return null}throw Error(mt(156,e.tag))}function XL(t,e){switch(Y0(e),e.tag){case 1:return Fs(e.type)&&c_(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return $d(),hr(Bs),hr(ns),ob(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return sb(e),null;case 13:if(hr(kr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(mt(340));Ud()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return hr(kr),null;case 4:return $d(),null;case 10:return tb(e.type._context),null;case 22:case 23:return _b(),null;case 24:return null;default:return null}}var _g=!1,es=!1,YL=typeof WeakSet=="function"?WeakSet:Set,Rt=null;function Sd(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(l){Ur(t,e,l)}else i.current=null}function Zx(t,e,i){try{i()}catch(l){Ur(t,e,l)}}var UT=!1;function JL(t,e){if(Cx=s_,t=S2(),K0(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var f=l.anchorOffset,v=l.focusNode;l=l.focusOffset;try{i.nodeType,v.nodeType}catch{i=null;break e}var g=0,c=-1,A=-1,N=0,Z=0,W=t,K=null;t:for(;;){for(var J;W!==i||f!==0&&W.nodeType!==3||(c=g+f),W!==v||l!==0&&W.nodeType!==3||(A=g+l),W.nodeType===3&&(g+=W.nodeValue.length),(J=W.firstChild)!==null;)K=W,W=J;for(;;){if(W===t)break t;if(K===i&&++N===f&&(c=g),K===v&&++Z===l&&(A=g),(J=W.nextSibling)!==null)break;W=K,K=W.parentNode}W=J}i=c===-1||A===-1?null:{start:c,end:A}}else i=null}i=i||{start:0,end:0}}else i=null;for(Ix={focusedElem:t,selectionRange:i},s_=!1,Rt=e;Rt!==null;)if(e=Rt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Rt=t;else for(;Rt!==null;){e=Rt;try{var ce=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(ce!==null){var ie=ce.memoizedProps,oe=ce.memoizedState,re=e.stateNode,$=re.getSnapshotBeforeUpdate(e.elementType===e.type?ie:fa(e.type,ie),oe);re.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var te=e.stateNode.containerInfo;te.nodeType===1?te.textContent="":te.nodeType===9&&te.documentElement&&te.removeChild(te.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(mt(163))}}catch(fe){Ur(e,e.return,fe)}if(t=e.sibling,t!==null){t.return=e.return,Rt=t;break}Rt=e.return}return ce=UT,UT=!1,ce}function yp(t,e,i){var l=e.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var f=l=l.next;do{if((f.tag&t)===t){var v=f.destroy;f.destroy=void 0,v!==void 0&&Zx(e,i,v)}f=f.next}while(f!==l)}}function Z_(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var l=i.create;i.destroy=l()}i=i.next}while(i!==e)}}function Gx(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function xE(t){var e=t.alternate;e!==null&&(t.alternate=null,xE(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ul],delete e[Bp],delete e[Ax],delete e[zL],delete e[DL])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function bE(t){return t.tag===5||t.tag===3||t.tag===4}function VT(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||bE(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qx(t,e,i){var l=t.tag;if(l===5||l===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=l_));else if(l!==4&&(t=t.child,t!==null))for(qx(t,e,i),t=t.sibling;t!==null;)qx(t,e,i),t=t.sibling}function Wx(t,e,i){var l=t.tag;if(l===5||l===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(l!==4&&(t=t.child,t!==null))for(Wx(t,e,i),t=t.sibling;t!==null;)Wx(t,e,i),t=t.sibling}var Vi=null,ma=!1;function Nc(t,e,i){for(i=i.child;i!==null;)wE(t,e,i),i=i.sibling}function wE(t,e,i){if(fl&&typeof fl.onCommitFiberUnmount=="function")try{fl.onCommitFiberUnmount(N_,i)}catch{}switch(i.tag){case 5:es||Sd(i,e);case 6:var l=Vi,f=ma;Vi=null,Nc(t,e,i),Vi=l,ma=f,Vi!==null&&(ma?(t=Vi,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):Vi.removeChild(i.stateNode));break;case 18:Vi!==null&&(ma?(t=Vi,i=i.stateNode,t.nodeType===8?xv(t.parentNode,i):t.nodeType===1&&xv(t,i),zp(t)):xv(Vi,i.stateNode));break;case 4:l=Vi,f=ma,Vi=i.stateNode.containerInfo,ma=!0,Nc(t,e,i),Vi=l,ma=f;break;case 0:case 11:case 14:case 15:if(!es&&(l=i.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){f=l=l.next;do{var v=f,g=v.destroy;v=v.tag,g!==void 0&&(v&2||v&4)&&Zx(i,e,g),f=f.next}while(f!==l)}Nc(t,e,i);break;case 1:if(!es&&(Sd(i,e),l=i.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=i.memoizedProps,l.state=i.memoizedState,l.componentWillUnmount()}catch(c){Ur(i,e,c)}Nc(t,e,i);break;case 21:Nc(t,e,i);break;case 22:i.mode&1?(es=(l=es)||i.memoizedState!==null,Nc(t,e,i),es=l):Nc(t,e,i);break;default:Nc(t,e,i)}}function $T(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new YL),e.forEach(function(l){var f=az.bind(null,t,l);i.has(l)||(i.add(l),l.then(f,f))})}}function da(t,e){var i=e.deletions;if(i!==null)for(var l=0;l<i.length;l++){var f=i[l];try{var v=t,g=e,c=g;e:for(;c!==null;){switch(c.tag){case 5:Vi=c.stateNode,ma=!1;break e;case 3:Vi=c.stateNode.containerInfo,ma=!0;break e;case 4:Vi=c.stateNode.containerInfo,ma=!0;break e}c=c.return}if(Vi===null)throw Error(mt(160));wE(v,g,f),Vi=null,ma=!1;var A=f.alternate;A!==null&&(A.return=null),f.return=null}catch(N){Ur(f,e,N)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)TE(e,t),e=e.sibling}function TE(t,e){var i=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(da(e,t),ol(t),l&4){try{yp(3,t,t.return),Z_(3,t)}catch(ie){Ur(t,t.return,ie)}try{yp(5,t,t.return)}catch(ie){Ur(t,t.return,ie)}}break;case 1:da(e,t),ol(t),l&512&&i!==null&&Sd(i,i.return);break;case 5:if(da(e,t),ol(t),l&512&&i!==null&&Sd(i,i.return),t.flags&32){var f=t.stateNode;try{Mp(f,"")}catch(ie){Ur(t,t.return,ie)}}if(l&4&&(f=t.stateNode,f!=null)){var v=t.memoizedProps,g=i!==null?i.memoizedProps:v,c=t.type,A=t.updateQueue;if(t.updateQueue=null,A!==null)try{c==="input"&&v.type==="radio"&&v.name!=null&&GP(f,v),_x(c,g);var N=_x(c,v);for(g=0;g<A.length;g+=2){var Z=A[g],W=A[g+1];Z==="style"?XP(f,W):Z==="dangerouslySetInnerHTML"?HP(f,W):Z==="children"?Mp(f,W):N0(f,Z,W,N)}switch(c){case"input":dx(f,v);break;case"textarea":qP(f,v);break;case"select":var K=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!v.multiple;var J=v.value;J!=null?Cd(f,!!v.multiple,J,!1):K!==!!v.multiple&&(v.defaultValue!=null?Cd(f,!!v.multiple,v.defaultValue,!0):Cd(f,!!v.multiple,v.multiple?[]:"",!1))}f[Bp]=v}catch(ie){Ur(t,t.return,ie)}}break;case 6:if(da(e,t),ol(t),l&4){if(t.stateNode===null)throw Error(mt(162));f=t.stateNode,v=t.memoizedProps;try{f.nodeValue=v}catch(ie){Ur(t,t.return,ie)}}break;case 3:if(da(e,t),ol(t),l&4&&i!==null&&i.memoizedState.isDehydrated)try{zp(e.containerInfo)}catch(ie){Ur(t,t.return,ie)}break;case 4:da(e,t),ol(t);break;case 13:da(e,t),ol(t),f=t.child,f.flags&8192&&(v=f.memoizedState!==null,f.stateNode.isHidden=v,!v||f.alternate!==null&&f.alternate.memoizedState!==null||(mb=Hr())),l&4&&$T(t);break;case 22:if(Z=i!==null&&i.memoizedState!==null,t.mode&1?(es=(N=es)||Z,da(e,t),es=N):da(e,t),ol(t),l&8192){if(N=t.memoizedState!==null,(t.stateNode.isHidden=N)&&!Z&&t.mode&1)for(Rt=t,Z=t.child;Z!==null;){for(W=Rt=Z;Rt!==null;){switch(K=Rt,J=K.child,K.tag){case 0:case 11:case 14:case 15:yp(4,K,K.return);break;case 1:Sd(K,K.return);var ce=K.stateNode;if(typeof ce.componentWillUnmount=="function"){l=K,i=K.return;try{e=l,ce.props=e.memoizedProps,ce.state=e.memoizedState,ce.componentWillUnmount()}catch(ie){Ur(l,i,ie)}}break;case 5:Sd(K,K.return);break;case 22:if(K.memoizedState!==null){GT(W);continue}}J!==null?(J.return=K,Rt=J):GT(W)}Z=Z.sibling}e:for(Z=null,W=t;;){if(W.tag===5){if(Z===null){Z=W;try{f=W.stateNode,N?(v=f.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(c=W.stateNode,A=W.memoizedProps.style,g=A!=null&&A.hasOwnProperty("display")?A.display:null,c.style.display=KP("display",g))}catch(ie){Ur(t,t.return,ie)}}}else if(W.tag===6){if(Z===null)try{W.stateNode.nodeValue=N?"":W.memoizedProps}catch(ie){Ur(t,t.return,ie)}}else if((W.tag!==22&&W.tag!==23||W.memoizedState===null||W===t)&&W.child!==null){W.child.return=W,W=W.child;continue}if(W===t)break e;for(;W.sibling===null;){if(W.return===null||W.return===t)break e;Z===W&&(Z=null),W=W.return}Z===W&&(Z=null),W.sibling.return=W.return,W=W.sibling}}break;case 19:da(e,t),ol(t),l&4&&$T(t);break;case 21:break;default:da(e,t),ol(t)}}function ol(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(bE(i)){var l=i;break e}i=i.return}throw Error(mt(160))}switch(l.tag){case 5:var f=l.stateNode;l.flags&32&&(Mp(f,""),l.flags&=-33);var v=VT(t);Wx(t,v,f);break;case 3:case 4:var g=l.stateNode.containerInfo,c=VT(t);qx(t,c,g);break;default:throw Error(mt(161))}}catch(A){Ur(t,t.return,A)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function QL(t,e,i){Rt=t,SE(t)}function SE(t,e,i){for(var l=(t.mode&1)!==0;Rt!==null;){var f=Rt,v=f.child;if(f.tag===22&&l){var g=f.memoizedState!==null||_g;if(!g){var c=f.alternate,A=c!==null&&c.memoizedState!==null||es;c=_g;var N=es;if(_g=g,(es=A)&&!N)for(Rt=f;Rt!==null;)g=Rt,A=g.child,g.tag===22&&g.memoizedState!==null?qT(f):A!==null?(A.return=g,Rt=A):qT(f);for(;v!==null;)Rt=v,SE(v),v=v.sibling;Rt=f,_g=c,es=N}ZT(t)}else f.subtreeFlags&8772&&v!==null?(v.return=f,Rt=v):ZT(t)}}function ZT(t){for(;Rt!==null;){var e=Rt;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:es||Z_(5,e);break;case 1:var l=e.stateNode;if(e.flags&4&&!es)if(i===null)l.componentDidMount();else{var f=e.elementType===e.type?i.memoizedProps:fa(e.type,i.memoizedProps);l.componentDidUpdate(f,i.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var v=e.updateQueue;v!==null&&IT(e,v,l);break;case 3:var g=e.updateQueue;if(g!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}IT(e,g,i)}break;case 5:var c=e.stateNode;if(i===null&&e.flags&4){i=c;var A=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&i.focus();break;case"img":A.src&&(i.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var N=e.alternate;if(N!==null){var Z=N.memoizedState;if(Z!==null){var W=Z.dehydrated;W!==null&&zp(W)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(mt(163))}es||e.flags&512&&Gx(e)}catch(K){Ur(e,e.return,K)}}if(e===t){Rt=null;break}if(i=e.sibling,i!==null){i.return=e.return,Rt=i;break}Rt=e.return}}function GT(t){for(;Rt!==null;){var e=Rt;if(e===t){Rt=null;break}var i=e.sibling;if(i!==null){i.return=e.return,Rt=i;break}Rt=e.return}}function qT(t){for(;Rt!==null;){var e=Rt;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{Z_(4,e)}catch(A){Ur(e,i,A)}break;case 1:var l=e.stateNode;if(typeof l.componentDidMount=="function"){var f=e.return;try{l.componentDidMount()}catch(A){Ur(e,f,A)}}var v=e.return;try{Gx(e)}catch(A){Ur(e,v,A)}break;case 5:var g=e.return;try{Gx(e)}catch(A){Ur(e,g,A)}}}catch(A){Ur(e,e.return,A)}if(e===t){Rt=null;break}var c=e.sibling;if(c!==null){c.return=e.return,Rt=c;break}Rt=e.return}}var ez=Math.ceil,v_=ic.ReactCurrentDispatcher,fb=ic.ReactCurrentOwner,zo=ic.ReactCurrentBatchConfig,Pn=0,ki=null,si=null,$i=0,ao=0,Pd=yu(0),_i=0,Gp=null,dh=0,G_=0,pb=0,vp=null,Ns=null,mb=0,Gd=1/0,Vl=null,x_=!1,Hx=null,su=null,yg=!1,Kc=null,b_=0,xp=0,Kx=null,Og=-1,jg=0;function ys(){return Pn&6?Hr():Og!==-1?Og:Og=Hr()}function ou(t){return t.mode&1?Pn&2&&$i!==0?$i&-$i:OL.transition!==null?(jg===0&&(jg=l2()),jg):(t=Bn,t!==0||(t=window.event,t=t===void 0?16:m2(t.type)),t):1}function ba(t,e,i,l){if(50<xp)throw xp=0,Kx=null,Error(mt(185));tm(t,i,l),(!(Pn&2)||t!==ki)&&(t===ki&&(!(Pn&2)&&(G_|=i),_i===4&&$c(t,$i)),Us(t,l),i===1&&Pn===0&&!(e.mode&1)&&(Gd=Hr()+500,U_&&vu()))}function Us(t,e){var i=t.callbackNode;OR(t,e);var l=i_(t,t===ki?$i:0);if(l===0)i!==null&&tT(i),t.callbackNode=null,t.callbackPriority=0;else if(e=l&-l,t.callbackPriority!==e){if(i!=null&&tT(i),e===1)t.tag===0?NL(WT.bind(null,t)):z2(WT.bind(null,t)),RL(function(){!(Pn&6)&&vu()}),i=null;else{switch(c2(l)){case 1:i=U0;break;case 4:i=o2;break;case 16:i=r_;break;case 536870912:i=a2;break;default:i=r_}i=RE(i,PE.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function PE(t,e){if(Og=-1,jg=0,Pn&6)throw Error(mt(327));var i=t.callbackNode;if(Rd()&&t.callbackNode!==i)return null;var l=i_(t,t===ki?$i:0);if(l===0)return null;if(l&30||l&t.expiredLanes||e)e=w_(t,l);else{e=l;var f=Pn;Pn|=2;var v=CE();(ki!==t||$i!==e)&&(Vl=null,Gd=Hr()+500,ih(t,e));do try{rz();break}catch(c){EE(t,c)}while(!0);eb(),v_.current=v,Pn=f,si!==null?e=0:(ki=null,$i=0,e=_i)}if(e!==0){if(e===2&&(f=wx(t),f!==0&&(l=f,e=Xx(t,f))),e===1)throw i=Gp,ih(t,0),$c(t,l),Us(t,Hr()),i;if(e===6)$c(t,l);else{if(f=t.current.alternate,!(l&30)&&!tz(f)&&(e=w_(t,l),e===2&&(v=wx(t),v!==0&&(l=v,e=Xx(t,v))),e===1))throw i=Gp,ih(t,0),$c(t,l),Us(t,Hr()),i;switch(t.finishedWork=f,t.finishedLanes=l,e){case 0:case 1:throw Error(mt(345));case 2:Ju(t,Ns,Vl);break;case 3:if($c(t,l),(l&130023424)===l&&(e=mb+500-Hr(),10<e)){if(i_(t,0)!==0)break;if(f=t.suspendedLanes,(f&l)!==l){ys(),t.pingedLanes|=t.suspendedLanes&f;break}t.timeoutHandle=Mx(Ju.bind(null,t,Ns,Vl),e);break}Ju(t,Ns,Vl);break;case 4:if($c(t,l),(l&4194240)===l)break;for(e=t.eventTimes,f=-1;0<l;){var g=31-xa(l);v=1<<g,g=e[g],g>f&&(f=g),l&=~v}if(l=f,l=Hr()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*ez(l/1960))-l,10<l){t.timeoutHandle=Mx(Ju.bind(null,t,Ns,Vl),l);break}Ju(t,Ns,Vl);break;case 5:Ju(t,Ns,Vl);break;default:throw Error(mt(329))}}}return Us(t,Hr()),t.callbackNode===i?PE.bind(null,t):null}function Xx(t,e){var i=vp;return t.current.memoizedState.isDehydrated&&(ih(t,e).flags|=256),t=w_(t,e),t!==2&&(e=Ns,Ns=i,e!==null&&Yx(e)),t}function Yx(t){Ns===null?Ns=t:Ns.push.apply(Ns,t)}function tz(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var l=0;l<i.length;l++){var f=i[l],v=f.getSnapshot;f=f.value;try{if(!wa(v(),f))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function $c(t,e){for(e&=~pb,e&=~G_,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-xa(e),l=1<<i;t[i]=-1,e&=~l}}function WT(t){if(Pn&6)throw Error(mt(327));Rd();var e=i_(t,0);if(!(e&1))return Us(t,Hr()),null;var i=w_(t,e);if(t.tag!==0&&i===2){var l=wx(t);l!==0&&(e=l,i=Xx(t,l))}if(i===1)throw i=Gp,ih(t,0),$c(t,e),Us(t,Hr()),i;if(i===6)throw Error(mt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ju(t,Ns,Vl),Us(t,Hr()),null}function gb(t,e){var i=Pn;Pn|=1;try{return t(e)}finally{Pn=i,Pn===0&&(Gd=Hr()+500,U_&&vu())}}function fh(t){Kc!==null&&Kc.tag===0&&!(Pn&6)&&Rd();var e=Pn;Pn|=1;var i=zo.transition,l=Bn;try{if(zo.transition=null,Bn=1,t)return t()}finally{Bn=l,zo.transition=i,Pn=e,!(Pn&6)&&vu()}}function _b(){ao=Pd.current,hr(Pd)}function ih(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,AL(i)),si!==null)for(i=si.return;i!==null;){var l=i;switch(Y0(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&c_();break;case 3:$d(),hr(Bs),hr(ns),ob();break;case 5:sb(l);break;case 4:$d();break;case 13:hr(kr);break;case 19:hr(kr);break;case 10:tb(l.type._context);break;case 22:case 23:_b()}i=i.return}if(ki=t,si=t=au(t.current,null),$i=ao=e,_i=0,Gp=null,pb=G_=dh=0,Ns=vp=null,th!==null){for(e=0;e<th.length;e++)if(i=th[e],l=i.interleaved,l!==null){i.interleaved=null;var f=l.next,v=i.pending;if(v!==null){var g=v.next;v.next=f,l.next=g}i.pending=l}th=null}return t}function EE(t,e){do{var i=si;try{if(eb(),zg.current=y_,__){for(var l=Lr.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}__=!1}if(hh=0,Ii=gi=Lr=null,_p=!1,Vp=0,fb.current=null,i===null||i.return===null){_i=1,Gp=e,si=null;break}e:{var v=t,g=i.return,c=i,A=e;if(e=$i,c.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var N=A,Z=c,W=Z.tag;if(!(Z.mode&1)&&(W===0||W===11||W===15)){var K=Z.alternate;K?(Z.updateQueue=K.updateQueue,Z.memoizedState=K.memoizedState,Z.lanes=K.lanes):(Z.updateQueue=null,Z.memoizedState=null)}var J=zT(g);if(J!==null){J.flags&=-257,DT(J,g,c,v,e),J.mode&1&&LT(v,N,e),e=J,A=N;var ce=e.updateQueue;if(ce===null){var ie=new Set;ie.add(A),e.updateQueue=ie}else ce.add(A);break e}else{if(!(e&1)){LT(v,N,e),yb();break e}A=Error(mt(426))}}else if(vr&&c.mode&1){var oe=zT(g);if(oe!==null){!(oe.flags&65536)&&(oe.flags|=256),DT(oe,g,c,v,e),J0(Zd(A,c));break e}}v=A=Zd(A,c),_i!==4&&(_i=2),vp===null?vp=[v]:vp.push(v),v=g;do{switch(v.tag){case 3:v.flags|=65536,e&=-e,v.lanes|=e;var re=cE(v,A,e);CT(v,re);break e;case 1:c=A;var $=v.type,te=v.stateNode;if(!(v.flags&128)&&(typeof $.getDerivedStateFromError=="function"||te!==null&&typeof te.componentDidCatch=="function"&&(su===null||!su.has(te)))){v.flags|=65536,e&=-e,v.lanes|=e;var fe=uE(v,c,e);CT(v,fe);break e}}v=v.return}while(v!==null)}kE(i)}catch(pe){e=pe,si===i&&i!==null&&(si=i=i.return);continue}break}while(!0)}function CE(){var t=v_.current;return v_.current=y_,t===null?y_:t}function yb(){(_i===0||_i===3||_i===2)&&(_i=4),ki===null||!(dh&268435455)&&!(G_&268435455)||$c(ki,$i)}function w_(t,e){var i=Pn;Pn|=2;var l=CE();(ki!==t||$i!==e)&&(Vl=null,ih(t,e));do try{nz();break}catch(f){EE(t,f)}while(!0);if(eb(),Pn=i,v_.current=l,si!==null)throw Error(mt(261));return ki=null,$i=0,_i}function nz(){for(;si!==null;)IE(si)}function rz(){for(;si!==null&&!IR();)IE(si)}function IE(t){var e=AE(t.alternate,t,ao);t.memoizedProps=t.pendingProps,e===null?kE(t):si=e,fb.current=null}function kE(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=XL(i,e),i!==null){i.flags&=32767,si=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_i=6,si=null;return}}else if(i=KL(i,e,ao),i!==null){si=i;return}if(e=e.sibling,e!==null){si=e;return}si=e=t}while(e!==null);_i===0&&(_i=5)}function Ju(t,e,i){var l=Bn,f=zo.transition;try{zo.transition=null,Bn=1,iz(t,e,i,l)}finally{zo.transition=f,Bn=l}return null}function iz(t,e,i,l){do Rd();while(Kc!==null);if(Pn&6)throw Error(mt(327));i=t.finishedWork;var f=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(mt(177));t.callbackNode=null,t.callbackPriority=0;var v=i.lanes|i.childLanes;if(jR(t,v),t===ki&&(si=ki=null,$i=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||yg||(yg=!0,RE(r_,function(){return Rd(),null})),v=(i.flags&15990)!==0,i.subtreeFlags&15990||v){v=zo.transition,zo.transition=null;var g=Bn;Bn=1;var c=Pn;Pn|=4,fb.current=null,JL(t,i),TE(i,t),SL(Ix),s_=!!Cx,Ix=Cx=null,t.current=i,QL(i),kR(),Pn=c,Bn=g,zo.transition=v}else t.current=i;if(yg&&(yg=!1,Kc=t,b_=f),v=t.pendingLanes,v===0&&(su=null),RR(i.stateNode),Us(t,Hr()),e!==null)for(l=t.onRecoverableError,i=0;i<e.length;i++)f=e[i],l(f.value,{componentStack:f.stack,digest:f.digest});if(x_)throw x_=!1,t=Hx,Hx=null,t;return b_&1&&t.tag!==0&&Rd(),v=t.pendingLanes,v&1?t===Kx?xp++:(xp=0,Kx=t):xp=0,vu(),null}function Rd(){if(Kc!==null){var t=c2(b_),e=zo.transition,i=Bn;try{if(zo.transition=null,Bn=16>t?16:t,Kc===null)var l=!1;else{if(t=Kc,Kc=null,b_=0,Pn&6)throw Error(mt(331));var f=Pn;for(Pn|=4,Rt=t.current;Rt!==null;){var v=Rt,g=v.child;if(Rt.flags&16){var c=v.deletions;if(c!==null){for(var A=0;A<c.length;A++){var N=c[A];for(Rt=N;Rt!==null;){var Z=Rt;switch(Z.tag){case 0:case 11:case 15:yp(8,Z,v)}var W=Z.child;if(W!==null)W.return=Z,Rt=W;else for(;Rt!==null;){Z=Rt;var K=Z.sibling,J=Z.return;if(xE(Z),Z===N){Rt=null;break}if(K!==null){K.return=J,Rt=K;break}Rt=J}}}var ce=v.alternate;if(ce!==null){var ie=ce.child;if(ie!==null){ce.child=null;do{var oe=ie.sibling;ie.sibling=null,ie=oe}while(ie!==null)}}Rt=v}}if(v.subtreeFlags&2064&&g!==null)g.return=v,Rt=g;else e:for(;Rt!==null;){if(v=Rt,v.flags&2048)switch(v.tag){case 0:case 11:case 15:yp(9,v,v.return)}var re=v.sibling;if(re!==null){re.return=v.return,Rt=re;break e}Rt=v.return}}var $=t.current;for(Rt=$;Rt!==null;){g=Rt;var te=g.child;if(g.subtreeFlags&2064&&te!==null)te.return=g,Rt=te;else e:for(g=$;Rt!==null;){if(c=Rt,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Z_(9,c)}}catch(pe){Ur(c,c.return,pe)}if(c===g){Rt=null;break e}var fe=c.sibling;if(fe!==null){fe.return=c.return,Rt=fe;break e}Rt=c.return}}if(Pn=f,vu(),fl&&typeof fl.onPostCommitFiberRoot=="function")try{fl.onPostCommitFiberRoot(N_,t)}catch{}l=!0}return l}finally{Bn=i,zo.transition=e}}return!1}function HT(t,e,i){e=Zd(i,e),e=cE(t,e,1),t=iu(t,e,1),e=ys(),t!==null&&(tm(t,1,e),Us(t,e))}function Ur(t,e,i){if(t.tag===3)HT(t,t,i);else for(;e!==null;){if(e.tag===3){HT(e,t,i);break}else if(e.tag===1){var l=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(su===null||!su.has(l))){t=Zd(i,t),t=uE(e,t,1),e=iu(e,t,1),t=ys(),e!==null&&(tm(e,1,t),Us(e,t));break}}e=e.return}}function sz(t,e,i){var l=t.pingCache;l!==null&&l.delete(e),e=ys(),t.pingedLanes|=t.suspendedLanes&i,ki===t&&($i&i)===i&&(_i===4||_i===3&&($i&130023424)===$i&&500>Hr()-mb?ih(t,0):pb|=i),Us(t,e)}function ME(t,e){e===0&&(t.mode&1?(e=lg,lg<<=1,!(lg&130023424)&&(lg=4194304)):e=1);var i=ys();t=Ql(t,e),t!==null&&(tm(t,e,i),Us(t,i))}function oz(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),ME(t,i)}function az(t,e){var i=0;switch(t.tag){case 13:var l=t.stateNode,f=t.memoizedState;f!==null&&(i=f.retryLane);break;case 19:l=t.stateNode;break;default:throw Error(mt(314))}l!==null&&l.delete(e),ME(t,i)}var AE;AE=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||Bs.current)js=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return js=!1,HL(t,e,i);js=!!(t.flags&131072)}else js=!1,vr&&e.flags&1048576&&D2(e,d_,e.index);switch(e.lanes=0,e.tag){case 2:var l=e.type;Ng(t,e),t=e.pendingProps;var f=Fd(e,ns.current);Ad(e,i),f=lb(null,e,l,t,f,i);var v=cb();return e.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Fs(l)?(v=!0,u_(e)):v=!1,e.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,rb(e),f.updater=$_,e.stateNode=f,f._reactInternals=e,Ox(e,l,t,i),e=Fx(null,e,l,!0,v,i)):(e.tag=0,vr&&v&&X0(e),gs(null,e,f,i),e=e.child),e;case 16:l=e.elementType;e:{switch(Ng(t,e),t=e.pendingProps,f=l._init,l=f(l._payload),e.type=l,f=e.tag=cz(l),t=fa(l,t),f){case 0:e=Bx(null,e,l,t,i);break e;case 1:e=jT(null,e,l,t,i);break e;case 11:e=NT(null,e,l,t,i);break e;case 14:e=OT(null,e,l,fa(l.type,t),i);break e}throw Error(mt(306,l,""))}return e;case 0:return l=e.type,f=e.pendingProps,f=e.elementType===l?f:fa(l,f),Bx(t,e,l,f,i);case 1:return l=e.type,f=e.pendingProps,f=e.elementType===l?f:fa(l,f),jT(t,e,l,f,i);case 3:e:{if(pE(e),t===null)throw Error(mt(387));l=e.pendingProps,v=e.memoizedState,f=v.element,U2(t,e),m_(e,l,null,i);var g=e.memoizedState;if(l=g.element,v.isDehydrated)if(v={element:l,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},e.updateQueue.baseState=v,e.memoizedState=v,e.flags&256){f=Zd(Error(mt(423)),e),e=BT(t,e,l,i,f);break e}else if(l!==f){f=Zd(Error(mt(424)),e),e=BT(t,e,l,i,f);break e}else for(lo=ru(e.stateNode.containerInfo.firstChild),co=e,vr=!0,_a=null,i=B2(e,null,l,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Ud(),l===f){e=ec(t,e,i);break e}gs(t,e,l,i)}e=e.child}return e;case 5:return V2(e),t===null&&zx(e),l=e.type,f=e.pendingProps,v=t!==null?t.memoizedProps:null,g=f.children,kx(l,f)?g=null:v!==null&&kx(l,v)&&(e.flags|=32),fE(t,e),gs(t,e,g,i),e.child;case 6:return t===null&&zx(e),null;case 13:return mE(t,e,i);case 4:return ib(e,e.stateNode.containerInfo),l=e.pendingProps,t===null?e.child=Vd(e,null,l,i):gs(t,e,l,i),e.child;case 11:return l=e.type,f=e.pendingProps,f=e.elementType===l?f:fa(l,f),NT(t,e,l,f,i);case 7:return gs(t,e,e.pendingProps,i),e.child;case 8:return gs(t,e,e.pendingProps.children,i),e.child;case 12:return gs(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(l=e.type._context,f=e.pendingProps,v=e.memoizedProps,g=f.value,rr(f_,l._currentValue),l._currentValue=g,v!==null)if(wa(v.value,g)){if(v.children===f.children&&!Bs.current){e=ec(t,e,i);break e}}else for(v=e.child,v!==null&&(v.return=e);v!==null;){var c=v.dependencies;if(c!==null){g=v.child;for(var A=c.firstContext;A!==null;){if(A.context===l){if(v.tag===1){A=Kl(-1,i&-i),A.tag=2;var N=v.updateQueue;if(N!==null){N=N.shared;var Z=N.pending;Z===null?A.next=A:(A.next=Z.next,Z.next=A),N.pending=A}}v.lanes|=i,A=v.alternate,A!==null&&(A.lanes|=i),Dx(v.return,i,e),c.lanes|=i;break}A=A.next}}else if(v.tag===10)g=v.type===e.type?null:v.child;else if(v.tag===18){if(g=v.return,g===null)throw Error(mt(341));g.lanes|=i,c=g.alternate,c!==null&&(c.lanes|=i),Dx(g,i,e),g=v.sibling}else g=v.child;if(g!==null)g.return=v;else for(g=v;g!==null;){if(g===e){g=null;break}if(v=g.sibling,v!==null){v.return=g.return,g=v;break}g=g.return}v=g}gs(t,e,f.children,i),e=e.child}return e;case 9:return f=e.type,l=e.pendingProps.children,Ad(e,i),f=No(f),l=l(f),e.flags|=1,gs(t,e,l,i),e.child;case 14:return l=e.type,f=fa(l,e.pendingProps),f=fa(l.type,f),OT(t,e,l,f,i);case 15:return hE(t,e,e.type,e.pendingProps,i);case 17:return l=e.type,f=e.pendingProps,f=e.elementType===l?f:fa(l,f),Ng(t,e),e.tag=1,Fs(l)?(t=!0,u_(e)):t=!1,Ad(e,i),lE(e,l,f),Ox(e,l,f,i),Fx(null,e,l,!0,t,i);case 19:return gE(t,e,i);case 22:return dE(t,e,i)}throw Error(mt(156,e.tag))};function RE(t,e){return s2(t,e)}function lz(t,e,i,l){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lo(t,e,i,l){return new lz(t,e,i,l)}function vb(t){return t=t.prototype,!(!t||!t.isReactComponent)}function cz(t){if(typeof t=="function")return vb(t)?1:0;if(t!=null){if(t=t.$$typeof,t===j0)return 11;if(t===B0)return 14}return 2}function au(t,e){var i=t.alternate;return i===null?(i=Lo(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function Bg(t,e,i,l,f,v){var g=2;if(l=t,typeof t=="function")vb(t)&&(g=1);else if(typeof t=="string")g=5;else e:switch(t){case md:return sh(i.children,f,v,e);case O0:g=8,f|=8;break;case ax:return t=Lo(12,i,e,f|2),t.elementType=ax,t.lanes=v,t;case lx:return t=Lo(13,i,e,f),t.elementType=lx,t.lanes=v,t;case cx:return t=Lo(19,i,e,f),t.elementType=cx,t.lanes=v,t;case VP:return q_(i,f,v,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case FP:g=10;break e;case UP:g=9;break e;case j0:g=11;break e;case B0:g=14;break e;case Fc:g=16,l=null;break e}throw Error(mt(130,t==null?t:typeof t,""))}return e=Lo(g,i,e,f),e.elementType=t,e.type=l,e.lanes=v,e}function sh(t,e,i,l){return t=Lo(7,t,l,e),t.lanes=i,t}function q_(t,e,i,l){return t=Lo(22,t,l,e),t.elementType=VP,t.lanes=i,t.stateNode={isHidden:!1},t}function Iv(t,e,i){return t=Lo(6,t,null,e),t.lanes=i,t}function kv(t,e,i){return e=Lo(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function uz(t,e,i,l,f){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cv(0),this.expirationTimes=cv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cv(0),this.identifierPrefix=l,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function xb(t,e,i,l,f,v,g,c,A){return t=new uz(t,e,i,c,A),e===1?(e=1,v===!0&&(e|=8)):e=0,v=Lo(3,null,null,e),t.current=v,v.stateNode=t,v.memoizedState={element:l,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},rb(v),t}function hz(t,e,i){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pd,key:l==null?null:""+l,children:t,containerInfo:e,implementation:i}}function LE(t){if(!t)return pu;t=t._reactInternals;e:{if(_h(t)!==t||t.tag!==1)throw Error(mt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Fs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(mt(171))}if(t.tag===1){var i=t.type;if(Fs(i))return L2(t,i,e)}return e}function zE(t,e,i,l,f,v,g,c,A){return t=xb(i,l,!0,t,f,v,g,c,A),t.context=LE(null),i=t.current,l=ys(),f=ou(i),v=Kl(l,f),v.callback=e??null,iu(i,v,f),t.current.lanes=f,tm(t,f,l),Us(t,l),t}function W_(t,e,i,l){var f=e.current,v=ys(),g=ou(f);return i=LE(i),e.context===null?e.context=i:e.pendingContext=i,e=Kl(v,g),e.payload={element:t},l=l===void 0?null:l,l!==null&&(e.callback=l),t=iu(f,e,g),t!==null&&(ba(t,f,g,v),Lg(t,f,g)),g}function T_(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function KT(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function bb(t,e){KT(t,e),(t=t.alternate)&&KT(t,e)}function dz(){return null}var DE=typeof reportError=="function"?reportError:function(t){console.error(t)};function wb(t){this._internalRoot=t}H_.prototype.render=wb.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(mt(409));W_(t,e,null,null)};H_.prototype.unmount=wb.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;fh(function(){W_(null,t,null,null)}),e[Jl]=null}};function H_(t){this._internalRoot=t}H_.prototype.unstable_scheduleHydration=function(t){if(t){var e=d2();t={blockedOn:null,target:t,priority:e};for(var i=0;i<Vc.length&&e!==0&&e<Vc[i].priority;i++);Vc.splice(i,0,t),i===0&&p2(t)}};function Tb(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function K_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function XT(){}function fz(t,e,i,l,f){if(f){if(typeof l=="function"){var v=l;l=function(){var N=T_(g);v.call(N)}}var g=zE(e,l,t,0,null,!1,!1,"",XT);return t._reactRootContainer=g,t[Jl]=g.current,Op(t.nodeType===8?t.parentNode:t),fh(),g}for(;f=t.lastChild;)t.removeChild(f);if(typeof l=="function"){var c=l;l=function(){var N=T_(A);c.call(N)}}var A=xb(t,0,!1,null,null,!1,!1,"",XT);return t._reactRootContainer=A,t[Jl]=A.current,Op(t.nodeType===8?t.parentNode:t),fh(function(){W_(e,A,i,l)}),A}function X_(t,e,i,l,f){var v=i._reactRootContainer;if(v){var g=v;if(typeof f=="function"){var c=f;f=function(){var A=T_(g);c.call(A)}}W_(e,g,t,f)}else g=fz(i,e,t,f,l);return T_(g)}u2=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=ap(e.pendingLanes);i!==0&&(V0(e,i|1),Us(e,Hr()),!(Pn&6)&&(Gd=Hr()+500,vu()))}break;case 13:fh(function(){var l=Ql(t,1);if(l!==null){var f=ys();ba(l,t,1,f)}}),bb(t,1)}};$0=function(t){if(t.tag===13){var e=Ql(t,134217728);if(e!==null){var i=ys();ba(e,t,134217728,i)}bb(t,134217728)}};h2=function(t){if(t.tag===13){var e=ou(t),i=Ql(t,e);if(i!==null){var l=ys();ba(i,t,e,l)}bb(t,e)}};d2=function(){return Bn};f2=function(t,e){var i=Bn;try{return Bn=t,e()}finally{Bn=i}};vx=function(t,e,i){switch(e){case"input":if(dx(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var l=i[e];if(l!==t&&l.form===t.form){var f=F_(l);if(!f)throw Error(mt(90));ZP(l),dx(l,f)}}}break;case"textarea":qP(t,i);break;case"select":e=i.value,e!=null&&Cd(t,!!i.multiple,e,!1)}};QP=gb;e2=fh;var pz={usingClientEntryPoint:!1,Events:[rm,vd,F_,YP,JP,gb]},Qf={findFiberByHostInstance:eh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mz={bundleType:Qf.bundleType,version:Qf.version,rendererPackageName:Qf.rendererPackageName,rendererConfig:Qf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ic.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=r2(t),t===null?null:t.stateNode},findFiberByHostInstance:Qf.findFiberByHostInstance||dz,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vg.isDisabled&&vg.supportsFiber)try{N_=vg.inject(mz),fl=vg}catch{}}fo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pz;fo.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tb(e))throw Error(mt(200));return hz(t,e,null,i)};fo.createRoot=function(t,e){if(!Tb(t))throw Error(mt(299));var i=!1,l="",f=DE;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(l=e.identifierPrefix),e.onRecoverableError!==void 0&&(f=e.onRecoverableError)),e=xb(t,1,!1,null,null,i,!1,l,f),t[Jl]=e.current,Op(t.nodeType===8?t.parentNode:t),new wb(e)};fo.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(mt(188)):(t=Object.keys(t).join(","),Error(mt(268,t)));return t=r2(e),t=t===null?null:t.stateNode,t};fo.flushSync=function(t){return fh(t)};fo.hydrate=function(t,e,i){if(!K_(e))throw Error(mt(200));return X_(null,t,e,!0,i)};fo.hydrateRoot=function(t,e,i){if(!Tb(t))throw Error(mt(405));var l=i!=null&&i.hydratedSources||null,f=!1,v="",g=DE;if(i!=null&&(i.unstable_strictMode===!0&&(f=!0),i.identifierPrefix!==void 0&&(v=i.identifierPrefix),i.onRecoverableError!==void 0&&(g=i.onRecoverableError)),e=zE(e,null,t,1,i??null,f,!1,v,g),t[Jl]=e.current,Op(t),l)for(t=0;t<l.length;t++)i=l[t],f=i._getVersion,f=f(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,f]:e.mutableSourceEagerHydrationData.push(i,f);return new H_(e)};fo.render=function(t,e,i){if(!K_(e))throw Error(mt(200));return X_(null,t,e,!1,i)};fo.unmountComponentAtNode=function(t){if(!K_(t))throw Error(mt(40));return t._reactRootContainer?(fh(function(){X_(null,null,t,!1,function(){t._reactRootContainer=null,t[Jl]=null})}),!0):!1};fo.unstable_batchedUpdates=gb;fo.unstable_renderSubtreeIntoContainer=function(t,e,i,l){if(!K_(i))throw Error(mt(200));if(t==null||t._reactInternals===void 0)throw Error(mt(38));return X_(t,e,i,!1,l)};fo.version="18.3.1-next-f1338f8080-20240426";function NE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NE)}catch(t){console.error(t)}}NE(),NP.exports=fo;var Y_=NP.exports;const gz=z_(Y_);var OE,YT=Y_;OE=YT.createRoot,YT.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qp(){return qp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(t[l]=i[l])}return t},qp.apply(this,arguments)}var Xc;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Xc||(Xc={}));const JT="popstate";function _z(t){t===void 0&&(t={});function e(l,f){let{pathname:v,search:g,hash:c}=l.location;return Jx("",{pathname:v,search:g,hash:c},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function i(l,f){return typeof f=="string"?f:BE(f)}return vz(e,i,null,t)}function ai(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function jE(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function yz(){return Math.random().toString(36).substr(2,8)}function QT(t,e){return{usr:t.state,key:t.key,idx:e}}function Jx(t,e,i,l){return i===void 0&&(i=null),qp({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?ef(e):e,{state:i,key:e&&e.key||l||yz()})}function BE(t){let{pathname:e="/",search:i="",hash:l=""}=t;return i&&i!=="?"&&(e+=i.charAt(0)==="?"?i:"?"+i),l&&l!=="#"&&(e+=l.charAt(0)==="#"?l:"#"+l),e}function ef(t){let e={};if(t){let i=t.indexOf("#");i>=0&&(e.hash=t.substr(i),t=t.substr(0,i));let l=t.indexOf("?");l>=0&&(e.search=t.substr(l),t=t.substr(0,l)),t&&(e.pathname=t)}return e}function vz(t,e,i,l){l===void 0&&(l={});let{window:f=document.defaultView,v5Compat:v=!1}=l,g=f.history,c=Xc.Pop,A=null,N=Z();N==null&&(N=0,g.replaceState(qp({},g.state,{idx:N}),""));function Z(){return(g.state||{idx:null}).idx}function W(){c=Xc.Pop;let oe=Z(),re=oe==null?null:oe-N;N=oe,A&&A({action:c,location:ie.location,delta:re})}function K(oe,re){c=Xc.Push;let $=Jx(ie.location,oe,re);N=Z()+1;let te=QT($,N),fe=ie.createHref($);try{g.pushState(te,"",fe)}catch(pe){if(pe instanceof DOMException&&pe.name==="DataCloneError")throw pe;f.location.assign(fe)}v&&A&&A({action:c,location:ie.location,delta:1})}function J(oe,re){c=Xc.Replace;let $=Jx(ie.location,oe,re);N=Z();let te=QT($,N),fe=ie.createHref($);g.replaceState(te,"",fe),v&&A&&A({action:c,location:ie.location,delta:0})}function ce(oe){let re=f.location.origin!=="null"?f.location.origin:f.location.href,$=typeof oe=="string"?oe:BE(oe);return $=$.replace(/ $/,"%20"),ai(re,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,re)}let ie={get action(){return c},get location(){return t(f,g)},listen(oe){if(A)throw new Error("A history only accepts one active listener");return f.addEventListener(JT,W),A=oe,()=>{f.removeEventListener(JT,W),A=null}},createHref(oe){return e(f,oe)},createURL:ce,encodeLocation(oe){let re=ce(oe);return{pathname:re.pathname,search:re.search,hash:re.hash}},push:K,replace:J,go(oe){return g.go(oe)}};return ie}var eS;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(eS||(eS={}));function xz(t,e,i){return i===void 0&&(i="/"),bz(t,e,i)}function bz(t,e,i,l){let f=typeof e=="string"?ef(e):e,v=VE(f.pathname||"/",i);if(v==null)return null;let g=FE(t);wz(g);let c=null;for(let A=0;c==null&&A<g.length;++A){let N=zz(v);c=Az(g[A],N)}return c}function FE(t,e,i,l){e===void 0&&(e=[]),i===void 0&&(i=[]),l===void 0&&(l="");let f=(v,g,c)=>{let A={relativePath:c===void 0?v.path||"":c,caseSensitive:v.caseSensitive===!0,childrenIndex:g,route:v};A.relativePath.startsWith("/")&&(ai(A.relativePath.startsWith(l),'Absolute route path "'+A.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),A.relativePath=A.relativePath.slice(l.length));let N=oh([l,A.relativePath]),Z=i.concat(A);v.children&&v.children.length>0&&(ai(v.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+N+'".')),FE(v.children,e,Z,N)),!(v.path==null&&!v.index)&&e.push({path:N,score:kz(N,v.index),routesMeta:Z})};return t.forEach((v,g)=>{var c;if(v.path===""||!((c=v.path)!=null&&c.includes("?")))f(v,g);else for(let A of UE(v.path))f(v,g,A)}),e}function UE(t){let e=t.split("/");if(e.length===0)return[];let[i,...l]=e,f=i.endsWith("?"),v=i.replace(/\?$/,"");if(l.length===0)return f?[v,""]:[v];let g=UE(l.join("/")),c=[];return c.push(...g.map(A=>A===""?v:[v,A].join("/"))),f&&c.push(...g),c.map(A=>t.startsWith("/")&&A===""?"/":A)}function wz(t){t.sort((e,i)=>e.score!==i.score?i.score-e.score:Mz(e.routesMeta.map(l=>l.childrenIndex),i.routesMeta.map(l=>l.childrenIndex)))}const Tz=/^:[\w-]+$/,Sz=3,Pz=2,Ez=1,Cz=10,Iz=-2,tS=t=>t==="*";function kz(t,e){let i=t.split("/"),l=i.length;return i.some(tS)&&(l+=Iz),e&&(l+=Pz),i.filter(f=>!tS(f)).reduce((f,v)=>f+(Tz.test(v)?Sz:v===""?Ez:Cz),l)}function Mz(t,e){return t.length===e.length&&t.slice(0,-1).every((l,f)=>l===e[f])?t[t.length-1]-e[e.length-1]:0}function Az(t,e,i){let{routesMeta:l}=t,f={},v="/",g=[];for(let c=0;c<l.length;++c){let A=l[c],N=c===l.length-1,Z=v==="/"?e:e.slice(v.length)||"/",W=Rz({path:A.relativePath,caseSensitive:A.caseSensitive,end:N},Z),K=A.route;if(!W)return null;Object.assign(f,W.params),g.push({params:f,pathname:oh([v,W.pathname]),pathnameBase:jz(oh([v,W.pathnameBase])),route:K}),W.pathnameBase!=="/"&&(v=oh([v,W.pathnameBase]))}return g}function Rz(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[i,l]=Lz(t.path,t.caseSensitive,t.end),f=e.match(i);if(!f)return null;let v=f[0],g=v.replace(/(.)\/+$/,"$1"),c=f.slice(1);return{params:l.reduce((N,Z,W)=>{let{paramName:K,isOptional:J}=Z;if(K==="*"){let ie=c[W]||"";g=v.slice(0,v.length-ie.length).replace(/(.)\/+$/,"$1")}const ce=c[W];return J&&!ce?N[K]=void 0:N[K]=(ce||"").replace(/%2F/g,"/"),N},{}),pathname:v,pathnameBase:g,pattern:t}}function Lz(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!0),jE(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let l=[],f="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,c,A)=>(l.push({paramName:c,isOptional:A!=null}),A?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(l.push({paramName:"*"}),f+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?f+="\\/*$":t!==""&&t!=="/"&&(f+="(?:(?=\\/|$))"),[new RegExp(f,e?void 0:"i"),l]}function zz(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return jE(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function VE(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,l=t.charAt(i);return l&&l!=="/"?null:t.slice(i)||"/"}function Dz(t,e){e===void 0&&(e="/");let{pathname:i,search:l="",hash:f=""}=typeof t=="string"?ef(t):t;return{pathname:i?i.startsWith("/")?i:Nz(i,e):e,search:Bz(l),hash:Fz(f)}}function Nz(t,e){let i=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(f=>{f===".."?i.length>1&&i.pop():f!=="."&&i.push(f)}),i.length>1?i.join("/"):"/"}function Mv(t,e,i,l){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Oz(t){return t.filter((e,i)=>i===0||e.route.path&&e.route.path.length>0)}function $E(t,e){let i=Oz(t);return e?i.map((l,f)=>f===i.length-1?l.pathname:l.pathnameBase):i.map(l=>l.pathnameBase)}function ZE(t,e,i,l){l===void 0&&(l=!1);let f;typeof t=="string"?f=ef(t):(f=qp({},t),ai(!f.pathname||!f.pathname.includes("?"),Mv("?","pathname","search",f)),ai(!f.pathname||!f.pathname.includes("#"),Mv("#","pathname","hash",f)),ai(!f.search||!f.search.includes("#"),Mv("#","search","hash",f)));let v=t===""||f.pathname==="",g=v?"/":f.pathname,c;if(g==null)c=i;else{let W=e.length-1;if(!l&&g.startsWith("..")){let K=g.split("/");for(;K[0]==="..";)K.shift(),W-=1;f.pathname=K.join("/")}c=W>=0?e[W]:"/"}let A=Dz(f,c),N=g&&g!=="/"&&g.endsWith("/"),Z=(v||g===".")&&i.endsWith("/");return!A.pathname.endsWith("/")&&(N||Z)&&(A.pathname+="/"),A}const oh=t=>t.join("/").replace(/\/\/+/g,"/"),jz=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Bz=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Fz=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Uz(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const GE=["post","put","patch","delete"];new Set(GE);const Vz=["get",...GE];new Set(Vz);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wp(){return Wp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(t[l]=i[l])}return t},Wp.apply(this,arguments)}const Sb=se.createContext(null),$z=se.createContext(null),sm=se.createContext(null),J_=se.createContext(null),yh=se.createContext({outlet:null,matches:[],isDataRoute:!1}),qE=se.createContext(null);function om(){return se.useContext(J_)!=null}function Pb(){return om()||ai(!1),se.useContext(J_).location}function WE(t){se.useContext(sm).static||se.useLayoutEffect(t)}function vh(){let{isDataRoute:t}=se.useContext(yh);return t?nD():Zz()}function Zz(){om()||ai(!1);let t=se.useContext(Sb),{basename:e,future:i,navigator:l}=se.useContext(sm),{matches:f}=se.useContext(yh),{pathname:v}=Pb(),g=JSON.stringify($E(f,i.v7_relativeSplatPath)),c=se.useRef(!1);return WE(()=>{c.current=!0}),se.useCallback(function(N,Z){if(Z===void 0&&(Z={}),!c.current)return;if(typeof N=="number"){l.go(N);return}let W=ZE(N,JSON.parse(g),v,Z.relative==="path");t==null&&e!=="/"&&(W.pathname=W.pathname==="/"?e:oh([e,W.pathname])),(Z.replace?l.replace:l.push)(W,Z.state,Z)},[e,l,g,v,t])}function Gz(t,e){return qz(t,e)}function qz(t,e,i,l){om()||ai(!1);let{navigator:f}=se.useContext(sm),{matches:v}=se.useContext(yh),g=v[v.length-1],c=g?g.params:{};g&&g.pathname;let A=g?g.pathnameBase:"/";g&&g.route;let N=Pb(),Z;if(e){var W;let oe=typeof e=="string"?ef(e):e;A==="/"||(W=oe.pathname)!=null&&W.startsWith(A)||ai(!1),Z=oe}else Z=N;let K=Z.pathname||"/",J=K;if(A!=="/"){let oe=A.replace(/^\//,"").split("/");J="/"+K.replace(/^\//,"").split("/").slice(oe.length).join("/")}let ce=xz(t,{pathname:J}),ie=Yz(ce&&ce.map(oe=>Object.assign({},oe,{params:Object.assign({},c,oe.params),pathname:oh([A,f.encodeLocation?f.encodeLocation(oe.pathname).pathname:oe.pathname]),pathnameBase:oe.pathnameBase==="/"?A:oh([A,f.encodeLocation?f.encodeLocation(oe.pathnameBase).pathname:oe.pathnameBase])})),v,i,l);return e&&ie?se.createElement(J_.Provider,{value:{location:Wp({pathname:"/",search:"",hash:"",state:null,key:"default"},Z),navigationType:Xc.Pop}},ie):ie}function Wz(){let t=tD(),e=Uz(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),i=t instanceof Error?t.stack:null,f={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return se.createElement(se.Fragment,null,se.createElement("h2",null,"Unexpected Application Error!"),se.createElement("h3",{style:{fontStyle:"italic"}},e),i?se.createElement("pre",{style:f},i):null,null)}const Hz=se.createElement(Wz,null);class Kz extends se.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,i){return i.location!==e.location||i.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:i.error,location:i.location,revalidation:e.revalidation||i.revalidation}}componentDidCatch(e,i){console.error("React Router caught the following error during render",e,i)}render(){return this.state.error!==void 0?se.createElement(yh.Provider,{value:this.props.routeContext},se.createElement(qE.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Xz(t){let{routeContext:e,match:i,children:l}=t,f=se.useContext(Sb);return f&&f.static&&f.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(f.staticContext._deepestRenderedBoundaryId=i.route.id),se.createElement(yh.Provider,{value:e},l)}function Yz(t,e,i,l){var f;if(e===void 0&&(e=[]),i===void 0&&(i=null),l===void 0&&(l=null),t==null){var v;if(!i)return null;if(i.errors)t=i.matches;else if((v=l)!=null&&v.v7_partialHydration&&e.length===0&&!i.initialized&&i.matches.length>0)t=i.matches;else return null}let g=t,c=(f=i)==null?void 0:f.errors;if(c!=null){let Z=g.findIndex(W=>W.route.id&&(c==null?void 0:c[W.route.id])!==void 0);Z>=0||ai(!1),g=g.slice(0,Math.min(g.length,Z+1))}let A=!1,N=-1;if(i&&l&&l.v7_partialHydration)for(let Z=0;Z<g.length;Z++){let W=g[Z];if((W.route.HydrateFallback||W.route.hydrateFallbackElement)&&(N=Z),W.route.id){let{loaderData:K,errors:J}=i,ce=W.route.loader&&K[W.route.id]===void 0&&(!J||J[W.route.id]===void 0);if(W.route.lazy||ce){A=!0,N>=0?g=g.slice(0,N+1):g=[g[0]];break}}}return g.reduceRight((Z,W,K)=>{let J,ce=!1,ie=null,oe=null;i&&(J=c&&W.route.id?c[W.route.id]:void 0,ie=W.route.errorElement||Hz,A&&(N<0&&K===0?(rD("route-fallback"),ce=!0,oe=null):N===K&&(ce=!0,oe=W.route.hydrateFallbackElement||null)));let re=e.concat(g.slice(0,K+1)),$=()=>{let te;return J?te=ie:ce?te=oe:W.route.Component?te=se.createElement(W.route.Component,null):W.route.element?te=W.route.element:te=Z,se.createElement(Xz,{match:W,routeContext:{outlet:Z,matches:re,isDataRoute:i!=null},children:te})};return i&&(W.route.ErrorBoundary||W.route.errorElement||K===0)?se.createElement(Kz,{location:i.location,revalidation:i.revalidation,component:ie,error:J,children:$(),routeContext:{outlet:null,matches:re,isDataRoute:!0}}):$()},null)}var HE=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(HE||{}),KE=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(KE||{});function Jz(t){let e=se.useContext(Sb);return e||ai(!1),e}function Qz(t){let e=se.useContext($z);return e||ai(!1),e}function eD(t){let e=se.useContext(yh);return e||ai(!1),e}function XE(t){let e=eD(),i=e.matches[e.matches.length-1];return i.route.id||ai(!1),i.route.id}function tD(){var t;let e=se.useContext(qE),i=Qz(),l=XE();return e!==void 0?e:(t=i.errors)==null?void 0:t[l]}function nD(){let{router:t}=Jz(HE.UseNavigateStable),e=XE(KE.UseNavigateStable),i=se.useRef(!1);return WE(()=>{i.current=!0}),se.useCallback(function(f,v){v===void 0&&(v={}),i.current&&(typeof f=="number"?t.navigate(f):t.navigate(f,Wp({fromRouteId:e},v)))},[t,e])}const nS={};function rD(t,e,i){nS[t]||(nS[t]=!0)}function iD(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function ep(t){let{to:e,replace:i,state:l,relative:f}=t;om()||ai(!1);let{future:v,static:g}=se.useContext(sm),{matches:c}=se.useContext(yh),{pathname:A}=Pb(),N=vh(),Z=ZE(e,$E(c,v.v7_relativeSplatPath),A,f==="path"),W=JSON.stringify(Z);return se.useEffect(()=>N(JSON.parse(W),{replace:i,state:l,relative:f}),[N,W,f,i,l]),null}function ll(t){ai(!1)}function sD(t){let{basename:e="/",children:i=null,location:l,navigationType:f=Xc.Pop,navigator:v,static:g=!1,future:c}=t;om()&&ai(!1);let A=e.replace(/^\/*/,"/"),N=se.useMemo(()=>({basename:A,navigator:v,static:g,future:Wp({v7_relativeSplatPath:!1},c)}),[A,c,v,g]);typeof l=="string"&&(l=ef(l));let{pathname:Z="/",search:W="",hash:K="",state:J=null,key:ce="default"}=l,ie=se.useMemo(()=>{let oe=VE(Z,A);return oe==null?null:{location:{pathname:oe,search:W,hash:K,state:J,key:ce},navigationType:f}},[A,Z,W,K,J,ce,f]);return ie==null?null:se.createElement(sm.Provider,{value:N},se.createElement(J_.Provider,{children:i,value:ie}))}function oD(t){let{children:e,location:i}=t;return Gz(Qx(e),i)}new Promise(()=>{});function Qx(t,e){e===void 0&&(e=[]);let i=[];return se.Children.forEach(t,(l,f)=>{if(!se.isValidElement(l))return;let v=[...e,f];if(l.type===se.Fragment){i.push.apply(i,Qx(l.props.children,v));return}l.type!==ll&&ai(!1),!l.props.index||!l.props.children||ai(!1);let g={id:l.props.id||v.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(g.children=Qx(l.props.children,v)),i.push(g)}),i}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const aD="6";try{window.__reactRouterVersion=aD}catch{}const lD="startTransition",rS=L0[lD];function cD(t){let{basename:e,children:i,future:l,window:f}=t,v=se.useRef();v.current==null&&(v.current=_z({window:f,v5Compat:!0}));let g=v.current,[c,A]=se.useState({action:g.action,location:g.location}),{v7_startTransition:N}=l||{},Z=se.useCallback(W=>{N&&rS?rS(()=>A(W)):A(W)},[A,N]);return se.useLayoutEffect(()=>g.listen(Z),[g,Z]),se.useEffect(()=>iD(l),[l]),se.createElement(sD,{basename:e,children:i,location:c.location,navigationType:c.action,navigator:g,future:l})}var iS;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(iS||(iS={}));var sS;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(sS||(sS={}));class uD{constructor(e={}){console.warn("[AirtableMock] API key/base id missing. Running in mock mode. Features requiring Airtable will be disabled.")}base(e){return function(i){return{select(f={}){return{all:async()=>(console.warn(`[AirtableMock] select.all() called for table "${i}" (mock returns empty array)`),[])}},create(f=[]){console.warn(`[AirtableMock] create() called for table "${i}" (mock returns echo)`);const v=f[0]&&f[0].fields||{};return Promise.resolve([{id:"mock-id",fields:v}])},update(f=[]){return console.warn(`[AirtableMock] update() called for table "${i}" (mock resolves)`),Promise.resolve()},find(f){return console.warn(`[AirtableMock] find(${f}) called for table "${i}" (mock returns empty record)`),Promise.resolve({id:"mock-id",fields:{}})}}}}}const Av=new uD({apiKey:void 0}).base(void 0),Rv={async get(t,e=""){return(await Av(t).select({filterByFormula:e}).all()).map(l=>({id:l.id,...l.fields}))},async create(t,e){const i=await Av(t).create([{fields:e}]);return{id:i[0].id,...i[0].fields}},async update(t,e,i){await Av(t).update([{id:e,fields:i}])}},hD={functions:{invoke:async()=>{throw new Error("Supabase ???")}}};function YE(t,e){return function(){return t.apply(e,arguments)}}const{toString:dD}=Object.prototype,{getPrototypeOf:Eb}=Object,{iterator:Q_,toStringTag:JE}=Symbol,ey=(t=>e=>{const i=dD.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Ta=t=>(t=t.toLowerCase(),e=>ey(e)===t),ty=t=>e=>typeof e===t,{isArray:tf}=Array,qd=ty("undefined");function am(t){return t!==null&&!qd(t)&&t.constructor!==null&&!qd(t.constructor)&&Vs(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const QE=Ta("ArrayBuffer");function fD(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&QE(t.buffer),e}const pD=ty("string"),Vs=ty("function"),eC=ty("number"),lm=t=>t!==null&&typeof t=="object",mD=t=>t===!0||t===!1,Fg=t=>{if(ey(t)!=="object")return!1;const e=Eb(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(JE in t)&&!(Q_ in t)},gD=t=>{if(!lm(t)||am(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},_D=Ta("Date"),yD=Ta("File"),vD=Ta("Blob"),xD=Ta("FileList"),bD=t=>lm(t)&&Vs(t.pipe),wD=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Vs(t.append)&&((e=ey(t))==="formdata"||e==="object"&&Vs(t.toString)&&t.toString()==="[object FormData]"))},TD=Ta("URLSearchParams"),[SD,PD,ED,CD]=["ReadableStream","Request","Response","Headers"].map(Ta),ID=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function cm(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let l,f;if(typeof t!="object"&&(t=[t]),tf(t))for(l=0,f=t.length;l<f;l++)e.call(null,t[l],l,t);else{if(am(t))return;const v=i?Object.getOwnPropertyNames(t):Object.keys(t),g=v.length;let c;for(l=0;l<g;l++)c=v[l],e.call(null,t[c],c,t)}}function tC(t,e){if(am(t))return null;e=e.toLowerCase();const i=Object.keys(t);let l=i.length,f;for(;l-- >0;)if(f=i[l],e===f.toLowerCase())return f;return null}const rh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,nC=t=>!qd(t)&&t!==rh;function e0(){const{caseless:t,skipUndefined:e}=nC(this)&&this||{},i={},l=(f,v)=>{const g=t&&tC(i,v)||v;Fg(i[g])&&Fg(f)?i[g]=e0(i[g],f):Fg(f)?i[g]=e0({},f):tf(f)?i[g]=f.slice():(!e||!qd(f))&&(i[g]=f)};for(let f=0,v=arguments.length;f<v;f++)arguments[f]&&cm(arguments[f],l);return i}const kD=(t,e,i,{allOwnKeys:l}={})=>(cm(e,(f,v)=>{i&&Vs(f)?t[v]=YE(f,i):t[v]=f},{allOwnKeys:l}),t),MD=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),AD=(t,e,i,l)=>{t.prototype=Object.create(e.prototype,l),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},RD=(t,e,i,l)=>{let f,v,g;const c={};if(e=e||{},t==null)return e;do{for(f=Object.getOwnPropertyNames(t),v=f.length;v-- >0;)g=f[v],(!l||l(g,t,e))&&!c[g]&&(e[g]=t[g],c[g]=!0);t=i!==!1&&Eb(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},LD=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const l=t.indexOf(e,i);return l!==-1&&l===i},zD=t=>{if(!t)return null;if(tf(t))return t;let e=t.length;if(!eC(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},DD=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Eb(Uint8Array)),ND=(t,e)=>{const l=(t&&t[Q_]).call(t);let f;for(;(f=l.next())&&!f.done;){const v=f.value;e.call(t,v[0],v[1])}},OD=(t,e)=>{let i;const l=[];for(;(i=t.exec(e))!==null;)l.push(i);return l},jD=Ta("HTMLFormElement"),BD=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,l,f){return l.toUpperCase()+f}),oS=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),FD=Ta("RegExp"),rC=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),l={};cm(i,(f,v)=>{let g;(g=e(f,v,t))!==!1&&(l[v]=g||f)}),Object.defineProperties(t,l)},UD=t=>{rC(t,(e,i)=>{if(Vs(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const l=t[i];if(Vs(l)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},VD=(t,e)=>{const i={},l=f=>{f.forEach(v=>{i[v]=!0})};return tf(t)?l(t):l(String(t).split(e)),i},$D=()=>{},ZD=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function GD(t){return!!(t&&Vs(t.append)&&t[JE]==="FormData"&&t[Q_])}const qD=t=>{const e=new Array(10),i=(l,f)=>{if(lm(l)){if(e.indexOf(l)>=0)return;if(am(l))return l;if(!("toJSON"in l)){e[f]=l;const v=tf(l)?[]:{};return cm(l,(g,c)=>{const A=i(g,f+1);!qd(A)&&(v[c]=A)}),e[f]=void 0,v}}return l};return i(t,0)},WD=Ta("AsyncFunction"),HD=t=>t&&(lm(t)||Vs(t))&&Vs(t.then)&&Vs(t.catch),iC=((t,e)=>t?setImmediate:e?((i,l)=>(rh.addEventListener("message",({source:f,data:v})=>{f===rh&&v===i&&l.length&&l.shift()()},!1),f=>{l.push(f),rh.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",Vs(rh.postMessage)),KD=typeof queueMicrotask<"u"?queueMicrotask.bind(rh):typeof process<"u"&&process.nextTick||iC,XD=t=>t!=null&&Vs(t[Q_]),Je={isArray:tf,isArrayBuffer:QE,isBuffer:am,isFormData:wD,isArrayBufferView:fD,isString:pD,isNumber:eC,isBoolean:mD,isObject:lm,isPlainObject:Fg,isEmptyObject:gD,isReadableStream:SD,isRequest:PD,isResponse:ED,isHeaders:CD,isUndefined:qd,isDate:_D,isFile:yD,isBlob:vD,isRegExp:FD,isFunction:Vs,isStream:bD,isURLSearchParams:TD,isTypedArray:DD,isFileList:xD,forEach:cm,merge:e0,extend:kD,trim:ID,stripBOM:MD,inherits:AD,toFlatObject:RD,kindOf:ey,kindOfTest:Ta,endsWith:LD,toArray:zD,forEachEntry:ND,matchAll:OD,isHTMLForm:jD,hasOwnProperty:oS,hasOwnProp:oS,reduceDescriptors:rC,freezeMethods:UD,toObjectSet:VD,toCamelCase:BD,noop:$D,toFiniteNumber:ZD,findKey:tC,global:rh,isContextDefined:nC,isSpecCompliantForm:GD,toJSONObject:qD,isAsyncFn:WD,isThenable:HD,setImmediate:iC,asap:KD,isIterable:XD};function hn(t,e,i,l,f){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),l&&(this.request=l),f&&(this.response=f,this.status=f.status?f.status:null)}Je.inherits(hn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Je.toJSONObject(this.config),code:this.code,status:this.status}}});const sC=hn.prototype,oC={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{oC[t]={value:t}});Object.defineProperties(hn,oC);Object.defineProperty(sC,"isAxiosError",{value:!0});hn.from=(t,e,i,l,f,v)=>{const g=Object.create(sC);Je.toFlatObject(t,g,function(Z){return Z!==Error.prototype},N=>N!=="isAxiosError");const c=t&&t.message?t.message:"Error",A=e==null&&t?t.code:e;return hn.call(g,c,A,i,l,f),t&&g.cause==null&&Object.defineProperty(g,"cause",{value:t,configurable:!0}),g.name=t&&t.name||"Error",v&&Object.assign(g,v),g};const YD=null;function t0(t){return Je.isPlainObject(t)||Je.isArray(t)}function aC(t){return Je.endsWith(t,"[]")?t.slice(0,-2):t}function aS(t,e,i){return t?t.concat(e).map(function(f,v){return f=aC(f),!i&&v?"["+f+"]":f}).join(i?".":""):e}function JD(t){return Je.isArray(t)&&!t.some(t0)}const QD=Je.toFlatObject(Je,{},null,function(e){return/^is[A-Z]/.test(e)});function ny(t,e,i){if(!Je.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=Je.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ie,oe){return!Je.isUndefined(oe[ie])});const l=i.metaTokens,f=i.visitor||Z,v=i.dots,g=i.indexes,A=(i.Blob||typeof Blob<"u"&&Blob)&&Je.isSpecCompliantForm(e);if(!Je.isFunction(f))throw new TypeError("visitor must be a function");function N(ce){if(ce===null)return"";if(Je.isDate(ce))return ce.toISOString();if(Je.isBoolean(ce))return ce.toString();if(!A&&Je.isBlob(ce))throw new hn("Blob is not supported. Use a Buffer instead.");return Je.isArrayBuffer(ce)||Je.isTypedArray(ce)?A&&typeof Blob=="function"?new Blob([ce]):Buffer.from(ce):ce}function Z(ce,ie,oe){let re=ce;if(ce&&!oe&&typeof ce=="object"){if(Je.endsWith(ie,"{}"))ie=l?ie:ie.slice(0,-2),ce=JSON.stringify(ce);else if(Je.isArray(ce)&&JD(ce)||(Je.isFileList(ce)||Je.endsWith(ie,"[]"))&&(re=Je.toArray(ce)))return ie=aC(ie),re.forEach(function(te,fe){!(Je.isUndefined(te)||te===null)&&e.append(g===!0?aS([ie],fe,v):g===null?ie:ie+"[]",N(te))}),!1}return t0(ce)?!0:(e.append(aS(oe,ie,v),N(ce)),!1)}const W=[],K=Object.assign(QD,{defaultVisitor:Z,convertValue:N,isVisitable:t0});function J(ce,ie){if(!Je.isUndefined(ce)){if(W.indexOf(ce)!==-1)throw Error("Circular reference detected in "+ie.join("."));W.push(ce),Je.forEach(ce,function(re,$){(!(Je.isUndefined(re)||re===null)&&f.call(e,re,Je.isString($)?$.trim():$,ie,K))===!0&&J(re,ie?ie.concat($):[$])}),W.pop()}}if(!Je.isObject(t))throw new TypeError("data must be an object");return J(t),e}function lS(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(l){return e[l]})}function Cb(t,e){this._pairs=[],t&&ny(t,this,e)}const lC=Cb.prototype;lC.append=function(e,i){this._pairs.push([e,i])};lC.toString=function(e){const i=e?function(l){return e.call(this,l,lS)}:lS;return this._pairs.map(function(f){return i(f[0])+"="+i(f[1])},"").join("&")};function eN(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function cC(t,e,i){if(!e)return t;const l=i&&i.encode||eN;Je.isFunction(i)&&(i={serialize:i});const f=i&&i.serialize;let v;if(f?v=f(e,i):v=Je.isURLSearchParams(e)?e.toString():new Cb(e,i).toString(l),v){const g=t.indexOf("#");g!==-1&&(t=t.slice(0,g)),t+=(t.indexOf("?")===-1?"?":"&")+v}return t}class cS{constructor(){this.handlers=[]}use(e,i,l){return this.handlers.push({fulfilled:e,rejected:i,synchronous:l?l.synchronous:!1,runWhen:l?l.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Je.forEach(this.handlers,function(l){l!==null&&e(l)})}}const uC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},tN=typeof URLSearchParams<"u"?URLSearchParams:Cb,nN=typeof FormData<"u"?FormData:null,rN=typeof Blob<"u"?Blob:null,iN={isBrowser:!0,classes:{URLSearchParams:tN,FormData:nN,Blob:rN},protocols:["http","https","file","blob","url","data"]},Ib=typeof window<"u"&&typeof document<"u",n0=typeof navigator=="object"&&navigator||void 0,sN=Ib&&(!n0||["ReactNative","NativeScript","NS"].indexOf(n0.product)<0),oN=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",aN=Ib&&window.location.href||"http://localhost",lN=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ib,hasStandardBrowserEnv:sN,hasStandardBrowserWebWorkerEnv:oN,navigator:n0,origin:aN},Symbol.toStringTag,{value:"Module"})),ts={...lN,...iN};function cN(t,e){return ny(t,new ts.classes.URLSearchParams,{visitor:function(i,l,f,v){return ts.isNode&&Je.isBuffer(i)?(this.append(l,i.toString("base64")),!1):v.defaultVisitor.apply(this,arguments)},...e})}function uN(t){return Je.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function hN(t){const e={},i=Object.keys(t);let l;const f=i.length;let v;for(l=0;l<f;l++)v=i[l],e[v]=t[v];return e}function hC(t){function e(i,l,f,v){let g=i[v++];if(g==="__proto__")return!0;const c=Number.isFinite(+g),A=v>=i.length;return g=!g&&Je.isArray(f)?f.length:g,A?(Je.hasOwnProp(f,g)?f[g]=[f[g],l]:f[g]=l,!c):((!f[g]||!Je.isObject(f[g]))&&(f[g]=[]),e(i,l,f[g],v)&&Je.isArray(f[g])&&(f[g]=hN(f[g])),!c)}if(Je.isFormData(t)&&Je.isFunction(t.entries)){const i={};return Je.forEachEntry(t,(l,f)=>{e(uN(l),f,i,0)}),i}return null}function dN(t,e,i){if(Je.isString(t))try{return(e||JSON.parse)(t),Je.trim(t)}catch(l){if(l.name!=="SyntaxError")throw l}return(i||JSON.stringify)(t)}const um={transitional:uC,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const l=i.getContentType()||"",f=l.indexOf("application/json")>-1,v=Je.isObject(e);if(v&&Je.isHTMLForm(e)&&(e=new FormData(e)),Je.isFormData(e))return f?JSON.stringify(hC(e)):e;if(Je.isArrayBuffer(e)||Je.isBuffer(e)||Je.isStream(e)||Je.isFile(e)||Je.isBlob(e)||Je.isReadableStream(e))return e;if(Je.isArrayBufferView(e))return e.buffer;if(Je.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(v){if(l.indexOf("application/x-www-form-urlencoded")>-1)return cN(e,this.formSerializer).toString();if((c=Je.isFileList(e))||l.indexOf("multipart/form-data")>-1){const A=this.env&&this.env.FormData;return ny(c?{"files[]":e}:e,A&&new A,this.formSerializer)}}return v||f?(i.setContentType("application/json",!1),dN(e)):e}],transformResponse:[function(e){const i=this.transitional||um.transitional,l=i&&i.forcedJSONParsing,f=this.responseType==="json";if(Je.isResponse(e)||Je.isReadableStream(e))return e;if(e&&Je.isString(e)&&(l&&!this.responseType||f)){const g=!(i&&i.silentJSONParsing)&&f;try{return JSON.parse(e,this.parseReviver)}catch(c){if(g)throw c.name==="SyntaxError"?hn.from(c,hn.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ts.classes.FormData,Blob:ts.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Je.forEach(["delete","get","head","post","put","patch"],t=>{um.headers[t]={}});const fN=Je.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),pN=t=>{const e={};let i,l,f;return t&&t.split(`
`).forEach(function(g){f=g.indexOf(":"),i=g.substring(0,f).trim().toLowerCase(),l=g.substring(f+1).trim(),!(!i||e[i]&&fN[i])&&(i==="set-cookie"?e[i]?e[i].push(l):e[i]=[l]:e[i]=e[i]?e[i]+", "+l:l)}),e},uS=Symbol("internals");function tp(t){return t&&String(t).trim().toLowerCase()}function Ug(t){return t===!1||t==null?t:Je.isArray(t)?t.map(Ug):String(t)}function mN(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=i.exec(t);)e[l[1]]=l[2];return e}const gN=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Lv(t,e,i,l,f){if(Je.isFunction(l))return l.call(this,e,i);if(f&&(e=i),!!Je.isString(e)){if(Je.isString(l))return e.indexOf(l)!==-1;if(Je.isRegExp(l))return l.test(e)}}function _N(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,l)=>i.toUpperCase()+l)}function yN(t,e){const i=Je.toCamelCase(" "+e);["get","set","has"].forEach(l=>{Object.defineProperty(t,l+i,{value:function(f,v,g){return this[l].call(this,e,f,v,g)},configurable:!0})})}let $s=class{constructor(e){e&&this.set(e)}set(e,i,l){const f=this;function v(c,A,N){const Z=tp(A);if(!Z)throw new Error("header name must be a non-empty string");const W=Je.findKey(f,Z);(!W||f[W]===void 0||N===!0||N===void 0&&f[W]!==!1)&&(f[W||A]=Ug(c))}const g=(c,A)=>Je.forEach(c,(N,Z)=>v(N,Z,A));if(Je.isPlainObject(e)||e instanceof this.constructor)g(e,i);else if(Je.isString(e)&&(e=e.trim())&&!gN(e))g(pN(e),i);else if(Je.isObject(e)&&Je.isIterable(e)){let c={},A,N;for(const Z of e){if(!Je.isArray(Z))throw TypeError("Object iterator must return a key-value pair");c[N=Z[0]]=(A=c[N])?Je.isArray(A)?[...A,Z[1]]:[A,Z[1]]:Z[1]}g(c,i)}else e!=null&&v(i,e,l);return this}get(e,i){if(e=tp(e),e){const l=Je.findKey(this,e);if(l){const f=this[l];if(!i)return f;if(i===!0)return mN(f);if(Je.isFunction(i))return i.call(this,f,l);if(Je.isRegExp(i))return i.exec(f);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=tp(e),e){const l=Je.findKey(this,e);return!!(l&&this[l]!==void 0&&(!i||Lv(this,this[l],l,i)))}return!1}delete(e,i){const l=this;let f=!1;function v(g){if(g=tp(g),g){const c=Je.findKey(l,g);c&&(!i||Lv(l,l[c],c,i))&&(delete l[c],f=!0)}}return Je.isArray(e)?e.forEach(v):v(e),f}clear(e){const i=Object.keys(this);let l=i.length,f=!1;for(;l--;){const v=i[l];(!e||Lv(this,this[v],v,e,!0))&&(delete this[v],f=!0)}return f}normalize(e){const i=this,l={};return Je.forEach(this,(f,v)=>{const g=Je.findKey(l,v);if(g){i[g]=Ug(f),delete i[v];return}const c=e?_N(v):String(v).trim();c!==v&&delete i[v],i[c]=Ug(f),l[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Je.forEach(this,(l,f)=>{l!=null&&l!==!1&&(i[f]=e&&Je.isArray(l)?l.join(", "):l)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const l=new this(e);return i.forEach(f=>l.set(f)),l}static accessor(e){const l=(this[uS]=this[uS]={accessors:{}}).accessors,f=this.prototype;function v(g){const c=tp(g);l[c]||(yN(f,g),l[c]=!0)}return Je.isArray(e)?e.forEach(v):v(e),this}};$s.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Je.reduceDescriptors($s.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(l){this[i]=l}}});Je.freezeMethods($s);function zv(t,e){const i=this||um,l=e||i,f=$s.from(l.headers);let v=l.data;return Je.forEach(t,function(c){v=c.call(i,v,f.normalize(),e?e.status:void 0)}),f.normalize(),v}function dC(t){return!!(t&&t.__CANCEL__)}function nf(t,e,i){hn.call(this,t??"canceled",hn.ERR_CANCELED,e,i),this.name="CanceledError"}Je.inherits(nf,hn,{__CANCEL__:!0});function fC(t,e,i){const l=i.config.validateStatus;!i.status||!l||l(i.status)?t(i):e(new hn("Request failed with status code "+i.status,[hn.ERR_BAD_REQUEST,hn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function vN(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function xN(t,e){t=t||10;const i=new Array(t),l=new Array(t);let f=0,v=0,g;return e=e!==void 0?e:1e3,function(A){const N=Date.now(),Z=l[v];g||(g=N),i[f]=A,l[f]=N;let W=v,K=0;for(;W!==f;)K+=i[W++],W=W%t;if(f=(f+1)%t,f===v&&(v=(v+1)%t),N-g<e)return;const J=Z&&N-Z;return J?Math.round(K*1e3/J):void 0}}function bN(t,e){let i=0,l=1e3/e,f,v;const g=(N,Z=Date.now())=>{i=Z,f=null,v&&(clearTimeout(v),v=null),t(...N)};return[(...N)=>{const Z=Date.now(),W=Z-i;W>=l?g(N,Z):(f=N,v||(v=setTimeout(()=>{v=null,g(f)},l-W)))},()=>f&&g(f)]}const S_=(t,e,i=3)=>{let l=0;const f=xN(50,250);return bN(v=>{const g=v.loaded,c=v.lengthComputable?v.total:void 0,A=g-l,N=f(A),Z=g<=c;l=g;const W={loaded:g,total:c,progress:c?g/c:void 0,bytes:A,rate:N||void 0,estimated:N&&c&&Z?(c-g)/N:void 0,event:v,lengthComputable:c!=null,[e?"download":"upload"]:!0};t(W)},i)},hS=(t,e)=>{const i=t!=null;return[l=>e[0]({lengthComputable:i,total:t,loaded:l}),e[1]]},dS=t=>(...e)=>Je.asap(()=>t(...e)),wN=ts.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,ts.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(ts.origin),ts.navigator&&/(msie|trident)/i.test(ts.navigator.userAgent)):()=>!0,TN=ts.hasStandardBrowserEnv?{write(t,e,i,l,f,v){const g=[t+"="+encodeURIComponent(e)];Je.isNumber(i)&&g.push("expires="+new Date(i).toGMTString()),Je.isString(l)&&g.push("path="+l),Je.isString(f)&&g.push("domain="+f),v===!0&&g.push("secure"),document.cookie=g.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function SN(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function PN(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function pC(t,e,i){let l=!SN(e);return t&&(l||i==!1)?PN(t,e):e}const fS=t=>t instanceof $s?{...t}:t;function ph(t,e){e=e||{};const i={};function l(N,Z,W,K){return Je.isPlainObject(N)&&Je.isPlainObject(Z)?Je.merge.call({caseless:K},N,Z):Je.isPlainObject(Z)?Je.merge({},Z):Je.isArray(Z)?Z.slice():Z}function f(N,Z,W,K){if(Je.isUndefined(Z)){if(!Je.isUndefined(N))return l(void 0,N,W,K)}else return l(N,Z,W,K)}function v(N,Z){if(!Je.isUndefined(Z))return l(void 0,Z)}function g(N,Z){if(Je.isUndefined(Z)){if(!Je.isUndefined(N))return l(void 0,N)}else return l(void 0,Z)}function c(N,Z,W){if(W in e)return l(N,Z);if(W in t)return l(void 0,N)}const A={url:v,method:v,data:v,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:c,headers:(N,Z,W)=>f(fS(N),fS(Z),W,!0)};return Je.forEach(Object.keys({...t,...e}),function(Z){const W=A[Z]||f,K=W(t[Z],e[Z],Z);Je.isUndefined(K)&&W!==c||(i[Z]=K)}),i}const mC=t=>{const e=ph({},t);let{data:i,withXSRFToken:l,xsrfHeaderName:f,xsrfCookieName:v,headers:g,auth:c}=e;if(e.headers=g=$s.from(g),e.url=cC(pC(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),c&&g.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),Je.isFormData(i)){if(ts.hasStandardBrowserEnv||ts.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if(Je.isFunction(i.getHeaders)){const A=i.getHeaders(),N=["content-type","content-length"];Object.entries(A).forEach(([Z,W])=>{N.includes(Z.toLowerCase())&&g.set(Z,W)})}}if(ts.hasStandardBrowserEnv&&(l&&Je.isFunction(l)&&(l=l(e)),l||l!==!1&&wN(e.url))){const A=f&&v&&TN.read(v);A&&g.set(f,A)}return e},EN=typeof XMLHttpRequest<"u",CN=EN&&function(t){return new Promise(function(i,l){const f=mC(t);let v=f.data;const g=$s.from(f.headers).normalize();let{responseType:c,onUploadProgress:A,onDownloadProgress:N}=f,Z,W,K,J,ce;function ie(){J&&J(),ce&&ce(),f.cancelToken&&f.cancelToken.unsubscribe(Z),f.signal&&f.signal.removeEventListener("abort",Z)}let oe=new XMLHttpRequest;oe.open(f.method.toUpperCase(),f.url,!0),oe.timeout=f.timeout;function re(){if(!oe)return;const te=$s.from("getAllResponseHeaders"in oe&&oe.getAllResponseHeaders()),pe={data:!c||c==="text"||c==="json"?oe.responseText:oe.response,status:oe.status,statusText:oe.statusText,headers:te,config:t,request:oe};fC(function(Ge){i(Ge),ie()},function(Ge){l(Ge),ie()},pe),oe=null}"onloadend"in oe?oe.onloadend=re:oe.onreadystatechange=function(){!oe||oe.readyState!==4||oe.status===0&&!(oe.responseURL&&oe.responseURL.indexOf("file:")===0)||setTimeout(re)},oe.onabort=function(){oe&&(l(new hn("Request aborted",hn.ECONNABORTED,t,oe)),oe=null)},oe.onerror=function(fe){const pe=fe&&fe.message?fe.message:"Network Error",Ie=new hn(pe,hn.ERR_NETWORK,t,oe);Ie.event=fe||null,l(Ie),oe=null},oe.ontimeout=function(){let fe=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded";const pe=f.transitional||uC;f.timeoutErrorMessage&&(fe=f.timeoutErrorMessage),l(new hn(fe,pe.clarifyTimeoutError?hn.ETIMEDOUT:hn.ECONNABORTED,t,oe)),oe=null},v===void 0&&g.setContentType(null),"setRequestHeader"in oe&&Je.forEach(g.toJSON(),function(fe,pe){oe.setRequestHeader(pe,fe)}),Je.isUndefined(f.withCredentials)||(oe.withCredentials=!!f.withCredentials),c&&c!=="json"&&(oe.responseType=f.responseType),N&&([K,ce]=S_(N,!0),oe.addEventListener("progress",K)),A&&oe.upload&&([W,J]=S_(A),oe.upload.addEventListener("progress",W),oe.upload.addEventListener("loadend",J)),(f.cancelToken||f.signal)&&(Z=te=>{oe&&(l(!te||te.type?new nf(null,t,oe):te),oe.abort(),oe=null)},f.cancelToken&&f.cancelToken.subscribe(Z),f.signal&&(f.signal.aborted?Z():f.signal.addEventListener("abort",Z)));const $=vN(f.url);if($&&ts.protocols.indexOf($)===-1){l(new hn("Unsupported protocol "+$+":",hn.ERR_BAD_REQUEST,t));return}oe.send(v||null)})},IN=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let l=new AbortController,f;const v=function(N){if(!f){f=!0,c();const Z=N instanceof Error?N:this.reason;l.abort(Z instanceof hn?Z:new nf(Z instanceof Error?Z.message:Z))}};let g=e&&setTimeout(()=>{g=null,v(new hn(`timeout ${e} of ms exceeded`,hn.ETIMEDOUT))},e);const c=()=>{t&&(g&&clearTimeout(g),g=null,t.forEach(N=>{N.unsubscribe?N.unsubscribe(v):N.removeEventListener("abort",v)}),t=null)};t.forEach(N=>N.addEventListener("abort",v));const{signal:A}=l;return A.unsubscribe=()=>Je.asap(c),A}},kN=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let l=0,f;for(;l<i;)f=l+e,yield t.slice(l,f),l=f},MN=async function*(t,e){for await(const i of AN(t))yield*kN(i,e)},AN=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:l}=await e.read();if(i)break;yield l}}finally{await e.cancel()}},pS=(t,e,i,l)=>{const f=MN(t,e);let v=0,g,c=A=>{g||(g=!0,l&&l(A))};return new ReadableStream({async pull(A){try{const{done:N,value:Z}=await f.next();if(N){c(),A.close();return}let W=Z.byteLength;if(i){let K=v+=W;i(K)}A.enqueue(new Uint8Array(Z))}catch(N){throw c(N),N}},cancel(A){return c(A),f.return()}},{highWaterMark:2})},mS=64*1024,{isFunction:xg}=Je,RN=(({Request:t,Response:e})=>({Request:t,Response:e}))(Je.global),{ReadableStream:gS,TextEncoder:_S}=Je.global,yS=(t,...e)=>{try{return!!t(...e)}catch{return!1}},LN=t=>{t=Je.merge.call({skipUndefined:!0},RN,t);const{fetch:e,Request:i,Response:l}=t,f=e?xg(e):typeof fetch=="function",v=xg(i),g=xg(l);if(!f)return!1;const c=f&&xg(gS),A=f&&(typeof _S=="function"?(ce=>ie=>ce.encode(ie))(new _S):async ce=>new Uint8Array(await new i(ce).arrayBuffer())),N=v&&c&&yS(()=>{let ce=!1;const ie=new i(ts.origin,{body:new gS,method:"POST",get duplex(){return ce=!0,"half"}}).headers.has("Content-Type");return ce&&!ie}),Z=g&&c&&yS(()=>Je.isReadableStream(new l("").body)),W={stream:Z&&(ce=>ce.body)};f&&["text","arrayBuffer","blob","formData","stream"].forEach(ce=>{!W[ce]&&(W[ce]=(ie,oe)=>{let re=ie&&ie[ce];if(re)return re.call(ie);throw new hn(`Response type '${ce}' is not supported`,hn.ERR_NOT_SUPPORT,oe)})});const K=async ce=>{if(ce==null)return 0;if(Je.isBlob(ce))return ce.size;if(Je.isSpecCompliantForm(ce))return(await new i(ts.origin,{method:"POST",body:ce}).arrayBuffer()).byteLength;if(Je.isArrayBufferView(ce)||Je.isArrayBuffer(ce))return ce.byteLength;if(Je.isURLSearchParams(ce)&&(ce=ce+""),Je.isString(ce))return(await A(ce)).byteLength},J=async(ce,ie)=>{const oe=Je.toFiniteNumber(ce.getContentLength());return oe??K(ie)};return async ce=>{let{url:ie,method:oe,data:re,signal:$,cancelToken:te,timeout:fe,onDownloadProgress:pe,onUploadProgress:Ie,responseType:Ge,headers:Le,withCredentials:xt="same-origin",fetchOptions:ct}=mC(ce),ht=e||fetch;Ge=Ge?(Ge+"").toLowerCase():"text";let ze=IN([$,te&&te.toAbortSignal()],fe),vt=null;const at=ze&&ze.unsubscribe&&(()=>{ze.unsubscribe()});let Mt;try{if(Ie&&N&&oe!=="get"&&oe!=="head"&&(Mt=await J(Le,re))!==0){let nt=new i(ie,{method:"POST",body:re,duplex:"half"}),_t;if(Je.isFormData(re)&&(_t=nt.headers.get("content-type"))&&Le.setContentType(_t),nt.body){const[Bt,Ft]=hS(Mt,S_(dS(Ie)));re=pS(nt.body,mS,Bt,Ft)}}Je.isString(xt)||(xt=xt?"include":"omit");const wt=v&&"credentials"in i.prototype,jt={...ct,signal:ze,method:oe.toUpperCase(),headers:Le.normalize().toJSON(),body:re,duplex:"half",credentials:wt?xt:void 0};vt=v&&new i(ie,jt);let Ne=await(v?ht(vt,ct):ht(ie,jt));const Oe=Z&&(Ge==="stream"||Ge==="response");if(Z&&(pe||Oe&&at)){const nt={};["status","statusText","headers"].forEach(Ut=>{nt[Ut]=Ne[Ut]});const _t=Je.toFiniteNumber(Ne.headers.get("content-length")),[Bt,Ft]=pe&&hS(_t,S_(dS(pe),!0))||[];Ne=new l(pS(Ne.body,mS,Bt,()=>{Ft&&Ft(),at&&at()}),nt)}Ge=Ge||"text";let We=await W[Je.findKey(W,Ge)||"text"](Ne,ce);return!Oe&&at&&at(),await new Promise((nt,_t)=>{fC(nt,_t,{data:We,headers:$s.from(Ne.headers),status:Ne.status,statusText:Ne.statusText,config:ce,request:vt})})}catch(wt){throw at&&at(),wt&&wt.name==="TypeError"&&/Load failed|fetch/i.test(wt.message)?Object.assign(new hn("Network Error",hn.ERR_NETWORK,ce,vt),{cause:wt.cause||wt}):hn.from(wt,wt&&wt.code,ce,vt)}}},zN=new Map,gC=t=>{let e=t?t.env:{};const{fetch:i,Request:l,Response:f}=e,v=[l,f,i];let g=v.length,c=g,A,N,Z=zN;for(;c--;)A=v[c],N=Z.get(A),N===void 0&&Z.set(A,N=c?new Map:LN(e)),Z=N;return N};gC();const r0={http:YD,xhr:CN,fetch:{get:gC}};Je.forEach(r0,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const vS=t=>`- ${t}`,DN=t=>Je.isFunction(t)||t===null||t===!1,_C={getAdapter:(t,e)=>{t=Je.isArray(t)?t:[t];const{length:i}=t;let l,f;const v={};for(let g=0;g<i;g++){l=t[g];let c;if(f=l,!DN(l)&&(f=r0[(c=String(l)).toLowerCase()],f===void 0))throw new hn(`Unknown adapter '${c}'`);if(f&&(Je.isFunction(f)||(f=f.get(e))))break;v[c||"#"+g]=f}if(!f){const g=Object.entries(v).map(([A,N])=>`adapter ${A} `+(N===!1?"is not supported by the environment":"is not available in the build"));let c=i?g.length>1?`since :
`+g.map(vS).join(`
`):" "+vS(g[0]):"as no adapter specified";throw new hn("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return f},adapters:r0};function Dv(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new nf(null,t)}function xS(t){return Dv(t),t.headers=$s.from(t.headers),t.data=zv.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),_C.getAdapter(t.adapter||um.adapter,t)(t).then(function(l){return Dv(t),l.data=zv.call(t,t.transformResponse,l),l.headers=$s.from(l.headers),l},function(l){return dC(l)||(Dv(t),l&&l.response&&(l.response.data=zv.call(t,t.transformResponse,l.response),l.response.headers=$s.from(l.response.headers))),Promise.reject(l)})}const yC="1.12.2",ry={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{ry[t]=function(l){return typeof l===t||"a"+(e<1?"n ":" ")+t}});const bS={};ry.transitional=function(e,i,l){function f(v,g){return"[Axios v"+yC+"] Transitional option '"+v+"'"+g+(l?". "+l:"")}return(v,g,c)=>{if(e===!1)throw new hn(f(g," has been removed"+(i?" in "+i:"")),hn.ERR_DEPRECATED);return i&&!bS[g]&&(bS[g]=!0,console.warn(f(g," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(v,g,c):!0}};ry.spelling=function(e){return(i,l)=>(console.warn(`${l} is likely a misspelling of ${e}`),!0)};function NN(t,e,i){if(typeof t!="object")throw new hn("options must be an object",hn.ERR_BAD_OPTION_VALUE);const l=Object.keys(t);let f=l.length;for(;f-- >0;){const v=l[f],g=e[v];if(g){const c=t[v],A=c===void 0||g(c,v,t);if(A!==!0)throw new hn("option "+v+" must be "+A,hn.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new hn("Unknown option "+v,hn.ERR_BAD_OPTION)}}const Vg={assertOptions:NN,validators:ry},al=Vg.validators;let ah=class{constructor(e){this.defaults=e||{},this.interceptors={request:new cS,response:new cS}}async request(e,i){try{return await this._request(e,i)}catch(l){if(l instanceof Error){let f={};Error.captureStackTrace?Error.captureStackTrace(f):f=new Error;const v=f.stack?f.stack.replace(/^.+\n/,""):"";try{l.stack?v&&!String(l.stack).endsWith(v.replace(/^.+\n.+\n/,""))&&(l.stack+=`
`+v):l.stack=v}catch{}}throw l}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=ph(this.defaults,i);const{transitional:l,paramsSerializer:f,headers:v}=i;l!==void 0&&Vg.assertOptions(l,{silentJSONParsing:al.transitional(al.boolean),forcedJSONParsing:al.transitional(al.boolean),clarifyTimeoutError:al.transitional(al.boolean)},!1),f!=null&&(Je.isFunction(f)?i.paramsSerializer={serialize:f}:Vg.assertOptions(f,{encode:al.function,serialize:al.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),Vg.assertOptions(i,{baseUrl:al.spelling("baseURL"),withXsrfToken:al.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let g=v&&Je.merge(v.common,v[i.method]);v&&Je.forEach(["delete","get","head","post","put","patch","common"],ce=>{delete v[ce]}),i.headers=$s.concat(g,v);const c=[];let A=!0;this.interceptors.request.forEach(function(ie){typeof ie.runWhen=="function"&&ie.runWhen(i)===!1||(A=A&&ie.synchronous,c.unshift(ie.fulfilled,ie.rejected))});const N=[];this.interceptors.response.forEach(function(ie){N.push(ie.fulfilled,ie.rejected)});let Z,W=0,K;if(!A){const ce=[xS.bind(this),void 0];for(ce.unshift(...c),ce.push(...N),K=ce.length,Z=Promise.resolve(i);W<K;)Z=Z.then(ce[W++],ce[W++]);return Z}K=c.length;let J=i;for(;W<K;){const ce=c[W++],ie=c[W++];try{J=ce(J)}catch(oe){ie.call(this,oe);break}}try{Z=xS.call(this,J)}catch(ce){return Promise.reject(ce)}for(W=0,K=N.length;W<K;)Z=Z.then(N[W++],N[W++]);return Z}getUri(e){e=ph(this.defaults,e);const i=pC(e.baseURL,e.url,e.allowAbsoluteUrls);return cC(i,e.params,e.paramsSerializer)}};Je.forEach(["delete","get","head","options"],function(e){ah.prototype[e]=function(i,l){return this.request(ph(l||{},{method:e,url:i,data:(l||{}).data}))}});Je.forEach(["post","put","patch"],function(e){function i(l){return function(v,g,c){return this.request(ph(c||{},{method:e,headers:l?{"Content-Type":"multipart/form-data"}:{},url:v,data:g}))}}ah.prototype[e]=i(),ah.prototype[e+"Form"]=i(!0)});let ON=class vC{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(v){i=v});const l=this;this.promise.then(f=>{if(!l._listeners)return;let v=l._listeners.length;for(;v-- >0;)l._listeners[v](f);l._listeners=null}),this.promise.then=f=>{let v;const g=new Promise(c=>{l.subscribe(c),v=c}).then(f);return g.cancel=function(){l.unsubscribe(v)},g},e(function(v,g,c){l.reason||(l.reason=new nf(v,g,c),i(l.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=l=>{e.abort(l)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new vC(function(f){e=f}),cancel:e}}};function jN(t){return function(i){return t.apply(null,i)}}function BN(t){return Je.isObject(t)&&t.isAxiosError===!0}const i0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(i0).forEach(([t,e])=>{i0[e]=t});function xC(t){const e=new ah(t),i=YE(ah.prototype.request,e);return Je.extend(i,ah.prototype,e,{allOwnKeys:!0}),Je.extend(i,e,null,{allOwnKeys:!0}),i.create=function(f){return xC(ph(t,f))},i}const Kr=xC(um);Kr.Axios=ah;Kr.CanceledError=nf;Kr.CancelToken=ON;Kr.isCancel=dC;Kr.VERSION=yC;Kr.toFormData=ny;Kr.AxiosError=hn;Kr.Cancel=Kr.CanceledError;Kr.all=function(e){return Promise.all(e)};Kr.spread=jN;Kr.isAxiosError=BN;Kr.mergeConfig=ph;Kr.AxiosHeaders=$s;Kr.formToJSON=t=>hC(Je.isHTMLForm(t)?new FormData(t):t);Kr.getAdapter=_C.getAdapter;Kr.HttpStatusCode=i0;Kr.default=Kr;const{Axios:W6,AxiosError:H6,CanceledError:K6,isCancel:X6,CancelToken:Y6,VERSION:J6,all:Q6,Cancel:eU,isAxiosError:tU,spread:nU,toFormData:rU,AxiosHeaders:iU,HttpStatusCode:sU,formToJSON:oU,getAdapter:aU,mergeConfig:lU}=Kr,FN={},Nv=typeof import.meta<"u"&&FN?"http://localhost:3001":"",UN="http://localhost:3001";let bp;Nv&&Nv.trim()!==""?bp=Nv.trim():typeof window<"u"&&window.location?bp=window.location.origin:bp=UN;const yr=Kr.create({baseURL:bp,timeout:15e3});try{"".toLowerCase()==="true"&&console.info("[API] baseURL =",bp)}catch{}yr.interceptors.request.use(t=>{const e="true".toLowerCase();if(e==="true"||e==="1"||e==="yes")return t.headers&&"Authorization"in t.headers&&delete t.headers.Authorization,t;const l=localStorage.getItem("bf_auth_token");return l&&(t.headers=t.headers||{},t.headers.Authorization=`Bearer ${l}`),t});yr.interceptors.response.use(t=>t,t=>{var e;return((e=t.response)==null?void 0:e.status)===401&&console.warn(" Token "),Promise.reject(t)});const VN=Object.freeze(Object.defineProperty({__proto__:null,default:yr},Symbol.toStringTag,{value:"Module"}));async function Os(t,e={}){const i="true".toLowerCase(),l=i==="true"||i==="1"||i==="yes",f=localStorage.getItem("bf_auth_token");if(l)try{switch(t){case"phone-login":return(await yr.post("/auth/login",e)).data;case"phone-login-pwd":return(await yr.post("/auth/login-pwd",e)).data;case"verify-phone":return(await yr.post("/auth/verify-phone",e)).data;case"verify-firebase":return(await yr.post("/auth/verify-firebase",e)).data;case"request-ride":return(await yr.post("/ride/request",e)).data;case"update-ride-status":return(await yr.post("/ride/update-status",e)).data;case"get-driver-status":return(await yr.get("/drivers/status")).data;case"get-user-rides":{const v=(e==null?void 0:e.phone)||(e==null?void 0:e.passengerPhone),g=v?`/user/${v}/orders`:"/orders/all";return(await yr.get(g)).data}case"driver-heartbeat":{const v={phone:e==null?void 0:e.phone,status:e==null?void 0:e.status,lat:(e==null?void 0:e.lat)??(e==null?void 0:e.latitude)??null,lng:(e==null?void 0:e.lng)??(e==null?void 0:e.longitude)??null,heading:(e==null?void 0:e.heading)??null,speed:(e==null?void 0:e.speed)??null};return(await yr.post("/driver-heartbeat",v)).data}case"update-driver-status":{const v=e==null?void 0:e.phone;return(await yr.post(`/driver/${v}/status`,{status:(e==null?void 0:e.status)||"idle"})).data}case"user-register":return(await yr.post("/auth/register",e)).data;default:return{success:!1,message:`guest : ${t}`}}}catch(v){throw v}try{const{data:v,error:g}=await hD.functions.invoke(t,{body:e,headers:f?{Authorization:`Bearer ${f}`}:{}});if(g)throw new Error(g.message);return v}catch(v){const g=String((v==null?void 0:v.message)||v);if(t==="phone-login")try{return(await yr.post("/auth/login",e)).data}catch(c){throw c}throw/Supabase /.test(g)?new Error(" VITE_SUPABASE_URL  VITE_SUPABASE_ANON_KEY "):v}}class $N{async updateDriverStatus({phone:e,status:i}){try{return await Os("driver-status",{phone:e,status:i})}catch{return(await yr.post("/drivers/update-status",{phone:e,status:i})).data}}async updateRideStatus({rideId:e,nextStatus:i,driverPhone:l,passengerPhone:f}){const v={rideId:e,nextStatus:i,driverPhone:l,passengerPhone:f};try{return await Os("ride-status-update",v)}catch{return(await yr.post("/rides/update-status",v)).data}}async submitOrderReview({orderId:e,rating:i,comment:l,byPhone:f}){try{return await Os("orders-review",{orderId:e,rating:i,comment:l,by_phone:f})}catch{return(await yr.post("/orders/review",{orderId:e,rating:i,comment:l,by_phone:f})).data}}async getUserProfile(e){const i=encodeURIComponent(e);return(await yr.get("/users/"+i)).data}async requestRide({passengerPhone:e,pickup:i,dropoff:l,remarks:f}){const v={passengerPhone:e,pickup:i,dropoff:l,remarks:f};try{return await Os("ride-request",v)}catch{return(await yr.post("/rides/request",v)).data}}async completeRide({rideId:e,driverPhone:i}){try{return await Os("rides-complete",{rideId:e,driverPhone:i})}catch{return(await yr.post("/rides/complete",{rideId:e,driverPhone:i})).data}}}const _s=new $N,ml=Object.create(null);ml.open="0";ml.close="1";ml.ping="2";ml.pong="3";ml.message="4";ml.upgrade="5";ml.noop="6";const $g=Object.create(null);Object.keys(ml).forEach(t=>{$g[ml[t]]=t});const s0={type:"error",data:"parser error"},bC=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",wC=typeof ArrayBuffer=="function",TC=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,kb=({type:t,data:e},i,l)=>bC&&e instanceof Blob?i?l(e):wS(e,l):wC&&(e instanceof ArrayBuffer||TC(e))?i?l(e):wS(new Blob([e]),l):l(ml[t]+(e||"")),wS=(t,e)=>{const i=new FileReader;return i.onload=function(){const l=i.result.split(",")[1];e("b"+(l||""))},i.readAsDataURL(t)};function TS(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Ov;function ZN(t,e){if(bC&&t.data instanceof Blob)return t.data.arrayBuffer().then(TS).then(e);if(wC&&(t.data instanceof ArrayBuffer||TC(t.data)))return e(TS(t.data));kb(t,!1,i=>{Ov||(Ov=new TextEncoder),e(Ov.encode(i))})}const SS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",cp=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<SS.length;t++)cp[SS.charCodeAt(t)]=t;const GN=t=>{let e=t.length*.75,i=t.length,l,f=0,v,g,c,A;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const N=new ArrayBuffer(e),Z=new Uint8Array(N);for(l=0;l<i;l+=4)v=cp[t.charCodeAt(l)],g=cp[t.charCodeAt(l+1)],c=cp[t.charCodeAt(l+2)],A=cp[t.charCodeAt(l+3)],Z[f++]=v<<2|g>>4,Z[f++]=(g&15)<<4|c>>2,Z[f++]=(c&3)<<6|A&63;return N},qN=typeof ArrayBuffer=="function",Mb=(t,e)=>{if(typeof t!="string")return{type:"message",data:SC(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:WN(t.substring(1),e)}:$g[i]?t.length>1?{type:$g[i],data:t.substring(1)}:{type:$g[i]}:s0},WN=(t,e)=>{if(qN){const i=GN(t);return SC(i,e)}else return{base64:!0,data:t}},SC=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},PC="",HN=(t,e)=>{const i=t.length,l=new Array(i);let f=0;t.forEach((v,g)=>{kb(v,!1,c=>{l[g]=c,++f===i&&e(l.join(PC))})})},KN=(t,e)=>{const i=t.split(PC),l=[];for(let f=0;f<i.length;f++){const v=Mb(i[f],e);if(l.push(v),v.type==="error")break}return l};function XN(){return new TransformStream({transform(t,e){ZN(t,i=>{const l=i.length;let f;if(l<126)f=new Uint8Array(1),new DataView(f.buffer).setUint8(0,l);else if(l<65536){f=new Uint8Array(3);const v=new DataView(f.buffer);v.setUint8(0,126),v.setUint16(1,l)}else{f=new Uint8Array(9);const v=new DataView(f.buffer);v.setUint8(0,127),v.setBigUint64(1,BigInt(l))}t.data&&typeof t.data!="string"&&(f[0]|=128),e.enqueue(f),e.enqueue(i)})}})}let jv;function bg(t){return t.reduce((e,i)=>e+i.length,0)}function wg(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let l=0;for(let f=0;f<e;f++)i[f]=t[0][l++],l===t[0].length&&(t.shift(),l=0);return t.length&&l<t[0].length&&(t[0]=t[0].slice(l)),i}function YN(t,e){jv||(jv=new TextDecoder);const i=[];let l=0,f=-1,v=!1;return new TransformStream({transform(g,c){for(i.push(g);;){if(l===0){if(bg(i)<1)break;const A=wg(i,1);v=(A[0]&128)===128,f=A[0]&127,f<126?l=3:f===126?l=1:l=2}else if(l===1){if(bg(i)<2)break;const A=wg(i,2);f=new DataView(A.buffer,A.byteOffset,A.length).getUint16(0),l=3}else if(l===2){if(bg(i)<8)break;const A=wg(i,8),N=new DataView(A.buffer,A.byteOffset,A.length),Z=N.getUint32(0);if(Z>Math.pow(2,21)-1){c.enqueue(s0);break}f=Z*Math.pow(2,32)+N.getUint32(4),l=3}else{if(bg(i)<f)break;const A=wg(i,f);c.enqueue(Mb(v?A:jv.decode(A),e)),l=0}if(f===0||f>t){c.enqueue(s0);break}}}})}const EC=4;function oi(t){if(t)return JN(t)}function JN(t){for(var e in oi.prototype)t[e]=oi.prototype[e];return t}oi.prototype.on=oi.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};oi.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};oi.prototype.off=oi.prototype.removeListener=oi.prototype.removeAllListeners=oi.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var l,f=0;f<i.length;f++)if(l=i[f],l===e||l.fn===e){i.splice(f,1);break}return i.length===0&&delete this._callbacks["$"+t],this};oi.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],l=1;l<arguments.length;l++)e[l-1]=arguments[l];if(i){i=i.slice(0);for(var l=0,f=i.length;l<f;++l)i[l].apply(this,e)}return this};oi.prototype.emitReserved=oi.prototype.emit;oi.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};oi.prototype.hasListeners=function(t){return!!this.listeners(t).length};const iy=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),Ro=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),QN="arraybuffer";function CC(t,...e){return e.reduce((i,l)=>(t.hasOwnProperty(l)&&(i[l]=t[l]),i),{})}const eO=Ro.setTimeout,tO=Ro.clearTimeout;function sy(t,e){e.useNativeTimers?(t.setTimeoutFn=eO.bind(Ro),t.clearTimeoutFn=tO.bind(Ro)):(t.setTimeoutFn=Ro.setTimeout.bind(Ro),t.clearTimeoutFn=Ro.clearTimeout.bind(Ro))}const nO=1.33;function rO(t){return typeof t=="string"?iO(t):Math.ceil((t.byteLength||t.size)*nO)}function iO(t){let e=0,i=0;for(let l=0,f=t.length;l<f;l++)e=t.charCodeAt(l),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(l++,i+=4);return i}function IC(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function sO(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function oO(t){let e={},i=t.split("&");for(let l=0,f=i.length;l<f;l++){let v=i[l].split("=");e[decodeURIComponent(v[0])]=decodeURIComponent(v[1])}return e}class aO extends Error{constructor(e,i,l){super(e),this.description=i,this.context=l,this.type="TransportError"}}class Ab extends oi{constructor(e){super(),this.writable=!1,sy(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,i,l){return super.emitReserved("error",new aO(e,i,l)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=Mb(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=sO(e);return i.length?"?"+i:""}}class lO extends Ab{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let l=0;this._polling&&(l++,this.once("pollComplete",function(){--l||i()})),this.writable||(l++,this.once("drain",function(){--l||i()}))}else i()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=l=>{if(this.readyState==="opening"&&l.type==="open"&&this.onOpen(),l.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(l)};KN(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,HN(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=IC()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}}let kC=!1;try{kC=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const cO=kC;function uO(){}class hO extends lO{constructor(e){if(super(e),typeof location<"u"){const i=location.protocol==="https:";let l=location.port;l||(l=i?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||l!==e.port}}doWrite(e,i){const l=this.request({method:"POST",data:e});l.on("success",i),l.on("error",(f,v)=>{this.onError("xhr post error",f,v)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,l)=>{this.onError("xhr poll error",i,l)}),this.pollXhr=e}}let Ld=class Zg extends oi{constructor(e,i,l){super(),this.createRequest=e,sy(this,l),this._opts=l,this._method=l.method||"GET",this._uri=i,this._data=l.data!==void 0?l.data:null,this._create()}_create(){var e;const i=CC(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this._opts.xd;const l=this._xhr=this.createRequest(i);try{l.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){l.setDisableHeaderCheck&&l.setDisableHeaderCheck(!0);for(let f in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(f)&&l.setRequestHeader(f,this._opts.extraHeaders[f])}}catch{}if(this._method==="POST")try{l.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{l.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(l),"withCredentials"in l&&(l.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(l.timeout=this._opts.requestTimeout),l.onreadystatechange=()=>{var f;l.readyState===3&&((f=this._opts.cookieJar)===null||f===void 0||f.parseCookies(l.getResponseHeader("set-cookie"))),l.readyState===4&&(l.status===200||l.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof l.status=="number"?l.status:0)},0))},l.send(this._data)}catch(f){this.setTimeoutFn(()=>{this._onError(f)},0);return}typeof document<"u"&&(this._index=Zg.requestsCount++,Zg.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=uO,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Zg.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Ld.requestsCount=0;Ld.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",PS);else if(typeof addEventListener=="function"){const t="onpagehide"in Ro?"pagehide":"unload";addEventListener(t,PS,!1)}}function PS(){for(let t in Ld.requests)Ld.requests.hasOwnProperty(t)&&Ld.requests[t].abort()}const dO=function(){const t=MC({xdomain:!1});return t&&t.responseType!==null}();class fO extends hO{constructor(e){super(e);const i=e&&e.forceBase64;this.supportsBinary=dO&&!i}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Ld(MC,this.uri(),e)}}function MC(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||cO))return new XMLHttpRequest}catch{}if(!e)try{return new Ro[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const AC=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class pO extends Ab{get name(){return"websocket"}doOpen(){const e=this.uri(),i=this.opts.protocols,l=AC?{}:CC(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(l.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,i,l)}catch(f){return this.emitReserved("error",f)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const l=e[i],f=i===e.length-1;kb(l,this.supportsBinary,v=>{try{this.doWrite(l,v)}catch{}f&&iy(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=IC()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}}const Bv=Ro.WebSocket||Ro.MozWebSocket;class mO extends pO{createSocket(e,i,l){return AC?new Bv(e,i,l):i?new Bv(e,i):new Bv(e)}doWrite(e,i){this.ws.send(i)}}class gO extends Ab{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const i=YN(Number.MAX_SAFE_INTEGER,this.socket.binaryType),l=e.readable.pipeThrough(i).getReader(),f=XN();f.readable.pipeTo(e.writable),this._writer=f.writable.getWriter();const v=()=>{l.read().then(({done:c,value:A})=>{c||(this.onPacket(A),v())}).catch(c=>{})};v();const g={type:"open"};this.query.sid&&(g.data=`{"sid":"${this.query.sid}"}`),this._writer.write(g).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const l=e[i],f=i===e.length-1;this._writer.write(l).then(()=>{f&&iy(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const _O={websocket:mO,webtransport:gO,polling:fO},yO=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,vO=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function o0(t){if(t.length>8e3)throw"URI too long";const e=t,i=t.indexOf("["),l=t.indexOf("]");i!=-1&&l!=-1&&(t=t.substring(0,i)+t.substring(i,l).replace(/:/g,";")+t.substring(l,t.length));let f=yO.exec(t||""),v={},g=14;for(;g--;)v[vO[g]]=f[g]||"";return i!=-1&&l!=-1&&(v.source=e,v.host=v.host.substring(1,v.host.length-1).replace(/;/g,":"),v.authority=v.authority.replace("[","").replace("]","").replace(/;/g,":"),v.ipv6uri=!0),v.pathNames=xO(v,v.path),v.queryKey=bO(v,v.query),v}function xO(t,e){const i=/\/{2,9}/g,l=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&l.splice(0,1),e.slice(-1)=="/"&&l.splice(l.length-1,1),l}function bO(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(l,f,v){f&&(i[f]=v)}),i}const a0=typeof addEventListener=="function"&&typeof removeEventListener=="function",Gg=[];a0&&addEventListener("offline",()=>{Gg.forEach(t=>t())},!1);class lu extends oi{constructor(e,i){if(super(),this.binaryType=QN,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(i=e,e=null),e){const l=o0(e);i.hostname=l.host,i.secure=l.protocol==="https"||l.protocol==="wss",i.port=l.port,l.query&&(i.query=l.query)}else i.host&&(i.hostname=o0(i.host).host);sy(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},i.transports.forEach(l=>{const f=l.prototype.name;this.transports.push(f),this._transportsByName[f]=l}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=oO(this.opts.query)),a0&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Gg.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=EC,i.transport=e,this.id&&(i.sid=this.id);const l=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](l)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&lu.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const i=this.createTransport(e);i.open(),this.setTransport(i)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",i=>this._onClose("transport close",i))}onOpen(){this.readyState="open",lu.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const i=new Error("server error");i.code=e.data,this._onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let l=0;l<this.writeBuffer.length;l++){const f=this.writeBuffer[l].data;if(f&&(i+=rO(f)),l>0&&i>this._maxPayload)return this.writeBuffer.slice(0,l);i+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,iy(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,i,l){return this._sendPacket("message",e,i,l),this}send(e,i,l){return this._sendPacket("message",e,i,l),this}_sendPacket(e,i,l,f){if(typeof i=="function"&&(f=i,i=void 0),typeof l=="function"&&(f=l,l=null),this.readyState==="closing"||this.readyState==="closed")return;l=l||{},l.compress=l.compress!==!1;const v={type:e,data:i,options:l};this.emitReserved("packetCreate",v),this.writeBuffer.push(v),f&&this.once("flush",f),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},l=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?l():e()}):this.upgrading?l():e()),this}_onError(e){if(lu.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),a0&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const l=Gg.indexOf(this._offlineEventListener);l!==-1&&Gg.splice(l,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this._prevBufferLen=0}}}lu.protocol=EC;class wO extends lu{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let i=this.createTransport(e),l=!1;lu.priorWebsocketSuccess=!1;const f=()=>{l||(i.send([{type:"ping",data:"probe"}]),i.once("packet",W=>{if(!l)if(W.type==="pong"&&W.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;lu.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{l||this.readyState!=="closed"&&(Z(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const K=new Error("probe error");K.transport=i.name,this.emitReserved("upgradeError",K)}}))};function v(){l||(l=!0,Z(),i.close(),i=null)}const g=W=>{const K=new Error("probe error: "+W);K.transport=i.name,v(),this.emitReserved("upgradeError",K)};function c(){g("transport closed")}function A(){g("socket closed")}function N(W){i&&W.name!==i.name&&v()}const Z=()=>{i.removeListener("open",f),i.removeListener("error",g),i.removeListener("close",c),this.off("close",A),this.off("upgrading",N)};i.once("open",f),i.once("error",g),i.once("close",c),this.once("close",A),this.once("upgrading",N),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{l||i.open()},200):i.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const i=[];for(let l=0;l<e.length;l++)~this.transports.indexOf(e[l])&&i.push(e[l]);return i}}let TO=class extends wO{constructor(e,i={}){const l=typeof e=="object"?e:i;(!l.transports||l.transports&&typeof l.transports[0]=="string")&&(l.transports=(l.transports||["polling","websocket","webtransport"]).map(f=>_O[f]).filter(f=>!!f)),super(e,l)}};function SO(t,e="",i){let l=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),l=o0(t)),l.port||(/^(http|ws)$/.test(l.protocol)?l.port="80":/^(http|ws)s$/.test(l.protocol)&&(l.port="443")),l.path=l.path||"/";const v=l.host.indexOf(":")!==-1?"["+l.host+"]":l.host;return l.id=l.protocol+"://"+v+":"+l.port+e,l.href=l.protocol+"://"+v+(i&&i.port===l.port?"":":"+l.port),l}const PO=typeof ArrayBuffer=="function",EO=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,RC=Object.prototype.toString,CO=typeof Blob=="function"||typeof Blob<"u"&&RC.call(Blob)==="[object BlobConstructor]",IO=typeof File=="function"||typeof File<"u"&&RC.call(File)==="[object FileConstructor]";function Rb(t){return PO&&(t instanceof ArrayBuffer||EO(t))||CO&&t instanceof Blob||IO&&t instanceof File}function qg(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,l=t.length;i<l;i++)if(qg(t[i]))return!0;return!1}if(Rb(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return qg(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&qg(t[i]))return!0;return!1}function kO(t){const e=[],i=t.data,l=t;return l.data=l0(i,e),l.attachments=e.length,{packet:l,buffers:e}}function l0(t,e){if(!t)return t;if(Rb(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let l=0;l<t.length;l++)i[l]=l0(t[l],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const l in t)Object.prototype.hasOwnProperty.call(t,l)&&(i[l]=l0(t[l],e));return i}return t}function MO(t,e){return t.data=c0(t.data,e),delete t.attachments,t}function c0(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=c0(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=c0(t[i],e));return t}const AO=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],RO=5;var wn;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(wn||(wn={}));class LO{constructor(e){this.replacer=e}encode(e){return(e.type===wn.EVENT||e.type===wn.ACK)&&qg(e)?this.encodeAsBinary({type:e.type===wn.EVENT?wn.BINARY_EVENT:wn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===wn.BINARY_EVENT||e.type===wn.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=kO(e),l=this.encodeAsString(i.packet),f=i.buffers;return f.unshift(l),f}}function ES(t){return Object.prototype.toString.call(t)==="[object Object]"}class Lb extends oi{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const l=i.type===wn.BINARY_EVENT;l||i.type===wn.BINARY_ACK?(i.type=l?wn.EVENT:wn.ACK,this.reconstructor=new zO(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(Rb(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const l={type:Number(e.charAt(0))};if(wn[l.type]===void 0)throw new Error("unknown packet type "+l.type);if(l.type===wn.BINARY_EVENT||l.type===wn.BINARY_ACK){const v=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const g=e.substring(v,i);if(g!=Number(g)||e.charAt(i)!=="-")throw new Error("Illegal attachments");l.attachments=Number(g)}if(e.charAt(i+1)==="/"){const v=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););l.nsp=e.substring(v,i)}else l.nsp="/";const f=e.charAt(i+1);if(f!==""&&Number(f)==f){const v=i+1;for(;++i;){const g=e.charAt(i);if(g==null||Number(g)!=g){--i;break}if(i===e.length)break}l.id=Number(e.substring(v,i+1))}if(e.charAt(++i)){const v=this.tryParse(e.substr(i));if(Lb.isPayloadValid(l.type,v))l.data=v;else throw new Error("invalid payload")}return l}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case wn.CONNECT:return ES(i);case wn.DISCONNECT:return i===void 0;case wn.CONNECT_ERROR:return typeof i=="string"||ES(i);case wn.EVENT:case wn.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&AO.indexOf(i[0])===-1);case wn.ACK:case wn.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class zO{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=MO(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const DO=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Lb,Encoder:LO,get PacketType(){return wn},protocol:RO},Symbol.toStringTag,{value:"Module"}));function ga(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const NO=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class LC extends oi{constructor(e,i,l){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,l&&l.auth&&(this.auth=l.auth),this._opts=Object.assign({},l),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ga(e,"open",this.onopen.bind(this)),ga(e,"packet",this.onpacket.bind(this)),ga(e,"error",this.onerror.bind(this)),ga(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){var l,f,v;if(NO.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const g={type:wn.EVENT,data:i};if(g.options={},g.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const Z=this.ids++,W=i.pop();this._registerAckCallback(Z,W),g.id=Z}const c=(f=(l=this.io.engine)===null||l===void 0?void 0:l.transport)===null||f===void 0?void 0:f.writable,A=this.connected&&!(!((v=this.io.engine)===null||v===void 0)&&v._hasPingExpired());return this.flags.volatile&&!c||(A?(this.notifyOutgoingListeners(g),this.packet(g)):this.sendBuffer.push(g)),this.flags={},this}_registerAckCallback(e,i){var l;const f=(l=this.flags.timeout)!==null&&l!==void 0?l:this._opts.ackTimeout;if(f===void 0){this.acks[e]=i;return}const v=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===e&&this.sendBuffer.splice(c,1);i.call(this,new Error("operation has timed out"))},f),g=(...c)=>{this.io.clearTimeoutFn(v),i.apply(this,c)};g.withError=!0,this.acks[e]=g}emitWithAck(e,...i){return new Promise((l,f)=>{const v=(g,c)=>g?f(g):l(c);v.withError=!0,i.push(v),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const l={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((f,...v)=>l!==this._queue[0]?void 0:(f!==null?l.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(f)):(this._queue.shift(),i&&i(null,...v)),l.pending=!1,this._drainQueue())),this._queue.push(l),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:wn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(l=>String(l.id)===e)){const l=this.acks[e];delete this.acks[e],l.withError&&l.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case wn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case wn.EVENT:case wn.BINARY_EVENT:this.onevent(e);break;case wn.ACK:case wn.BINARY_ACK:this.onack(e);break;case wn.DISCONNECT:this.ondisconnect();break;case wn.CONNECT_ERROR:this.destroy();const l=new Error(e.data.message);l.data=e.data.data,this.emitReserved("connect_error",l);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const l of i)l.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let l=!1;return function(...f){l||(l=!0,i.packet({type:wn.ACK,id:e,data:f}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(delete this.acks[e.id],i.withError&&e.data.unshift(null),i.apply(this,e.data))}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:wn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let l=0;l<i.length;l++)if(e===i[l])return i.splice(l,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let l=0;l<i.length;l++)if(e===i[l])return i.splice(l,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const l of i)l.apply(this,e.data)}}}function rf(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}rf.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+i:t-i}return Math.min(t,this.max)|0};rf.prototype.reset=function(){this.attempts=0};rf.prototype.setMin=function(t){this.ms=t};rf.prototype.setMax=function(t){this.max=t};rf.prototype.setJitter=function(t){this.jitter=t};class u0 extends oi{constructor(e,i){var l;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,sy(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((l=i.randomizationFactor)!==null&&l!==void 0?l:.5),this.backoff=new rf({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const f=i.parser||DO;this.encoder=new f.Encoder,this.decoder=new f.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new TO(this.uri,this.opts);const i=this.engine,l=this;this._readyState="opening",this.skipReconnect=!1;const f=ga(i,"open",function(){l.onopen(),e&&e()}),v=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},g=ga(i,"error",v);if(this._timeout!==!1){const c=this._timeout,A=this.setTimeoutFn(()=>{f(),v(new Error("timeout")),i.close()},c);this.opts.autoUnref&&A.unref(),this.subs.push(()=>{this.clearTimeoutFn(A)})}return this.subs.push(f),this.subs.push(g),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ga(e,"ping",this.onping.bind(this)),ga(e,"data",this.ondata.bind(this)),ga(e,"error",this.onerror.bind(this)),ga(e,"close",this.onclose.bind(this)),ga(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){iy(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let l=this.nsps[e];return l?this._autoConnect&&!l.active&&l.connect():(l=new LC(this,e,i),this.nsps[e]=l),l}_destroy(e){const i=Object.keys(this.nsps);for(const l of i)if(this.nsps[l].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let l=0;l<i.length;l++)this.engine.write(i[l],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,i){var l;this.cleanup(),(l=this.engine)===null||l===void 0||l.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const l=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(f=>{f?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",f)):e.onreconnect()}))},i);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const np={};function Wg(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=SO(t,e.path||"/socket.io"),l=i.source,f=i.id,v=i.path,g=np[f]&&v in np[f].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||g;let A;return c?A=new u0(l,e):(np[f]||(np[f]=new u0(l,e)),A=np[f]),i.query&&!e.query&&(e.query=i.queryKey),A.socket(i.path,e)}Object.assign(Wg,{Manager:u0,Socket:LC,io:Wg,connect:Wg});const zC=se.createContext(),OO={user:null,drivers:[],orders:[],currentOrder:null,subscriptions:[],loading:!1,error:null,stats:{totalDrivers:0,idleDrivers:0,busyDrivers:0,offlineDrivers:0,totalOrders:0,completedOrders:0,pendingOrders:0}};function jO(t,e){var i;switch(e.type){case"SET_LOADING":return{...t,loading:e.payload};case"SET_ERROR":return{...t,error:e.payload,loading:!1};case"SET_USER":return{...t,user:e.payload};case"SET_DRIVERS":return{...t,drivers:e.payload,stats:{...t.stats,totalDrivers:e.payload.length,idleDrivers:e.payload.filter(l=>l.status==="idle").length,busyDrivers:e.payload.filter(l=>l.status==="busy").length,offlineDrivers:e.payload.filter(l=>l.status==="offline").length}};case"UPDATE_DRIVER_STATUS":return{...t,drivers:t.drivers.map(l=>l.phone===e.payload.phone?{...l,status:e.payload.status??l.status,lat:e.payload.lat??e.payload.latitude??l.lat??null,lng:e.payload.lng??e.payload.longitude??l.lng??null}:l)};case"SET_ORDERS":return{...t,orders:e.payload,stats:{...t.stats,totalOrders:e.payload.length,completedOrders:e.payload.filter(l=>l.status==="completed").length,pendingOrders:e.payload.filter(l=>l.status==="pending").length}};case"ADD_ORDER":return{...t,orders:[e.payload,...t.orders],currentOrder:e.payload};case"UPDATE_ORDER":return{...t,orders:t.orders.map(l=>l.id===e.payload.id?e.payload:l),currentOrder:((i=t.currentOrder)==null?void 0:i.id)===e.payload.id?e.payload:t.currentOrder};case"SET_CURRENT_ORDER":return{...t,currentOrder:e.payload};case"SET_SOCKET":return{...t,socket:e.payload};case"CLEAR_ERROR":return{...t,error:null};default:return t}}function BO({children:t}){const[e,i]=se.useReducer(jO,OO);se.useEffect(()=>{try{let ie=localStorage.getItem("bf_auth_token");const oe="true".toLowerCase();if(!ie&&(oe==="true"||oe==="1"||oe==="yes")){const ze="passenger",vt="0912345678",at="",Mt=Math.floor(Date.now()/1e3),wt={alg:"HS256",typ:"JWT"},jt={iss:"black-feather-taxi",iat:Mt,exp:Mt+60*60*24*7,sub:String(vt),role:ze,name:at},Ne=Oe=>{const We=JSON.stringify(Oe);return btoa(We).replace(/=+/g,"").replace(/\+/g,"-").replace(/\//g,"_")};ie=`${Ne(wt)}.${Ne(jt)}.dev`;try{localStorage.setItem("bf_auth_token",ie),localStorage.setItem("bf_user_profile",JSON.stringify({userId:String(vt),phone:String(vt),name:at,role:ze,permissions:{role:ze,can_access_admin:ze==="admin",can_access_driver:ze==="driver"||ze==="admin",can_access_passenger:!0}}))}catch{}}if(!ie)return;const $=ie.split(".");if($.length!==3)return;let te=$[1].replace(/-/g,"+").replace(/_/g,"/");const fe=te.length%4;fe===2?te+="==":fe===3?te+="=":fe===1&&(te+="===");const pe=atob(te),Ie=JSON.parse(pe||"{}"),Ge=Math.floor(Date.now()/1e3);if(!(Ie!=null&&Ie.exp)||Ie.exp<Ge){localStorage.removeItem("bf_auth_token"),localStorage.removeItem("bf_user_profile");return}let Le=null;try{const ze=localStorage.getItem("bf_user_profile");Le=ze?JSON.parse(ze):null}catch{}const xt=(Le==null?void 0:Le.role)||(Ie==null?void 0:Ie.role)||"passenger",ct=(Le==null?void 0:Le.name)||(Ie==null?void 0:Ie.name)||"&",ht={userId:(Le==null?void 0:Le.userId)||(Ie==null?void 0:Ie.sub)||null,phone:(Le==null?void 0:Le.phone)||null,name:ct,role:xt,permissions:(Le==null?void 0:Le.permissions)||{role:xt,can_access_admin:xt==="admin",can_access_driver:xt==="driver"||xt==="admin",can_access_passenger:!0},token:ie};e.user||N(ht).catch(()=>{})}catch{}},[]),se.useEffect(()=>{let ie=()=>{};try{const re=Wg("http://localhost:3001",{transports:["websocket"]});i({type:"SET_SOCKET",payload:re}),re.on("connect",()=>{}),re.on("order_created",$=>{i({type:"ADD_ORDER",payload:$})}),re.on("order_completed",$=>{i({type:"UPDATE_ORDER",payload:$})}),re.on("order_status_update",$=>{i({type:"UPDATE_ORDER",payload:$})}),re.on("driver_status_update",({phone:$,status:te})=>{i({type:"UPDATE_DRIVER_STATUS",payload:{phone:$,status:te}})}),ie=()=>{try{re.disconnect()}catch{}}}catch{}return()=>{ie()}},[]);const l=async()=>{var ie;try{i({type:"SET_LOADING",payload:!0});const oe=await yr.get("/drivers/status"),$=(((ie=oe==null?void 0:oe.data)==null?void 0:ie.drivers)||[]).map(te=>({phone:te.phone,name:te.name||te.phone,status:te.status,lat:te.lat??null,lng:te.lng??null,rating:te.rating??null,vehicle:te.vehicle||void 0}));i({type:"SET_DRIVERS",payload:$})}catch(oe){i({type:"SET_ERROR",payload:oe.message||"????????"})}finally{i({type:"SET_LOADING",payload:!1})}},f=async(ie=null)=>{var oe;try{i({type:"SET_LOADING",payload:!0});let re=supabase.from("rides").select("*").order("created_at",{ascending:!1});ie&&(re=re.eq("passenger_phone",ie));const{data:$,error:te}=await re;if(te)throw te;const fe=($||[]).map(pe=>({id:pe.id,passengerPhone:pe.passenger_phone,driverPhone:pe.driver_phone,driverName:pe.driver_name||"S &",pickup:pe.pickup_location,dropoff:pe.dropoff_location,status:pe.status,estimatedPrice:pe.estimated_price||0,createdAt:pe.created_at,completedAt:pe.completed_at,review:pe.review??null}));i({type:"SET_ORDERS",payload:fe})}catch(re){try{let $;ie?$=await yr.get(`/user/${ie}/orders`):$=await yr.get("/orders/all");const fe=(((oe=$==null?void 0:$.data)==null?void 0:oe.data)||[]).map(pe=>({id:pe.id,passengerPhone:pe.passengerPhone??pe.passenger_phone,driverPhone:pe.driverPhone??pe.driver_phone,driverName:pe.driverName??pe.driver_name??"S &",pickup:pe.pickup??pe.pickup_location,dropoff:pe.dropoff??pe.dropoff_location,status:pe.status,estimatedPrice:pe.estimatedPrice??pe.estimated_price??0,createdAt:pe.createdAt??pe.created_at,completedAt:pe.completedAt??pe.completed_at,pickupLat:pe.pickupLat??pe.pickup_lat??null,pickupLng:pe.pickupLng??pe.pickup_lng??null,dropoffLat:pe.dropoffLat??pe.dropoff_lat??null,dropoffLng:pe.dropoffLng??pe.dropoff_lng??null,estimatedDistanceMeters:pe.estimatedDistanceMeters??pe.estimated_distance_meters??null,estimatedDurationSeconds:pe.estimatedDurationSeconds??pe.estimated_duration_seconds??null,review:pe.review??null}));i({type:"SET_ORDERS",payload:fe})}catch($){i({type:"SET_ERROR",payload:$.message||re.message})}}finally{i({type:"SET_LOADING",payload:!1})}},v=async ie=>{try{i({type:"SET_LOADING",payload:!0});const oe=await _s.requestRide({passengerPhone:ie.passengerPhone,pickup:ie.pickup,dropoff:ie.dropoff,pickup_lat:ie.pickup_lat,pickup_lng:ie.pickup_lng,dropoff_lat:ie.dropoff_lat,dropoff_lng:ie.dropoff_lng,estimated_distance_meters:ie.estimated_distance_meters,estimated_duration_seconds:ie.estimated_duration_seconds,estimated_price:ie.estimated_price,service_type:ie.service_type,deposit:ie.deposit,notes:ie.notes,map_provider:ie.map_provider}),re=(oe==null?void 0:oe.data)||oe,$=re.ride||re.order,te=re.driver||null;if(!$||!$.id)throw new Error('API:~"aR');const fe={id:$.id,passengerPhone:$.passenger_phone??$.passengerPhone,driverPhone:$.driver_phone??$.driverPhone,driverName:(te==null?void 0:te.name)??$.driverName??"S &",pickup:$.pickup_location??$.pickup,dropoff:$.dropoff_location??$.dropoff,status:$.status,estimatedPrice:$.estimated_price??$.estimatedPrice??0,deposit:$.deposit??ie.deposit??0,serviceType:$.service_type??ie.service_type??"standard",estimatedDistanceMeters:$.estimated_distance_meters??$.estimatedDistanceMeters,estimatedDurationSeconds:$.estimated_duration_seconds??$.estimatedDurationSeconds,pickupLat:$.pickup_lat??$.pickupLat,pickupLng:$.pickup_lng??$.pickupLng,dropoffLat:$.dropoff_lat??$.dropoffLat,dropoffLng:$.dropoff_lng??$.dropoffLng,notes:$.notes??ie.notes??"",createdAt:$.created_at??$.createdAt};return i({type:"ADD_ORDER",payload:fe}),{order:fe,driver:te}}catch(oe){throw i({type:"SET_ERROR",payload:oe.message}),oe}finally{i({type:"SET_LOADING",payload:!1})}},g=async(ie,oe)=>{var re,$;try{i({type:"SET_LOADING",payload:!0});const te=await _s.completeRide({rideId:ie,driverPhone:oe}),fe=(te==null?void 0:te.data)||te,pe=fe.ride||fe.order;if(!pe||!pe.id)throw new Error('API:~"aR');const Ie={id:pe.id,passengerPhone:pe.passenger_phone,driverPhone:pe.driver_phone,driverName:pe.driver_name??((re=e.currentOrder)==null?void 0:re.driverName)??pe.driverName??"S &",pickup:pe.pickup_location??pe.pickup,dropoff:pe.dropoff_location??pe.dropoff,status:pe.status,estimatedPrice:pe.estimated_price??pe.estimatedPrice??0,createdAt:pe.created_at??pe.createdAt,completedAt:pe.completed_at??pe.completedAt};i({type:"UPDATE_ORDER",payload:Ie});try{await _s.updateDriverStatus({status:"idle",phone:oe||(($=e.user)==null?void 0:$.phone)})}catch{}return{order:Ie}}catch(te){throw i({type:"SET_ERROR",payload:te.message}),te}finally{i({type:"SET_LOADING",payload:!1})}},c=async({orderId:ie,nextStatus:oe,driverPhone:re,passengerPhone:$})=>{var te,fe,pe;try{i({type:"SET_LOADING",payload:!0});const Ie=await _s.updateRideStatus({rideId:ie,nextStatus:oe,driverPhone:re,passengerPhone:$}),Ge=(Ie==null?void 0:Ie.data)||Ie,Le=Ge.ride||Ge.order;if(!Le||!Le.id)throw new Error('API:~"aR');const xt={id:Le.id,passengerPhone:Le.passenger_phone??Le.passengerPhone,driverPhone:Le.driver_phone??Le.driverPhone,driverName:Le.driver_name??((te=e.currentOrder)==null?void 0:te.driverName)??Le.driverName??"S &",pickup:Le.pickup_location??Le.pickup,dropoff:Le.dropoff_location??Le.dropoff,status:Le.status,estimatedPrice:Le.estimated_price??Le.estimatedPrice??0,createdAt:Le.created_at??Le.createdAt,completedAt:Le.completed_at??Le.completedAt};if(i({type:"UPDATE_ORDER",payload:xt}),oe==="completed"||oe==="cancelled")try{await _s.updateDriverStatus({status:"idle",phone:re||((fe=e.user)==null?void 0:fe.phone)})}catch{}else if(oe==="accepted"||oe==="enroute"||oe==="arrived")try{await _s.updateDriverStatus({status:"busy",phone:re||((pe=e.user)==null?void 0:pe.phone)})}catch{}return{order:xt}}catch(Ie){throw i({type:"SET_ERROR",payload:Ie.message}),Ie}finally{i({type:"SET_LOADING",payload:!1})}},A=async(ie,oe)=>{try{await _s.updateDriverStatus({status:oe,phone:ie}),i({type:"UPDATE_DRIVER_STATUS",payload:{phone:ie,status:oe}})}catch(re){throw i({type:"SET_ERROR",payload:re.message}),re}},N=async(ie,oe)=>{try{i({type:"SET_LOADING",payload:!0});let re=null;if(typeof ie=="string"){const $=ie.trim();if(re=(await Rv.get("Users",{email:$})).find(fe=>fe.password===oe),!re)throw new Error("???????")}else if(ie&&typeof ie=="object")re=ie;else throw new Error("???????");return i({type:"SET_USER",payload:re}),re.role==="admin"?(await l(),await f()):await f(re.phone),re}catch(re){throw i({type:"SET_ERROR",payload:re.message}),re}finally{i({type:"SET_LOADING",payload:!1})}},ce={...e,loadDrivers:l,loadOrders:f,requestRide:v,completeRide:g,updateRideStatus:c,updateDriverStatus:A,loginUser:N,registerUser:async ie=>{const oe=await Rv.create("Users",ie);return i({type:"SET_USER",payload:oe}),oe},saveOrder:async ie=>await Rv.create("Orders",ie),logout:async()=>{i({type:"SET_USER",payload:null}),i({type:"SET_ORDERS",payload:[]}),i({type:"SET_DRIVERS",payload:[]}),i({type:"SET_CURRENT_ORDER",payload:null}),i({type:"CLEAR_ERROR"});try{socketCleanup==null||socketCleanup()}catch{}try{localStorage.removeItem("bf_auth_token"),localStorage.removeItem("bf_user_profile"),Object.keys(sessionStorage||{}).forEach(oe=>{if(oe.startsWith("bf_"))try{sessionStorage.removeItem(oe)}catch{}})}catch{}},clearError:()=>{i({type:"CLEAR_ERROR"})}};return I.jsx(zC.Provider,{value:ce,children:t})}const _l=()=>{const t=se.useContext(zC);if(!t)throw new Error("useApp must be used within an AppProvider");return t},Fv={};let ko=null;const Hp=new Map;function FO(t="passenger",e=Fv!=null&&Fv.VITE_WS_URL?void 0:"ws://localhost:3010"){return ko&&ko.readyState===WebSocket.OPEN||(ko=new WebSocket(`${e}?role=${t}`),ko.onmessage=i=>{let l;try{l=JSON.parse(i.data)}catch{l={event:"message",data:i.data}}const f=Hp.get(l.event);f&&f.forEach(v=>{try{v(l.data)}catch(g){console.error("ws listener error",g)}})},ko.onopen=()=>console.log("[ws] connected as",t),ko.onclose=()=>console.log("[ws] closed"),ko.onerror=i=>console.error("[ws] error",i)),ko}function CS(t,e){const i=Hp.get(t)||[];return i.push(e),Hp.set(t,i),()=>UO(t,e)}function UO(t,e){const i=Hp.get(t)||[];Hp.set(t,i.filter(l=>l!==e))}function Uv(t,e){return!ko||ko.readyState!==WebSocket.OPEN?!1:(ko.send(JSON.stringify({event:t,data:e})),!0)}const DC=se.createContext(null);function VO({children:t}){const{user:e}=_l(),[i,l]=se.useState(!1),[f,v]=se.useState(null),g=se.useRef(new Map),c=se.useRef(null),A=se.useRef(null);se.useEffect(()=>{if(!e)return;const Z=e.role||"passenger";FO(Z),Uv("register",{role:Z});const W=CS("passenger:update_driver_marker",J=>{const{phone:ce,lat:ie,lng:oe,orderId:re}=J||{};!ce||typeof ie!="number"||typeof oe!="number"||g.current.set(String(ce),{lat:ie,lng:oe,orderId:re})}),K=CS("passenger:meter_started",({orderId:J})=>{try{console.log("[ws] passenger meter started for order",J)}catch{}});return()=>{W==null||W(),K==null||K()}},[e]),se.useEffect(()=>{if(!e||e.role!=="driver")return;function Z(){if(!("geolocation"in navigator)){console.warn("[ws] Geolocation not supported");return}try{c.current=navigator.geolocation.watchPosition(ce=>{const{latitude:ie,longitude:oe}=(ce==null?void 0:ce.coords)||{};typeof ie=="number"&&typeof oe=="number"&&v({lat:ie,lng:oe,at:Date.now()})},ce=>{console.warn("[ws] geolocation error",ce)},{enableHighAccuracy:!0,maximumAge:2e3,timeout:1e4})}catch(ce){console.warn("[ws] geolocation start failed",ce)}}function W(){try{c.current!=null&&navigator.geolocation.clearWatch(c.current)}catch{}c.current=null}function K(){J(),A.current=setInterval(()=>{if(!i)return;const ce=f;if(!ce)return;const ie={phone:e.phone||e.phoneNumber||e.mobile||e.userId||void 0,lat:Number(ce.lat),lng:Number(ce.lng)};Uv("driver:update_location",ie)},3e3)}function J(){if(A.current){try{clearInterval(A.current)}catch{}A.current=null}}return i?(Z(),K()):(J(),W()),()=>{J(),W()}},[i,e,f]);const N=se.useMemo(()=>({online:i,setOnline:l,lastLocation:f,getMarkers:()=>g.current,startMeter:Z=>Z?Uv("driver:meter_start",{orderId:Z}):!1}),[i,f]);return I.jsx(DC.Provider,{value:N,children:t})}function $O(){return se.useContext(DC)}function Vr(t,e,{checkForDefaultPrevented:i=!0}={}){return function(f){if(t==null||t(f),i===!1||!f.defaultPrevented)return e==null?void 0:e(f)}}function IS(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function NC(...t){return e=>{let i=!1;const l=t.map(f=>{const v=IS(f,e);return!i&&typeof v=="function"&&(i=!0),v});if(i)return()=>{for(let f=0;f<l.length;f++){const v=l[f];typeof v=="function"?v():IS(t[f],null)}}}}function mu(...t){return se.useCallback(NC(...t),t)}function oy(t,e=[]){let i=[];function l(v,g){const c=se.createContext(g),A=i.length;i=[...i,g];const N=W=>{var re;const{scope:K,children:J,...ce}=W,ie=((re=K==null?void 0:K[t])==null?void 0:re[A])||c,oe=se.useMemo(()=>ce,Object.values(ce));return I.jsx(ie.Provider,{value:oe,children:J})};N.displayName=v+"Provider";function Z(W,K){var ie;const J=((ie=K==null?void 0:K[t])==null?void 0:ie[A])||c,ce=se.useContext(J);if(ce)return ce;if(g!==void 0)return g;throw new Error(`\`${W}\` must be used within \`${v}\``)}return[N,Z]}const f=()=>{const v=i.map(g=>se.createContext(g));return function(c){const A=(c==null?void 0:c[t])||v;return se.useMemo(()=>({[`__scope${t}`]:{...c,[t]:A}}),[c,A])}};return f.scopeName=t,[l,ZO(f,...e)]}function ZO(...t){const e=t[0];if(t.length===1)return e;const i=()=>{const l=t.map(f=>({useScope:f(),scopeName:f.scopeName}));return function(v){const g=l.reduce((c,{useScope:A,scopeName:N})=>{const W=A(v)[`__scope${N}`];return{...c,...W}},{});return se.useMemo(()=>({[`__scope${e.scopeName}`]:g}),[g])}};return i.scopeName=e.scopeName,i}function P_(t){const e=qO(t),i=se.forwardRef((l,f)=>{const{children:v,...g}=l,c=se.Children.toArray(v),A=c.find(HO);if(A){const N=A.props.children,Z=c.map(W=>W===A?se.Children.count(N)>1?se.Children.only(null):se.isValidElement(N)?N.props.children:null:W);return I.jsx(e,{...g,ref:f,children:se.isValidElement(N)?se.cloneElement(N,void 0,Z):null})}return I.jsx(e,{...g,ref:f,children:v})});return i.displayName=`${t}.Slot`,i}var GO=P_("Slot");function qO(t){const e=se.forwardRef((i,l)=>{const{children:f,...v}=i;if(se.isValidElement(f)){const g=XO(f),c=KO(v,f.props);return f.type!==se.Fragment&&(c.ref=l?NC(l,g):g),se.cloneElement(f,c)}return se.Children.count(f)>1?se.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var WO=Symbol("radix.slottable");function HO(t){return se.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===WO}function KO(t,e){const i={...e};for(const l in e){const f=t[l],v=e[l];/^on[A-Z]/.test(l)?f&&v?i[l]=(...c)=>{const A=v(...c);return f(...c),A}:f&&(i[l]=f):l==="style"?i[l]={...f,...v}:l==="className"&&(i[l]=[f,v].filter(Boolean).join(" "))}return{...t,...i}}function XO(t){var l,f;let e=(l=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:l.get,i=e&&"isReactWarning"in e&&e.isReactWarning;return i?t.ref:(e=(f=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:f.get,i=e&&"isReactWarning"in e&&e.isReactWarning,i?t.props.ref:t.props.ref||t.ref)}function OC(t){const e=t+"CollectionProvider",[i,l]=oy(e),[f,v]=i(e,{collectionRef:{current:null},itemMap:new Map}),g=ie=>{const{scope:oe,children:re}=ie,$=pa.useRef(null),te=pa.useRef(new Map).current;return I.jsx(f,{scope:oe,itemMap:te,collectionRef:$,children:re})};g.displayName=e;const c=t+"CollectionSlot",A=P_(c),N=pa.forwardRef((ie,oe)=>{const{scope:re,children:$}=ie,te=v(c,re),fe=mu(oe,te.collectionRef);return I.jsx(A,{ref:fe,children:$})});N.displayName=c;const Z=t+"CollectionItemSlot",W="data-radix-collection-item",K=P_(Z),J=pa.forwardRef((ie,oe)=>{const{scope:re,children:$,...te}=ie,fe=pa.useRef(null),pe=mu(oe,fe),Ie=v(Z,re);return pa.useEffect(()=>(Ie.itemMap.set(fe,{ref:fe,...te}),()=>void Ie.itemMap.delete(fe))),I.jsx(K,{[W]:"",ref:pe,children:$})});J.displayName=Z;function ce(ie){const oe=v(t+"CollectionConsumer",ie);return pa.useCallback(()=>{const $=oe.collectionRef.current;if(!$)return[];const te=Array.from($.querySelectorAll(`[${W}]`));return Array.from(oe.itemMap.values()).sort((Ie,Ge)=>te.indexOf(Ie.ref.current)-te.indexOf(Ge.ref.current))},[oe.collectionRef,oe.itemMap])}return[{Provider:g,Slot:N,ItemSlot:J},ce,l]}var YO=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],rs=YO.reduce((t,e)=>{const i=P_(`Primitive.${e}`),l=se.forwardRef((f,v)=>{const{asChild:g,...c}=f,A=g?i:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),I.jsx(A,{...c,ref:v})});return l.displayName=`Primitive.${e}`,{...t,[e]:l}},{});function jC(t,e){t&&Y_.flushSync(()=>t.dispatchEvent(e))}function gu(t){const e=se.useRef(t);return se.useEffect(()=>{e.current=t}),se.useMemo(()=>(...i)=>{var l;return(l=e.current)==null?void 0:l.call(e,...i)},[])}function JO(t,e=globalThis==null?void 0:globalThis.document){const i=gu(t);se.useEffect(()=>{const l=f=>{f.key==="Escape"&&i(f)};return e.addEventListener("keydown",l,{capture:!0}),()=>e.removeEventListener("keydown",l,{capture:!0})},[i,e])}var QO="DismissableLayer",h0="dismissableLayer.update",e3="dismissableLayer.pointerDownOutside",t3="dismissableLayer.focusOutside",kS,BC=se.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),FC=se.forwardRef((t,e)=>{const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:l,onPointerDownOutside:f,onFocusOutside:v,onInteractOutside:g,onDismiss:c,...A}=t,N=se.useContext(BC),[Z,W]=se.useState(null),K=(Z==null?void 0:Z.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,J]=se.useState({}),ce=mu(e,Ge=>W(Ge)),ie=Array.from(N.layers),[oe]=[...N.layersWithOutsidePointerEventsDisabled].slice(-1),re=ie.indexOf(oe),$=Z?ie.indexOf(Z):-1,te=N.layersWithOutsidePointerEventsDisabled.size>0,fe=$>=re,pe=r3(Ge=>{const Le=Ge.target,xt=[...N.branches].some(ct=>ct.contains(Le));!fe||xt||(f==null||f(Ge),g==null||g(Ge),Ge.defaultPrevented||c==null||c())},K),Ie=i3(Ge=>{const Le=Ge.target;[...N.branches].some(ct=>ct.contains(Le))||(v==null||v(Ge),g==null||g(Ge),Ge.defaultPrevented||c==null||c())},K);return JO(Ge=>{$===N.layers.size-1&&(l==null||l(Ge),!Ge.defaultPrevented&&c&&(Ge.preventDefault(),c()))},K),se.useEffect(()=>{if(Z)return i&&(N.layersWithOutsidePointerEventsDisabled.size===0&&(kS=K.body.style.pointerEvents,K.body.style.pointerEvents="none"),N.layersWithOutsidePointerEventsDisabled.add(Z)),N.layers.add(Z),MS(),()=>{i&&N.layersWithOutsidePointerEventsDisabled.size===1&&(K.body.style.pointerEvents=kS)}},[Z,K,i,N]),se.useEffect(()=>()=>{Z&&(N.layers.delete(Z),N.layersWithOutsidePointerEventsDisabled.delete(Z),MS())},[Z,N]),se.useEffect(()=>{const Ge=()=>J({});return document.addEventListener(h0,Ge),()=>document.removeEventListener(h0,Ge)},[]),I.jsx(rs.div,{...A,ref:ce,style:{pointerEvents:te?fe?"auto":"none":void 0,...t.style},onFocusCapture:Vr(t.onFocusCapture,Ie.onFocusCapture),onBlurCapture:Vr(t.onBlurCapture,Ie.onBlurCapture),onPointerDownCapture:Vr(t.onPointerDownCapture,pe.onPointerDownCapture)})});FC.displayName=QO;var n3="DismissableLayerBranch",UC=se.forwardRef((t,e)=>{const i=se.useContext(BC),l=se.useRef(null),f=mu(e,l);return se.useEffect(()=>{const v=l.current;if(v)return i.branches.add(v),()=>{i.branches.delete(v)}},[i.branches]),I.jsx(rs.div,{...t,ref:f})});UC.displayName=n3;function r3(t,e=globalThis==null?void 0:globalThis.document){const i=gu(t),l=se.useRef(!1),f=se.useRef(()=>{});return se.useEffect(()=>{const v=c=>{if(c.target&&!l.current){let A=function(){VC(e3,i,N,{discrete:!0})};const N={originalEvent:c};c.pointerType==="touch"?(e.removeEventListener("click",f.current),f.current=A,e.addEventListener("click",f.current,{once:!0})):A()}else e.removeEventListener("click",f.current);l.current=!1},g=window.setTimeout(()=>{e.addEventListener("pointerdown",v)},0);return()=>{window.clearTimeout(g),e.removeEventListener("pointerdown",v),e.removeEventListener("click",f.current)}},[e,i]),{onPointerDownCapture:()=>l.current=!0}}function i3(t,e=globalThis==null?void 0:globalThis.document){const i=gu(t),l=se.useRef(!1);return se.useEffect(()=>{const f=v=>{v.target&&!l.current&&VC(t3,i,{originalEvent:v},{discrete:!1})};return e.addEventListener("focusin",f),()=>e.removeEventListener("focusin",f)},[e,i]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function MS(){const t=new CustomEvent(h0);document.dispatchEvent(t)}function VC(t,e,i,{discrete:l}){const f=i.originalEvent.target,v=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:i});e&&f.addEventListener(t,e,{once:!0}),l?jC(f,v):f.dispatchEvent(v)}var s3=FC,o3=UC,Wd=globalThis!=null&&globalThis.document?se.useLayoutEffect:()=>{},a3="Portal",$C=se.forwardRef((t,e)=>{var c;const{container:i,...l}=t,[f,v]=se.useState(!1);Wd(()=>v(!0),[]);const g=i||f&&((c=globalThis==null?void 0:globalThis.document)==null?void 0:c.body);return g?gz.createPortal(I.jsx(rs.div,{...l,ref:e}),g):null});$C.displayName=a3;function l3(t,e){return se.useReducer((i,l)=>e[i][l]??i,t)}var zb=t=>{const{present:e,children:i}=t,l=c3(e),f=typeof i=="function"?i({present:l.isPresent}):se.Children.only(i),v=mu(l.ref,u3(f));return typeof i=="function"||l.isPresent?se.cloneElement(f,{ref:v}):null};zb.displayName="Presence";function c3(t){const[e,i]=se.useState(),l=se.useRef(null),f=se.useRef(t),v=se.useRef("none"),g=t?"mounted":"unmounted",[c,A]=l3(g,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return se.useEffect(()=>{const N=Tg(l.current);v.current=c==="mounted"?N:"none"},[c]),Wd(()=>{const N=l.current,Z=f.current;if(Z!==t){const K=v.current,J=Tg(N);t?A("MOUNT"):J==="none"||(N==null?void 0:N.display)==="none"?A("UNMOUNT"):A(Z&&K!==J?"ANIMATION_OUT":"UNMOUNT"),f.current=t}},[t,A]),Wd(()=>{if(e){let N;const Z=e.ownerDocument.defaultView??window,W=J=>{const ie=Tg(l.current).includes(CSS.escape(J.animationName));if(J.target===e&&ie&&(A("ANIMATION_END"),!f.current)){const oe=e.style.animationFillMode;e.style.animationFillMode="forwards",N=Z.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=oe)})}},K=J=>{J.target===e&&(v.current=Tg(l.current))};return e.addEventListener("animationstart",K),e.addEventListener("animationcancel",W),e.addEventListener("animationend",W),()=>{Z.clearTimeout(N),e.removeEventListener("animationstart",K),e.removeEventListener("animationcancel",W),e.removeEventListener("animationend",W)}}else A("ANIMATION_END")},[e,A]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:se.useCallback(N=>{l.current=N?getComputedStyle(N):null,i(N)},[])}}function Tg(t){return(t==null?void 0:t.animationName)||"none"}function u3(t){var l,f;let e=(l=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:l.get,i=e&&"isReactWarning"in e&&e.isReactWarning;return i?t.ref:(e=(f=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:f.get,i=e&&"isReactWarning"in e&&e.isReactWarning,i?t.props.ref:t.props.ref||t.ref)}var h3=L0[" useInsertionEffect ".trim().toString()]||Wd;function Db({prop:t,defaultProp:e,onChange:i=()=>{},caller:l}){const[f,v,g]=d3({defaultProp:e,onChange:i}),c=t!==void 0,A=c?t:f;{const Z=se.useRef(t!==void 0);se.useEffect(()=>{const W=Z.current;W!==c&&console.warn(`${l} is changing from ${W?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),Z.current=c},[c,l])}const N=se.useCallback(Z=>{var W;if(c){const K=f3(Z)?Z(t):Z;K!==t&&((W=g.current)==null||W.call(g,K))}else v(Z)},[c,t,v,g]);return[A,N]}function d3({defaultProp:t,onChange:e}){const[i,l]=se.useState(t),f=se.useRef(i),v=se.useRef(e);return h3(()=>{v.current=e},[e]),se.useEffect(()=>{var g;f.current!==i&&((g=v.current)==null||g.call(v,i),f.current=i)},[i,f]),[i,l,v]}function f3(t){return typeof t=="function"}var p3=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),m3="VisuallyHidden",Nb=se.forwardRef((t,e)=>I.jsx(rs.span,{...t,ref:e,style:{...p3,...t.style}}));Nb.displayName=m3;var Ob="ToastProvider",[jb,g3,_3]=OC("Toast"),[ZC]=oy("Toast",[_3]),[y3,ay]=ZC(Ob),GC=t=>{const{__scopeToast:e,label:i="Notification",duration:l=5e3,swipeDirection:f="right",swipeThreshold:v=50,children:g}=t,[c,A]=se.useState(null),[N,Z]=se.useState(0),W=se.useRef(!1),K=se.useRef(!1);return i.trim()||console.error(`Invalid prop \`label\` supplied to \`${Ob}\`. Expected non-empty \`string\`.`),I.jsx(jb.Provider,{scope:e,children:I.jsx(y3,{scope:e,label:i,duration:l,swipeDirection:f,swipeThreshold:v,toastCount:N,viewport:c,onViewportChange:A,onToastAdd:se.useCallback(()=>Z(J=>J+1),[]),onToastRemove:se.useCallback(()=>Z(J=>J-1),[]),isFocusedToastEscapeKeyDownRef:W,isClosePausedRef:K,children:g})})};GC.displayName=Ob;var qC="ToastViewport",v3=["F8"],d0="toast.viewportPause",f0="toast.viewportResume",WC=se.forwardRef((t,e)=>{const{__scopeToast:i,hotkey:l=v3,label:f="Notifications ({hotkey})",...v}=t,g=ay(qC,i),c=g3(i),A=se.useRef(null),N=se.useRef(null),Z=se.useRef(null),W=se.useRef(null),K=mu(e,W,g.onViewportChange),J=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),ce=g.toastCount>0;se.useEffect(()=>{const oe=re=>{var te;l.length!==0&&l.every(fe=>re[fe]||re.code===fe)&&((te=W.current)==null||te.focus())};return document.addEventListener("keydown",oe),()=>document.removeEventListener("keydown",oe)},[l]),se.useEffect(()=>{const oe=A.current,re=W.current;if(ce&&oe&&re){const $=()=>{if(!g.isClosePausedRef.current){const Ie=new CustomEvent(d0);re.dispatchEvent(Ie),g.isClosePausedRef.current=!0}},te=()=>{if(g.isClosePausedRef.current){const Ie=new CustomEvent(f0);re.dispatchEvent(Ie),g.isClosePausedRef.current=!1}},fe=Ie=>{!oe.contains(Ie.relatedTarget)&&te()},pe=()=>{oe.contains(document.activeElement)||te()};return oe.addEventListener("focusin",$),oe.addEventListener("focusout",fe),oe.addEventListener("pointermove",$),oe.addEventListener("pointerleave",pe),window.addEventListener("blur",$),window.addEventListener("focus",te),()=>{oe.removeEventListener("focusin",$),oe.removeEventListener("focusout",fe),oe.removeEventListener("pointermove",$),oe.removeEventListener("pointerleave",pe),window.removeEventListener("blur",$),window.removeEventListener("focus",te)}}},[ce,g.isClosePausedRef]);const ie=se.useCallback(({tabbingDirection:oe})=>{const $=c().map(te=>{const fe=te.ref.current,pe=[fe,...R3(fe)];return oe==="forwards"?pe:pe.reverse()});return(oe==="forwards"?$.reverse():$).flat()},[c]);return se.useEffect(()=>{const oe=W.current;if(oe){const re=$=>{var pe,Ie,Ge;const te=$.altKey||$.ctrlKey||$.metaKey;if($.key==="Tab"&&!te){const Le=document.activeElement,xt=$.shiftKey;if($.target===oe&&xt){(pe=N.current)==null||pe.focus();return}const ze=ie({tabbingDirection:xt?"backwards":"forwards"}),vt=ze.findIndex(at=>at===Le);Vv(ze.slice(vt+1))?$.preventDefault():xt?(Ie=N.current)==null||Ie.focus():(Ge=Z.current)==null||Ge.focus()}};return oe.addEventListener("keydown",re),()=>oe.removeEventListener("keydown",re)}},[c,ie]),I.jsxs(o3,{ref:A,role:"region","aria-label":f.replace("{hotkey}",J),tabIndex:-1,style:{pointerEvents:ce?void 0:"none"},children:[ce&&I.jsx(p0,{ref:N,onFocusFromOutsideViewport:()=>{const oe=ie({tabbingDirection:"forwards"});Vv(oe)}}),I.jsx(jb.Slot,{scope:i,children:I.jsx(rs.ol,{tabIndex:-1,...v,ref:K})}),ce&&I.jsx(p0,{ref:Z,onFocusFromOutsideViewport:()=>{const oe=ie({tabbingDirection:"backwards"});Vv(oe)}})]})});WC.displayName=qC;var HC="ToastFocusProxy",p0=se.forwardRef((t,e)=>{const{__scopeToast:i,onFocusFromOutsideViewport:l,...f}=t,v=ay(HC,i);return I.jsx(Nb,{tabIndex:0,...f,ref:e,style:{position:"fixed"},onFocus:g=>{var N;const c=g.relatedTarget;!((N=v.viewport)!=null&&N.contains(c))&&l()}})});p0.displayName=HC;var hm="Toast",x3="toast.swipeStart",b3="toast.swipeMove",w3="toast.swipeCancel",T3="toast.swipeEnd",KC=se.forwardRef((t,e)=>{const{forceMount:i,open:l,defaultOpen:f,onOpenChange:v,...g}=t,[c,A]=Db({prop:l,defaultProp:f??!0,onChange:v,caller:hm});return I.jsx(zb,{present:i||c,children:I.jsx(E3,{open:c,...g,ref:e,onClose:()=>A(!1),onPause:gu(t.onPause),onResume:gu(t.onResume),onSwipeStart:Vr(t.onSwipeStart,N=>{N.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Vr(t.onSwipeMove,N=>{const{x:Z,y:W}=N.detail.delta;N.currentTarget.setAttribute("data-swipe","move"),N.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${Z}px`),N.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${W}px`)}),onSwipeCancel:Vr(t.onSwipeCancel,N=>{N.currentTarget.setAttribute("data-swipe","cancel"),N.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),N.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),N.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),N.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Vr(t.onSwipeEnd,N=>{const{x:Z,y:W}=N.detail.delta;N.currentTarget.setAttribute("data-swipe","end"),N.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),N.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),N.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${Z}px`),N.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${W}px`),A(!1)})})})});KC.displayName=hm;var[S3,P3]=ZC(hm,{onClose(){}}),E3=se.forwardRef((t,e)=>{const{__scopeToast:i,type:l="foreground",duration:f,open:v,onClose:g,onEscapeKeyDown:c,onPause:A,onResume:N,onSwipeStart:Z,onSwipeMove:W,onSwipeCancel:K,onSwipeEnd:J,...ce}=t,ie=ay(hm,i),[oe,re]=se.useState(null),$=mu(e,at=>re(at)),te=se.useRef(null),fe=se.useRef(null),pe=f||ie.duration,Ie=se.useRef(0),Ge=se.useRef(pe),Le=se.useRef(0),{onToastAdd:xt,onToastRemove:ct}=ie,ht=gu(()=>{var Mt;(oe==null?void 0:oe.contains(document.activeElement))&&((Mt=ie.viewport)==null||Mt.focus()),g()}),ze=se.useCallback(at=>{!at||at===1/0||(window.clearTimeout(Le.current),Ie.current=new Date().getTime(),Le.current=window.setTimeout(ht,at))},[ht]);se.useEffect(()=>{const at=ie.viewport;if(at){const Mt=()=>{ze(Ge.current),N==null||N()},wt=()=>{const jt=new Date().getTime()-Ie.current;Ge.current=Ge.current-jt,window.clearTimeout(Le.current),A==null||A()};return at.addEventListener(d0,wt),at.addEventListener(f0,Mt),()=>{at.removeEventListener(d0,wt),at.removeEventListener(f0,Mt)}}},[ie.viewport,pe,A,N,ze]),se.useEffect(()=>{v&&!ie.isClosePausedRef.current&&ze(pe)},[v,pe,ie.isClosePausedRef,ze]),se.useEffect(()=>(xt(),()=>ct()),[xt,ct]);const vt=se.useMemo(()=>oe?nI(oe):null,[oe]);return ie.viewport?I.jsxs(I.Fragment,{children:[vt&&I.jsx(C3,{__scopeToast:i,role:"status","aria-live":l==="foreground"?"assertive":"polite",children:vt}),I.jsx(S3,{scope:i,onClose:ht,children:Y_.createPortal(I.jsx(jb.ItemSlot,{scope:i,children:I.jsx(s3,{asChild:!0,onEscapeKeyDown:Vr(c,()=>{ie.isFocusedToastEscapeKeyDownRef.current||ht(),ie.isFocusedToastEscapeKeyDownRef.current=!1}),children:I.jsx(rs.li,{tabIndex:0,"data-state":v?"open":"closed","data-swipe-direction":ie.swipeDirection,...ce,ref:$,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:Vr(t.onKeyDown,at=>{at.key==="Escape"&&(c==null||c(at.nativeEvent),at.nativeEvent.defaultPrevented||(ie.isFocusedToastEscapeKeyDownRef.current=!0,ht()))}),onPointerDown:Vr(t.onPointerDown,at=>{at.button===0&&(te.current={x:at.clientX,y:at.clientY})}),onPointerMove:Vr(t.onPointerMove,at=>{if(!te.current)return;const Mt=at.clientX-te.current.x,wt=at.clientY-te.current.y,jt=!!fe.current,Ne=["left","right"].includes(ie.swipeDirection),Oe=["left","up"].includes(ie.swipeDirection)?Math.min:Math.max,We=Ne?Oe(0,Mt):0,nt=Ne?0:Oe(0,wt),_t=at.pointerType==="touch"?10:2,Bt={x:We,y:nt},Ft={originalEvent:at,delta:Bt};jt?(fe.current=Bt,Sg(b3,W,Ft,{discrete:!1})):AS(Bt,ie.swipeDirection,_t)?(fe.current=Bt,Sg(x3,Z,Ft,{discrete:!1}),at.target.setPointerCapture(at.pointerId)):(Math.abs(Mt)>_t||Math.abs(wt)>_t)&&(te.current=null)}),onPointerUp:Vr(t.onPointerUp,at=>{const Mt=fe.current,wt=at.target;if(wt.hasPointerCapture(at.pointerId)&&wt.releasePointerCapture(at.pointerId),fe.current=null,te.current=null,Mt){const jt=at.currentTarget,Ne={originalEvent:at,delta:Mt};AS(Mt,ie.swipeDirection,ie.swipeThreshold)?Sg(T3,J,Ne,{discrete:!0}):Sg(w3,K,Ne,{discrete:!0}),jt.addEventListener("click",Oe=>Oe.preventDefault(),{once:!0})}})})})}),ie.viewport)})]}):null}),C3=t=>{const{__scopeToast:e,children:i,...l}=t,f=ay(hm,e),[v,g]=se.useState(!1),[c,A]=se.useState(!1);return M3(()=>g(!0)),se.useEffect(()=>{const N=window.setTimeout(()=>A(!0),1e3);return()=>window.clearTimeout(N)},[]),c?null:I.jsx($C,{asChild:!0,children:I.jsx(Nb,{...l,children:v&&I.jsxs(I.Fragment,{children:[f.label," ",i]})})})},I3="ToastTitle",XC=se.forwardRef((t,e)=>{const{__scopeToast:i,...l}=t;return I.jsx(rs.div,{...l,ref:e})});XC.displayName=I3;var k3="ToastDescription",YC=se.forwardRef((t,e)=>{const{__scopeToast:i,...l}=t;return I.jsx(rs.div,{...l,ref:e})});YC.displayName=k3;var JC="ToastAction",QC=se.forwardRef((t,e)=>{const{altText:i,...l}=t;return i.trim()?I.jsx(tI,{altText:i,asChild:!0,children:I.jsx(Bb,{...l,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${JC}\`. Expected non-empty \`string\`.`),null)});QC.displayName=JC;var eI="ToastClose",Bb=se.forwardRef((t,e)=>{const{__scopeToast:i,...l}=t,f=P3(eI,i);return I.jsx(tI,{asChild:!0,children:I.jsx(rs.button,{type:"button",...l,ref:e,onClick:Vr(t.onClick,f.onClose)})})});Bb.displayName=eI;var tI=se.forwardRef((t,e)=>{const{__scopeToast:i,altText:l,...f}=t;return I.jsx(rs.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":l||void 0,...f,ref:e})});function nI(t){const e=[];return Array.from(t.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&e.push(l.textContent),A3(l)){const f=l.ariaHidden||l.hidden||l.style.display==="none",v=l.dataset.radixToastAnnounceExclude==="";if(!f)if(v){const g=l.dataset.radixToastAnnounceAlt;g&&e.push(g)}else e.push(...nI(l))}}),e}function Sg(t,e,i,{discrete:l}){const f=i.originalEvent.currentTarget,v=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:i});e&&f.addEventListener(t,e,{once:!0}),l?jC(f,v):f.dispatchEvent(v)}var AS=(t,e,i=0)=>{const l=Math.abs(t.x),f=Math.abs(t.y),v=l>f;return e==="left"||e==="right"?v&&l>i:!v&&f>i};function M3(t=()=>{}){const e=gu(t);Wd(()=>{let i=0,l=0;return i=window.requestAnimationFrame(()=>l=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(i),window.cancelAnimationFrame(l)}},[e])}function A3(t){return t.nodeType===t.ELEMENT_NODE}function R3(t){const e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const f=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||f?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)e.push(i.currentNode);return e}function Vv(t){const e=document.activeElement;return t.some(i=>i===e?!0:(i.focus(),document.activeElement!==e))}var L3=GC,rI=WC,iI=KC,sI=XC,oI=YC,aI=QC,lI=Bb;function cI(t){var e,i,l="";if(typeof t=="string"||typeof t=="number")l+=t;else if(typeof t=="object")if(Array.isArray(t)){var f=t.length;for(e=0;e<f;e++)t[e]&&(i=cI(t[e]))&&(l&&(l+=" "),l+=i)}else for(i in t)t[i]&&(l&&(l+=" "),l+=i);return l}function uI(){for(var t,e,i=0,l="",f=arguments.length;i<f;i++)(t=arguments[i])&&(e=cI(t))&&(l&&(l+=" "),l+=e);return l}const RS=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,LS=uI,Fb=(t,e)=>i=>{var l;if((e==null?void 0:e.variants)==null)return LS(t,i==null?void 0:i.class,i==null?void 0:i.className);const{variants:f,defaultVariants:v}=e,g=Object.keys(f).map(N=>{const Z=i==null?void 0:i[N],W=v==null?void 0:v[N];if(Z===null)return null;const K=RS(Z)||RS(W);return f[N][K]}),c=i&&Object.entries(i).reduce((N,Z)=>{let[W,K]=Z;return K===void 0||(N[W]=K),N},{}),A=e==null||(l=e.compoundVariants)===null||l===void 0?void 0:l.reduce((N,Z)=>{let{class:W,className:K,...J}=Z;return Object.entries(J).every(ce=>{let[ie,oe]=ce;return Array.isArray(oe)?oe.includes({...v,...c}[ie]):{...v,...c}[ie]===oe})?[...N,W,K]:N},[]);return LS(t,g,A,i==null?void 0:i.class,i==null?void 0:i.className)};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z3=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),hI=(...t)=>t.filter((e,i,l)=>!!e&&e.trim()!==""&&l.indexOf(e)===i).join(" ").trim();/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var D3={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N3=se.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:f="",children:v,iconNode:g,...c},A)=>se.createElement("svg",{ref:A,...D3,width:e,height:e,stroke:t,strokeWidth:l?Number(i)*24/Number(e):i,className:hI("lucide",f),...c},[...g.map(([N,Z])=>se.createElement(N,Z)),...Array.isArray(v)?v:[v]]));/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=(t,e)=>{const i=se.forwardRef(({className:l,...f},v)=>se.createElement(N3,{ref:v,iconNode:e,className:hI(`lucide-${z3(t)}`,l),...f}));return i.displayName=`${t}`,i};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wp=Xr("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=Xr("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O3=Xr("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=Xr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cu=Xr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zS=Xr("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xl=Xr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E_=Xr("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ub=Xr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=Xr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j3=Xr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=Xr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vb=Xr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kp=Xr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dI=Xr("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DS=Xr("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B3=Xr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F3=Xr("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ly=Xr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U3=Xr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V3=Xr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),$b="-",$3=t=>{const e=G3(t),{conflictingClassGroups:i,conflictingClassGroupModifiers:l}=t;return{getClassGroupId:g=>{const c=g.split($b);return c[0]===""&&c.length!==1&&c.shift(),fI(c,e)||Z3(g)},getConflictingClassGroupIds:(g,c)=>{const A=i[g]||[];return c&&l[g]?[...A,...l[g]]:A}}},fI=(t,e)=>{var g;if(t.length===0)return e.classGroupId;const i=t[0],l=e.nextPart.get(i),f=l?fI(t.slice(1),l):void 0;if(f)return f;if(e.validators.length===0)return;const v=t.join($b);return(g=e.validators.find(({validator:c})=>c(v)))==null?void 0:g.classGroupId},NS=/^\[(.+)\]$/,Z3=t=>{if(NS.test(t)){const e=NS.exec(t)[1],i=e==null?void 0:e.substring(0,e.indexOf(":"));if(i)return"arbitrary.."+i}},G3=t=>{const{theme:e,prefix:i}=t,l={nextPart:new Map,validators:[]};return W3(Object.entries(t.classGroups),i).forEach(([v,g])=>{m0(g,l,v,e)}),l},m0=(t,e,i,l)=>{t.forEach(f=>{if(typeof f=="string"){const v=f===""?e:OS(e,f);v.classGroupId=i;return}if(typeof f=="function"){if(q3(f)){m0(f(l),e,i,l);return}e.validators.push({validator:f,classGroupId:i});return}Object.entries(f).forEach(([v,g])=>{m0(g,OS(e,v),i,l)})})},OS=(t,e)=>{let i=t;return e.split($b).forEach(l=>{i.nextPart.has(l)||i.nextPart.set(l,{nextPart:new Map,validators:[]}),i=i.nextPart.get(l)}),i},q3=t=>t.isThemeGetter,W3=(t,e)=>e?t.map(([i,l])=>{const f=l.map(v=>typeof v=="string"?e+v:typeof v=="object"?Object.fromEntries(Object.entries(v).map(([g,c])=>[e+g,c])):v);return[i,f]}):t,H3=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,i=new Map,l=new Map;const f=(v,g)=>{i.set(v,g),e++,e>t&&(e=0,l=i,i=new Map)};return{get(v){let g=i.get(v);if(g!==void 0)return g;if((g=l.get(v))!==void 0)return f(v,g),g},set(v,g){i.has(v)?i.set(v,g):f(v,g)}}},pI="!",K3=t=>{const{separator:e,experimentalParseClassName:i}=t,l=e.length===1,f=e[0],v=e.length,g=c=>{const A=[];let N=0,Z=0,W;for(let oe=0;oe<c.length;oe++){let re=c[oe];if(N===0){if(re===f&&(l||c.slice(oe,oe+v)===e)){A.push(c.slice(Z,oe)),Z=oe+v;continue}if(re==="/"){W=oe;continue}}re==="["?N++:re==="]"&&N--}const K=A.length===0?c:c.substring(Z),J=K.startsWith(pI),ce=J?K.substring(1):K,ie=W&&W>Z?W-Z:void 0;return{modifiers:A,hasImportantModifier:J,baseClassName:ce,maybePostfixModifierPosition:ie}};return i?c=>i({className:c,parseClassName:g}):g},X3=t=>{if(t.length<=1)return t;const e=[];let i=[];return t.forEach(l=>{l[0]==="["?(e.push(...i.sort(),l),i=[]):i.push(l)}),e.push(...i.sort()),e},Y3=t=>({cache:H3(t.cacheSize),parseClassName:K3(t),...$3(t)}),J3=/\s+/,Q3=(t,e)=>{const{parseClassName:i,getClassGroupId:l,getConflictingClassGroupIds:f}=e,v=[],g=t.trim().split(J3);let c="";for(let A=g.length-1;A>=0;A-=1){const N=g[A],{modifiers:Z,hasImportantModifier:W,baseClassName:K,maybePostfixModifierPosition:J}=i(N);let ce=!!J,ie=l(ce?K.substring(0,J):K);if(!ie){if(!ce){c=N+(c.length>0?" "+c:c);continue}if(ie=l(K),!ie){c=N+(c.length>0?" "+c:c);continue}ce=!1}const oe=X3(Z).join(":"),re=W?oe+pI:oe,$=re+ie;if(v.includes($))continue;v.push($);const te=f(ie,ce);for(let fe=0;fe<te.length;++fe){const pe=te[fe];v.push(re+pe)}c=N+(c.length>0?" "+c:c)}return c};function ej(){let t=0,e,i,l="";for(;t<arguments.length;)(e=arguments[t++])&&(i=mI(e))&&(l&&(l+=" "),l+=i);return l}const mI=t=>{if(typeof t=="string")return t;let e,i="";for(let l=0;l<t.length;l++)t[l]&&(e=mI(t[l]))&&(i&&(i+=" "),i+=e);return i};function tj(t,...e){let i,l,f,v=g;function g(A){const N=e.reduce((Z,W)=>W(Z),t());return i=Y3(N),l=i.cache.get,f=i.cache.set,v=c,c(A)}function c(A){const N=l(A);if(N)return N;const Z=Q3(A,i);return f(A,Z),Z}return function(){return v(ej.apply(null,arguments))}}const cr=t=>{const e=i=>i[t]||[];return e.isThemeGetter=!0,e},gI=/^\[(?:([a-z-]+):)?(.+)\]$/i,nj=/^\d+\/\d+$/,rj=new Set(["px","full","screen"]),ij=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,sj=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,oj=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,aj=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,lj=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ul=t=>zd(t)||rj.has(t)||nj.test(t),Oc=t=>sf(t,"length",gj),zd=t=>!!t&&!Number.isNaN(Number(t)),$v=t=>sf(t,"number",zd),rp=t=>!!t&&Number.isInteger(Number(t)),cj=t=>t.endsWith("%")&&zd(t.slice(0,-1)),pn=t=>gI.test(t),jc=t=>ij.test(t),uj=new Set(["length","size","percentage"]),hj=t=>sf(t,uj,_I),dj=t=>sf(t,"position",_I),fj=new Set(["image","url"]),pj=t=>sf(t,fj,yj),mj=t=>sf(t,"",_j),ip=()=>!0,sf=(t,e,i)=>{const l=gI.exec(t);return l?l[1]?typeof e=="string"?l[1]===e:e.has(l[1]):i(l[2]):!1},gj=t=>sj.test(t)&&!oj.test(t),_I=()=>!1,_j=t=>aj.test(t),yj=t=>lj.test(t),vj=()=>{const t=cr("colors"),e=cr("spacing"),i=cr("blur"),l=cr("brightness"),f=cr("borderColor"),v=cr("borderRadius"),g=cr("borderSpacing"),c=cr("borderWidth"),A=cr("contrast"),N=cr("grayscale"),Z=cr("hueRotate"),W=cr("invert"),K=cr("gap"),J=cr("gradientColorStops"),ce=cr("gradientColorStopPositions"),ie=cr("inset"),oe=cr("margin"),re=cr("opacity"),$=cr("padding"),te=cr("saturate"),fe=cr("scale"),pe=cr("sepia"),Ie=cr("skew"),Ge=cr("space"),Le=cr("translate"),xt=()=>["auto","contain","none"],ct=()=>["auto","hidden","clip","visible","scroll"],ht=()=>["auto",pn,e],ze=()=>[pn,e],vt=()=>["",Ul,Oc],at=()=>["auto",zd,pn],Mt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],wt=()=>["solid","dashed","dotted","double","none"],jt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ne=()=>["start","end","center","between","around","evenly","stretch"],Oe=()=>["","0",pn],We=()=>["auto","avoid","all","avoid-page","page","left","right","column"],nt=()=>[zd,pn];return{cacheSize:500,separator:":",theme:{colors:[ip],spacing:[Ul,Oc],blur:["none","",jc,pn],brightness:nt(),borderColor:[t],borderRadius:["none","","full",jc,pn],borderSpacing:ze(),borderWidth:vt(),contrast:nt(),grayscale:Oe(),hueRotate:nt(),invert:Oe(),gap:ze(),gradientColorStops:[t],gradientColorStopPositions:[cj,Oc],inset:ht(),margin:ht(),opacity:nt(),padding:ze(),saturate:nt(),scale:nt(),sepia:Oe(),skew:nt(),space:ze(),translate:ze()},classGroups:{aspect:[{aspect:["auto","square","video",pn]}],container:["container"],columns:[{columns:[jc]}],"break-after":[{"break-after":We()}],"break-before":[{"break-before":We()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Mt(),pn]}],overflow:[{overflow:ct()}],"overflow-x":[{"overflow-x":ct()}],"overflow-y":[{"overflow-y":ct()}],overscroll:[{overscroll:xt()}],"overscroll-x":[{"overscroll-x":xt()}],"overscroll-y":[{"overscroll-y":xt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[ie]}],"inset-x":[{"inset-x":[ie]}],"inset-y":[{"inset-y":[ie]}],start:[{start:[ie]}],end:[{end:[ie]}],top:[{top:[ie]}],right:[{right:[ie]}],bottom:[{bottom:[ie]}],left:[{left:[ie]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",rp,pn]}],basis:[{basis:ht()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",pn]}],grow:[{grow:Oe()}],shrink:[{shrink:Oe()}],order:[{order:["first","last","none",rp,pn]}],"grid-cols":[{"grid-cols":[ip]}],"col-start-end":[{col:["auto",{span:["full",rp,pn]},pn]}],"col-start":[{"col-start":at()}],"col-end":[{"col-end":at()}],"grid-rows":[{"grid-rows":[ip]}],"row-start-end":[{row:["auto",{span:[rp,pn]},pn]}],"row-start":[{"row-start":at()}],"row-end":[{"row-end":at()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",pn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",pn]}],gap:[{gap:[K]}],"gap-x":[{"gap-x":[K]}],"gap-y":[{"gap-y":[K]}],"justify-content":[{justify:["normal",...Ne()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ne(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ne(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[$]}],px:[{px:[$]}],py:[{py:[$]}],ps:[{ps:[$]}],pe:[{pe:[$]}],pt:[{pt:[$]}],pr:[{pr:[$]}],pb:[{pb:[$]}],pl:[{pl:[$]}],m:[{m:[oe]}],mx:[{mx:[oe]}],my:[{my:[oe]}],ms:[{ms:[oe]}],me:[{me:[oe]}],mt:[{mt:[oe]}],mr:[{mr:[oe]}],mb:[{mb:[oe]}],ml:[{ml:[oe]}],"space-x":[{"space-x":[Ge]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ge]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",pn,e]}],"min-w":[{"min-w":[pn,e,"min","max","fit"]}],"max-w":[{"max-w":[pn,e,"none","full","min","max","fit","prose",{screen:[jc]},jc]}],h:[{h:[pn,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[pn,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[pn,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[pn,e,"auto","min","max","fit"]}],"font-size":[{text:["base",jc,Oc]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",$v]}],"font-family":[{font:[ip]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",pn]}],"line-clamp":[{"line-clamp":["none",zd,$v]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ul,pn]}],"list-image":[{"list-image":["none",pn]}],"list-style-type":[{list:["none","disc","decimal",pn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[re]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[re]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...wt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ul,Oc]}],"underline-offset":[{"underline-offset":["auto",Ul,pn]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ze()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",pn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",pn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[re]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Mt(),dj]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",hj]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},pj]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[ce]}],"gradient-via-pos":[{via:[ce]}],"gradient-to-pos":[{to:[ce]}],"gradient-from":[{from:[J]}],"gradient-via":[{via:[J]}],"gradient-to":[{to:[J]}],rounded:[{rounded:[v]}],"rounded-s":[{"rounded-s":[v]}],"rounded-e":[{"rounded-e":[v]}],"rounded-t":[{"rounded-t":[v]}],"rounded-r":[{"rounded-r":[v]}],"rounded-b":[{"rounded-b":[v]}],"rounded-l":[{"rounded-l":[v]}],"rounded-ss":[{"rounded-ss":[v]}],"rounded-se":[{"rounded-se":[v]}],"rounded-ee":[{"rounded-ee":[v]}],"rounded-es":[{"rounded-es":[v]}],"rounded-tl":[{"rounded-tl":[v]}],"rounded-tr":[{"rounded-tr":[v]}],"rounded-br":[{"rounded-br":[v]}],"rounded-bl":[{"rounded-bl":[v]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[re]}],"border-style":[{border:[...wt(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[re]}],"divide-style":[{divide:wt()}],"border-color":[{border:[f]}],"border-color-x":[{"border-x":[f]}],"border-color-y":[{"border-y":[f]}],"border-color-s":[{"border-s":[f]}],"border-color-e":[{"border-e":[f]}],"border-color-t":[{"border-t":[f]}],"border-color-r":[{"border-r":[f]}],"border-color-b":[{"border-b":[f]}],"border-color-l":[{"border-l":[f]}],"divide-color":[{divide:[f]}],"outline-style":[{outline:["",...wt()]}],"outline-offset":[{"outline-offset":[Ul,pn]}],"outline-w":[{outline:[Ul,Oc]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:vt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[re]}],"ring-offset-w":[{"ring-offset":[Ul,Oc]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",jc,mj]}],"shadow-color":[{shadow:[ip]}],opacity:[{opacity:[re]}],"mix-blend":[{"mix-blend":[...jt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":jt()}],filter:[{filter:["","none"]}],blur:[{blur:[i]}],brightness:[{brightness:[l]}],contrast:[{contrast:[A]}],"drop-shadow":[{"drop-shadow":["","none",jc,pn]}],grayscale:[{grayscale:[N]}],"hue-rotate":[{"hue-rotate":[Z]}],invert:[{invert:[W]}],saturate:[{saturate:[te]}],sepia:[{sepia:[pe]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[i]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[A]}],"backdrop-grayscale":[{"backdrop-grayscale":[N]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Z]}],"backdrop-invert":[{"backdrop-invert":[W]}],"backdrop-opacity":[{"backdrop-opacity":[re]}],"backdrop-saturate":[{"backdrop-saturate":[te]}],"backdrop-sepia":[{"backdrop-sepia":[pe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[g]}],"border-spacing-x":[{"border-spacing-x":[g]}],"border-spacing-y":[{"border-spacing-y":[g]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",pn]}],duration:[{duration:nt()}],ease:[{ease:["linear","in","out","in-out",pn]}],delay:[{delay:nt()}],animate:[{animate:["none","spin","ping","pulse","bounce",pn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[fe]}],"scale-x":[{"scale-x":[fe]}],"scale-y":[{"scale-y":[fe]}],rotate:[{rotate:[rp,pn]}],"translate-x":[{"translate-x":[Le]}],"translate-y":[{"translate-y":[Le]}],"skew-x":[{"skew-x":[Ie]}],"skew-y":[{"skew-y":[Ie]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",pn]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",pn]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ze()}],"scroll-mx":[{"scroll-mx":ze()}],"scroll-my":[{"scroll-my":ze()}],"scroll-ms":[{"scroll-ms":ze()}],"scroll-me":[{"scroll-me":ze()}],"scroll-mt":[{"scroll-mt":ze()}],"scroll-mr":[{"scroll-mr":ze()}],"scroll-mb":[{"scroll-mb":ze()}],"scroll-ml":[{"scroll-ml":ze()}],"scroll-p":[{"scroll-p":ze()}],"scroll-px":[{"scroll-px":ze()}],"scroll-py":[{"scroll-py":ze()}],"scroll-ps":[{"scroll-ps":ze()}],"scroll-pe":[{"scroll-pe":ze()}],"scroll-pt":[{"scroll-pt":ze()}],"scroll-pr":[{"scroll-pr":ze()}],"scroll-pb":[{"scroll-pb":ze()}],"scroll-pl":[{"scroll-pl":ze()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",pn]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Ul,Oc,$v]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},xj=tj(vj);function Mi(...t){return xj(uI(t))}function Xp(t){return new Date(t).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function dl(t){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD"}).format(t)}function bj(t){return t?t.replace(/(\d{4})(\d{3})(\d{3})/,"$1-$2-$3"):""}function Yc(t){switch(t){case"idle":return"status-idle";case"busy":return"status-busy";case"offline":return"status-offline";case"completed":return"status-completed";case"requested":return"status-pending";case"assigned":return"status-pending";case"accepted":return"status-pending";case"enroute":return"status-pending";case"arrived":return"status-pending";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function Zl(t){switch(t){case"idle":return"";case"busy":return"";case"offline":return"";case"completed":return"";case"requested":return"";case"assigned":return"";case"accepted":return"";case"enroute":return"";case"arrived":return"";default:return""}}const yI=L3,vI=se.forwardRef(({className:t,...e},i)=>I.jsx(rI,{ref:i,className:Mi("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));vI.displayName=rI.displayName;const wj=Fb("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive border-destructive bg-destructive text-destructive-foreground",success:"border-green-600 bg-green-600 text-white"}},defaultVariants:{variant:"default"}}),xI=se.forwardRef(({className:t,variant:e,...i},l)=>I.jsx(iI,{ref:l,className:Mi(wj({variant:e}),t),...i}));xI.displayName=iI.displayName;const Tj=se.forwardRef(({className:t,...e},i)=>I.jsx(aI,{ref:i,className:Mi("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...e}));Tj.displayName=aI.displayName;const bI=se.forwardRef(({className:t,...e},i)=>I.jsx(lI,{ref:i,className:Mi("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:I.jsx(V3,{className:"h-4 w-4"})}));bI.displayName=lI.displayName;const wI=se.forwardRef(({className:t,...e},i)=>I.jsx(sI,{ref:i,className:Mi("text-sm font-semibold",t),...e}));wI.displayName=sI.displayName;const TI=se.forwardRef(({className:t,...e},i)=>I.jsx(oI,{ref:i,className:Mi("text-sm opacity-90",t),...e}));TI.displayName=oI.displayName;const Sj="modulepreload",Pj=function(t,e){return new URL(t,e).href},jS={},g0=function(e,i,l){let f=Promise.resolve();if(i&&i.length>0){const g=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),A=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));f=Promise.allSettled(i.map(N=>{if(N=Pj(N,l),N in jS)return;jS[N]=!0;const Z=N.endsWith(".css"),W=Z?'[rel="stylesheet"]':"";if(!!l)for(let ce=g.length-1;ce>=0;ce--){const ie=g[ce];if(ie.href===N&&(!Z||ie.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${N}"]${W}`))return;const J=document.createElement("link");if(J.rel=Z?"stylesheet":Sj,Z||(J.as="script"),J.crossOrigin="",J.href=N,A&&J.setAttribute("nonce",A),document.head.appendChild(J),Z)return new Promise((ce,ie)=>{J.addEventListener("load",ce),J.addEventListener("error",()=>ie(new Error(`Unable to preload CSS for ${N}`)))})}))}function v(g){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=g,window.dispatchEvent(c),!c.defaultPrevented)throw g}return f.then(g=>{for(const c of g||[])c.status==="rejected"&&v(c.reason);return e().catch(v)})},Rn=se.forwardRef(({className:t,...e},i)=>I.jsx("div",{ref:i,className:Mi("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));Rn.displayName="Card";const Mr=se.forwardRef(({className:t,...e},i)=>I.jsx("div",{ref:i,className:Mi("flex flex-col space-y-1.5 p-6",t),...e}));Mr.displayName="CardHeader";const Ar=se.forwardRef(({className:t,...e},i)=>I.jsx("h3",{ref:i,className:Mi("text-2xl font-semibold leading-none tracking-tight",t),...e}));Ar.displayName="CardTitle";const Rr=se.forwardRef(({className:t,...e},i)=>I.jsx("p",{ref:i,className:Mi("text-sm text-muted-foreground",t),...e}));Rr.displayName="CardDescription";const Ln=se.forwardRef(({className:t,...e},i)=>I.jsx("div",{ref:i,className:Mi("p-6 pt-0",t),...e}));Ln.displayName="CardContent";const Ej=se.forwardRef(({className:t,...e},i)=>I.jsx("div",{ref:i,className:Mi("flex items-center p-6 pt-0",t),...e}));Ej.displayName="CardFooter";const nr=se.forwardRef(({className:t,type:e,...i},l)=>I.jsx("input",{type:e,className:Mi("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:l,...i}));nr.displayName="Input";const Cj=Fb("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-green-600 text-white hover:bg-green-700",warning:"bg-yellow-600 text-white hover:bg-yellow-700"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Cn=se.forwardRef(({className:t,variant:e,size:i,asChild:l=!1,...f},v)=>{const g=l?GO:"button";return I.jsx(g,{className:Mi(Cj({variant:e,size:i,className:t})),ref:v,...f})});Cn.displayName="Button";const Ij=1,kj=1e6;let Zv=0;function Mj(){return Zv=(Zv+1)%Number.MAX_SAFE_INTEGER,Zv.toString()}const Gv=new Map,BS=t=>{if(Gv.has(t))return;const e=setTimeout(()=>{Gv.delete(t),Tp({type:"REMOVE_TOAST",toastId:t})},kj);Gv.set(t,e)},Aj=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,Ij)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(i=>i.id===e.toast.id?{...i,...e.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=e;return i?BS(i):t.toasts.forEach(l=>{BS(l.id)}),{...t,toasts:t.toasts.map(l=>l.id===i||i===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(i=>i.id!==e.toastId)}}},Hg=[];let Kg={toasts:[]};function Tp(t){Kg=Aj(Kg,t),Hg.forEach(e=>{e(Kg)})}function _0({...t}){const e=Mj(),i=f=>Tp({type:"UPDATE_TOAST",toast:{...f,id:e}}),l=()=>Tp({type:"DISMISS_TOAST",toastId:e});return Tp({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:f=>{f||l()}}}),{id:e,dismiss:l,update:i}}function sc(){const[t,e]=se.useState(Kg);return se.useEffect(()=>(Hg.push(e),()=>{const i=Hg.indexOf(e);i>-1&&Hg.splice(i,1)}),[]),{...t,toast:_0,dismiss:i=>Tp({type:"DISMISS_TOAST",toastId:i})}}const Rj=()=>{};var FS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SI=function(t){const e=[];let i=0;for(let l=0;l<t.length;l++){let f=t.charCodeAt(l);f<128?e[i++]=f:f<2048?(e[i++]=f>>6|192,e[i++]=f&63|128):(f&64512)===55296&&l+1<t.length&&(t.charCodeAt(l+1)&64512)===56320?(f=65536+((f&1023)<<10)+(t.charCodeAt(++l)&1023),e[i++]=f>>18|240,e[i++]=f>>12&63|128,e[i++]=f>>6&63|128,e[i++]=f&63|128):(e[i++]=f>>12|224,e[i++]=f>>6&63|128,e[i++]=f&63|128)}return e},Lj=function(t){const e=[];let i=0,l=0;for(;i<t.length;){const f=t[i++];if(f<128)e[l++]=String.fromCharCode(f);else if(f>191&&f<224){const v=t[i++];e[l++]=String.fromCharCode((f&31)<<6|v&63)}else if(f>239&&f<365){const v=t[i++],g=t[i++],c=t[i++],A=((f&7)<<18|(v&63)<<12|(g&63)<<6|c&63)-65536;e[l++]=String.fromCharCode(55296+(A>>10)),e[l++]=String.fromCharCode(56320+(A&1023))}else{const v=t[i++],g=t[i++];e[l++]=String.fromCharCode((f&15)<<12|(v&63)<<6|g&63)}}return e.join("")},PI={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,l=[];for(let f=0;f<t.length;f+=3){const v=t[f],g=f+1<t.length,c=g?t[f+1]:0,A=f+2<t.length,N=A?t[f+2]:0,Z=v>>2,W=(v&3)<<4|c>>4;let K=(c&15)<<2|N>>6,J=N&63;A||(J=64,g||(K=64)),l.push(i[Z],i[W],i[K],i[J])}return l.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(SI(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Lj(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,l=[];for(let f=0;f<t.length;){const v=i[t.charAt(f++)],c=f<t.length?i[t.charAt(f)]:0;++f;const N=f<t.length?i[t.charAt(f)]:64;++f;const W=f<t.length?i[t.charAt(f)]:64;if(++f,v==null||c==null||N==null||W==null)throw new zj;const K=v<<2|c>>4;if(l.push(K),N!==64){const J=c<<4&240|N>>2;if(l.push(J),W!==64){const ce=N<<6&192|W;l.push(ce)}}}return l},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class zj extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Dj=function(t){const e=SI(t);return PI.encodeByteArray(e,!0)},EI=function(t){return Dj(t).replace(/\./g,"")},CI=function(t){try{return PI.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nj(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oj=()=>Nj().__FIREBASE_DEFAULTS__,jj=()=>{if(typeof process>"u"||typeof FS>"u")return;const t=FS.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Bj=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&CI(t[1]);return e&&JSON.parse(e)},Zb=()=>{try{return Rj()||Oj()||jj()||Bj()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Fj=t=>{var e,i;return(i=(e=Zb())==null?void 0:e.emulatorHosts)==null?void 0:i[t]},II=()=>{var t;return(t=Zb())==null?void 0:t.config},kI=t=>{var e;return(e=Zb())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,l)=>{i?this.reject(i):this.resolve(l),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,l))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cy(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Vj(t){return(await fetch(t,{credentials:"include"})).ok}const Sp={};function $j(){const t={prod:[],emulator:[]};for(const e of Object.keys(Sp))Sp[e]?t.emulator.push(e):t.prod.push(e);return t}function Zj(t){let e=document.getElementById(t),i=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),i=!0),{created:i,element:e}}let US=!1;function Gj(t,e){if(typeof window>"u"||typeof document>"u"||!cy(window.location.host)||Sp[t]===e||Sp[t]||US)return;Sp[t]=e;function i(K){return`__firebase__banner__${K}`}const l="__firebase__banner",v=$j().prod.length>0;function g(){const K=document.getElementById(l);K&&K.remove()}function c(K){K.style.display="flex",K.style.background="#7faaf0",K.style.position="fixed",K.style.bottom="5px",K.style.left="5px",K.style.padding=".5em",K.style.borderRadius="5px",K.style.alignItems="center"}function A(K,J){K.setAttribute("width","24"),K.setAttribute("id",J),K.setAttribute("height","24"),K.setAttribute("viewBox","0 0 24 24"),K.setAttribute("fill","none"),K.style.marginLeft="-6px"}function N(){const K=document.createElement("span");return K.style.cursor="pointer",K.style.marginLeft="16px",K.style.fontSize="24px",K.innerHTML=" &times;",K.onclick=()=>{US=!0,g()},K}function Z(K,J){K.setAttribute("id",J),K.innerText="Learn more",K.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",K.setAttribute("target","__blank"),K.style.paddingLeft="5px",K.style.textDecoration="underline"}function W(){const K=Zj(l),J=i("text"),ce=document.getElementById(J)||document.createElement("span"),ie=i("learnmore"),oe=document.getElementById(ie)||document.createElement("a"),re=i("preprendIcon"),$=document.getElementById(re)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(K.created){const te=K.element;c(te),Z(oe,ie);const fe=N();A($,re),te.append($,ce,oe,fe),document.body.appendChild(te)}v?(ce.innerText="Preview backend disconnected.",$.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):($.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,ce.innerText="Preview backend running in this workspace."),ce.setAttribute("id",J)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",W):W()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qj(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(vs())}function Wj(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Hj(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Kj(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Xj(){const t=vs();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Yj(){try{return typeof indexedDB=="object"}catch{return!1}}function Jj(){return new Promise((t,e)=>{try{let i=!0;const l="validate-browser-context-for-indexeddb-analytics-module",f=self.indexedDB.open(l);f.onsuccess=()=>{f.result.close(),i||self.indexedDB.deleteDatabase(l),t(!0)},f.onupgradeneeded=()=>{i=!1},f.onerror=()=>{var v;e(((v=f.error)==null?void 0:v.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qj="FirebaseError";class xu extends Error{constructor(e,i,l){super(i),this.code=e,this.customData=l,this.name=Qj,Object.setPrototypeOf(this,xu.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dm.prototype.create)}}class dm{constructor(e,i,l){this.service=e,this.serviceName=i,this.errors=l}create(e,...i){const l=i[0]||{},f=`${this.service}/${e}`,v=this.errors[e],g=v?eB(v,l):"Error",c=`${this.serviceName}: ${g} (${f}).`;return new xu(f,c,l)}}function eB(t,e){return t.replace(tB,(i,l)=>{const f=e[l];return f!=null?String(f):`<${l}?>`})}const tB=/\{\$([^}]+)}/g;function nB(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Hd(t,e){if(t===e)return!0;const i=Object.keys(t),l=Object.keys(e);for(const f of i){if(!l.includes(f))return!1;const v=t[f],g=e[f];if(VS(v)&&VS(g)){if(!Hd(v,g))return!1}else if(v!==g)return!1}for(const f of l)if(!i.includes(f))return!1;return!0}function VS(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function of(t){const e=[];for(const[i,l]of Object.entries(t))Array.isArray(l)?l.forEach(f=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(f))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(l));return e.length?"&"+e.join("&"):""}function rB(t,e){const i=new iB(t,e);return i.subscribe.bind(i)}class iB{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(l=>{this.error(l)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,l){let f;if(e===void 0&&i===void 0&&l===void 0)throw new Error("Missing Observer.");sB(e,["next","error","complete"])?f=e:f={next:e,error:i,complete:l},f.next===void 0&&(f.next=qv),f.error===void 0&&(f.error=qv),f.complete===void 0&&(f.complete=qv);const v=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?f.error(this.finalError):f.complete()}catch{}}),this.observers.push(f),v}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(l){typeof console<"u"&&console.error&&console.error(l)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function sB(t,e){if(typeof t!="object"||t===null)return!1;for(const i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}function qv(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xh(t){return t&&t._delegate?t._delegate:t}class Kd{constructor(e,i,l){this.name=e,this.instanceFactory=i,this.type=l,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oB{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const l=new Uj;if(this.instancesDeferred.set(i,l),this.isInitialized(i)||this.shouldAutoInitialize())try{const f=this.getOrInitializeService({instanceIdentifier:i});f&&l.resolve(f)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(e==null?void 0:e.optional)??!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(f){if(l)return null;throw f}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(lB(e))try{this.getOrInitializeService({instanceIdentifier:Qu})}catch{}for(const[i,l]of this.instancesDeferred.entries()){const f=this.normalizeInstanceIdentifier(i);try{const v=this.getOrInitializeService({instanceIdentifier:f});l.resolve(v)}catch{}}}}clearInstance(e=Qu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Qu){return this.instances.has(e)}getOptions(e=Qu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,l=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(l))throw Error(`${this.name}(${l}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const f=this.getOrInitializeService({instanceIdentifier:l,options:i});for(const[v,g]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(v);l===c&&g.resolve(f)}return f}onInit(e,i){const l=this.normalizeInstanceIdentifier(i),f=this.onInitCallbacks.get(l)??new Set;f.add(e),this.onInitCallbacks.set(l,f);const v=this.instances.get(l);return v&&e(v,l),()=>{f.delete(e)}}invokeOnInitCallbacks(e,i){const l=this.onInitCallbacks.get(i);if(l)for(const f of l)try{f(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let l=this.instances.get(e);if(!l&&this.component&&(l=this.component.instanceFactory(this.container,{instanceIdentifier:aB(e),options:i}),this.instances.set(e,l),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(l,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,l)}catch{}return l||null}normalizeInstanceIdentifier(e=Qu){return this.component?this.component.multipleInstances?e:Qu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function aB(t){return t===Qu?void 0:t}function lB(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cB{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new oB(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wn;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Wn||(Wn={}));const uB={debug:Wn.DEBUG,verbose:Wn.VERBOSE,info:Wn.INFO,warn:Wn.WARN,error:Wn.ERROR,silent:Wn.SILENT},hB=Wn.INFO,dB={[Wn.DEBUG]:"log",[Wn.VERBOSE]:"log",[Wn.INFO]:"info",[Wn.WARN]:"warn",[Wn.ERROR]:"error"},fB=(t,e,...i)=>{if(e<t.logLevel)return;const l=new Date().toISOString(),f=dB[e];if(f)console[f](`[${l}]  ${t.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class MI{constructor(e){this.name=e,this._logLevel=hB,this._logHandler=fB,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Wn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?uB[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Wn.DEBUG,...e),this._logHandler(this,Wn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Wn.VERBOSE,...e),this._logHandler(this,Wn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Wn.INFO,...e),this._logHandler(this,Wn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Wn.WARN,...e),this._logHandler(this,Wn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Wn.ERROR,...e),this._logHandler(this,Wn.ERROR,...e)}}const pB=(t,e)=>e.some(i=>t instanceof i);let $S,ZS;function mB(){return $S||($S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gB(){return ZS||(ZS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const AI=new WeakMap,y0=new WeakMap,RI=new WeakMap,Wv=new WeakMap,Gb=new WeakMap;function _B(t){const e=new Promise((i,l)=>{const f=()=>{t.removeEventListener("success",v),t.removeEventListener("error",g)},v=()=>{i(uu(t.result)),f()},g=()=>{l(t.error),f()};t.addEventListener("success",v),t.addEventListener("error",g)});return e.then(i=>{i instanceof IDBCursor&&AI.set(i,t)}).catch(()=>{}),Gb.set(e,t),e}function yB(t){if(y0.has(t))return;const e=new Promise((i,l)=>{const f=()=>{t.removeEventListener("complete",v),t.removeEventListener("error",g),t.removeEventListener("abort",g)},v=()=>{i(),f()},g=()=>{l(t.error||new DOMException("AbortError","AbortError")),f()};t.addEventListener("complete",v),t.addEventListener("error",g),t.addEventListener("abort",g)});y0.set(t,e)}let v0={get(t,e,i){if(t instanceof IDBTransaction){if(e==="done")return y0.get(t);if(e==="objectStoreNames")return t.objectStoreNames||RI.get(t);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return uu(t[e])},set(t,e,i){return t[e]=i,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function vB(t){v0=t(v0)}function xB(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const l=t.call(Hv(this),e,...i);return RI.set(l,e.sort?e.sort():[e]),uu(l)}:gB().includes(t)?function(...e){return t.apply(Hv(this),e),uu(AI.get(this))}:function(...e){return uu(t.apply(Hv(this),e))}}function bB(t){return typeof t=="function"?xB(t):(t instanceof IDBTransaction&&yB(t),pB(t,mB())?new Proxy(t,v0):t)}function uu(t){if(t instanceof IDBRequest)return _B(t);if(Wv.has(t))return Wv.get(t);const e=bB(t);return e!==t&&(Wv.set(t,e),Gb.set(e,t)),e}const Hv=t=>Gb.get(t);function wB(t,e,{blocked:i,upgrade:l,blocking:f,terminated:v}={}){const g=indexedDB.open(t,e),c=uu(g);return l&&g.addEventListener("upgradeneeded",A=>{l(uu(g.result),A.oldVersion,A.newVersion,uu(g.transaction),A)}),i&&g.addEventListener("blocked",A=>i(A.oldVersion,A.newVersion,A)),c.then(A=>{v&&A.addEventListener("close",()=>v()),f&&A.addEventListener("versionchange",N=>f(N.oldVersion,N.newVersion,N))}).catch(()=>{}),c}const TB=["get","getKey","getAll","getAllKeys","count"],SB=["put","add","delete","clear"],Kv=new Map;function GS(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Kv.get(e))return Kv.get(e);const i=e.replace(/FromIndex$/,""),l=e!==i,f=SB.includes(i);if(!(i in(l?IDBIndex:IDBObjectStore).prototype)||!(f||TB.includes(i)))return;const v=async function(g,...c){const A=this.transaction(g,f?"readwrite":"readonly");let N=A.store;return l&&(N=N.index(c.shift())),(await Promise.all([N[i](...c),f&&A.done]))[0]};return Kv.set(e,v),v}vB(t=>({...t,get:(e,i,l)=>GS(e,i)||t.get(e,i,l),has:(e,i)=>!!GS(e,i)||t.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PB{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(EB(i)){const l=i.getImmediate();return`${l.library}/${l.version}`}else return null}).filter(i=>i).join(" ")}}function EB(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const x0="@firebase/app",qS="0.14.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc=new MI("@firebase/app"),CB="@firebase/app-compat",IB="@firebase/analytics-compat",kB="@firebase/analytics",MB="@firebase/app-check-compat",AB="@firebase/app-check",RB="@firebase/auth",LB="@firebase/auth-compat",zB="@firebase/database",DB="@firebase/data-connect",NB="@firebase/database-compat",OB="@firebase/functions",jB="@firebase/functions-compat",BB="@firebase/installations",FB="@firebase/installations-compat",UB="@firebase/messaging",VB="@firebase/messaging-compat",$B="@firebase/performance",ZB="@firebase/performance-compat",GB="@firebase/remote-config",qB="@firebase/remote-config-compat",WB="@firebase/storage",HB="@firebase/storage-compat",KB="@firebase/firestore",XB="@firebase/ai",YB="@firebase/firestore-compat",JB="firebase",QB="12.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b0="[DEFAULT]",eF={[x0]:"fire-core",[CB]:"fire-core-compat",[kB]:"fire-analytics",[IB]:"fire-analytics-compat",[AB]:"fire-app-check",[MB]:"fire-app-check-compat",[RB]:"fire-auth",[LB]:"fire-auth-compat",[zB]:"fire-rtdb",[DB]:"fire-data-connect",[NB]:"fire-rtdb-compat",[OB]:"fire-fn",[jB]:"fire-fn-compat",[BB]:"fire-iid",[FB]:"fire-iid-compat",[UB]:"fire-fcm",[VB]:"fire-fcm-compat",[$B]:"fire-perf",[ZB]:"fire-perf-compat",[GB]:"fire-rc",[qB]:"fire-rc-compat",[WB]:"fire-gcs",[HB]:"fire-gcs-compat",[KB]:"fire-fst",[YB]:"fire-fst-compat",[XB]:"fire-vertex","fire-js":"fire-js",[JB]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C_=new Map,tF=new Map,w0=new Map;function WS(t,e){try{t.container.addComponent(e)}catch(i){tc.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function Yp(t){const e=t.name;if(w0.has(e))return tc.debug(`There were multiple attempts to register component ${e}.`),!1;w0.set(e,t);for(const i of C_.values())WS(i,t);for(const i of tF.values())WS(i,t);return!0}function LI(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}function hl(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nF={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hu=new dm("app","Firebase",nF);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rF{constructor(e,i,l){this._isDeleted=!1,this._options={...e},this._config={...i},this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=l,this.container.addComponent(new Kd("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hu.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fm=QB;function zI(t,e={}){let i=t;typeof e!="object"&&(e={name:e});const l={name:b0,automaticDataCollectionEnabled:!0,...e},f=l.name;if(typeof f!="string"||!f)throw hu.create("bad-app-name",{appName:String(f)});if(i||(i=II()),!i)throw hu.create("no-options");const v=C_.get(f);if(v){if(Hd(i,v.options)&&Hd(l,v.config))return v;throw hu.create("duplicate-app",{appName:f})}const g=new cB(f);for(const A of w0.values())g.addComponent(A);const c=new rF(i,l,g);return C_.set(f,c),c}function iF(t=b0){const e=C_.get(t);if(!e&&t===b0&&II())return zI();if(!e)throw hu.create("no-app",{appName:t});return e}function Dd(t,e,i){let l=eF[t]??t;i&&(l+=`-${i}`);const f=l.match(/\s|\//),v=e.match(/\s|\//);if(f||v){const g=[`Unable to register library "${l}" with version "${e}":`];f&&g.push(`library name "${l}" contains illegal characters (whitespace or "/")`),f&&v&&g.push("and"),v&&g.push(`version name "${e}" contains illegal characters (whitespace or "/")`),tc.warn(g.join(" "));return}Yp(new Kd(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sF="firebase-heartbeat-database",oF=1,Jp="firebase-heartbeat-store";let Xv=null;function DI(){return Xv||(Xv=wB(sF,oF,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Jp)}catch(i){console.warn(i)}}}}).catch(t=>{throw hu.create("idb-open",{originalErrorMessage:t.message})})),Xv}async function aF(t){try{const i=(await DI()).transaction(Jp),l=await i.objectStore(Jp).get(NI(t));return await i.done,l}catch(e){if(e instanceof xu)tc.warn(e.message);else{const i=hu.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});tc.warn(i.message)}}}async function HS(t,e){try{const l=(await DI()).transaction(Jp,"readwrite");await l.objectStore(Jp).put(e,NI(t)),await l.done}catch(i){if(i instanceof xu)tc.warn(i.message);else{const l=hu.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});tc.warn(l.message)}}}function NI(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lF=1024,cF=30;class uF{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new dF(i),this._heartbeatsCachePromise=this._storage.read().then(l=>(this._heartbeatsCache=l,l))}async triggerHeartbeat(){var e,i;try{const f=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),v=KS();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)==null?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===v||this._heartbeatsCache.heartbeats.some(g=>g.date===v))return;if(this._heartbeatsCache.heartbeats.push({date:v,agent:f}),this._heartbeatsCache.heartbeats.length>cF){const g=fF(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(g,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(l){tc.warn(l)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=KS(),{heartbeatsToSend:l,unsentEntries:f}=hF(this._heartbeatsCache.heartbeats),v=EI(JSON.stringify({version:2,heartbeats:l}));return this._heartbeatsCache.lastSentHeartbeatDate=i,f.length>0?(this._heartbeatsCache.heartbeats=f,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),v}catch(i){return tc.warn(i),""}}}function KS(){return new Date().toISOString().substring(0,10)}function hF(t,e=lF){const i=[];let l=t.slice();for(const f of t){const v=i.find(g=>g.agent===f.agent);if(v){if(v.dates.push(f.date),XS(i)>e){v.dates.pop();break}}else if(i.push({agent:f.agent,dates:[f.date]}),XS(i)>e){i.pop();break}l=l.slice(1)}return{heartbeatsToSend:i,unsentEntries:l}}class dF{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Yj()?Jj().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await aF(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const l=await this.read();return HS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const l=await this.read();return HS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function XS(t){return EI(JSON.stringify({version:2,heartbeats:t})).length}function fF(t){if(t.length===0)return-1;let e=0,i=t[0].date;for(let l=1;l<t.length;l++)t[l].date<i&&(i=t[l].date,e=l);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pF(t){Yp(new Kd("platform-logger",e=>new PB(e),"PRIVATE")),Yp(new Kd("heartbeat",e=>new uF(e),"PRIVATE")),Dd(x0,qS,t),Dd(x0,qS,"esm2020"),Dd("fire-js","")}pF("");var mF="firebase",gF="12.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Dd(mF,gF,"app");function OI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const _F=OI,jI=new dm("auth","Firebase",OI());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I_=new MI("@firebase/auth");function yF(t,...e){I_.logLevel<=Wn.WARN&&I_.warn(`Auth (${fm}): ${t}`,...e)}function Xg(t,...e){I_.logLevel<=Wn.ERROR&&I_.error(`Auth (${fm}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(t,...e){throw qb(t,...e)}function uo(t,...e){return qb(t,...e)}function BI(t,e,i){const l={..._F(),[e]:i};return new dm("auth","Firebase",l).create(e,{appName:t.name})}function du(t){return BI(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qb(t,...e){if(typeof t!="string"){const i=e[0],l=[...e.slice(1)];return l[0]&&(l[0].appName=t.name),t._errorFactory.create(i,...l)}return jI.create(t,...e)}function Lt(t,e,...i){if(!t)throw qb(e,...i)}function Wl(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Xg(e),new Error(e)}function rc(t,e){t||Wl(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T0(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function FI(){return YS()==="http:"||YS()==="https:"}function YS(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vF(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(FI()||Hj()||"connection"in navigator)?navigator.onLine:!0}function xF(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e,i){this.shortDelay=e,this.longDelay=i,rc(i>e,"Short delay should be less than long delay!"),this.isMobile=qj()||Kj()}get(){return vF()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wb(t,e){rc(t.emulator,"Emulator should always be set here");const{url:i}=t.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UI{static initialize(e,i,l){this.fetchImpl=e,i&&(this.headersImpl=i),l&&(this.responseImpl=l)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Wl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Wl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Wl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bF={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wF=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],TF=new pm(3e4,6e4);function yl(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Sa(t,e,i,l,f={}){return VI(t,f,async()=>{let v={},g={};l&&(e==="GET"?g=l:v={body:JSON.stringify(l)});const c=of({key:t.config.apiKey,...g}).slice(1),A=await t._getAdditionalHeaders();A["Content-Type"]="application/json",t.languageCode&&(A["X-Firebase-Locale"]=t.languageCode);const N={method:e,headers:A,...v};return Wj()||(N.referrerPolicy="no-referrer"),t.emulatorConfig&&cy(t.emulatorConfig.host)&&(N.credentials="include"),UI.fetch()(await $I(t,t.config.apiHost,i,c),N)})}async function VI(t,e,i){t._canInitEmulator=!1;const l={...bF,...e};try{const f=new PF(t),v=await Promise.race([i(),f.promise]);f.clearNetworkTimeout();const g=await v.json();if("needConfirmation"in g)throw hp(t,"account-exists-with-different-credential",g);if(v.ok&&!("errorMessage"in g))return g;{const c=v.ok?g.errorMessage:g.error.message,[A,N]=c.split(" : ");if(A==="FEDERATED_USER_ID_ALREADY_LINKED")throw hp(t,"credential-already-in-use",g);if(A==="EMAIL_EXISTS")throw hp(t,"email-already-in-use",g);if(A==="USER_DISABLED")throw hp(t,"user-disabled",g);const Z=l[A]||A.toLowerCase().replace(/[_\s]+/g,"-");if(N)throw BI(t,Z,N);nc(t,Z)}}catch(f){if(f instanceof xu)throw f;nc(t,"network-request-failed",{message:String(f)})}}async function uy(t,e,i,l,f={}){const v=await Sa(t,e,i,l,f);return"mfaPendingCredential"in v&&nc(t,"multi-factor-auth-required",{_serverResponse:v}),v}async function $I(t,e,i,l){const f=`${e}${i}?${l}`,v=t,g=v.config.emulator?Wb(t.config,f):`${t.config.apiScheme}://${f}`;return wF.includes(i)&&(await v._persistenceManagerAvailable,v._getPersistenceType()==="COOKIE")?v._getPersistence()._getFinalTarget(g).toString():g}function SF(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class PF{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,l)=>{this.timer=setTimeout(()=>l(uo(this.auth,"network-request-failed")),TF.get())})}}function hp(t,e,i){const l={appName:t.name};i.email&&(l.email=i.email),i.phoneNumber&&(l.phoneNumber=i.phoneNumber);const f=uo(t,e,l);return f.customData._tokenResponse=i,f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JS(t){return t!==void 0&&t.getResponse!==void 0}function QS(t){return t!==void 0&&t.enterprise!==void 0}class ZI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return SF(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EF(t){return(await Sa(t,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function GI(t,e){return Sa(t,"GET","/v2/recaptchaConfig",yl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CF(t,e){return Sa(t,"POST","/v1/accounts:delete",e)}async function k_(t,e){return Sa(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pp(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function IF(t,e=!1){const i=xh(t),l=await i.getIdToken(e),f=Hb(l);Lt(f&&f.exp&&f.auth_time&&f.iat,i.auth,"internal-error");const v=typeof f.firebase=="object"?f.firebase:void 0,g=v==null?void 0:v.sign_in_provider;return{claims:f,token:l,authTime:Pp(Yv(f.auth_time)),issuedAtTime:Pp(Yv(f.iat)),expirationTime:Pp(Yv(f.exp)),signInProvider:g||null,signInSecondFactor:(v==null?void 0:v.sign_in_second_factor)||null}}function Yv(t){return Number(t)*1e3}function Hb(t){const[e,i,l]=t.split(".");if(e===void 0||i===void 0||l===void 0)return Xg("JWT malformed, contained fewer than 3 sections"),null;try{const f=CI(i);return f?JSON.parse(f):(Xg("Failed to decode base64 JWT payload"),null)}catch(f){return Xg("Caught error parsing JWT payload as JSON",f==null?void 0:f.toString()),null}}function eP(t){const e=Hb(t);return Lt(e,"internal-error"),Lt(typeof e.exp<"u","internal-error"),Lt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qp(t,e,i=!1){if(i)return e;try{return await e}catch(l){throw l instanceof xu&&kF(l)&&t.auth.currentUser===t&&await t.auth.signOut(),l}}function kF({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const l=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=Pp(this.lastLoginAt),this.creationTime=Pp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M_(t){var W;const e=t.auth,i=await t.getIdToken(),l=await Qp(t,k_(e,{idToken:i}));Lt(l==null?void 0:l.users.length,e,"internal-error");const f=l.users[0];t._notifyReloadListener(f);const v=(W=f.providerUserInfo)!=null&&W.length?qI(f.providerUserInfo):[],g=RF(t.providerData,v),c=t.isAnonymous,A=!(t.email&&f.passwordHash)&&!(g!=null&&g.length),N=c?A:!1,Z={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:g,metadata:new S0(f.createdAt,f.lastLoginAt),isAnonymous:N};Object.assign(t,Z)}async function AF(t){const e=xh(t);await M_(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function RF(t,e){return[...t.filter(l=>!e.some(f=>f.providerId===l.providerId)),...e]}function qI(t){return t.map(({providerId:e,...i})=>({providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LF(t,e){const i=await VI(t,{},async()=>{const l=of({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:f,apiKey:v}=t.config,g=await $I(t,f,"/v1/token",`key=${v}`),c=await t._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const A={method:"POST",headers:c,body:l};return t.emulatorConfig&&cy(t.emulatorConfig.host)&&(A.credentials="include"),UI.fetch()(g,A)});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function zF(t,e){return Sa(t,"POST","/v2/accounts:revokeToken",yl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Lt(e.idToken,"internal-error"),Lt(typeof e.idToken<"u","internal-error"),Lt(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):eP(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Lt(e.length!==0,"internal-error");const i=eP(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Lt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:l,refreshToken:f,expiresIn:v}=await LF(e,i);this.updateTokensAndExpiration(l,f,Number(v))}updateTokensAndExpiration(e,i,l){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+l*1e3}static fromJSON(e,i){const{refreshToken:l,accessToken:f,expirationTime:v}=i,g=new Nd;return l&&(Lt(typeof l=="string","internal-error",{appName:e}),g.refreshToken=l),f&&(Lt(typeof f=="string","internal-error",{appName:e}),g.accessToken=f),v&&(Lt(typeof v=="number","internal-error",{appName:e}),g.expirationTime=v),g}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Nd,this.toJSON())}_performRefresh(){return Wl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(t,e){Lt(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ya{constructor({uid:e,auth:i,stsTokenManager:l,...f}){this.providerId="firebase",this.proactiveRefresh=new MF(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new S0(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(e){const i=await Qp(this,this.stsTokenManager.getToken(this.auth,e));return Lt(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return IF(this,e)}reload(){return AF(this)}_assign(e){this!==e&&(Lt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>({...i})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new ya({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return i.metadata._copy(this.metadata),i}_onReload(e){Lt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let l=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),l=!0),i&&await M_(this),await this.auth._persistUserIfCurrent(this),l&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hl(this.auth.app))return Promise.reject(du(this.auth));const e=await this.getIdToken();return await Qp(this,CF(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){const l=i.displayName??void 0,f=i.email??void 0,v=i.phoneNumber??void 0,g=i.photoURL??void 0,c=i.tenantId??void 0,A=i._redirectEventId??void 0,N=i.createdAt??void 0,Z=i.lastLoginAt??void 0,{uid:W,emailVerified:K,isAnonymous:J,providerData:ce,stsTokenManager:ie}=i;Lt(W&&ie,e,"internal-error");const oe=Nd.fromJSON(this.name,ie);Lt(typeof W=="string",e,"internal-error"),Bc(l,e.name),Bc(f,e.name),Lt(typeof K=="boolean",e,"internal-error"),Lt(typeof J=="boolean",e,"internal-error"),Bc(v,e.name),Bc(g,e.name),Bc(c,e.name),Bc(A,e.name),Bc(N,e.name),Bc(Z,e.name);const re=new ya({uid:W,auth:e,email:f,emailVerified:K,displayName:l,isAnonymous:J,photoURL:g,phoneNumber:v,tenantId:c,stsTokenManager:oe,createdAt:N,lastLoginAt:Z});return ce&&Array.isArray(ce)&&(re.providerData=ce.map($=>({...$}))),A&&(re._redirectEventId=A),re}static async _fromIdTokenResponse(e,i,l=!1){const f=new Nd;f.updateFromServerResponse(i);const v=new ya({uid:i.localId,auth:e,stsTokenManager:f,isAnonymous:l});return await M_(v),v}static async _fromGetAccountInfoResponse(e,i,l){const f=i.users[0];Lt(f.localId!==void 0,"internal-error");const v=f.providerUserInfo!==void 0?qI(f.providerUserInfo):[],g=!(f.email&&f.passwordHash)&&!(v!=null&&v.length),c=new Nd;c.updateFromIdToken(l);const A=new ya({uid:f.localId,auth:e,stsTokenManager:c,isAnonymous:g}),N={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:v,metadata:new S0(f.createdAt,f.lastLoginAt),isAnonymous:!(f.email&&f.passwordHash)&&!(v!=null&&v.length)};return Object.assign(A,N),A}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tP=new Map;function Hl(t){rc(t instanceof Function,"Expected a class definition");let e=tP.get(t);return e?(rc(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,tP.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}WI.type="NONE";const nP=WI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yg(t,e,i){return`firebase:${t}:${e}:${i}`}class Od{constructor(e,i,l){this.persistence=e,this.auth=i,this.userKey=l;const{config:f,name:v}=this.auth;this.fullUserKey=Yg(this.userKey,f.apiKey,v),this.fullPersistenceKey=Yg("persistence",f.apiKey,v),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const i=await k_(this.auth,{idToken:e}).catch(()=>{});return i?ya._fromGetAccountInfoResponse(this.auth,i,e):null}return ya._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,l="authUser"){if(!i.length)return new Od(Hl(nP),e,l);const f=(await Promise.all(i.map(async N=>{if(await N._isAvailable())return N}))).filter(N=>N);let v=f[0]||Hl(nP);const g=Yg(l,e.config.apiKey,e.name);let c=null;for(const N of i)try{const Z=await N._get(g);if(Z){let W;if(typeof Z=="string"){const K=await k_(e,{idToken:Z}).catch(()=>{});if(!K)break;W=await ya._fromGetAccountInfoResponse(e,K,Z)}else W=ya._fromJSON(e,Z);N!==v&&(c=W),v=N;break}}catch{}const A=f.filter(N=>N._shouldAllowMigration);return!v._shouldAllowMigration||!A.length?new Od(v,e,l):(v=A[0],c&&await v._set(g,c.toJSON()),await Promise.all(i.map(async N=>{if(N!==v)try{await N._remove(g)}catch{}})),new Od(v,e,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(YI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(HI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(QI(e))return"Blackberry";if(ek(e))return"Webos";if(KI(e))return"Safari";if((e.includes("chrome/")||XI(e))&&!e.includes("edge/"))return"Chrome";if(JI(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,l=t.match(i);if((l==null?void 0:l.length)===2)return l[1]}return"Other"}function HI(t=vs()){return/firefox\//i.test(t)}function KI(t=vs()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function XI(t=vs()){return/crios\//i.test(t)}function YI(t=vs()){return/iemobile/i.test(t)}function JI(t=vs()){return/android/i.test(t)}function QI(t=vs()){return/blackberry/i.test(t)}function ek(t=vs()){return/webos/i.test(t)}function Kb(t=vs()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function DF(t=vs()){var e;return Kb(t)&&!!((e=window.navigator)!=null&&e.standalone)}function NF(){return Xj()&&document.documentMode===10}function tk(t=vs()){return Kb(t)||JI(t)||ek(t)||QI(t)||/windows phone/i.test(t)||YI(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nk(t,e=[]){let i;switch(t){case"Browser":i=rP(vs());break;case"Worker":i=`${rP(vs())}-${t}`;break;default:i=t}const l=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${fm}/${l}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const l=v=>new Promise((g,c)=>{try{const A=e(v);g(A)}catch(A){c(A)}});l.onAbort=i,this.queue.push(l);const f=this.queue.length-1;return()=>{this.queue[f]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const l of this.queue)await l(e),l.onAbort&&i.push(l.onAbort)}catch(l){i.reverse();for(const f of i)try{f()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:l==null?void 0:l.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jF(t,e={}){return Sa(t,"GET","/v2/passwordPolicy",yl(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BF=6;class FF{constructor(e){var l;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=i.minPasswordLength??BF,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),i.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),i.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),i.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),i.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((l=e.allowedNonAlphanumericCharacters)==null?void 0:l.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const i={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,i),this.validatePasswordCharacterOptions(e,i),i.isValid&&(i.isValid=i.meetsMinPasswordLength??!0),i.isValid&&(i.isValid=i.meetsMaxPasswordLength??!0),i.isValid&&(i.isValid=i.containsLowercaseLetter??!0),i.isValid&&(i.isValid=i.containsUppercaseLetter??!0),i.isValid&&(i.isValid=i.containsNumericCharacter??!0),i.isValid&&(i.isValid=i.containsNonAlphanumericCharacter??!0),i}validatePasswordLengthOptions(e,i){const l=this.customStrengthOptions.minPasswordLength,f=this.customStrengthOptions.maxPasswordLength;l&&(i.meetsMinPasswordLength=e.length>=l),f&&(i.meetsMaxPasswordLength=e.length<=f)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let l;for(let f=0;f<e.length;f++)l=e.charAt(f),this.updatePasswordCharacterOptionsStatuses(i,l>="a"&&l<="z",l>="A"&&l<="Z",l>="0"&&l<="9",this.allowedNonAlphanumericCharacters.includes(l))}updatePasswordCharacterOptionsStatuses(e,i,l,f,v){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=l)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=f)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=v))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UF{constructor(e,i,l,f){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=l,this.config=f,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new iP(this),this.idTokenSubscription=new iP(this),this.beforeStateQueue=new OF(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=f.sdkClientVersion,this._persistenceManagerAvailable=new Promise(v=>this._resolvePersistenceManagerAvailable=v)}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Hl(i)),this._initializationPromise=this.queue(async()=>{var l,f,v;if(!this._deleted&&(this.persistenceManager=await Od.create(this,e),(l=this._resolvePersistenceManagerAvailable)==null||l.call(this),!this._deleted)){if((f=this._popupRedirectResolver)!=null&&f._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((v=this.currentUser)==null?void 0:v.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await k_(this,{idToken:e}),l=await ya._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(l)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var v;if(hl(this.app)){const g=this.app.settings.authIdToken;return g?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(g).then(c,c))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let l=i,f=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const g=(v=this.redirectUser)==null?void 0:v._redirectEventId,c=l==null?void 0:l._redirectEventId,A=await this.tryRedirectSignIn(e);(!g||g===c)&&(A!=null&&A.user)&&(l=A.user,f=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(f)try{await this.beforeStateQueue.runMiddleware(l)}catch(g){l=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(g))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Lt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await M_(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=xF()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hl(this.app))return Promise.reject(du(this));const i=e?xh(e):null;return i&&Lt(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Lt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return hl(this.app)?Promise.reject(du(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hl(this.app)?Promise.reject(du(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Hl(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await jF(this),i=new FF(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new dm("auth","Firebase",e())}onAuthStateChanged(e,i,l){return this.registerStateListener(this.authStateSubscription,e,i,l)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,l){return this.registerStateListener(this.idTokenSubscription,e,i,l)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const l=this.onAuthStateChanged(()=>{l(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),l={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(l.tenantId=this.tenantId),await zF(this,l)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,i){const l=await this.getOrInitRedirectPersistenceManager(i);return e===null?l.removeCurrentUser():l.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Hl(e)||this._popupRedirectResolver;Lt(i,this,"argument-error"),this.redirectPersistenceManager=await Od.create(this,[Hl(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,l;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)==null?void 0:i._redirectEventId)===e?this._currentUser:((l=this.redirectUser)==null?void 0:l._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((i=this.currentUser)==null?void 0:i.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,l,f){if(this._deleted)return()=>{};const v=typeof i=="function"?i:i.next.bind(i);let g=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Lt(c,this,"internal-error"),c.then(()=>{g||v(this.currentUser)}),typeof i=="function"){const A=e.addObserver(i,l,f);return()=>{g=!0,A()}}else{const A=e.addObserver(i);return()=>{g=!0,A()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Lt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var f;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const i=await((f=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:f.getHeartbeatsHeader());i&&(e["X-Firebase-Client"]=i);const l=await this._getAppCheckToken();return l&&(e["X-Firebase-AppCheck"]=l),e}async _getAppCheckToken(){var i;if(hl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((i=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getToken());return e!=null&&e.error&&yF(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function bu(t){return xh(t)}class iP{constructor(e){this.auth=e,this.observer=null,this.addObserver=rB(i=>this.observer=i)}get next(){return Lt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mm={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function VF(t){mm=t}function Xb(t){return mm.loadJS(t)}function $F(){return mm.recaptchaV2Script}function ZF(){return mm.recaptchaEnterpriseScript}function GF(){return mm.gapiScript}function rk(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qF=500,WF=6e4,Pg=1e12;class HF{constructor(e){this.auth=e,this.counter=Pg,this._widgets=new Map}render(e,i){const l=this.counter;return this._widgets.set(l,new YF(e,this.auth.name,i||{})),this.counter++,l}reset(e){var l;const i=e||Pg;(l=this._widgets.get(i))==null||l.delete(),this._widgets.delete(i)}getResponse(e){var l;const i=e||Pg;return((l=this._widgets.get(i))==null?void 0:l.getResponse())||""}async execute(e){var l;const i=e||Pg;return(l=this._widgets.get(i))==null||l.execute(),""}}class KF{constructor(){this.enterprise=new XF}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class XF{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class YF{constructor(e,i,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const f=typeof e=="string"?document.getElementById(e):e;Lt(f,"argument-error",{appName:i}),this.container=f,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=JF(50);const{callback:e,"expired-callback":i}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,i)try{i()}catch{}this.isVisible&&this.execute()},WF)},qF))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function JF(t){const e=[],i="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<t;l++)e.push(i.charAt(Math.floor(Math.random()*i.length)));return e.join("")}const QF="recaptcha-enterprise",Ep="NO_RECAPTCHA";class ik{constructor(e){this.type=QF,this.auth=bu(e)}async verify(e="verify",i=!1){async function l(v){if(!i){if(v.tenantId==null&&v._agentRecaptchaConfig!=null)return v._agentRecaptchaConfig.siteKey;if(v.tenantId!=null&&v._tenantRecaptchaConfigs[v.tenantId]!==void 0)return v._tenantRecaptchaConfigs[v.tenantId].siteKey}return new Promise(async(g,c)=>{GI(v,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(A=>{if(A.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const N=new ZI(A);return v.tenantId==null?v._agentRecaptchaConfig=N:v._tenantRecaptchaConfigs[v.tenantId]=N,g(N.siteKey)}}).catch(A=>{c(A)})})}function f(v,g,c){const A=window.grecaptcha;QS(A)?A.enterprise.ready(()=>{A.enterprise.execute(v,{action:e}).then(N=>{g(N)}).catch(()=>{g(Ep)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new KF().execute("siteKey",{action:"verify"}):new Promise((v,g)=>{l(this.auth).then(c=>{if(!i&&QS(window.grecaptcha))f(c,v,g);else{if(typeof window>"u"){g(new Error("RecaptchaVerifier is only supported in browser"));return}let A=ZF();A.length!==0&&(A+=c),Xb(A).then(()=>{f(c,v,g)}).catch(N=>{g(N)})}}).catch(c=>{g(c)})})}}async function Jv(t,e,i,l=!1,f=!1){const v=new ik(t);let g;if(f)g=Ep;else try{g=await v.verify(i)}catch{g=await v.verify(i,!0)}const c={...e};if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const A=c.phoneEnrollmentInfo.phoneNumber,N=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:A,recaptchaToken:N,captchaResponse:g,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const A=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:A,captchaResponse:g,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return l?Object.assign(c,{captchaResp:g}):Object.assign(c,{captchaResponse:g}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function Qv(t,e,i,l,f){var v;if((v=t._getRecaptchaConfig())!=null&&v.isProviderEnabled("PHONE_PROVIDER")){const g=await Jv(t,e,i);return l(t,g).catch(async c=>{var A;if(((A=t._getRecaptchaConfig())==null?void 0:A.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(c.code==="auth/missing-recaptcha-token"||c.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${i} flow.`);const N=await Jv(t,e,i,!1,!0);return l(t,N)}return Promise.reject(c)})}else{const g=await Jv(t,e,i,!1,!0);return l(t,g)}}async function e4(t){const e=bu(t),i=await GI(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),l=new ZI(i);e.tenantId==null?e._agentRecaptchaConfig=l:e._tenantRecaptchaConfigs[e.tenantId]=l,l.isAnyProviderEnabled()&&new ik(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t4(t,e){const i=LI(t,"auth");if(i.isInitialized()){const f=i.getImmediate(),v=i.getOptions();if(Hd(v,e??{}))return f;nc(f,"already-initialized")}return i.initialize({options:e})}function n4(t,e){const i=(e==null?void 0:e.persistence)||[],l=(Array.isArray(i)?i:[i]).map(Hl);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(l,e==null?void 0:e.popupRedirectResolver)}function r4(t,e,i){const l=bu(t);Lt(/^https?:\/\//.test(e),l,"invalid-emulator-scheme");const f=!1,v=sk(e),{host:g,port:c}=i4(e),A=c===null?"":`:${c}`,N={url:`${v}//${g}${A}/`},Z=Object.freeze({host:g,port:c,protocol:v.replace(":",""),options:Object.freeze({disableWarnings:f})});if(!l._canInitEmulator){Lt(l.config.emulator&&l.emulatorConfig,l,"emulator-config-failed"),Lt(Hd(N,l.config.emulator)&&Hd(Z,l.emulatorConfig),l,"emulator-config-failed");return}l.config.emulator=N,l.emulatorConfig=Z,l.settings.appVerificationDisabledForTesting=!0,cy(g)?(Vj(`${v}//${g}${A}`),Gj("Auth",!0)):s4()}function sk(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function i4(t){const e=sk(t),i=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!i)return{host:"",port:null};const l=i[2].split("@").pop()||"",f=/^(\[[^\]]+\])(:|$)/.exec(l);if(f){const v=f[1];return{host:v,port:sP(l.substr(v.length+1))}}else{const[v,g]=l.split(":");return{host:v,port:sP(g)}}}function sP(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function s4(){function t(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Wl("not implemented")}_getIdTokenResponse(e){return Wl("not implemented")}_linkToIdToken(e,i){return Wl("not implemented")}_getReauthenticationResolver(e){return Wl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jd(t,e){return uy(t,"POST","/v1/accounts:signInWithIdp",yl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4="http://localhost";class mh extends Yb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new mh(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):nc("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:l,signInMethod:f,...v}=i;if(!l||!f)return null;const g=new mh(l,f);return g.idToken=v.idToken||void 0,g.accessToken=v.accessToken||void 0,g.secret=v.secret,g.nonce=v.nonce,g.pendingToken=v.pendingToken||null,g}_getIdTokenResponse(e){const i=this.buildRequest();return jd(e,i)}_linkToIdToken(e,i){const l=this.buildRequest();return l.idToken=i,jd(e,l)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,jd(e,i)}buildRequest(){const e={requestUri:o4,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=of(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oP(t,e){return Sa(t,"POST","/v1/accounts:sendVerificationCode",yl(t,e))}async function a4(t,e){return uy(t,"POST","/v1/accounts:signInWithPhoneNumber",yl(t,e))}async function l4(t,e){const i=await uy(t,"POST","/v1/accounts:signInWithPhoneNumber",yl(t,e));if(i.temporaryProof)throw hp(t,"account-exists-with-different-credential",i);return i}const c4={USER_NOT_FOUND:"user-not-found"};async function u4(t,e){const i={...e,operation:"REAUTH"};return uy(t,"POST","/v1/accounts:signInWithPhoneNumber",yl(t,i),c4)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp extends Yb{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,i){return new Cp({verificationId:e,verificationCode:i})}static _fromTokenResponse(e,i){return new Cp({phoneNumber:e,temporaryProof:i})}_getIdTokenResponse(e){return a4(e,this._makeVerificationRequest())}_linkToIdToken(e,i){return l4(e,{idToken:i,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return u4(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:i,verificationId:l,verificationCode:f}=this.params;return e&&i?{temporaryProof:e,phoneNumber:i}:{sessionInfo:l,code:f}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:i,verificationCode:l,phoneNumber:f,temporaryProof:v}=e;return!l&&!i&&!f&&!v?null:new Cp({verificationId:i,verificationCode:l,phoneNumber:f,temporaryProof:v})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm extends ok{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc extends gm{constructor(){super("facebook.com")}static credential(e){return mh._fromParams({providerId:Zc.PROVIDER_ID,signInMethod:Zc.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zc.credentialFromTaggedObject(e)}static credentialFromError(e){return Zc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zc.credential(e.oauthAccessToken)}catch{return null}}}Zc.FACEBOOK_SIGN_IN_METHOD="facebook.com";Zc.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc extends gm{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return mh._fromParams({providerId:Gc.PROVIDER_ID,signInMethod:Gc.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return Gc.credentialFromTaggedObject(e)}static credentialFromError(e){return Gc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:l}=e;if(!i&&!l)return null;try{return Gc.credential(i,l)}catch{return null}}}Gc.GOOGLE_SIGN_IN_METHOD="google.com";Gc.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc extends gm{constructor(){super("github.com")}static credential(e){return mh._fromParams({providerId:qc.PROVIDER_ID,signInMethod:qc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qc.credentialFromTaggedObject(e)}static credentialFromError(e){return qc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qc.credential(e.oauthAccessToken)}catch{return null}}}qc.GITHUB_SIGN_IN_METHOD="github.com";qc.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc extends gm{constructor(){super("twitter.com")}static credential(e,i){return mh._fromParams({providerId:Wc.PROVIDER_ID,signInMethod:Wc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return Wc.credentialFromTaggedObject(e)}static credentialFromError(e){return Wc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:l}=e;if(!i||!l)return null;try{return Wc.credential(i,l)}catch{return null}}}Wc.TWITTER_SIGN_IN_METHOD="twitter.com";Wc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,l,f=!1){const v=await ya._fromIdTokenResponse(e,l,f),g=aP(l);return new Xd({user:v,providerId:g,_tokenResponse:l,operationType:i})}static async _forOperation(e,i,l){await e._updateTokensIfNecessary(l,!0);const f=aP(l);return new Xd({user:e,providerId:f,_tokenResponse:l,operationType:i})}}function aP(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_ extends xu{constructor(e,i,l,f){super(i.code,i.message),this.operationType=l,this.user=f,Object.setPrototypeOf(this,A_.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:i.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(e,i,l,f){return new A_(e,i,l,f)}}function ak(t,e,i,l){return(e==="reauthenticate"?i._getReauthenticationResolver(t):i._getIdTokenResponse(t)).catch(v=>{throw v.code==="auth/multi-factor-auth-required"?A_._fromErrorAndOperation(t,v,e,l):v})}async function h4(t,e,i=!1){const l=await Qp(t,e._linkToIdToken(t.auth,await t.getIdToken()),i);return Xd._forOperation(t,"link",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d4(t,e,i=!1){const{auth:l}=t;if(hl(l.app))return Promise.reject(du(l));const f="reauthenticate";try{const v=await Qp(t,ak(l,f,e,t),i);Lt(v.idToken,l,"internal-error");const g=Hb(v.idToken);Lt(g,l,"internal-error");const{sub:c}=g;return Lt(t.uid===c,l,"user-mismatch"),Xd._forOperation(t,f,v)}catch(v){throw(v==null?void 0:v.code)==="auth/user-not-found"&&nc(l,"user-mismatch"),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lk(t,e,i=!1){if(hl(t.app))return Promise.reject(du(t));const l="signIn",f=await ak(t,l,e),v=await Xd._fromIdTokenResponse(t,l,f);return i||await t._updateCurrentUser(v.user),v}async function f4(t,e){return lk(bu(t),e)}function p4(t,e,i,l){return xh(t).onIdTokenChanged(e,i,l)}function m4(t,e,i){return xh(t).beforeAuthStateChanged(e,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lP(t,e){return Sa(t,"POST","/v2/accounts/mfaEnrollment:start",yl(t,e))}const R_="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(R_,"1"),this.storage.removeItem(R_),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g4=1e3,_4=10;class uk extends ck{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=tk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const l=this.storage.getItem(i),f=this.localCache[i];l!==f&&e(i,f,l)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((g,c,A)=>{this.notifyListeners(g,A)});return}const l=e.key;i?this.detachListener():this.stopPolling();const f=()=>{const g=this.storage.getItem(l);!i&&this.localCache[l]===g||this.notifyListeners(l,g)},v=this.storage.getItem(l);NF()&&v!==e.newValue&&e.newValue!==e.oldValue?setTimeout(f,_4):f()}notifyListeners(e,i){this.localCache[e]=i;const l=this.listeners[e];if(l)for(const f of Array.from(l))f(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,l)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:l}),!0)})},g4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}uk.type="LOCAL";const y4=uk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk extends ck{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}hk.type="SESSION";const dk=hk;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(f=>f.isListeningto(e));if(i)return i;const l=new hy(e);return this.receivers.push(l),l}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:l,eventType:f,data:v}=i.data,g=this.handlersMap[f];if(!(g!=null&&g.size))return;i.ports[0].postMessage({status:"ack",eventId:l,eventType:f});const c=Array.from(g).map(async N=>N(i.origin,v)),A=await v4(c);i.ports[0].postMessage({status:"done",eventId:l,eventType:f,response:A})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}hy.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jb(t="",e=10){let i="";for(let l=0;l<e;l++)i+=Math.floor(Math.random()*10);return t+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,l=50){const f=typeof MessageChannel<"u"?new MessageChannel:null;if(!f)throw new Error("connection_unavailable");let v,g;return new Promise((c,A)=>{const N=Jb("",20);f.port1.start();const Z=setTimeout(()=>{A(new Error("unsupported_event"))},l);g={messageChannel:f,onMessage(W){const K=W;if(K.data.eventId===N)switch(K.data.status){case"ack":clearTimeout(Z),v=setTimeout(()=>{A(new Error("timeout"))},3e3);break;case"done":clearTimeout(v),c(K.data.response);break;default:clearTimeout(Z),clearTimeout(v),A(new Error("invalid_response"));break}}},this.handlers.add(g),f.port1.addEventListener("message",g.onMessage),this.target.postMessage({eventType:e,eventId:N,data:i},[f.port2])}).finally(()=>{g&&this.removeMessageHandler(g)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ii(){return window}function b4(t){ii().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qb(){return typeof ii().WorkerGlobalScope<"u"&&typeof ii().importScripts=="function"}async function w4(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function T4(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function S4(){return Qb()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk="firebaseLocalStorageDb",P4=1,L_="firebaseLocalStorage",pk="fbase_key";class _m{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function dy(t,e){return t.transaction([L_],e?"readwrite":"readonly").objectStore(L_)}function E4(){const t=indexedDB.deleteDatabase(fk);return new _m(t).toPromise()}function P0(){const t=indexedDB.open(fk,P4);return new Promise((e,i)=>{t.addEventListener("error",()=>{i(t.error)}),t.addEventListener("upgradeneeded",()=>{const l=t.result;try{l.createObjectStore(L_,{keyPath:pk})}catch(f){i(f)}}),t.addEventListener("success",async()=>{const l=t.result;l.objectStoreNames.contains(L_)?e(l):(l.close(),await E4(),e(await P0()))})})}async function cP(t,e,i){const l=dy(t,!0).put({[pk]:e,value:i});return new _m(l).toPromise()}async function C4(t,e){const i=dy(t,!1).get(e),l=await new _m(i).toPromise();return l===void 0?null:l.value}function uP(t,e){const i=dy(t,!0).delete(e);return new _m(i).toPromise()}const I4=800,k4=3;class mk{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await P0(),this.db)}async _withRetries(e){let i=0;for(;;)try{const l=await this._openDb();return await e(l)}catch(l){if(i++>k4)throw l;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qb()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=hy._getInstance(S4()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var i,l;if(this.activeServiceWorker=await w4(),!this.activeServiceWorker)return;this.sender=new x4(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(i=e[0])!=null&&i.fulfilled&&(l=e[0])!=null&&l.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||T4()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await P0();return await cP(e,R_,"1"),await uP(e,R_),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(l=>cP(l,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(l=>C4(l,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>uP(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(f=>{const v=dy(f,!1).getAll();return new _m(v).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],l=new Set;if(e.length!==0)for(const{fbase_key:f,value:v}of e)l.add(f),JSON.stringify(this.localCache[f])!==JSON.stringify(v)&&(this.notifyListeners(f,v),i.push(f));for(const f of Object.keys(this.localCache))this.localCache[f]&&!l.has(f)&&(this.notifyListeners(f,null),i.push(f));return i}notifyListeners(e,i){this.localCache[e]=i;const l=this.listeners[e];if(l)for(const f of Array.from(l))f(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),I4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}mk.type="LOCAL";const M4=mk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hP(t,e){return Sa(t,"POST","/v2/accounts/mfaSignIn:start",yl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ex=rk("rcb"),A4=new pm(3e4,6e4);class R4{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=ii().grecaptcha)!=null&&e.render)}load(e,i=""){return Lt(L4(i),e,"argument-error"),this.shouldResolveImmediately(i)&&JS(ii().grecaptcha)?Promise.resolve(ii().grecaptcha):new Promise((l,f)=>{const v=ii().setTimeout(()=>{f(uo(e,"network-request-failed"))},A4.get());ii()[ex]=()=>{ii().clearTimeout(v),delete ii()[ex];const c=ii().grecaptcha;if(!c||!JS(c)){f(uo(e,"internal-error"));return}const A=c.render;c.render=(N,Z)=>{const W=A(N,Z);return this.counter++,W},this.hostLanguage=i,l(c)};const g=`${$F()}?${of({onload:ex,render:"explicit",hl:i})}`;Xb(g).catch(()=>{clearTimeout(v),f(uo(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var i;return!!((i=ii().grecaptcha)!=null&&i.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function L4(t){return t.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(t)}class z4{async load(e){return new HF(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip="recaptcha",D4={theme:"light",type:"image"};class N4{constructor(e,i,l={...D4}){this.parameters=l,this.type=Ip,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=bu(e),this.isInvisible=this.parameters.size==="invisible",Lt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const f=typeof i=="string"?document.getElementById(i):i;Lt(f,this.auth,"argument-error"),this.container=f,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new z4:new R4,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),i=this.getAssertedRecaptcha(),l=i.getResponse(e);return l||new Promise(f=>{const v=g=>{g&&(this.tokenChangeListeners.delete(v),f(g))};this.tokenChangeListeners.add(v),this.isInvisible&&i.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Lt(!this.parameters.sitekey,this.auth,"argument-error"),Lt(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Lt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return i=>{if(this.tokenChangeListeners.forEach(l=>l(i)),typeof e=="function")e(i);else if(typeof e=="string"){const l=ii()[e];typeof l=="function"&&l(i)}}}assertNotDestroyed(){Lt(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const i=document.createElement("div");e.appendChild(i),e=i}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Lt(FI()&&!Qb(),this.auth,"internal-error"),await O4(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await EF(this.auth);Lt(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Lt(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function O4(){let t=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}t=()=>e(),window.addEventListener("load",t)}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{constructor(e,i){this.verificationId=e,this.onConfirmation=i}confirm(e){const i=Cp._fromVerification(this.verificationId,e);return this.onConfirmation(i)}}async function B4(t,e,i){if(hl(t.app))return Promise.reject(du(t));const l=bu(t),f=await F4(l,e,xh(i));return new j4(f,v=>f4(l,v))}async function F4(t,e,i){var l;if(!t._getRecaptchaConfig())try{await e4(t)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let f;if(typeof e=="string"?f={phoneNumber:e}:f=e,"session"in f){const v=f.session;if("phoneNumber"in f){Lt(v.type==="enroll",t,"internal-error");const g={idToken:v.credential,phoneEnrollmentInfo:{phoneNumber:f.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Qv(t,g,"mfaSmsEnrollment",async(Z,W)=>{if(W.phoneEnrollmentInfo.captchaResponse===Ep){Lt((i==null?void 0:i.type)===Ip,Z,"argument-error");const K=await tx(Z,W,i);return lP(Z,K)}return lP(Z,W)},"PHONE_PROVIDER").catch(Z=>Promise.reject(Z))).phoneSessionInfo.sessionInfo}else{Lt(v.type==="signin",t,"internal-error");const g=((l=f.multiFactorHint)==null?void 0:l.uid)||f.multiFactorUid;Lt(g,t,"missing-multi-factor-info");const c={mfaPendingCredential:v.credential,mfaEnrollmentId:g,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Qv(t,c,"mfaSmsSignIn",async(W,K)=>{if(K.phoneSignInInfo.captchaResponse===Ep){Lt((i==null?void 0:i.type)===Ip,W,"argument-error");const J=await tx(W,K,i);return hP(W,J)}return hP(W,K)},"PHONE_PROVIDER").catch(W=>Promise.reject(W))).phoneResponseInfo.sessionInfo}}else{const v={phoneNumber:f.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Qv(t,v,"sendVerificationCode",async(N,Z)=>{if(Z.captchaResponse===Ep){Lt((i==null?void 0:i.type)===Ip,N,"argument-error");const W=await tx(N,Z,i);return oP(N,W)}return oP(N,Z)},"PHONE_PROVIDER").catch(N=>Promise.reject(N))).sessionInfo}}finally{i==null||i._reset()}}async function tx(t,e,i){Lt(i.type===Ip,t,"argument-error");const l=await i.verify();Lt(typeof l=="string",t,"argument-error");const f={...e};if("phoneEnrollmentInfo"in f){const v=f.phoneEnrollmentInfo.phoneNumber,g=f.phoneEnrollmentInfo.captchaResponse,c=f.phoneEnrollmentInfo.clientType,A=f.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(f,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:l,captchaResponse:g,clientType:c,recaptchaVersion:A}}),f}else if("phoneSignInInfo"in f){const v=f.phoneSignInInfo.captchaResponse,g=f.phoneSignInInfo.clientType,c=f.phoneSignInInfo.recaptchaVersion;return Object.assign(f,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:v,clientType:g,recaptchaVersion:c}}),f}else return Object.assign(f,{recaptchaToken:l}),f}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U4(t,e){return e?Hl(e):(Lt(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew extends Yb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return jd(e,this._buildIdpRequest())}_linkToIdToken(e,i){return jd(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return jd(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function V4(t){return lk(t.auth,new ew(t),t.bypassAuthState)}function $4(t){const{auth:e,user:i}=t;return Lt(i,e,"internal-error"),d4(i,new ew(t),t.bypassAuthState)}async function Z4(t){const{auth:e,user:i}=t;return Lt(i,e,"internal-error"),h4(i,new ew(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e,i,l,f,v=!1){this.auth=e,this.resolver=l,this.user=f,this.bypassAuthState=v,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(l){this.reject(l)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:l,postBody:f,tenantId:v,error:g,type:c}=e;if(g){this.reject(g);return}const A={auth:this.auth,requestUri:i,sessionId:l,tenantId:v||void 0,postBody:f||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(A))}catch(N){this.reject(N)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return V4;case"linkViaPopup":case"linkViaRedirect":return Z4;case"reauthViaPopup":case"reauthViaRedirect":return $4;default:nc(this.auth,"internal-error")}}resolve(e){rc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){rc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G4=new pm(2e3,1e4);class Ed extends gk{constructor(e,i,l,f,v){super(e,i,f,v),this.provider=l,this.authWindow=null,this.pollId=null,Ed.currentPopupAction&&Ed.currentPopupAction.cancel(),Ed.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Lt(e,this.auth,"internal-error"),e}async onExecution(){rc(this.filter.length===1,"Popup operations only handle one event");const e=Jb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(uo(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(uo(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ed.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,l;if((l=(i=this.authWindow)==null?void 0:i.window)!=null&&l.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(uo(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,G4.get())};e()}}Ed.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q4="pendingRedirect",Jg=new Map;class W4 extends gk{constructor(e,i,l=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,l),this.eventId=null}async execute(){let e=Jg.get(this.auth._key());if(!e){try{const l=await H4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(l)}catch(i){e=()=>Promise.reject(i)}Jg.set(this.auth._key(),e)}return this.bypassAuthState||Jg.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function H4(t,e){const i=Y4(e),l=X4(t);if(!await l._isAvailable())return!1;const f=await l._get(i)==="true";return await l._remove(i),f}function K4(t,e){Jg.set(t._key(),e)}function X4(t){return Hl(t._redirectPersistence)}function Y4(t){return Yg(q4,t.config.apiKey,t.name)}async function J4(t,e,i=!1){if(hl(t.app))return Promise.reject(du(t));const l=bu(t),f=U4(l,e),g=await new W4(l,f,i).execute();return g&&!i&&(delete g.user._redirectEventId,await l._persistUserIfCurrent(g.user),await l._setRedirectUser(null,e)),g}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q4=10*60*1e3;class e5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(e,l)&&(i=!0,this.sendToConsumer(e,l),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!t5(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var l;if(e.error&&!_k(e)){const f=((l=e.error.code)==null?void 0:l.split("auth/")[1])||"internal-error";i.onError(uo(this.auth,f))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const l=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&l}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Q4&&this.cachedEventUids.clear(),this.cachedEventUids.has(dP(e))}saveEventToCache(e){this.cachedEventUids.add(dP(e)),this.lastProcessedEventTime=Date.now()}}function dP(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function _k({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function t5(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _k(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n5(t,e={}){return Sa(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i5=/^https?/;async function s5(t){if(t.config.emulator)return;const{authorizedDomains:e}=await n5(t);for(const i of e)try{if(o5(i))return}catch{}nc(t,"unauthorized-domain")}function o5(t){const e=T0(),{protocol:i,hostname:l}=new URL(e);if(t.startsWith("chrome-extension://")){const g=new URL(t);return g.hostname===""&&l===""?i==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&g.hostname===l}if(!i5.test(i))return!1;if(r5.test(t))return l===t;const f=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+f+"|"+f+")$","i").test(l)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a5=new pm(3e4,6e4);function fP(){const t=ii().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let i=0;i<t.CP.length;i++)t.CP[i]=null}}function l5(t){return new Promise((e,i)=>{var f,v,g;function l(){fP(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fP(),i(uo(t,"network-request-failed"))},timeout:a5.get()})}if((v=(f=ii().gapi)==null?void 0:f.iframes)!=null&&v.Iframe)e(gapi.iframes.getContext());else if((g=ii().gapi)!=null&&g.load)l();else{const c=rk("iframefcb");return ii()[c]=()=>{gapi.load?l():i(uo(t,"network-request-failed"))},Xb(`${GF()}?onload=${c}`).catch(A=>i(A))}}).catch(e=>{throw Qg=null,e})}let Qg=null;function c5(t){return Qg=Qg||l5(t),Qg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u5=new pm(5e3,15e3),h5="__/auth/iframe",d5="emulator/auth/iframe",f5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},p5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function m5(t){const e=t.config;Lt(e.authDomain,t,"auth-domain-config-required");const i=e.emulator?Wb(e,d5):`https://${t.config.authDomain}/${h5}`,l={apiKey:e.apiKey,appName:t.name,v:fm},f=p5.get(t.config.apiHost);f&&(l.eid=f);const v=t._getFrameworks();return v.length&&(l.fw=v.join(",")),`${i}?${of(l).slice(1)}`}async function g5(t){const e=await c5(t),i=ii().gapi;return Lt(i,t,"internal-error"),e.open({where:document.body,url:m5(t),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:f5,dontclear:!0},l=>new Promise(async(f,v)=>{await l.restyle({setHideOnLeave:!1});const g=uo(t,"network-request-failed"),c=ii().setTimeout(()=>{v(g)},u5.get());function A(){ii().clearTimeout(c),f(l)}l.ping(A).then(A,()=>{v(g)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},y5=500,v5=600,x5="_blank",b5="http://localhost";class pP{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function w5(t,e,i,l=y5,f=v5){const v=Math.max((window.screen.availHeight-f)/2,0).toString(),g=Math.max((window.screen.availWidth-l)/2,0).toString();let c="";const A={..._5,width:l.toString(),height:f.toString(),top:v,left:g},N=vs().toLowerCase();i&&(c=XI(N)?x5:i),HI(N)&&(e=e||b5,A.scrollbars="yes");const Z=Object.entries(A).reduce((K,[J,ce])=>`${K}${J}=${ce},`,"");if(DF(N)&&c!=="_self")return T5(e||"",c),new pP(null);const W=window.open(e||"",c,Z);Lt(W,t,"popup-blocked");try{W.focus()}catch{}return new pP(W)}function T5(t,e){const i=document.createElement("a");i.href=t,i.target=e;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(l)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S5="__/auth/handler",P5="emulator/auth/handler",E5=encodeURIComponent("fac");async function mP(t,e,i,l,f,v){Lt(t.config.authDomain,t,"auth-domain-config-required"),Lt(t.config.apiKey,t,"invalid-api-key");const g={apiKey:t.config.apiKey,appName:t.name,authType:i,redirectUrl:l,v:fm,eventId:f};if(e instanceof ok){e.setDefaultLanguage(t.languageCode),g.providerId=e.providerId||"",nB(e.getCustomParameters())||(g.customParameters=JSON.stringify(e.getCustomParameters()));for(const[Z,W]of Object.entries({}))g[Z]=W}if(e instanceof gm){const Z=e.getScopes().filter(W=>W!=="");Z.length>0&&(g.scopes=Z.join(","))}t.tenantId&&(g.tid=t.tenantId);const c=g;for(const Z of Object.keys(c))c[Z]===void 0&&delete c[Z];const A=await t._getAppCheckToken(),N=A?`#${E5}=${encodeURIComponent(A)}`:"";return`${C5(t)}?${of(c).slice(1)}${N}`}function C5({config:t}){return t.emulator?Wb(t,P5):`https://${t.authDomain}/${S5}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nx="webStorageSupport";class I5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dk,this._completeRedirectFn=J4,this._overrideRedirectResult=K4}async _openPopup(e,i,l,f){var g;rc((g=this.eventManagers[e._key()])==null?void 0:g.manager,"_initialize() not called before _openPopup()");const v=await mP(e,i,l,T0(),f);return w5(e,v,Jb())}async _openRedirect(e,i,l,f){await this._originValidation(e);const v=await mP(e,i,l,T0(),f);return b4(v),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:f,promise:v}=this.eventManagers[i];return f?Promise.resolve(f):(rc(v,"If manager is not set, promise should be"),v)}const l=this.initAndGetManager(e);return this.eventManagers[i]={promise:l},l.catch(()=>{delete this.eventManagers[i]}),l}async initAndGetManager(e){const i=await g5(e),l=new e5(e);return i.register("authEvent",f=>(Lt(f==null?void 0:f.authEvent,e,"invalid-auth-event"),{status:l.onEvent(f.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:l},this.iframes[e._key()]=i,l}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(nx,{type:nx},f=>{var g;const v=(g=f==null?void 0:f[0])==null?void 0:g[nx];v!==void 0&&i(!!v),nc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=s5(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return tk()||KI()||Kb()}}const k5=I5;var gP="@firebase/auth",_P="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(l=>{e((l==null?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Lt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A5(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function R5(t){Yp(new Kd("auth",(e,{options:i})=>{const l=e.getProvider("app").getImmediate(),f=e.getProvider("heartbeat"),v=e.getProvider("app-check-internal"),{apiKey:g,authDomain:c}=l.options;Lt(g&&!g.includes(":"),"invalid-api-key",{appName:l.name});const A={apiKey:g,authDomain:c,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nk(t)},N=new UF(l,f,v,A);return n4(N,i),N},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,l)=>{e.getProvider("auth-internal").initialize()})),Yp(new Kd("auth-internal",e=>{const i=bu(e.getProvider("auth").getImmediate());return(l=>new M5(l))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Dd(gP,_P,A5(t)),Dd(gP,_P,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L5=5*60,z5=kI("authIdTokenMaxAge")||L5;let yP=null;const D5=t=>async e=>{const i=e&&await e.getIdTokenResult(),l=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(l&&l>z5)return;const f=i==null?void 0:i.token;yP!==f&&(yP=f,await fetch(t,{method:f?"POST":"DELETE",headers:f?{Authorization:`Bearer ${f}`}:{}}))};function N5(t=iF()){const e=LI(t,"auth");if(e.isInitialized())return e.getImmediate();const i=t4(t,{popupRedirectResolver:k5,persistence:[M4,y4,dk]}),l=kI("authTokenSyncURL");if(l&&typeof isSecureContext=="boolean"&&isSecureContext){const v=new URL(l,location.origin);if(location.origin===v.origin){const g=D5(v.toString());m4(i,g,()=>g(i.currentUser)),p4(i,c=>g(c))}}const f=Fj("auth");return f&&r4(i,`http://${f}`),i}function O5(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}VF({loadJS(t){return new Promise((e,i)=>{const l=document.createElement("script");l.setAttribute("src",t),l.onload=e,l.onerror=f=>{const v=uo("internal-error");v.customData=f,i(v)},l.type="text/javascript",l.charset="UTF-8",O5().appendChild(l)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});R5("Browser");const j5={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:""};let Eg,vP;function tw(){return Eg||(Eg=zI(j5),vP=N5(Eg)),{app:Eg,auth:vP}}function B5(t){const{auth:e}=tw();return new N4(e,t,{size:"normal",callback:()=>{}})}async function F5(t,e){const{auth:i}=tw();if(!t)throw new Error("");if(!e)throw new Error(" RecaptchaVerifier");return await B4(i,t,e)}function xP(){const[t,e]=se.useState(""),[i,l]=se.useState(""),[f,v]=se.useState("passenger"),[g,c]=se.useState(!1),[A,N]=se.useState(""),[Z,W]=se.useState(!0),[K,J]=se.useState(!1),[ce,ie]=se.useState(""),[oe,re]=se.useState(null),{loginUser:$}=_l(),{toast:te}=sc(),fe=vh(),pe=async Le=>{var xt;if(Le.preventDefault(),!t.trim()){te({title:"&R",description:'9&09x"x',variant:"destructive"});return}if(!A.trim()){te({title:"&R",description:"9& ",variant:"destructive"});return}c(!0);try{const ct=await Os("phone-login-pwd",{phone:t,password:A,role:f,name:i,remember:Z});if(ct!=null&&ct.success){const ht=ct.data;if(ht!=null&&ht.token)try{localStorage.setItem("bf_auth_token",ht.token),localStorage.setItem("bf_user_profile",JSON.stringify({userId:ht.userId,phone:ht.phone,name:ht.name,role:ht.role,permissions:ht.permissions}))}catch(vt){console.warn(' JWT ":',vt)}await $(ht),te({title:'"&`x',description:`}:~ R${ht.name}`,variant:"default"});const ze=ht.permissions;ht.role==="admin"&&(ze!=null&&ze.can_access_admin)?fe("/admin"):ht.role==="driver"&&(ze!=null&&ze.can_access_driver)?fe("/driver"):ze!=null&&ze.can_access_passenger||ht.role==="passenger"?fe("/passenger"):fe("/login")}else{const ht=((xt=ct==null?void 0:ct.error)==null?void 0:xt.message)||'"&"';throw new Error(ht)}}catch(ct){te({title:'"&"',description:ct.message||'9xa09x"x&R `',variant:"destructive"})}finally{c(!1)}},Ie=async()=>{var Le,xt;if(!ce.trim()){te({title:"0",description:'9& 6 "0',variant:"destructive"});return}c(!0);try{if(!oe)throw new Error('SR9&"0');await oe.confirm(ce);let ct=!1;try{const at=await Os("verify-firebase",{phone:t,role:f,name:i});ct=!!(at!=null&&at.success)}catch{const wt=await(await g0(async()=>{const{default:jt}=await Promise.resolve().then(()=>VN);return{default:jt}},void 0,import.meta.url)).default.post("/auth/verify-firebase",{phone:t});ct=!!((Le=wt==null?void 0:wt.data)!=null&&Le.success)}if(!ct)throw new Error('"09&9"');const ht=await Os("phone-login-pwd",{phone:t,password:A,role:f,name:i,remember:Z});if(!(ht!=null&&ht.success))throw new Error(((xt=ht==null?void 0:ht.error)==null?void 0:xt.message)||'"&"');const ze=ht.data;ze!=null&&ze.token&&(localStorage.setItem("bf_auth_token",ze.token),localStorage.setItem("bf_user_profile",JSON.stringify({userId:ze.userId,phone:ze.phone,name:ze.name,role:ze.role,permissions:ze.permissions}))),await $(ze);const vt=ze.permissions;ze.role==="admin"&&(vt!=null&&vt.can_access_admin)?fe("/admin"):ze.role==="driver"&&(vt!=null&&vt.can_access_driver)?fe("/driver"):fe("/passenger")}catch(ct){te({title:'0"&"',description:ct.message||"9R ",variant:"destructive"})}finally{c(!1)}},Ge=async()=>{c(!0);try{tw();const Le=B5("firebase-recaptcha"),xt=await F5(t,Le);re(xt),te({title:"!0",description:"} Firebase ! OTP",variant:"default"})}catch(Le){te({title:'!"',description:Le.message||"9R ",variant:"destructive"})}finally{c(!1)}};return I.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:I.jsxs("div",{className:"w-full max-w-4xl",children:[I.jsxs("div",{className:"text-center mb-8",children:[I.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"Black Feather "}),I.jsx("p",{className:"text-gray-300",children:""})]}),I.jsx("div",{className:"w-full max-w-md mx-auto",children:I.jsxs(Rn,{className:"glass",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(Vb,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsxs(Ln,{children:[I.jsxs("form",{onSubmit:pe,className:"space-y-4",children:[I.jsx("div",{children:I.jsx(nr,{type:"tel",placeholder:" 6 ",value:t,onChange:Le=>e(Le.target.value),className:"bg-background/50",disabled:g})}),I.jsx("div",{children:I.jsx(nr,{type:"password",placeholder:"",value:A,onChange:Le=>N(Le.target.value),className:"bg-background/50",disabled:g})}),I.jsxs("div",{children:[I.jsx("label",{className:"block text-sm mb-2",children:""}),I.jsxs("select",{value:f,onChange:Le=>v(Le.target.value),className:"w-full p-2 rounded bg-background/50 border border-input",disabled:g,children:[I.jsx("option",{value:"passenger",children:""}),I.jsx("option",{value:"driver",children:""}),I.jsx("option",{value:"admin",children:""})]})]}),I.jsxs("div",{className:"flex items-center mb-2",children:[I.jsx("input",{id:"remember",type:"checkbox",className:"mr-2",checked:Z,onChange:Le=>W(Le.target.checked),disabled:g}),I.jsx("label",{htmlFor:"remember",className:"text-sm",children:""})]}),I.jsx(Cn,{type:"submit",className:"w-full btn-primary",disabled:g,children:g?"...":""}),K&&I.jsxs("div",{className:"mt-4 space-y-2",children:[I.jsx(nr,{type:"text",placeholder:"9& 6 ",value:ce,onChange:Le=>ie(Le.target.value),className:"bg-background/50",disabled:g}),I.jsxs("div",{className:"flex gap-2",children:[I.jsx(Cn,{type:"button",onClick:Ie,disabled:g,className:"btn-primary",children:'0"&'}),I.jsx(Cn,{type:"button",onClick:Ge,disabled:g,variant:"secondary",children:"!0"})]})]})]}),I.jsx("div",{id:"firebase-recaptcha",className:"mt-2"}),I.jsx("div",{className:"mt-6 text-center",children:I.jsxs("p",{className:"text-sm text-muted-foreground",children:['S0"xx',I.jsx("button",{onClick:()=>fe("/register"),className:"text-primary hover:underline font-medium",children:"9 `"})]})}),I.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-2",children:[I.jsx(Cn,{type:"button",className:"w-full bg-blue-600 text-white",onClick:()=>{$({userId:"test_passenger",role:"passenger",name:"",phone:"0912345678",permissions:{can_access_passenger:!0}}),fe("/passenger")},children:""}),I.jsx(Cn,{type:"button",className:"w-full bg-green-600 text-white",onClick:()=>{$({userId:"test_driver",role:"driver",name:"",phone:"090000001",permissions:{can_access_driver:!0}}),fe("/driver")},children:""})]})]})]})})]})})}var U5=L0[" useId ".trim().toString()]||(()=>{}),V5=0;function yk(t){const[e,i]=se.useState(U5());return Wd(()=>{i(l=>l??String(V5++))},[t]),e?`radix-${e}`:""}var $5=se.createContext(void 0);function vk(t){const e=se.useContext($5);return t||e||"ltr"}var rx="rovingFocusGroup.onEntryFocus",Z5={bubbles:!1,cancelable:!0},ym="RovingFocusGroup",[E0,xk,G5]=OC(ym),[q5,bk]=oy(ym,[G5]),[W5,H5]=q5(ym),wk=se.forwardRef((t,e)=>I.jsx(E0.Provider,{scope:t.__scopeRovingFocusGroup,children:I.jsx(E0.Slot,{scope:t.__scopeRovingFocusGroup,children:I.jsx(K5,{...t,ref:e})})}));wk.displayName=ym;var K5=se.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:i,orientation:l,loop:f=!1,dir:v,currentTabStopId:g,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:A,onEntryFocus:N,preventScrollOnEntryFocus:Z=!1,...W}=t,K=se.useRef(null),J=mu(e,K),ce=vk(v),[ie,oe]=Db({prop:g,defaultProp:c??null,onChange:A,caller:ym}),[re,$]=se.useState(!1),te=gu(N),fe=xk(i),pe=se.useRef(!1),[Ie,Ge]=se.useState(0);return se.useEffect(()=>{const Le=K.current;if(Le)return Le.addEventListener(rx,te),()=>Le.removeEventListener(rx,te)},[te]),I.jsx(W5,{scope:i,orientation:l,dir:ce,loop:f,currentTabStopId:ie,onItemFocus:se.useCallback(Le=>oe(Le),[oe]),onItemShiftTab:se.useCallback(()=>$(!0),[]),onFocusableItemAdd:se.useCallback(()=>Ge(Le=>Le+1),[]),onFocusableItemRemove:se.useCallback(()=>Ge(Le=>Le-1),[]),children:I.jsx(rs.div,{tabIndex:re||Ie===0?-1:0,"data-orientation":l,...W,ref:J,style:{outline:"none",...t.style},onMouseDown:Vr(t.onMouseDown,()=>{pe.current=!0}),onFocus:Vr(t.onFocus,Le=>{const xt=!pe.current;if(Le.target===Le.currentTarget&&xt&&!re){const ct=new CustomEvent(rx,Z5);if(Le.currentTarget.dispatchEvent(ct),!ct.defaultPrevented){const ht=fe().filter(wt=>wt.focusable),ze=ht.find(wt=>wt.active),vt=ht.find(wt=>wt.id===ie),Mt=[ze,vt,...ht].filter(Boolean).map(wt=>wt.ref.current);Pk(Mt,Z)}}pe.current=!1}),onBlur:Vr(t.onBlur,()=>$(!1))})})}),Tk="RovingFocusGroupItem",Sk=se.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:i,focusable:l=!0,active:f=!1,tabStopId:v,children:g,...c}=t,A=yk(),N=v||A,Z=H5(Tk,i),W=Z.currentTabStopId===N,K=xk(i),{onFocusableItemAdd:J,onFocusableItemRemove:ce,currentTabStopId:ie}=Z;return se.useEffect(()=>{if(l)return J(),()=>ce()},[l,J,ce]),I.jsx(E0.ItemSlot,{scope:i,id:N,focusable:l,active:f,children:I.jsx(rs.span,{tabIndex:W?0:-1,"data-orientation":Z.orientation,...c,ref:e,onMouseDown:Vr(t.onMouseDown,oe=>{l?Z.onItemFocus(N):oe.preventDefault()}),onFocus:Vr(t.onFocus,()=>Z.onItemFocus(N)),onKeyDown:Vr(t.onKeyDown,oe=>{if(oe.key==="Tab"&&oe.shiftKey){Z.onItemShiftTab();return}if(oe.target!==oe.currentTarget)return;const re=J5(oe,Z.orientation,Z.dir);if(re!==void 0){if(oe.metaKey||oe.ctrlKey||oe.altKey||oe.shiftKey)return;oe.preventDefault();let te=K().filter(fe=>fe.focusable).map(fe=>fe.ref.current);if(re==="last")te.reverse();else if(re==="prev"||re==="next"){re==="prev"&&te.reverse();const fe=te.indexOf(oe.currentTarget);te=Z.loop?Q5(te,fe+1):te.slice(fe+1)}setTimeout(()=>Pk(te))}}),children:typeof g=="function"?g({isCurrentTabStop:W,hasTabStop:ie!=null}):g})})});Sk.displayName=Tk;var X5={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Y5(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function J5(t,e,i){const l=Y5(t.key,i);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return X5[l]}function Pk(t,e=!1){const i=document.activeElement;for(const l of t)if(l===i||(l.focus({preventScroll:e}),document.activeElement!==i))return}function Q5(t,e){return t.map((i,l)=>t[(e+l)%t.length])}var e6=wk,t6=Sk,fy="Tabs",[n6]=oy(fy,[bk]),Ek=bk(),[r6,nw]=n6(fy),Ck=se.forwardRef((t,e)=>{const{__scopeTabs:i,value:l,onValueChange:f,defaultValue:v,orientation:g="horizontal",dir:c,activationMode:A="automatic",...N}=t,Z=vk(c),[W,K]=Db({prop:l,onChange:f,defaultProp:v??"",caller:fy});return I.jsx(r6,{scope:i,baseId:yk(),value:W,onValueChange:K,orientation:g,dir:Z,activationMode:A,children:I.jsx(rs.div,{dir:Z,"data-orientation":g,...N,ref:e})})});Ck.displayName=fy;var Ik="TabsList",kk=se.forwardRef((t,e)=>{const{__scopeTabs:i,loop:l=!0,...f}=t,v=nw(Ik,i),g=Ek(i);return I.jsx(e6,{asChild:!0,...g,orientation:v.orientation,dir:v.dir,loop:l,children:I.jsx(rs.div,{role:"tablist","aria-orientation":v.orientation,...f,ref:e})})});kk.displayName=Ik;var Mk="TabsTrigger",Ak=se.forwardRef((t,e)=>{const{__scopeTabs:i,value:l,disabled:f=!1,...v}=t,g=nw(Mk,i),c=Ek(i),A=zk(g.baseId,l),N=Dk(g.baseId,l),Z=l===g.value;return I.jsx(t6,{asChild:!0,...c,focusable:!f,active:Z,children:I.jsx(rs.button,{type:"button",role:"tab","aria-selected":Z,"aria-controls":N,"data-state":Z?"active":"inactive","data-disabled":f?"":void 0,disabled:f,id:A,...v,ref:e,onMouseDown:Vr(t.onMouseDown,W=>{!f&&W.button===0&&W.ctrlKey===!1?g.onValueChange(l):W.preventDefault()}),onKeyDown:Vr(t.onKeyDown,W=>{[" ","Enter"].includes(W.key)&&g.onValueChange(l)}),onFocus:Vr(t.onFocus,()=>{const W=g.activationMode!=="manual";!Z&&!f&&W&&g.onValueChange(l)})})})});Ak.displayName=Mk;var Rk="TabsContent",Lk=se.forwardRef((t,e)=>{const{__scopeTabs:i,value:l,forceMount:f,children:v,...g}=t,c=nw(Rk,i),A=zk(c.baseId,l),N=Dk(c.baseId,l),Z=l===c.value,W=se.useRef(Z);return se.useEffect(()=>{const K=requestAnimationFrame(()=>W.current=!1);return()=>cancelAnimationFrame(K)},[]),I.jsx(zb,{present:f||Z,children:({present:K})=>I.jsx(rs.div,{"data-state":Z?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":A,hidden:!K,id:N,tabIndex:0,...g,ref:e,style:{...t.style,animationDuration:W.current?"0s":void 0},children:K&&v})})});Lk.displayName=Rk;function zk(t,e){return`${t}-trigger-${e}`}function Dk(t,e){return`${t}-content-${e}`}var i6=Ck,Nk=kk,Ok=Ak,jk=Lk;const Bk=i6,rw=se.forwardRef(({className:t,...e},i)=>I.jsx(Nk,{ref:i,className:Mi("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));rw.displayName=Nk.displayName;const Jc=se.forwardRef(({className:t,...e},i)=>I.jsx(Ok,{ref:i,className:Mi("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...e}));Jc.displayName=Ok.displayName;const Qc=se.forwardRef(({className:t,...e},i)=>I.jsx(jk,{ref:i,className:Mi("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));Qc.displayName=jk.displayName;function s6(){const[t,e]=se.useState({phone:"",name:"",role:"passenger",nickname:"",carPlate:"",remarks:"",password:"",confirmPassword:"",remember:!0,inviteCode:""}),[i,l]=se.useState(!1),{toast:f}=sc(),v=vh(),{loginUser:g}=_l(),c=async N=>{var ce;if(N.preventDefault(),!t.phone.trim()||!t.name.trim()){f({title:"",description:`${userData.name}`,variant:"default"});return}if(t.role==="driver"&&(!t.nickname.trim()||!t.carPlate.trim())){f({title:"",description:error.message||"",variant:"destructive"});return}if(!t.password.trim()||t.password.length<6){f({title:"&R",description:'9a! 6 " ',variant:"destructive"});return}if(t.password!==t.confirmPassword){f({title:" !",description:"9&&a :R",variant:"destructive"});return}if(t.role!=="super_admin"&&!t.inviteCode.trim()){f({title:"",description:"",variant:"destructive"});return}const Z=(t.phone||"").trim(),W=t.role||"passenger",K=(t.inviteCode||"").trim();if(W==="driver"&&!["0971827628","0982214855"].includes(Z)){f({title:"",description:"0971827628  0982214855",variant:"destructive"});return}if(W==="driver"&&!(K==="0971827628"||K==="0982214855")){f({title:"",description:" 0971827628  0982214855",variant:"destructive"});return}if(W==="passenger")try{const ie=await Os("verify-phone",{phone:Z});if(!(ie&&(ie.success===!0||ie.exists===!0))){f({title:"",description:"",variant:"destructive"});return}}catch{f({title:"",description:"",variant:"destructive"});return}l(!0);try{const ie=["0971827628","0982214855"].includes((t.phone||"").trim())?"super_admin":t.role,oe=await Os("user-register",{phone:t.phone,name:t.name,role:ie,password:t.password,remember:t.remember,nickname:t.nickname,carPlate:t.carPlate,remarks:t.remarks,inviteCode:t.inviteCode});if(!(oe!=null&&oe.success))throw new Error(((ce=oe==null?void 0:oe.error)==null?void 0:ce.message)||"");const re=oe.data;re!=null&&re.token&&(localStorage.setItem("bf_auth_token",re.token),localStorage.setItem("bf_user_profile",JSON.stringify({userId:re.userId,phone:re.phone,name:re.name,role:re.role,permissions:re.permissions}))),await g(re),f({title:"",description:`${re.name}`,variant:"default"});const $=re.permissions;re.role==="admin"&&($!=null&&$.can_access_admin)?v("/admin"):re.role==="driver"&&($!=null&&$.can_access_driver)?v("/driver"):v("/passenger")}catch(ie){f({title:"",description:ie.message||"",variant:"destructive"})}finally{l(!1)}},A=(N,Z)=>{e(W=>({...W,[N]:Z}))};return I.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:I.jsxs("div",{className:"w-full max-w-2xl",children:[I.jsxs("div",{className:"text-center mb-8",children:[I.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:" Black Feather "}),I.jsx("p",{className:"text-gray-300",children:""})]}),I.jsxs(Rn,{className:"glass",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(F3,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsxs(Ln,{children:[I.jsxs("form",{onSubmit:c,className:"space-y-6",children:[I.jsxs(Bk,{value:t.role,onValueChange:N=>A("role",N),children:[I.jsxs(rw,{className:"grid w-full grid-cols-3",children:[I.jsxs(Jc,{value:"passenger",children:[I.jsx(ly,{className:"w-4 h-4 mr-2"}),""]}),I.jsxs(Jc,{value:"driver",children:[I.jsx(gl,{className:"w-4 h-4 mr-2"}),""]}),I.jsxs(Jc,{value:"super_admin",children:[I.jsx(j3,{className:"w-4 h-4 mr-2"}),""]})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:" *"}),I.jsx(nr,{type:"text",placeholder:"",value:t.inviteCode,onChange:N=>A("inviteCode",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsx(Qc,{value:"passenger",className:"mt-6",children:I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:""}),I.jsx(nr,{type:"tel",placeholder:"",value:t.phone,onChange:N=>A("phone",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:" *"}),I.jsx(nr,{type:"text",placeholder:"",value:t.name,onChange:N=>A("name",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:" **"}),I.jsx(nr,{type:"password",placeholder:"",value:t.password,onChange:N=>A("password",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:"  *"}),I.jsx(nr,{type:"password",placeholder:"",value:t.confirmPassword,onChange:N=>A("confirmPassword",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{className:"flex items-center",children:[I.jsx("input",{id:"remember-passenger",type:"checkbox",className:"mr-2",checked:t.remember,onChange:N=>A("remember",N.target.checked),disabled:i}),I.jsx("label",{htmlFor:"remember-passenger",className:"text-sm",children:"0"})]})]})}),I.jsx(Qc,{value:"driver",className:"mt-6",children:I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:'09x"x *'}),I.jsx(nr,{type:"tel",placeholder:"",value:t.phone,onChange:N=>A("phone",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:" *"}),I.jsx(nr,{type:"text",placeholder:"",value:t.name,onChange:N=>A("name",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:"a *"}),I.jsx(nr,{type:"text",placeholder:"",value:t.nickname,onChange:N=>A("nickname",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:" **"}),I.jsx(nr,{type:"text",placeholder:"",value:t.carPlate,onChange:N=>A("carPlate",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:'"'}),I.jsx(nr,{type:"text",placeholder:"",value:t.remarks,onChange:N=>A("remarks",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:" **"}),I.jsx(nr,{type:"password",placeholder:"",value:t.password,onChange:N=>A("password",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:"  *"}),I.jsx(nr,{type:"password",placeholder:"",value:t.confirmPassword,onChange:N=>A("confirmPassword",N.target.value),className:"bg-background/50",disabled:i})]})]}),I.jsxs("div",{className:"flex items-center",children:[I.jsx("input",{id:"remember-driver",type:"checkbox",className:"mr-2",checked:t.remember,onChange:N=>A("remember",N.target.checked),disabled:i}),I.jsx("label",{htmlFor:"remember-driver",className:"text-sm",children:"0"})]})]})}),I.jsx(Qc,{value:"super_admin",className:"mt-6",children:I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:'09x"x *'}),I.jsx(nr,{type:"tel",placeholder:"",value:t.phone,onChange:N=>A("phone",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:" *"}),I.jsx(nr,{type:"text",placeholder:"",value:t.name,onChange:N=>A("name",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsx("div",{className:"p-4 bg-warning/10 border border-warning/20 rounded-lg",children:I.jsx("p",{className:"text-sm text-warning-foreground",children:'a  "xSR `R9`9a`"'})}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:" **"}),I.jsx(nr,{type:"password",placeholder:"",value:t.password,onChange:N=>A("password",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{children:[I.jsx("label",{className:"text-sm font-medium",children:"  *"}),I.jsx(nr,{type:"password",placeholder:"",value:t.confirmPassword,onChange:N=>A("confirmPassword",N.target.value),className:"bg-background/50",disabled:i})]}),I.jsxs("div",{className:"flex items-center",children:[I.jsx("input",{id:"remember-admin",type:"checkbox",className:"mr-2",checked:t.remember,onChange:N=>A("remember",N.target.checked),disabled:i}),I.jsx("label",{htmlFor:"remember-admin",className:"text-sm",children:"0"})]})]})})]}),I.jsx("div",{id:"firebase-reCAPTCHA",className:"mt-2",style:{display:"none"}}),I.jsx(Cn,{type:"submit",className:"w-full btn-primary",disabled:i,children:i?"...":""})]}),I.jsx("div",{className:"mt-6 text-center",children:I.jsxs("p",{className:"text-sm text-muted-foreground",children:["",I.jsx("button",{onClick:()=>v("/login"),className:"text-primary hover:underline font-medium",children:""})]})})]})]})]})})}const o6=Fb("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-600",idle:"border-green-500/30 bg-green-500/20 text-green-400",busy:"border-yellow-500/30 bg-yellow-500/20 text-yellow-400",offline:"border-red-500/30 bg-red-500/20 text-red-400"}},defaultVariants:{variant:"default"}});function va({className:t,variant:e,children:i,...l}){return I.jsx("div",{className:Mi(o6({variant:e}),t),...l,children:i})}function a6(t,e){const i=se.useRef(e);se.useEffect(function(){e!==i.current&&t.attributionControl!=null&&(i.current!=null&&t.attributionControl.removeAttribution(i.current),e!=null&&t.attributionControl.addAttribution(e)),i.current=e},[t,e])}function l6(t,e,i){e.center!==i.center&&t.setLatLng(e.center),e.radius!=null&&e.radius!==i.radius&&t.setRadius(e.radius)}const c6=1;function u6(t){return Object.freeze({__version:c6,map:t})}function Fk(t,e){return Object.freeze({...t,...e})}const Uk=se.createContext(null),Vk=Uk.Provider;function iw(){const t=se.useContext(Uk);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function h6(t){function e(i,l){const{instance:f,context:v}=t(i).current;return se.useImperativeHandle(l,()=>f),i.children==null?null:pa.createElement(Vk,{value:v},i.children)}return se.forwardRef(e)}function d6(t){function e(i,l){const{instance:f}=t(i).current;return se.useImperativeHandle(l,()=>f),null}return se.forwardRef(e)}function $k(t,e){const i=se.useRef();se.useEffect(function(){return e!=null&&t.instance.on(e),i.current=e,function(){i.current!=null&&t.instance.off(i.current),i.current=null}},[t,e])}function sw(t,e){const i=t.pane??e.pane;return i?{...t,pane:i}:t}var C0={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(i,l){l(e)})(SP,function(i){var l="1.9.4";function f(u){var y,P,z,F;for(P=1,z=arguments.length;P<z;P++){F=arguments[P];for(y in F)u[y]=F[y]}return u}var v=Object.create||function(){function u(){}return function(y){return u.prototype=y,new u}}();function g(u,y){var P=Array.prototype.slice;if(u.bind)return u.bind.apply(u,P.call(arguments,1));var z=P.call(arguments,2);return function(){return u.apply(y,z.length?z.concat(P.call(arguments)):arguments)}}var c=0;function A(u){return"_leaflet_id"in u||(u._leaflet_id=++c),u._leaflet_id}function N(u,y,P){var z,F,ne,Se;return Se=function(){z=!1,F&&(ne.apply(P,F),F=!1)},ne=function(){z?F=arguments:(u.apply(P,arguments),setTimeout(Se,y),z=!0)},ne}function Z(u,y,P){var z=y[1],F=y[0],ne=z-F;return u===z&&P?u:((u-F)%ne+ne)%ne+F}function W(){return!1}function K(u,y){if(y===!1)return u;var P=Math.pow(10,y===void 0?6:y);return Math.round(u*P)/P}function J(u){return u.trim?u.trim():u.replace(/^\s+|\s+$/g,"")}function ce(u){return J(u).split(/\s+/)}function ie(u,y){Object.prototype.hasOwnProperty.call(u,"options")||(u.options=u.options?v(u.options):{});for(var P in y)u.options[P]=y[P];return u.options}function oe(u,y,P){var z=[];for(var F in u)z.push(encodeURIComponent(P?F.toUpperCase():F)+"="+encodeURIComponent(u[F]));return(!y||y.indexOf("?")===-1?"?":"&")+z.join("&")}var re=/\{ *([\w_ -]+) *\}/g;function $(u,y){return u.replace(re,function(P,z){var F=y[z];if(F===void 0)throw new Error("No value provided for variable "+P);return typeof F=="function"&&(F=F(y)),F})}var te=Array.isArray||function(u){return Object.prototype.toString.call(u)==="[object Array]"};function fe(u,y){for(var P=0;P<u.length;P++)if(u[P]===y)return P;return-1}var pe="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Ie(u){return window["webkit"+u]||window["moz"+u]||window["ms"+u]}var Ge=0;function Le(u){var y=+new Date,P=Math.max(0,16-(y-Ge));return Ge=y+P,window.setTimeout(u,P)}var xt=window.requestAnimationFrame||Ie("RequestAnimationFrame")||Le,ct=window.cancelAnimationFrame||Ie("CancelAnimationFrame")||Ie("CancelRequestAnimationFrame")||function(u){window.clearTimeout(u)};function ht(u,y,P){if(P&&xt===Le)u.call(y);else return xt.call(window,g(u,y))}function ze(u){u&&ct.call(window,u)}var vt={__proto__:null,extend:f,create:v,bind:g,get lastId(){return c},stamp:A,throttle:N,wrapNum:Z,falseFn:W,formatNum:K,trim:J,splitWords:ce,setOptions:ie,getParamString:oe,template:$,isArray:te,indexOf:fe,emptyImageUrl:pe,requestFn:xt,cancelFn:ct,requestAnimFrame:ht,cancelAnimFrame:ze};function at(){}at.extend=function(u){var y=function(){ie(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=y.__super__=this.prototype,z=v(P);z.constructor=y,y.prototype=z;for(var F in this)Object.prototype.hasOwnProperty.call(this,F)&&F!=="prototype"&&F!=="__super__"&&(y[F]=this[F]);return u.statics&&f(y,u.statics),u.includes&&(Mt(u.includes),f.apply(null,[z].concat(u.includes))),f(z,u),delete z.statics,delete z.includes,z.options&&(z.options=P.options?v(P.options):{},f(z.options,u.options)),z._initHooks=[],z.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var ne=0,Se=z._initHooks.length;ne<Se;ne++)z._initHooks[ne].call(this)}},y},at.include=function(u){var y=this.prototype.options;return f(this.prototype,u),u.options&&(this.prototype.options=y,this.mergeOptions(u.options)),this},at.mergeOptions=function(u){return f(this.prototype.options,u),this},at.addInitHook=function(u){var y=Array.prototype.slice.call(arguments,1),P=typeof u=="function"?u:function(){this[u].apply(this,y)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function Mt(u){if(!(typeof L>"u"||!L||!L.Mixin)){u=te(u)?u:[u];for(var y=0;y<u.length;y++)u[y]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var wt={on:function(u,y,P){if(typeof u=="object")for(var z in u)this._on(z,u[z],y);else{u=ce(u);for(var F=0,ne=u.length;F<ne;F++)this._on(u[F],y,P)}return this},off:function(u,y,P){if(!arguments.length)delete this._events;else if(typeof u=="object")for(var z in u)this._off(z,u[z],y);else{u=ce(u);for(var F=arguments.length===1,ne=0,Se=u.length;ne<Se;ne++)F?this._off(u[ne]):this._off(u[ne],y,P)}return this},_on:function(u,y,P,z){if(typeof y!="function"){console.warn("wrong listener type: "+typeof y);return}if(this._listens(u,y,P)===!1){P===this&&(P=void 0);var F={fn:y,ctx:P};z&&(F.once=!0),this._events=this._events||{},this._events[u]=this._events[u]||[],this._events[u].push(F)}},_off:function(u,y,P){var z,F,ne;if(this._events&&(z=this._events[u],!!z)){if(arguments.length===1){if(this._firingCount)for(F=0,ne=z.length;F<ne;F++)z[F].fn=W;delete this._events[u];return}if(typeof y!="function"){console.warn("wrong listener type: "+typeof y);return}var Se=this._listens(u,y,P);if(Se!==!1){var Be=z[Se];this._firingCount&&(Be.fn=W,this._events[u]=z=z.slice()),z.splice(Se,1)}}},fire:function(u,y,P){if(!this.listens(u,P))return this;var z=f({},y,{type:u,target:this,sourceTarget:y&&y.sourceTarget||this});if(this._events){var F=this._events[u];if(F){this._firingCount=this._firingCount+1||1;for(var ne=0,Se=F.length;ne<Se;ne++){var Be=F[ne],Ke=Be.fn;Be.once&&this.off(u,Ke,Be.ctx),Ke.call(Be.ctx||this,z)}this._firingCount--}}return P&&this._propagateEvent(z),this},listens:function(u,y,P,z){typeof u!="string"&&console.warn('"string" type argument expected');var F=y;typeof y!="function"&&(z=!!y,F=void 0,P=void 0);var ne=this._events&&this._events[u];if(ne&&ne.length&&this._listens(u,F,P)!==!1)return!0;if(z){for(var Se in this._eventParents)if(this._eventParents[Se].listens(u,y,P,z))return!0}return!1},_listens:function(u,y,P){if(!this._events)return!1;var z=this._events[u]||[];if(!y)return!!z.length;P===this&&(P=void 0);for(var F=0,ne=z.length;F<ne;F++)if(z[F].fn===y&&z[F].ctx===P)return F;return!1},once:function(u,y,P){if(typeof u=="object")for(var z in u)this._on(z,u[z],y,!0);else{u=ce(u);for(var F=0,ne=u.length;F<ne;F++)this._on(u[F],y,P,!0)}return this},addEventParent:function(u){return this._eventParents=this._eventParents||{},this._eventParents[A(u)]=u,this},removeEventParent:function(u){return this._eventParents&&delete this._eventParents[A(u)],this},_propagateEvent:function(u){for(var y in this._eventParents)this._eventParents[y].fire(u.type,f({layer:u.target,propagatedFrom:u.target},u),!0)}};wt.addEventListener=wt.on,wt.removeEventListener=wt.clearAllEventListeners=wt.off,wt.addOneTimeEventListener=wt.once,wt.fireEvent=wt.fire,wt.hasEventListeners=wt.listens;var jt=at.extend(wt);function Ne(u,y,P){this.x=P?Math.round(u):u,this.y=P?Math.round(y):y}var Oe=Math.trunc||function(u){return u>0?Math.floor(u):Math.ceil(u)};Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(u){return this.clone()._add(We(u))},_add:function(u){return this.x+=u.x,this.y+=u.y,this},subtract:function(u){return this.clone()._subtract(We(u))},_subtract:function(u){return this.x-=u.x,this.y-=u.y,this},divideBy:function(u){return this.clone()._divideBy(u)},_divideBy:function(u){return this.x/=u,this.y/=u,this},multiplyBy:function(u){return this.clone()._multiplyBy(u)},_multiplyBy:function(u){return this.x*=u,this.y*=u,this},scaleBy:function(u){return new Ne(this.x*u.x,this.y*u.y)},unscaleBy:function(u){return new Ne(this.x/u.x,this.y/u.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Oe(this.x),this.y=Oe(this.y),this},distanceTo:function(u){u=We(u);var y=u.x-this.x,P=u.y-this.y;return Math.sqrt(y*y+P*P)},equals:function(u){return u=We(u),u.x===this.x&&u.y===this.y},contains:function(u){return u=We(u),Math.abs(u.x)<=Math.abs(this.x)&&Math.abs(u.y)<=Math.abs(this.y)},toString:function(){return"Point("+K(this.x)+", "+K(this.y)+")"}};function We(u,y,P){return u instanceof Ne?u:te(u)?new Ne(u[0],u[1]):u==null?u:typeof u=="object"&&"x"in u&&"y"in u?new Ne(u.x,u.y):new Ne(u,y,P)}function nt(u,y){if(u)for(var P=y?[u,y]:u,z=0,F=P.length;z<F;z++)this.extend(P[z])}nt.prototype={extend:function(u){var y,P;if(!u)return this;if(u instanceof Ne||typeof u[0]=="number"||"x"in u)y=P=We(u);else if(u=_t(u),y=u.min,P=u.max,!y||!P)return this;return!this.min&&!this.max?(this.min=y.clone(),this.max=P.clone()):(this.min.x=Math.min(y.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(y.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(u){return We((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,u)},getBottomLeft:function(){return We(this.min.x,this.max.y)},getTopRight:function(){return We(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(u){var y,P;return typeof u[0]=="number"||u instanceof Ne?u=We(u):u=_t(u),u instanceof nt?(y=u.min,P=u.max):y=P=u,y.x>=this.min.x&&P.x<=this.max.x&&y.y>=this.min.y&&P.y<=this.max.y},intersects:function(u){u=_t(u);var y=this.min,P=this.max,z=u.min,F=u.max,ne=F.x>=y.x&&z.x<=P.x,Se=F.y>=y.y&&z.y<=P.y;return ne&&Se},overlaps:function(u){u=_t(u);var y=this.min,P=this.max,z=u.min,F=u.max,ne=F.x>y.x&&z.x<P.x,Se=F.y>y.y&&z.y<P.y;return ne&&Se},isValid:function(){return!!(this.min&&this.max)},pad:function(u){var y=this.min,P=this.max,z=Math.abs(y.x-P.x)*u,F=Math.abs(y.y-P.y)*u;return _t(We(y.x-z,y.y-F),We(P.x+z,P.y+F))},equals:function(u){return u?(u=_t(u),this.min.equals(u.getTopLeft())&&this.max.equals(u.getBottomRight())):!1}};function _t(u,y){return!u||u instanceof nt?u:new nt(u,y)}function Bt(u,y){if(u)for(var P=y?[u,y]:u,z=0,F=P.length;z<F;z++)this.extend(P[z])}Bt.prototype={extend:function(u){var y=this._southWest,P=this._northEast,z,F;if(u instanceof Ut)z=u,F=u;else if(u instanceof Bt){if(z=u._southWest,F=u._northEast,!z||!F)return this}else return u?this.extend(Pt(u)||Ft(u)):this;return!y&&!P?(this._southWest=new Ut(z.lat,z.lng),this._northEast=new Ut(F.lat,F.lng)):(y.lat=Math.min(z.lat,y.lat),y.lng=Math.min(z.lng,y.lng),P.lat=Math.max(F.lat,P.lat),P.lng=Math.max(F.lng,P.lng)),this},pad:function(u){var y=this._southWest,P=this._northEast,z=Math.abs(y.lat-P.lat)*u,F=Math.abs(y.lng-P.lng)*u;return new Bt(new Ut(y.lat-z,y.lng-F),new Ut(P.lat+z,P.lng+F))},getCenter:function(){return new Ut((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ut(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ut(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(u){typeof u[0]=="number"||u instanceof Ut||"lat"in u?u=Pt(u):u=Ft(u);var y=this._southWest,P=this._northEast,z,F;return u instanceof Bt?(z=u.getSouthWest(),F=u.getNorthEast()):z=F=u,z.lat>=y.lat&&F.lat<=P.lat&&z.lng>=y.lng&&F.lng<=P.lng},intersects:function(u){u=Ft(u);var y=this._southWest,P=this._northEast,z=u.getSouthWest(),F=u.getNorthEast(),ne=F.lat>=y.lat&&z.lat<=P.lat,Se=F.lng>=y.lng&&z.lng<=P.lng;return ne&&Se},overlaps:function(u){u=Ft(u);var y=this._southWest,P=this._northEast,z=u.getSouthWest(),F=u.getNorthEast(),ne=F.lat>y.lat&&z.lat<P.lat,Se=F.lng>y.lng&&z.lng<P.lng;return ne&&Se},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(u,y){return u?(u=Ft(u),this._southWest.equals(u.getSouthWest(),y)&&this._northEast.equals(u.getNorthEast(),y)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Ft(u,y){return u instanceof Bt?u:new Bt(u,y)}function Ut(u,y,P){if(isNaN(u)||isNaN(y))throw new Error("Invalid LatLng object: ("+u+", "+y+")");this.lat=+u,this.lng=+y,P!==void 0&&(this.alt=+P)}Ut.prototype={equals:function(u,y){if(!u)return!1;u=Pt(u);var P=Math.max(Math.abs(this.lat-u.lat),Math.abs(this.lng-u.lng));return P<=(y===void 0?1e-9:y)},toString:function(u){return"LatLng("+K(this.lat,u)+", "+K(this.lng,u)+")"},distanceTo:function(u){return Vn.distance(this,Pt(u))},wrap:function(){return Vn.wrapLatLng(this)},toBounds:function(u){var y=180*u/40075017,P=y/Math.cos(Math.PI/180*this.lat);return Ft([this.lat-y,this.lng-P],[this.lat+y,this.lng+P])},clone:function(){return new Ut(this.lat,this.lng,this.alt)}};function Pt(u,y,P){return u instanceof Ut?u:te(u)&&typeof u[0]!="object"?u.length===3?new Ut(u[0],u[1],u[2]):u.length===2?new Ut(u[0],u[1]):null:u==null?u:typeof u=="object"&&"lat"in u?new Ut(u.lat,"lng"in u?u.lng:u.lon,u.alt):y===void 0?null:new Ut(u,y,P)}var Un={latLngToPoint:function(u,y){var P=this.projection.project(u),z=this.scale(y);return this.transformation._transform(P,z)},pointToLatLng:function(u,y){var P=this.scale(y),z=this.transformation.untransform(u,P);return this.projection.unproject(z)},project:function(u){return this.projection.project(u)},unproject:function(u){return this.projection.unproject(u)},scale:function(u){return 256*Math.pow(2,u)},zoom:function(u){return Math.log(u/256)/Math.LN2},getProjectedBounds:function(u){if(this.infinite)return null;var y=this.projection.bounds,P=this.scale(u),z=this.transformation.transform(y.min,P),F=this.transformation.transform(y.max,P);return new nt(z,F)},infinite:!1,wrapLatLng:function(u){var y=this.wrapLng?Z(u.lng,this.wrapLng,!0):u.lng,P=this.wrapLat?Z(u.lat,this.wrapLat,!0):u.lat,z=u.alt;return new Ut(P,y,z)},wrapLatLngBounds:function(u){var y=u.getCenter(),P=this.wrapLatLng(y),z=y.lat-P.lat,F=y.lng-P.lng;if(z===0&&F===0)return u;var ne=u.getSouthWest(),Se=u.getNorthEast(),Be=new Ut(ne.lat-z,ne.lng-F),Ke=new Ut(Se.lat-z,Se.lng-F);return new Bt(Be,Ke)}},Vn=f({},Un,{wrapLng:[-180,180],R:6371e3,distance:function(u,y){var P=Math.PI/180,z=u.lat*P,F=y.lat*P,ne=Math.sin((y.lat-u.lat)*P/2),Se=Math.sin((y.lng-u.lng)*P/2),Be=ne*ne+Math.cos(z)*Math.cos(F)*Se*Se,Ke=2*Math.atan2(Math.sqrt(Be),Math.sqrt(1-Be));return this.R*Ke}}),yi=6378137,ws={R:yi,MAX_LATITUDE:85.0511287798,project:function(u){var y=Math.PI/180,P=this.MAX_LATITUDE,z=Math.max(Math.min(P,u.lat),-P),F=Math.sin(z*y);return new Ne(this.R*u.lng*y,this.R*Math.log((1+F)/(1-F))/2)},unproject:function(u){var y=180/Math.PI;return new Ut((2*Math.atan(Math.exp(u.y/this.R))-Math.PI/2)*y,u.x*y/this.R)},bounds:function(){var u=yi*Math.PI;return new nt([-u,-u],[u,u])}()};function Ts(u,y,P,z){if(te(u)){this._a=u[0],this._b=u[1],this._c=u[2],this._d=u[3];return}this._a=u,this._b=y,this._c=P,this._d=z}Ts.prototype={transform:function(u,y){return this._transform(u.clone(),y)},_transform:function(u,y){return y=y||1,u.x=y*(this._a*u.x+this._b),u.y=y*(this._c*u.y+this._d),u},untransform:function(u,y){return y=y||1,new Ne((u.x/y-this._b)/this._a,(u.y/y-this._d)/this._c)}};function xr(u,y,P,z){return new Ts(u,y,P,z)}var In=f({},Vn,{code:"EPSG:3857",projection:ws,transformation:function(){var u=.5/(Math.PI*ws.R);return xr(u,.5,-u,.5)}()}),$n=f({},In,{code:"EPSG:900913"});function vi(u){return document.createElementNS("http://www.w3.org/2000/svg",u)}function Dr(u,y){var P="",z,F,ne,Se,Be,Ke;for(z=0,ne=u.length;z<ne;z++){for(Be=u[z],F=0,Se=Be.length;F<Se;F++)Ke=Be[F],P+=(F?"L":"M")+Ke.x+" "+Ke.y;P+=y?Fe.svg?"z":"x":""}return P||"M0 0"}var Vt=document.documentElement.style,_n="ActiveXObject"in window,mn=_n&&!document.addEventListener,dr="msLaunchUri"in navigator&&!("documentMode"in document),Ai=nn("webkit"),Gi=nn("android"),xi=nn("android 2")||nn("android 3"),Ss=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),li=Gi&&nn("Google")&&Ss<537&&!("AudioNode"in window),Hn=!!window.opera,br=!dr&&nn("chrome"),Kn=nn("gecko")&&!Ai&&!Hn&&!_n,Ce=!br&&nn("safari"),X=nn("phantom"),Y="OTransition"in Vt,ae=navigator.platform.indexOf("Win")===0,ye=_n&&"transition"in Vt,we="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!xi,Me="MozPerspective"in Vt,je=!window.L_DISABLE_3D&&(ye||we||Me)&&!Y&&!X,ke=typeof orientation<"u"||nn("mobile"),He=ke&&Ai,et=ke&&we,Ye=!window.PointerEvent&&window.MSPointerEvent,bt=!!(window.PointerEvent||Ye),Ct="ontouchstart"in window||!!window.TouchEvent,De=!window.L_NO_TOUCH&&(Ct||bt),Ht=ke&&Hn,yn=ke&&Kn,St=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,on=function(){var u=!1;try{var y=Object.defineProperty({},"passive",{get:function(){u=!0}});window.addEventListener("testPassiveEventSupport",W,y),window.removeEventListener("testPassiveEventSupport",W,y)}catch{}return u}(),ir=function(){return!!document.createElement("canvas").getContext}(),Zn=!!(document.createElementNS&&vi("svg").createSVGRect),Xn=!!Zn&&function(){var u=document.createElement("div");return u.innerHTML="<svg/>",(u.firstChild&&u.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),wr=!Zn&&function(){try{var u=document.createElement("div");u.innerHTML='<v:shape adj="1"/>';var y=u.firstChild;return y.style.behavior="url(#default#VML)",y&&typeof y.adj=="object"}catch{return!1}}(),En=navigator.platform.indexOf("Mac")===0,Tr=navigator.platform.indexOf("Linux")===0;function nn(u){return navigator.userAgent.toLowerCase().indexOf(u)>=0}var Fe={ie:_n,ielt9:mn,edge:dr,webkit:Ai,android:Gi,android23:xi,androidStock:li,opera:Hn,chrome:br,gecko:Kn,safari:Ce,phantom:X,opera12:Y,win:ae,ie3d:ye,webkit3d:we,gecko3d:Me,any3d:je,mobile:ke,mobileWebkit:He,mobileWebkit3d:et,msPointer:Ye,pointer:bt,touch:De,touchNative:Ct,mobileOpera:Ht,mobileGecko:yn,retina:St,passiveEvents:on,canvas:ir,svg:Zn,vml:wr,inlineSvg:Xn,mac:En,linux:Tr},is=Fe.msPointer?"MSPointerDown":"pointerdown",bi=Fe.msPointer?"MSPointerMove":"pointermove",wi=Fe.msPointer?"MSPointerUp":"pointerup",fr=Fe.msPointer?"MSPointerCancel":"pointercancel",ut={touchstart:is,touchmove:bi,touchend:wi,touchcancel:fr},Jt={touchstart:Zs,touchmove:mo,touchend:mo,touchcancel:mo},qt={},Ti=!1;function Ps(u,y,P){return y==="touchstart"&&jo(),Jt[y]?(P=Jt[y].bind(this,P),u.addEventListener(ut[y],P,!1),P):(console.warn("wrong event specified:",y),W)}function Es(u,y,P){if(!ut[y]){console.warn("wrong event specified:",y);return}u.removeEventListener(ut[y],P,!1)}function Xt(u){qt[u.pointerId]=u}function Pa(u){qt[u.pointerId]&&(qt[u.pointerId]=u)}function Ea(u){delete qt[u.pointerId]}function jo(){Ti||(document.addEventListener(is,Xt,!0),document.addEventListener(bi,Pa,!0),document.addEventListener(wi,Ea,!0),document.addEventListener(fr,Ea,!0),Ti=!0)}function mo(u,y){if(y.pointerType!==(y.MSPOINTER_TYPE_MOUSE||"mouse")){y.touches=[];for(var P in qt)y.touches.push(qt[P]);y.changedTouches=[y],u(y)}}function Zs(u,y){y.MSPOINTER_TYPE_TOUCH&&y.pointerType===y.MSPOINTER_TYPE_TOUCH&&an(y),mo(u,y)}function Bo(u){var y={},P,z;for(z in u)P=u[z],y[z]=P&&P.bind?P.bind(u):P;return u=y,y.type="dblclick",y.detail=2,y.isTrusted=!1,y._simulated=!0,y}var sr=200;function Ri(u,y){u.addEventListener("dblclick",y);var P=0,z;function F(ne){if(ne.detail!==1){z=ne.detail;return}if(!(ne.pointerType==="mouse"||ne.sourceCapabilities&&!ne.sourceCapabilities.firesTouchEvents)){var Se=$t(ne);if(!(Se.some(function(Ke){return Ke instanceof HTMLLabelElement&&Ke.attributes.for})&&!Se.some(function(Ke){return Ke instanceof HTMLInputElement||Ke instanceof HTMLSelectElement}))){var Be=Date.now();Be-P<=sr?(z++,z===2&&y(Bo(ne))):z=1,P=Be}}}return u.addEventListener("click",F),{dblclick:y,simDblclick:F}}function Nn(u,y){u.removeEventListener("dblclick",y.dblclick),u.removeEventListener("click",y.simDblclick)}var Fo=xl(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Cs=xl(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),oc=Cs==="webkitTransition"||Cs==="OTransition"?Cs+"End":"transitionend";function go(u){return typeof u=="string"?document.getElementById(u):u}function Li(u,y){var P=u.style[y]||u.currentStyle&&u.currentStyle[y];if((!P||P==="auto")&&document.defaultView){var z=document.defaultView.getComputedStyle(u,null);P=z?z[y]:null}return P==="auto"?null:P}function vn(u,y,P){var z=document.createElement(u);return z.className=y||"",P&&P.appendChild(z),z}function On(u){var y=u.parentNode;y&&y.removeChild(u)}function vl(u){for(;u.firstChild;)u.removeChild(u.firstChild)}function ss(u){var y=u.parentNode;y&&y.lastChild!==u&&y.appendChild(u)}function Uo(u){var y=u.parentNode;y&&y.firstChild!==u&&y.insertBefore(u,y.firstChild)}function wu(u,y){if(u.classList!==void 0)return u.classList.contains(y);var P=Ca(u);return P.length>0&&new RegExp("(^|\\s)"+y+"(\\s|$)").test(P)}function rn(u,y){if(u.classList!==void 0)for(var P=ce(y),z=0,F=P.length;z<F;z++)u.classList.add(P[z]);else if(!wu(u,y)){var ne=Ca(u);ac(u,(ne?ne+" ":"")+y)}}function or(u,y){u.classList!==void 0?u.classList.remove(y):ac(u,J((" "+Ca(u)+" ").replace(" "+y+" "," ")))}function ac(u,y){u.className.baseVal===void 0?u.className=y:u.className.baseVal=y}function Ca(u){return u.correspondingElement&&(u=u.correspondingElement),u.className.baseVal===void 0?u.className:u.className.baseVal}function Nr(u,y){"opacity"in u.style?u.style.opacity=y:"filter"in u.style&&Tu(u,y)}function Tu(u,y){var P=!1,z="DXImageTransform.Microsoft.Alpha";try{P=u.filters.item(z)}catch{if(y===1)return}y=Math.round(y*100),P?(P.Enabled=y!==100,P.Opacity=y):u.style.filter+=" progid:"+z+"(opacity="+y+")"}function xl(u){for(var y=document.documentElement.style,P=0;P<u.length;P++)if(u[P]in y)return u[P];return!1}function zi(u,y,P){var z=y||new Ne(0,0);u.style[Fo]=(Fe.ie3d?"translate("+z.x+"px,"+z.y+"px)":"translate3d("+z.x+"px,"+z.y+"px,0)")+(P?" scale("+P+")":"")}function Yn(u,y){u._leaflet_pos=y,Fe.any3d?zi(u,y):(u.style.left=y.x+"px",u.style.top=y.y+"px")}function Vo(u){return u._leaflet_pos||new Ne(0,0)}var Gs,qs,bl;if("onselectstart"in document)Gs=function(){Dt(window,"selectstart",an)},qs=function(){en(window,"selectstart",an)};else{var Sr=xl(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Gs=function(){if(Sr){var u=document.documentElement.style;bl=u[Sr],u[Sr]="none"}},qs=function(){Sr&&(document.documentElement.style[Sr]=bl,bl=void 0)}}function sn(){Dt(window,"dragstart",an)}function _o(){en(window,"dragstart",an)}var Or,Ws;function Qt(u){for(;u.tabIndex===-1;)u=u.parentNode;u.style&&(yo(),Or=u,Ws=u.style.outlineStyle,u.style.outlineStyle="none",Dt(window,"keydown",yo))}function yo(){Or&&(Or.style.outlineStyle=Ws,Or=void 0,Ws=void 0,en(window,"keydown",yo))}function Ia(u){do u=u.parentNode;while((!u.offsetWidth||!u.offsetHeight)&&u!==document.body);return u}function vo(u){var y=u.getBoundingClientRect();return{x:y.width/u.offsetWidth||1,y:y.height/u.offsetHeight||1,boundingClientRect:y}}var Si={__proto__:null,TRANSFORM:Fo,TRANSITION:Cs,TRANSITION_END:oc,get:go,getStyle:Li,create:vn,remove:On,empty:vl,toFront:ss,toBack:Uo,hasClass:wu,addClass:rn,removeClass:or,setClass:ac,getClass:Ca,setOpacity:Nr,testProp:xl,setTransform:zi,setPosition:Yn,getPosition:Vo,get disableTextSelection(){return Gs},get enableTextSelection(){return qs},disableImageDrag:sn,enableImageDrag:_o,preventOutline:Qt,restoreOutline:yo,getSizedParentNode:Ia,getScale:vo};function Dt(u,y,P,z){if(y&&typeof y=="object")for(var F in y)$r(u,F,y[F],P);else{y=ce(y);for(var ne=0,Se=y.length;ne<Se;ne++)$r(u,y[ne],P,z)}return this}var kn="_leaflet_events";function en(u,y,P,z){if(arguments.length===1)Mn(u),delete u[kn];else if(y&&typeof y=="object")for(var F in y)ci(u,F,y[F],P);else if(y=ce(y),arguments.length===2)Mn(u,function(Be){return fe(y,Be)!==-1});else for(var ne=0,Se=y.length;ne<Se;ne++)ci(u,y[ne],P,z);return this}function Mn(u,y){for(var P in u[kn]){var z=P.split(/\d/)[0];(!y||y(z))&&ci(u,z,null,null,P)}}var xo={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function $r(u,y,P,z){var F=y+A(P)+(z?"_"+A(z):"");if(u[kn]&&u[kn][F])return this;var ne=function(Be){return P.call(z||u,Be||window.event)},Se=ne;!Fe.touchNative&&Fe.pointer&&y.indexOf("touch")===0?ne=Ps(u,y,ne):Fe.touch&&y==="dblclick"?ne=Ri(u,ne):"addEventListener"in u?y==="touchstart"||y==="touchmove"||y==="wheel"||y==="mousewheel"?u.addEventListener(xo[y]||y,ne,Fe.passiveEvents?{passive:!1}:!1):y==="mouseenter"||y==="mouseleave"?(ne=function(Be){Be=Be||window.event,jr(u,Be)&&Se(Be)},u.addEventListener(xo[y],ne,!1)):u.addEventListener(y,Se,!1):u.attachEvent("on"+y,ne),u[kn]=u[kn]||{},u[kn][F]=ne}function ci(u,y,P,z,F){F=F||y+A(P)+(z?"_"+A(z):"");var ne=u[kn]&&u[kn][F];if(!ne)return this;!Fe.touchNative&&Fe.pointer&&y.indexOf("touch")===0?Es(u,y,ne):Fe.touch&&y==="dblclick"?Nn(u,ne):"removeEventListener"in u?u.removeEventListener(xo[y]||y,ne,!1):u.detachEvent("on"+y,ne),u[kn][F]=null}function pr(u){return u.stopPropagation?u.stopPropagation():u.originalEvent?u.originalEvent._stopped=!0:u.cancelBubble=!0,this}function $o(u){return $r(u,"wheel",pr),this}function xn(u){return Dt(u,"mousedown touchstart dblclick contextmenu",pr),u._leaflet_disable_click=!0,this}function an(u){return u.preventDefault?u.preventDefault():u.returnValue=!1,this}function Kt(u){return an(u),pr(u),this}function $t(u){if(u.composedPath)return u.composedPath();for(var y=[],P=u.target;P;)y.push(P),P=P.parentNode;return y}function Zo(u,y){if(!y)return new Ne(u.clientX,u.clientY);var P=vo(y),z=P.boundingClientRect;return new Ne((u.clientX-z.left)/P.x-y.clientLeft,(u.clientY-z.top)/P.y-y.clientTop)}var Yt=Fe.linux&&Fe.chrome?window.devicePixelRatio:Fe.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function wl(u){return Fe.edge?u.wheelDeltaY/2:u.deltaY&&u.deltaMode===0?-u.deltaY/Yt:u.deltaY&&u.deltaMode===1?-u.deltaY*20:u.deltaY&&u.deltaMode===2?-u.deltaY*60:u.deltaX||u.deltaZ?0:u.wheelDelta?(u.wheelDeltaY||u.wheelDelta)/2:u.detail&&Math.abs(u.detail)<32765?-u.detail*20:u.detail?u.detail/-32765*60:0}function jr(u,y){var P=y.relatedTarget;if(!P)return!0;try{for(;P&&P!==u;)P=P.parentNode}catch{return!1}return P!==u}var Su={__proto__:null,on:Dt,off:en,stopPropagation:pr,disableScrollPropagation:$o,disableClickPropagation:xn,preventDefault:an,stop:Kt,getPropagationPath:$t,getMousePosition:Zo,getWheelDelta:wl,isExternalTarget:jr,addListener:Dt,removeListener:en},ka=jt.extend({run:function(u,y,P,z){this.stop(),this._el=u,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(z||.5,.2),this._startPos=Vo(u),this._offset=y.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=ht(this._animate,this),this._step()},_step:function(u){var y=+new Date-this._startTime,P=this._duration*1e3;y<P?this._runFrame(this._easeOut(y/P),u):(this._runFrame(1),this._complete())},_runFrame:function(u,y){var P=this._startPos.add(this._offset.multiplyBy(u));y&&P._round(),Yn(this._el,P),this.fire("step")},_complete:function(){ze(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(u){return 1-Math.pow(1-u,this._easeOutPower)}}),cn=jt.extend({options:{crs:In,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(u,y){y=ie(this,y),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(u),this._initLayout(),this._onResize=g(this._onResize,this),this._initEvents(),y.maxBounds&&this.setMaxBounds(y.maxBounds),y.zoom!==void 0&&(this._zoom=this._limitZoom(y.zoom)),y.center&&y.zoom!==void 0&&this.setView(Pt(y.center),y.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Cs&&Fe.any3d&&!Fe.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Dt(this._proxy,oc,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(u,y,P){if(y=y===void 0?this._zoom:this._limitZoom(y),u=this._limitCenter(Pt(u),y,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=f({animate:P.animate},P.zoom),P.pan=f({animate:P.animate,duration:P.duration},P.pan));var z=this._zoom!==y?this._tryAnimatedZoom&&this._tryAnimatedZoom(u,y,P.zoom):this._tryAnimatedPan(u,P.pan);if(z)return clearTimeout(this._sizeTimer),this}return this._resetView(u,y,P.pan&&P.pan.noMoveStart),this},setZoom:function(u,y){return this._loaded?this.setView(this.getCenter(),u,{zoom:y}):(this._zoom=u,this)},zoomIn:function(u,y){return u=u||(Fe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+u,y)},zoomOut:function(u,y){return u=u||(Fe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-u,y)},setZoomAround:function(u,y,P){var z=this.getZoomScale(y),F=this.getSize().divideBy(2),ne=u instanceof Ne?u:this.latLngToContainerPoint(u),Se=ne.subtract(F).multiplyBy(1-1/z),Be=this.containerPointToLatLng(F.add(Se));return this.setView(Be,y,{zoom:P})},_getBoundsCenterZoom:function(u,y){y=y||{},u=u.getBounds?u.getBounds():Ft(u);var P=We(y.paddingTopLeft||y.padding||[0,0]),z=We(y.paddingBottomRight||y.padding||[0,0]),F=this.getBoundsZoom(u,!1,P.add(z));if(F=typeof y.maxZoom=="number"?Math.min(y.maxZoom,F):F,F===1/0)return{center:u.getCenter(),zoom:F};var ne=z.subtract(P).divideBy(2),Se=this.project(u.getSouthWest(),F),Be=this.project(u.getNorthEast(),F),Ke=this.unproject(Se.add(Be).divideBy(2).add(ne),F);return{center:Ke,zoom:F}},fitBounds:function(u,y){if(u=Ft(u),!u.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(u,y);return this.setView(P.center,P.zoom,y)},fitWorld:function(u){return this.fitBounds([[-90,-180],[90,180]],u)},panTo:function(u,y){return this.setView(u,this._zoom,{pan:y})},panBy:function(u,y){if(u=We(u).round(),y=y||{},!u.x&&!u.y)return this.fire("moveend");if(y.animate!==!0&&!this.getSize().contains(u))return this._resetView(this.unproject(this.project(this.getCenter()).add(u)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ka,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),y.noMoveStart||this.fire("movestart"),y.animate!==!1){rn(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(u).round();this._panAnim.run(this._mapPane,P,y.duration||.25,y.easeLinearity)}else this._rawPanBy(u),this.fire("move").fire("moveend");return this},flyTo:function(u,y,P){if(P=P||{},P.animate===!1||!Fe.any3d)return this.setView(u,y,P);this._stop();var z=this.project(this.getCenter()),F=this.project(u),ne=this.getSize(),Se=this._zoom;u=Pt(u),y=y===void 0?Se:y;var Be=Math.max(ne.x,ne.y),Ke=Be*this.getZoomScale(Se,y),it=F.distanceTo(z)||1,Tt=1.42,Zt=Tt*Tt;function ln(Jn){var na=Jn?-1:1,Ru=Jn?Ke:Be,ra=Ke*Ke-Be*Be+na*Zt*Zt*it*it,Ha=2*Ru*Zt*it,ia=ra/Ha,Al=Math.sqrt(ia*ia+1)-ia,Lu=Al<1e-9?-18:Math.log(Al);return Lu}function Pr(Jn){return(Math.exp(Jn)-Math.exp(-Jn))/2}function ar(Jn){return(Math.exp(Jn)+Math.exp(-Jn))/2}function hi(Jn){return Pr(Jn)/ar(Jn)}var Zr=ln(0);function cs(Jn){return Be*(ar(Zr)/ar(Zr+Tt*Jn))}function Ml(Jn){return Be*(ar(Zr)*hi(Zr+Tt*Jn)-Pr(Zr))/Zt}function bc(Jn){return 1-Math.pow(1-Jn,1.5)}var Bh=Date.now(),Gn=(ln(1)-Zr)/Tt,ta=P.duration?1e3*P.duration:1e3*Gn*.8;function ji(){var Jn=(Date.now()-Bh)/ta,na=bc(Jn)*Gn;Jn<=1?(this._flyToFrame=ht(ji,this),this._move(this.unproject(z.add(F.subtract(z).multiplyBy(Ml(na)/it)),Se),this.getScaleZoom(Be/cs(na),Se),{flyTo:!0})):this._move(u,y)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),ji.call(this),this},flyToBounds:function(u,y){var P=this._getBoundsCenterZoom(u,y);return this.flyTo(P.center,P.zoom,y)},setMaxBounds:function(u){return u=Ft(u),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),u.isValid()?(this.options.maxBounds=u,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(u){var y=this.options.minZoom;return this.options.minZoom=u,this._loaded&&y!==u&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(u):this},setMaxZoom:function(u){var y=this.options.maxZoom;return this.options.maxZoom=u,this._loaded&&y!==u&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(u):this},panInsideBounds:function(u,y){this._enforcingBounds=!0;var P=this.getCenter(),z=this._limitCenter(P,this._zoom,Ft(u));return P.equals(z)||this.panTo(z,y),this._enforcingBounds=!1,this},panInside:function(u,y){y=y||{};var P=We(y.paddingTopLeft||y.padding||[0,0]),z=We(y.paddingBottomRight||y.padding||[0,0]),F=this.project(this.getCenter()),ne=this.project(u),Se=this.getPixelBounds(),Be=_t([Se.min.add(P),Se.max.subtract(z)]),Ke=Be.getSize();if(!Be.contains(ne)){this._enforcingBounds=!0;var it=ne.subtract(Be.getCenter()),Tt=Be.extend(ne).getSize().subtract(Ke);F.x+=it.x<0?-Tt.x:Tt.x,F.y+=it.y<0?-Tt.y:Tt.y,this.panTo(this.unproject(F),y),this._enforcingBounds=!1}return this},invalidateSize:function(u){if(!this._loaded)return this;u=f({animate:!1,pan:!0},u===!0?{animate:!0}:u);var y=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),z=y.divideBy(2).round(),F=P.divideBy(2).round(),ne=z.subtract(F);return!ne.x&&!ne.y?this:(u.animate&&u.pan?this.panBy(ne):(u.pan&&this._rawPanBy(ne),this.fire("move"),u.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(g(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:y,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(u){if(u=this._locateOptions=f({timeout:1e4,watch:!1},u),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var y=g(this._handleGeolocationResponse,this),P=g(this._handleGeolocationError,this);return u.watch?this._locationWatchId=navigator.geolocation.watchPosition(y,P,u):navigator.geolocation.getCurrentPosition(y,P,u),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(u){if(this._container._leaflet_id){var y=u.code,P=u.message||(y===1?"permission denied":y===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:y,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(u){if(this._container._leaflet_id){var y=u.coords.latitude,P=u.coords.longitude,z=new Ut(y,P),F=z.toBounds(u.coords.accuracy*2),ne=this._locateOptions;if(ne.setView){var Se=this.getBoundsZoom(F);this.setView(z,ne.maxZoom?Math.min(Se,ne.maxZoom):Se)}var Be={latlng:z,bounds:F,timestamp:u.timestamp};for(var Ke in u.coords)typeof u.coords[Ke]=="number"&&(Be[Ke]=u.coords[Ke]);this.fire("locationfound",Be)}},addHandler:function(u,y){if(!y)return this;var P=this[u]=new y(this);return this._handlers.push(P),this.options[u]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),On(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ze(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var u;for(u in this._layers)this._layers[u].remove();for(u in this._panes)On(this._panes[u]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(u,y){var P="leaflet-pane"+(u?" leaflet-"+u.replace("Pane","")+"-pane":""),z=vn("div",P,y||this._mapPane);return u&&(this._panes[u]=z),z},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var u=this.getPixelBounds(),y=this.unproject(u.getBottomLeft()),P=this.unproject(u.getTopRight());return new Bt(y,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(u,y,P){u=Ft(u),P=We(P||[0,0]);var z=this.getZoom()||0,F=this.getMinZoom(),ne=this.getMaxZoom(),Se=u.getNorthWest(),Be=u.getSouthEast(),Ke=this.getSize().subtract(P),it=_t(this.project(Be,z),this.project(Se,z)).getSize(),Tt=Fe.any3d?this.options.zoomSnap:1,Zt=Ke.x/it.x,ln=Ke.y/it.y,Pr=y?Math.max(Zt,ln):Math.min(Zt,ln);return z=this.getScaleZoom(Pr,z),Tt&&(z=Math.round(z/(Tt/100))*(Tt/100),z=y?Math.ceil(z/Tt)*Tt:Math.floor(z/Tt)*Tt),Math.max(F,Math.min(ne,z))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Ne(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(u,y){var P=this._getTopLeftPoint(u,y);return new nt(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(u){return this.options.crs.getProjectedBounds(u===void 0?this.getZoom():u)},getPane:function(u){return typeof u=="string"?this._panes[u]:u},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(u,y){var P=this.options.crs;return y=y===void 0?this._zoom:y,P.scale(u)/P.scale(y)},getScaleZoom:function(u,y){var P=this.options.crs;y=y===void 0?this._zoom:y;var z=P.zoom(u*P.scale(y));return isNaN(z)?1/0:z},project:function(u,y){return y=y===void 0?this._zoom:y,this.options.crs.latLngToPoint(Pt(u),y)},unproject:function(u,y){return y=y===void 0?this._zoom:y,this.options.crs.pointToLatLng(We(u),y)},layerPointToLatLng:function(u){var y=We(u).add(this.getPixelOrigin());return this.unproject(y)},latLngToLayerPoint:function(u){var y=this.project(Pt(u))._round();return y._subtract(this.getPixelOrigin())},wrapLatLng:function(u){return this.options.crs.wrapLatLng(Pt(u))},wrapLatLngBounds:function(u){return this.options.crs.wrapLatLngBounds(Ft(u))},distance:function(u,y){return this.options.crs.distance(Pt(u),Pt(y))},containerPointToLayerPoint:function(u){return We(u).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(u){return We(u).add(this._getMapPanePos())},containerPointToLatLng:function(u){var y=this.containerPointToLayerPoint(We(u));return this.layerPointToLatLng(y)},latLngToContainerPoint:function(u){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Pt(u)))},mouseEventToContainerPoint:function(u){return Zo(u,this._container)},mouseEventToLayerPoint:function(u){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(u))},mouseEventToLatLng:function(u){return this.layerPointToLatLng(this.mouseEventToLayerPoint(u))},_initContainer:function(u){var y=this._container=go(u);if(y){if(y._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Dt(y,"scroll",this._onScroll,this),this._containerId=A(y)},_initLayout:function(){var u=this._container;this._fadeAnimated=this.options.fadeAnimation&&Fe.any3d,rn(u,"leaflet-container"+(Fe.touch?" leaflet-touch":"")+(Fe.retina?" leaflet-retina":"")+(Fe.ielt9?" leaflet-oldie":"")+(Fe.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var y=Li(u,"position");y!=="absolute"&&y!=="relative"&&y!=="fixed"&&y!=="sticky"&&(u.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var u=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Yn(this._mapPane,new Ne(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(rn(u.markerPane,"leaflet-zoom-hide"),rn(u.shadowPane,"leaflet-zoom-hide"))},_resetView:function(u,y,P){Yn(this._mapPane,new Ne(0,0));var z=!this._loaded;this._loaded=!0,y=this._limitZoom(y),this.fire("viewprereset");var F=this._zoom!==y;this._moveStart(F,P)._move(u,y)._moveEnd(F),this.fire("viewreset"),z&&this.fire("load")},_moveStart:function(u,y){return u&&this.fire("zoomstart"),y||this.fire("movestart"),this},_move:function(u,y,P,z){y===void 0&&(y=this._zoom);var F=this._zoom!==y;return this._zoom=y,this._lastCenter=u,this._pixelOrigin=this._getNewPixelOrigin(u),z?P&&P.pinch&&this.fire("zoom",P):((F||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(u){return u&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ze(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(u){Yn(this._mapPane,this._getMapPanePos().subtract(u))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(u){this._targets={},this._targets[A(this._container)]=this;var y=u?en:Dt;y(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&y(window,"resize",this._onResize,this),Fe.any3d&&this.options.transform3DLimit&&(u?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ze(this._resizeRequest),this._resizeRequest=ht(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var u=this._getMapPanePos();Math.max(Math.abs(u.x),Math.abs(u.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(u,y){for(var P=[],z,F=y==="mouseout"||y==="mouseover",ne=u.target||u.srcElement,Se=!1;ne;){if(z=this._targets[A(ne)],z&&(y==="click"||y==="preclick")&&this._draggableMoved(z)){Se=!0;break}if(z&&z.listens(y,!0)&&(F&&!jr(ne,u)||(P.push(z),F))||ne===this._container)break;ne=ne.parentNode}return!P.length&&!Se&&!F&&this.listens(y,!0)&&(P=[this]),P},_isClickDisabled:function(u){for(;u&&u!==this._container;){if(u._leaflet_disable_click)return!0;u=u.parentNode}},_handleDOMEvent:function(u){var y=u.target||u.srcElement;if(!(!this._loaded||y._leaflet_disable_events||u.type==="click"&&this._isClickDisabled(y))){var P=u.type;P==="mousedown"&&Qt(y),this._fireDOMEvent(u,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(u,y,P){if(u.type==="click"){var z=f({},u);z.type="preclick",this._fireDOMEvent(z,z.type,P)}var F=this._findEventTargets(u,y);if(P){for(var ne=[],Se=0;Se<P.length;Se++)P[Se].listens(y,!0)&&ne.push(P[Se]);F=ne.concat(F)}if(F.length){y==="contextmenu"&&an(u);var Be=F[0],Ke={originalEvent:u};if(u.type!=="keypress"&&u.type!=="keydown"&&u.type!=="keyup"){var it=Be.getLatLng&&(!Be._radius||Be._radius<=10);Ke.containerPoint=it?this.latLngToContainerPoint(Be.getLatLng()):this.mouseEventToContainerPoint(u),Ke.layerPoint=this.containerPointToLayerPoint(Ke.containerPoint),Ke.latlng=it?Be.getLatLng():this.layerPointToLatLng(Ke.layerPoint)}for(Se=0;Se<F.length;Se++)if(F[Se].fire(y,Ke,!0),Ke.originalEvent._stopped||F[Se].options.bubblingMouseEvents===!1&&fe(this._mouseEvents,y)!==-1)return}},_draggableMoved:function(u){return u=u.dragging&&u.dragging.enabled()?u:this,u.dragging&&u.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var u=0,y=this._handlers.length;u<y;u++)this._handlers[u].disable()},whenReady:function(u,y){return this._loaded?u.call(y||this,{target:this}):this.on("load",u,y),this},_getMapPanePos:function(){return Vo(this._mapPane)||new Ne(0,0)},_moved:function(){var u=this._getMapPanePos();return u&&!u.equals([0,0])},_getTopLeftPoint:function(u,y){var P=u&&y!==void 0?this._getNewPixelOrigin(u,y):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(u,y){var P=this.getSize()._divideBy(2);return this.project(u,y)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(u,y,P){var z=this._getNewPixelOrigin(P,y);return this.project(u,y)._subtract(z)},_latLngBoundsToNewLayerBounds:function(u,y,P){var z=this._getNewPixelOrigin(P,y);return _t([this.project(u.getSouthWest(),y)._subtract(z),this.project(u.getNorthWest(),y)._subtract(z),this.project(u.getSouthEast(),y)._subtract(z),this.project(u.getNorthEast(),y)._subtract(z)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(u){return this.latLngToLayerPoint(u).subtract(this._getCenterLayerPoint())},_limitCenter:function(u,y,P){if(!P)return u;var z=this.project(u,y),F=this.getSize().divideBy(2),ne=new nt(z.subtract(F),z.add(F)),Se=this._getBoundsOffset(ne,P,y);return Math.abs(Se.x)<=1&&Math.abs(Se.y)<=1?u:this.unproject(z.add(Se),y)},_limitOffset:function(u,y){if(!y)return u;var P=this.getPixelBounds(),z=new nt(P.min.add(u),P.max.add(u));return u.add(this._getBoundsOffset(z,y))},_getBoundsOffset:function(u,y,P){var z=_t(this.project(y.getNorthEast(),P),this.project(y.getSouthWest(),P)),F=z.min.subtract(u.min),ne=z.max.subtract(u.max),Se=this._rebound(F.x,-ne.x),Be=this._rebound(F.y,-ne.y);return new Ne(Se,Be)},_rebound:function(u,y){return u+y>0?Math.round(u-y)/2:Math.max(0,Math.ceil(u))-Math.max(0,Math.floor(y))},_limitZoom:function(u){var y=this.getMinZoom(),P=this.getMaxZoom(),z=Fe.any3d?this.options.zoomSnap:1;return z&&(u=Math.round(u/z)*z),Math.max(y,Math.min(P,u))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){or(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(u,y){var P=this._getCenterOffset(u)._trunc();return(y&&y.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,y),!0)},_createAnimProxy:function(){var u=this._proxy=vn("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(u),this.on("zoomanim",function(y){var P=Fo,z=this._proxy.style[P];zi(this._proxy,this.project(y.center,y.zoom),this.getZoomScale(y.zoom,1)),z===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){On(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var u=this.getCenter(),y=this.getZoom();zi(this._proxy,this.project(u,y),this.getZoomScale(y,1))},_catchTransitionEnd:function(u){this._animatingZoom&&u.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(u,y,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(y-this._zoom)>this.options.zoomAnimationThreshold)return!1;var z=this.getZoomScale(y),F=this._getCenterOffset(u)._divideBy(1-1/z);return P.animate!==!0&&!this.getSize().contains(F)?!1:(ht(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(u,y,!0)},this),!0)},_animateZoom:function(u,y,P,z){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=u,this._animateToZoom=y,rn(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:u,zoom:y,noUpdate:z}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(g(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&or(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ma(u,y){return new cn(u,y)}var ui=at.extend({options:{position:"topright"},initialize:function(u){ie(this,u)},getPosition:function(){return this.options.position},setPosition:function(u){var y=this._map;return y&&y.removeControl(this),this.options.position=u,y&&y.addControl(this),this},getContainer:function(){return this._container},addTo:function(u){this.remove(),this._map=u;var y=this._container=this.onAdd(u),P=this.getPosition(),z=u._controlCorners[P];return rn(y,"leaflet-control"),P.indexOf("bottom")!==-1?z.insertBefore(y,z.firstChild):z.appendChild(y),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(On(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(u){this._map&&u&&u.screenX>0&&u.screenY>0&&this._map.getContainer().focus()}}),Go=function(u){return new ui(u)};cn.include({addControl:function(u){return u.addTo(this),this},removeControl:function(u){return u.remove(),this},_initControlPos:function(){var u=this._controlCorners={},y="leaflet-",P=this._controlContainer=vn("div",y+"control-container",this._container);function z(F,ne){var Se=y+F+" "+y+ne;u[F+ne]=vn("div",Se,P)}z("top","left"),z("top","right"),z("bottom","left"),z("bottom","right")},_clearControlPos:function(){for(var u in this._controlCorners)On(this._controlCorners[u]);On(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Tl=ui.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(u,y,P,z){return P<z?-1:z<P?1:0}},initialize:function(u,y,P){ie(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var z in u)this._addLayer(u[z],z);for(z in y)this._addLayer(y[z],z,!0)},onAdd:function(u){this._initLayout(),this._update(),this._map=u,u.on("zoomend",this._checkDisabledLayers,this);for(var y=0;y<this._layers.length;y++)this._layers[y].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(u){return ui.prototype.addTo.call(this,u),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var u=0;u<this._layers.length;u++)this._layers[u].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(u,y){return this._addLayer(u,y),this._map?this._update():this},addOverlay:function(u,y){return this._addLayer(u,y,!0),this._map?this._update():this},removeLayer:function(u){u.off("add remove",this._onLayerChange,this);var y=this._getLayer(A(u));return y&&this._layers.splice(this._layers.indexOf(y),1),this._map?this._update():this},expand:function(){rn(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var u=this._map.getSize().y-(this._container.offsetTop+50);return u<this._section.clientHeight?(rn(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=u+"px"):or(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return or(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var u="leaflet-control-layers",y=this._container=vn("div",u),P=this.options.collapsed;y.setAttribute("aria-haspopup",!0),xn(y),$o(y);var z=this._section=vn("section",u+"-list");P&&(this._map.on("click",this.collapse,this),Dt(y,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var F=this._layersLink=vn("a",u+"-toggle",y);F.href="#",F.title="Layers",F.setAttribute("role","button"),Dt(F,{keydown:function(ne){ne.keyCode===13&&this._expandSafely()},click:function(ne){an(ne),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=vn("div",u+"-base",z),this._separator=vn("div",u+"-separator",z),this._overlaysList=vn("div",u+"-overlays",z),y.appendChild(z)},_getLayer:function(u){for(var y=0;y<this._layers.length;y++)if(this._layers[y]&&A(this._layers[y].layer)===u)return this._layers[y]},_addLayer:function(u,y,P){this._map&&u.on("add remove",this._onLayerChange,this),this._layers.push({layer:u,name:y,overlay:P}),this.options.sortLayers&&this._layers.sort(g(function(z,F){return this.options.sortFunction(z.layer,F.layer,z.name,F.name)},this)),this.options.autoZIndex&&u.setZIndex&&(this._lastZIndex++,u.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;vl(this._baseLayersList),vl(this._overlaysList),this._layerControlInputs=[];var u,y,P,z,F=0;for(P=0;P<this._layers.length;P++)z=this._layers[P],this._addItem(z),y=y||z.overlay,u=u||!z.overlay,F+=z.overlay?0:1;return this.options.hideSingleBase&&(u=u&&F>1,this._baseLayersList.style.display=u?"":"none"),this._separator.style.display=y&&u?"":"none",this},_onLayerChange:function(u){this._handlingClick||this._update();var y=this._getLayer(A(u.target)),P=y.overlay?u.type==="add"?"overlayadd":"overlayremove":u.type==="add"?"baselayerchange":null;P&&this._map.fire(P,y)},_createRadioElement:function(u,y){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+u+'"'+(y?' checked="checked"':"")+"/>",z=document.createElement("div");return z.innerHTML=P,z.firstChild},_addItem:function(u){var y=document.createElement("label"),P=this._map.hasLayer(u.layer),z;u.overlay?(z=document.createElement("input"),z.type="checkbox",z.className="leaflet-control-layers-selector",z.defaultChecked=P):z=this._createRadioElement("leaflet-base-layers_"+A(this),P),this._layerControlInputs.push(z),z.layerId=A(u.layer),Dt(z,"click",this._onInputClick,this);var F=document.createElement("span");F.innerHTML=" "+u.name;var ne=document.createElement("span");y.appendChild(ne),ne.appendChild(z),ne.appendChild(F);var Se=u.overlay?this._overlaysList:this._baseLayersList;return Se.appendChild(y),this._checkDisabledLayers(),y},_onInputClick:function(){if(!this._preventClick){var u=this._layerControlInputs,y,P,z=[],F=[];this._handlingClick=!0;for(var ne=u.length-1;ne>=0;ne--)y=u[ne],P=this._getLayer(y.layerId).layer,y.checked?z.push(P):y.checked||F.push(P);for(ne=0;ne<F.length;ne++)this._map.hasLayer(F[ne])&&this._map.removeLayer(F[ne]);for(ne=0;ne<z.length;ne++)this._map.hasLayer(z[ne])||this._map.addLayer(z[ne]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var u=this._layerControlInputs,y,P,z=this._map.getZoom(),F=u.length-1;F>=0;F--)y=u[F],P=this._getLayer(y.layerId).layer,y.disabled=P.options.minZoom!==void 0&&z<P.options.minZoom||P.options.maxZoom!==void 0&&z>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var u=this._section;this._preventClick=!0,Dt(u,"click",an),this.expand();var y=this;setTimeout(function(){en(u,"click",an),y._preventClick=!1})}}),Sl=function(u,y,P){return new Tl(u,y,P)},qi=ui.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(u){var y="leaflet-control-zoom",P=vn("div",y+" leaflet-bar"),z=this.options;return this._zoomInButton=this._createButton(z.zoomInText,z.zoomInTitle,y+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(z.zoomOutText,z.zoomOutTitle,y+"-out",P,this._zoomOut),this._updateDisabled(),u.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(u){u.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(u){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(u.shiftKey?3:1))},_zoomOut:function(u){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(u.shiftKey?3:1))},_createButton:function(u,y,P,z,F){var ne=vn("a",P,z);return ne.innerHTML=u,ne.href="#",ne.title=y,ne.setAttribute("role","button"),ne.setAttribute("aria-label",y),xn(ne),Dt(ne,"click",Kt),Dt(ne,"click",F,this),Dt(ne,"click",this._refocusOnMap,this),ne},_updateDisabled:function(){var u=this._map,y="leaflet-disabled";or(this._zoomInButton,y),or(this._zoomOutButton,y),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||u._zoom===u.getMinZoom())&&(rn(this._zoomOutButton,y),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||u._zoom===u.getMaxZoom())&&(rn(this._zoomInButton,y),this._zoomInButton.setAttribute("aria-disabled","true"))}});cn.mergeOptions({zoomControl:!0}),cn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new qi,this.addControl(this.zoomControl))});var Br=function(u){return new qi(u)},bo=ui.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(u){var y="leaflet-control-scale",P=vn("div",y),z=this.options;return this._addScales(z,y+"-line",P),u.on(z.updateWhenIdle?"moveend":"move",this._update,this),u.whenReady(this._update,this),P},onRemove:function(u){u.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(u,y,P){u.metric&&(this._mScale=vn("div",y,P)),u.imperial&&(this._iScale=vn("div",y,P))},_update:function(){var u=this._map,y=u.getSize().y/2,P=u.distance(u.containerPointToLatLng([0,y]),u.containerPointToLatLng([this.options.maxWidth,y]));this._updateScales(P)},_updateScales:function(u){this.options.metric&&u&&this._updateMetric(u),this.options.imperial&&u&&this._updateImperial(u)},_updateMetric:function(u){var y=this._getRoundNum(u),P=y<1e3?y+" m":y/1e3+" km";this._updateScale(this._mScale,P,y/u)},_updateImperial:function(u){var y=u*3.2808399,P,z,F;y>5280?(P=y/5280,z=this._getRoundNum(P),this._updateScale(this._iScale,z+" mi",z/P)):(F=this._getRoundNum(y),this._updateScale(this._iScale,F+" ft",F/y))},_updateScale:function(u,y,P){u.style.width=Math.round(this.options.maxWidth*P)+"px",u.innerHTML=y},_getRoundNum:function(u){var y=Math.pow(10,(Math.floor(u)+"").length-1),P=u/y;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,y*P}}),Pl=function(u){return new bo(u)},wo='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',mr=ui.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Fe.inlineSvg?wo+" ":"")+"Leaflet</a>"},initialize:function(u){ie(this,u),this._attributions={}},onAdd:function(u){u.attributionControl=this,this._container=vn("div","leaflet-control-attribution"),xn(this._container);for(var y in u._layers)u._layers[y].getAttribution&&this.addAttribution(u._layers[y].getAttribution());return this._update(),u.on("layeradd",this._addAttribution,this),this._container},onRemove:function(u){u.off("layeradd",this._addAttribution,this)},_addAttribution:function(u){u.layer.getAttribution&&(this.addAttribution(u.layer.getAttribution()),u.layer.once("remove",function(){this.removeAttribution(u.layer.getAttribution())},this))},setPrefix:function(u){return this.options.prefix=u,this._update(),this},addAttribution:function(u){return u?(this._attributions[u]||(this._attributions[u]=0),this._attributions[u]++,this._update(),this):this},removeAttribution:function(u){return u?(this._attributions[u]&&(this._attributions[u]--,this._update()),this):this},_update:function(){if(this._map){var u=[];for(var y in this._attributions)this._attributions[y]&&u.push(y);var P=[];this.options.prefix&&P.push(this.options.prefix),u.length&&P.push(u.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});cn.mergeOptions({attributionControl:!0}),cn.addInitHook(function(){this.options.attributionControl&&new mr().addTo(this)});var lc=function(u){return new mr(u)};ui.Layers=Tl,ui.Zoom=qi,ui.Scale=bo,ui.Attribution=mr,Go.layers=Sl,Go.zoom=Br,Go.scale=Pl,Go.attribution=lc;var Di=at.extend({initialize:function(u){this._map=u},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Di.addTo=function(u,y){return u.addHandler(y,this),this};var bh={Events:wt},wh=Fe.touch?"touchstart mousedown":"mousedown",zn=jt.extend({options:{clickTolerance:3},initialize:function(u,y,P,z){ie(this,z),this._element=u,this._dragStartTarget=y||u,this._preventOutline=P},enable:function(){this._enabled||(Dt(this._dragStartTarget,wh,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(zn._dragging===this&&this.finishDrag(!0),en(this._dragStartTarget,wh,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(u){if(this._enabled&&(this._moved=!1,!wu(this._element,"leaflet-zoom-anim"))){if(u.touches&&u.touches.length!==1){zn._dragging===this&&this.finishDrag();return}if(!(zn._dragging||u.shiftKey||u.which!==1&&u.button!==1&&!u.touches)&&(zn._dragging=this,this._preventOutline&&Qt(this._element),sn(),Gs(),!this._moving)){this.fire("down");var y=u.touches?u.touches[0]:u,P=Ia(this._element);this._startPoint=new Ne(y.clientX,y.clientY),this._startPos=Vo(this._element),this._parentScale=vo(P);var z=u.type==="mousedown";Dt(document,z?"mousemove":"touchmove",this._onMove,this),Dt(document,z?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(u){if(this._enabled){if(u.touches&&u.touches.length>1){this._moved=!0;return}var y=u.touches&&u.touches.length===1?u.touches[0]:u,P=new Ne(y.clientX,y.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,an(u),this._moved||(this.fire("dragstart"),this._moved=!0,rn(document.body,"leaflet-dragging"),this._lastTarget=u.target||u.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),rn(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=u,this._updatePosition())}},_updatePosition:function(){var u={originalEvent:this._lastEvent};this.fire("predrag",u),Yn(this._element,this._newPos),this.fire("drag",u)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(u){or(document.body,"leaflet-dragging"),this._lastTarget&&(or(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),en(document,"mousemove touchmove",this._onMove,this),en(document,"mouseup touchend touchcancel",this._onUp,this),_o(),qs();var y=this._moved&&this._moving;this._moving=!1,zn._dragging=!1,y&&this.fire("dragend",{noInertia:u,distance:this._newPos.distanceTo(this._startPos)})}});function qo(u,y,P){var z,F=[1,4,2,8],ne,Se,Be,Ke,it,Tt,Zt,ln;for(ne=0,Tt=u.length;ne<Tt;ne++)u[ne]._code=Hs(u[ne],y);for(Be=0;Be<4;Be++){for(Zt=F[Be],z=[],ne=0,Tt=u.length,Se=Tt-1;ne<Tt;Se=ne++)Ke=u[ne],it=u[Se],Ke._code&Zt?it._code&Zt||(ln=Wo(it,Ke,Zt,y,P),ln._code=Hs(ln,y),z.push(ln)):(it._code&Zt&&(ln=Wo(it,Ke,Zt,y,P),ln._code=Hs(ln,y),z.push(ln)),z.push(Ke));u=z}return u}function Ni(u,y){var P,z,F,ne,Se,Be,Ke,it,Tt;if(!u||u.length===0)throw new Error("latlngs not passed");Pi(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var Zt=Pt([0,0]),ln=Ft(u),Pr=ln.getNorthWest().distanceTo(ln.getSouthWest())*ln.getNorthEast().distanceTo(ln.getNorthWest());Pr<1700&&(Zt=Aa(u));var ar=u.length,hi=[];for(P=0;P<ar;P++){var Zr=Pt(u[P]);hi.push(y.project(Pt([Zr.lat-Zt.lat,Zr.lng-Zt.lng])))}for(Be=Ke=it=0,P=0,z=ar-1;P<ar;z=P++)F=hi[P],ne=hi[z],Se=F.y*ne.x-ne.y*F.x,Ke+=(F.x+ne.x)*Se,it+=(F.y+ne.y)*Se,Be+=Se*3;Be===0?Tt=hi[0]:Tt=[Ke/Be,it/Be];var cs=y.unproject(We(Tt));return Pt([cs.lat+Zt.lat,cs.lng+Zt.lng])}function Aa(u){for(var y=0,P=0,z=0,F=0;F<u.length;F++){var ne=Pt(u[F]);y+=ne.lat,P+=ne.lng,z++}return Pt([y/z,P/z])}var Pu={__proto__:null,clipPolygon:qo,polygonCenter:Ni,centroid:Aa};function Ra(u,y){if(!y||!u.length)return u.slice();var P=y*y;return u=lf(u,P),u=Th(u,P),u}function Is(u,y,P){return Math.sqrt(ks(u,y,P,!0))}function os(u,y,P){return ks(u,y,P)}function Th(u,y){var P=u.length,z=typeof Uint8Array<"u"?Uint8Array:Array,F=new z(P);F[0]=F[P-1]=1,La(u,F,y,0,P-1);var ne,Se=[];for(ne=0;ne<P;ne++)F[ne]&&Se.push(u[ne]);return Se}function La(u,y,P,z,F){var ne=0,Se,Be,Ke;for(Be=z+1;Be<=F-1;Be++)Ke=ks(u[Be],u[z],u[F],!0),Ke>ne&&(Se=Be,ne=Ke);ne>P&&(y[Se]=1,La(u,y,P,z,Se),La(u,y,P,Se,F))}function lf(u,y){for(var P=[u[0]],z=1,F=0,ne=u.length;z<ne;z++)uc(u[z],u[F])>y&&(P.push(u[z]),F=z);return F<ne-1&&P.push(u[ne-1]),P}var cc;function Sh(u,y,P,z,F){var ne=z?cc:Hs(u,P),Se=Hs(y,P),Be,Ke,it;for(cc=Se;;){if(!(ne|Se))return[u,y];if(ne&Se)return!1;Be=ne||Se,Ke=Wo(u,y,Be,P,F),it=Hs(Ke,P),Be===ne?(u=Ke,ne=it):(y=Ke,Se=it)}}function Wo(u,y,P,z,F){var ne=y.x-u.x,Se=y.y-u.y,Be=z.min,Ke=z.max,it,Tt;return P&8?(it=u.x+ne*(Ke.y-u.y)/Se,Tt=Ke.y):P&4?(it=u.x+ne*(Be.y-u.y)/Se,Tt=Be.y):P&2?(it=Ke.x,Tt=u.y+Se*(Ke.x-u.x)/ne):P&1&&(it=Be.x,Tt=u.y+Se*(Be.x-u.x)/ne),new Ne(it,Tt,F)}function Hs(u,y){var P=0;return u.x<y.min.x?P|=1:u.x>y.max.x&&(P|=2),u.y<y.min.y?P|=4:u.y>y.max.y&&(P|=8),P}function uc(u,y){var P=y.x-u.x,z=y.y-u.y;return P*P+z*z}function ks(u,y,P,z){var F=y.x,ne=y.y,Se=P.x-F,Be=P.y-ne,Ke=Se*Se+Be*Be,it;return Ke>0&&(it=((u.x-F)*Se+(u.y-ne)*Be)/Ke,it>1?(F=P.x,ne=P.y):it>0&&(F+=Se*it,ne+=Be*it)),Se=u.x-F,Be=u.y-ne,z?Se*Se+Be*Be:new Ne(F,ne)}function Pi(u){return!te(u[0])||typeof u[0][0]!="object"&&typeof u[0][0]<"u"}function Wi(u){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Pi(u)}function Eu(u,y){var P,z,F,ne,Se,Be,Ke,it;if(!u||u.length===0)throw new Error("latlngs not passed");Pi(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var Tt=Pt([0,0]),Zt=Ft(u),ln=Zt.getNorthWest().distanceTo(Zt.getSouthWest())*Zt.getNorthEast().distanceTo(Zt.getNorthWest());ln<1700&&(Tt=Aa(u));var Pr=u.length,ar=[];for(P=0;P<Pr;P++){var hi=Pt(u[P]);ar.push(y.project(Pt([hi.lat-Tt.lat,hi.lng-Tt.lng])))}for(P=0,z=0;P<Pr-1;P++)z+=ar[P].distanceTo(ar[P+1])/2;if(z===0)it=ar[0];else for(P=0,ne=0;P<Pr-1;P++)if(Se=ar[P],Be=ar[P+1],F=Se.distanceTo(Be),ne+=F,ne>z){Ke=(ne-z)/F,it=[Be.x-Ke*(Be.x-Se.x),Be.y-Ke*(Be.y-Se.y)];break}var Zr=y.unproject(We(it));return Pt([Zr.lat+Tt.lat,Zr.lng+Tt.lng])}var Cu={__proto__:null,simplify:Ra,pointToSegmentDistance:Is,closestPointOnSegment:os,clipSegment:Sh,_getEdgeIntersection:Wo,_getBitCode:Hs,_sqClosestPointOnSegment:ks,isFlat:Pi,_flat:Wi,polylineCenter:Eu},To={project:function(u){return new Ne(u.lng,u.lat)},unproject:function(u){return new Ut(u.y,u.x)},bounds:new nt([-180,-90],[180,90])},Ho={R:6378137,R_MINOR:6356752314245179e-9,bounds:new nt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(u){var y=Math.PI/180,P=this.R,z=u.lat*y,F=this.R_MINOR/P,ne=Math.sqrt(1-F*F),Se=ne*Math.sin(z),Be=Math.tan(Math.PI/4-z/2)/Math.pow((1-Se)/(1+Se),ne/2);return z=-P*Math.log(Math.max(Be,1e-10)),new Ne(u.lng*y*P,z)},unproject:function(u){for(var y=180/Math.PI,P=this.R,z=this.R_MINOR/P,F=Math.sqrt(1-z*z),ne=Math.exp(-u.y/P),Se=Math.PI/2-2*Math.atan(ne),Be=0,Ke=.1,it;Be<15&&Math.abs(Ke)>1e-7;Be++)it=F*Math.sin(Se),it=Math.pow((1-it)/(1+it),F/2),Ke=Math.PI/2-2*Math.atan(ne*it)-Se,Se+=Ke;return new Ut(Se*y,u.x*y/P)}},cf={__proto__:null,LonLat:To,Mercator:Ho,SphericalMercator:ws},hc=f({},Vn,{code:"EPSG:3395",projection:Ho,transformation:function(){var u=.5/(Math.PI*Ho.R);return xr(u,.5,-u,.5)}()}),Ph=f({},Vn,{code:"EPSG:4326",projection:To,transformation:xr(1/180,1,-1/180,.5)}),za=f({},Un,{projection:To,transformation:xr(1,0,-1,0),scale:function(u){return Math.pow(2,u)},zoom:function(u){return Math.log(u)/Math.LN2},distance:function(u,y){var P=y.lng-u.lng,z=y.lat-u.lat;return Math.sqrt(P*P+z*z)},infinite:!0});Un.Earth=Vn,Un.EPSG3395=hc,Un.EPSG3857=In,Un.EPSG900913=$n,Un.EPSG4326=Ph,Un.Simple=za;var Hi=jt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(u){return u.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(u){return u&&u.removeLayer(this),this},getPane:function(u){return this._map.getPane(u?this.options[u]||u:this.options.pane)},addInteractiveTarget:function(u){return this._map._targets[A(u)]=this,this},removeInteractiveTarget:function(u){return delete this._map._targets[A(u)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(u){var y=u.target;if(y.hasLayer(this)){if(this._map=y,this._zoomAnimated=y._zoomAnimated,this.getEvents){var P=this.getEvents();y.on(P,this),this.once("remove",function(){y.off(P,this)},this)}this.onAdd(y),this.fire("add"),y.fire("layeradd",{layer:this})}}});cn.include({addLayer:function(u){if(!u._layerAdd)throw new Error("The provided object is not a Layer.");var y=A(u);return this._layers[y]?this:(this._layers[y]=u,u._mapToAdd=this,u.beforeAdd&&u.beforeAdd(this),this.whenReady(u._layerAdd,u),this)},removeLayer:function(u){var y=A(u);return this._layers[y]?(this._loaded&&u.onRemove(this),delete this._layers[y],this._loaded&&(this.fire("layerremove",{layer:u}),u.fire("remove")),u._map=u._mapToAdd=null,this):this},hasLayer:function(u){return A(u)in this._layers},eachLayer:function(u,y){for(var P in this._layers)u.call(y,this._layers[P]);return this},_addLayers:function(u){u=u?te(u)?u:[u]:[];for(var y=0,P=u.length;y<P;y++)this.addLayer(u[y])},_addZoomLimit:function(u){(!isNaN(u.options.maxZoom)||!isNaN(u.options.minZoom))&&(this._zoomBoundLayers[A(u)]=u,this._updateZoomLevels())},_removeZoomLimit:function(u){var y=A(u);this._zoomBoundLayers[y]&&(delete this._zoomBoundLayers[y],this._updateZoomLevels())},_updateZoomLevels:function(){var u=1/0,y=-1/0,P=this._getZoomSpan();for(var z in this._zoomBoundLayers){var F=this._zoomBoundLayers[z].options;u=F.minZoom===void 0?u:Math.min(u,F.minZoom),y=F.maxZoom===void 0?y:Math.max(y,F.maxZoom)}this._layersMaxZoom=y===-1/0?void 0:y,this._layersMinZoom=u===1/0?void 0:u,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var So=Hi.extend({initialize:function(u,y){ie(this,y),this._layers={};var P,z;if(u)for(P=0,z=u.length;P<z;P++)this.addLayer(u[P])},addLayer:function(u){var y=this.getLayerId(u);return this._layers[y]=u,this._map&&this._map.addLayer(u),this},removeLayer:function(u){var y=u in this._layers?u:this.getLayerId(u);return this._map&&this._layers[y]&&this._map.removeLayer(this._layers[y]),delete this._layers[y],this},hasLayer:function(u){var y=typeof u=="number"?u:this.getLayerId(u);return y in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(u){var y=Array.prototype.slice.call(arguments,1),P,z;for(P in this._layers)z=this._layers[P],z[u]&&z[u].apply(z,y);return this},onAdd:function(u){this.eachLayer(u.addLayer,u)},onRemove:function(u){this.eachLayer(u.removeLayer,u)},eachLayer:function(u,y){for(var P in this._layers)u.call(y,this._layers[P]);return this},getLayer:function(u){return this._layers[u]},getLayers:function(){var u=[];return this.eachLayer(u.push,u),u},setZIndex:function(u){return this.invoke("setZIndex",u)},getLayerId:function(u){return A(u)}}),Eh=function(u,y){return new So(u,y)},Ms=So.extend({addLayer:function(u){return this.hasLayer(u)?this:(u.addEventParent(this),So.prototype.addLayer.call(this,u),this.fire("layeradd",{layer:u}))},removeLayer:function(u){return this.hasLayer(u)?(u in this._layers&&(u=this._layers[u]),u.removeEventParent(this),So.prototype.removeLayer.call(this,u),this.fire("layerremove",{layer:u})):this},setStyle:function(u){return this.invoke("setStyle",u)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var u=new Bt;for(var y in this._layers){var P=this._layers[y];u.extend(P.getBounds?P.getBounds():P.getLatLng())}return u}}),Iu=function(u,y){return new Ms(u,y)},Ko=at.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(u){ie(this,u)},createIcon:function(u){return this._createIcon("icon",u)},createShadow:function(u){return this._createIcon("shadow",u)},_createIcon:function(u,y){var P=this._getIconUrl(u);if(!P){if(u==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var z=this._createImg(P,y&&y.tagName==="IMG"?y:null);return this._setIconStyles(z,u),(this.options.crossOrigin||this.options.crossOrigin==="")&&(z.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),z},_setIconStyles:function(u,y){var P=this.options,z=P[y+"Size"];typeof z=="number"&&(z=[z,z]);var F=We(z),ne=We(y==="shadow"&&P.shadowAnchor||P.iconAnchor||F&&F.divideBy(2,!0));u.className="leaflet-marker-"+y+" "+(P.className||""),ne&&(u.style.marginLeft=-ne.x+"px",u.style.marginTop=-ne.y+"px"),F&&(u.style.width=F.x+"px",u.style.height=F.y+"px")},_createImg:function(u,y){return y=y||document.createElement("img"),y.src=u,y},_getIconUrl:function(u){return Fe.retina&&this.options[u+"RetinaUrl"]||this.options[u+"Url"]}});function Ch(u){return new Ko(u)}var Ks=Ko.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(u){return typeof Ks.imagePath!="string"&&(Ks.imagePath=this._detectIconPath()),(this.options.imagePath||Ks.imagePath)+Ko.prototype._getIconUrl.call(this,u)},_stripUrl:function(u){var y=function(P,z,F){var ne=z.exec(P);return ne&&ne[F]};return u=y(u,/^url\((['"])?(.+)\1\)$/,2),u&&y(u,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var u=vn("div","leaflet-default-icon-path",document.body),y=Li(u,"background-image")||Li(u,"backgroundImage");if(document.body.removeChild(u),y=this._stripUrl(y),y)return y;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),ku=Di.extend({initialize:function(u){this._marker=u},addHooks:function(){var u=this._marker._icon;this._draggable||(this._draggable=new zn(u,u,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),rn(u,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&or(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(u){var y=this._marker,P=y._map,z=this._marker.options.autoPanSpeed,F=this._marker.options.autoPanPadding,ne=Vo(y._icon),Se=P.getPixelBounds(),Be=P.getPixelOrigin(),Ke=_t(Se.min._subtract(Be).add(F),Se.max._subtract(Be).subtract(F));if(!Ke.contains(ne)){var it=We((Math.max(Ke.max.x,ne.x)-Ke.max.x)/(Se.max.x-Ke.max.x)-(Math.min(Ke.min.x,ne.x)-Ke.min.x)/(Se.min.x-Ke.min.x),(Math.max(Ke.max.y,ne.y)-Ke.max.y)/(Se.max.y-Ke.max.y)-(Math.min(Ke.min.y,ne.y)-Ke.min.y)/(Se.min.y-Ke.min.y)).multiplyBy(z);P.panBy(it,{animate:!1}),this._draggable._newPos._add(it),this._draggable._startPos._add(it),Yn(y._icon,this._draggable._newPos),this._onDrag(u),this._panRequest=ht(this._adjustPan.bind(this,u))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(u){this._marker.options.autoPan&&(ze(this._panRequest),this._panRequest=ht(this._adjustPan.bind(this,u)))},_onDrag:function(u){var y=this._marker,P=y._shadow,z=Vo(y._icon),F=y._map.layerPointToLatLng(z);P&&Yn(P,z),y._latlng=F,u.latlng=F,u.oldLatLng=this._oldLatLng,y.fire("move",u).fire("drag",u)},_onDragEnd:function(u){ze(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",u)}}),As=Hi.extend({options:{icon:new Ks,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(u,y){ie(this,y),this._latlng=Pt(u)},onAdd:function(u){this._zoomAnimated=this._zoomAnimated&&u.options.markerZoomAnimation,this._zoomAnimated&&u.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(u){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&u.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(u){var y=this._latlng;return this._latlng=Pt(u),this.update(),this.fire("move",{oldLatLng:y,latlng:this._latlng})},setZIndexOffset:function(u){return this.options.zIndexOffset=u,this.update()},getIcon:function(){return this.options.icon},setIcon:function(u){return this.options.icon=u,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var u=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(u)}return this},_initIcon:function(){var u=this.options,y="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=u.icon.createIcon(this._icon),z=!1;P!==this._icon&&(this._icon&&this._removeIcon(),z=!0,u.title&&(P.title=u.title),P.tagName==="IMG"&&(P.alt=u.alt||"")),rn(P,y),u.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,u.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Dt(P,"focus",this._panOnFocus,this);var F=u.icon.createShadow(this._shadow),ne=!1;F!==this._shadow&&(this._removeShadow(),ne=!0),F&&(rn(F,y),F.alt=""),this._shadow=F,u.opacity<1&&this._updateOpacity(),z&&this.getPane().appendChild(this._icon),this._initInteraction(),F&&ne&&this.getPane(u.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&en(this._icon,"focus",this._panOnFocus,this),On(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&On(this._shadow),this._shadow=null},_setPos:function(u){this._icon&&Yn(this._icon,u),this._shadow&&Yn(this._shadow,u),this._zIndex=u.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(u){this._icon&&(this._icon.style.zIndex=this._zIndex+u)},_animateZoom:function(u){var y=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center).round();this._setPos(y)},_initInteraction:function(){if(this.options.interactive&&(rn(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ku)){var u=this.options.draggable;this.dragging&&(u=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ku(this),u&&this.dragging.enable()}},setOpacity:function(u){return this.options.opacity=u,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var u=this.options.opacity;this._icon&&Nr(this._icon,u),this._shadow&&Nr(this._shadow,u)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var u=this._map;if(u){var y=this.options.icon.options,P=y.iconSize?We(y.iconSize):We(0,0),z=y.iconAnchor?We(y.iconAnchor):We(0,0);u.panInside(this._latlng,{paddingTopLeft:z,paddingBottomRight:P.subtract(z)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Ih(u,y){return new As(u,y)}var Xs=Hi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(u){this._renderer=u.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(u){return ie(this,u),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&u&&Object.prototype.hasOwnProperty.call(u,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Rs=Xs.extend({options:{fill:!0,radius:10},initialize:function(u,y){ie(this,y),this._latlng=Pt(u),this._radius=this.options.radius},setLatLng:function(u){var y=this._latlng;return this._latlng=Pt(u),this.redraw(),this.fire("move",{oldLatLng:y,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(u){return this.options.radius=this._radius=u,this.redraw()},getRadius:function(){return this._radius},setStyle:function(u){var y=u&&u.radius||this._radius;return Xs.prototype.setStyle.call(this,u),this.setRadius(y),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var u=this._radius,y=this._radiusY||u,P=this._clickTolerance(),z=[u+P,y+P];this._pxBounds=new nt(this._point.subtract(z),this._point.add(z))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(u){return u.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function kh(u,y){return new Rs(u,y)}var Da=Rs.extend({initialize:function(u,y,P){if(typeof y=="number"&&(y=f({},P,{radius:y})),ie(this,y),this._latlng=Pt(u),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(u){return this._mRadius=u,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var u=[this._radius,this._radiusY||this._radius];return new Bt(this._map.layerPointToLatLng(this._point.subtract(u)),this._map.layerPointToLatLng(this._point.add(u)))},setStyle:Xs.prototype.setStyle,_project:function(){var u=this._latlng.lng,y=this._latlng.lat,P=this._map,z=P.options.crs;if(z.distance===Vn.distance){var F=Math.PI/180,ne=this._mRadius/Vn.R/F,Se=P.project([y+ne,u]),Be=P.project([y-ne,u]),Ke=Se.add(Be).divideBy(2),it=P.unproject(Ke).lat,Tt=Math.acos((Math.cos(ne*F)-Math.sin(y*F)*Math.sin(it*F))/(Math.cos(y*F)*Math.cos(it*F)))/F;(isNaN(Tt)||Tt===0)&&(Tt=ne/Math.cos(Math.PI/180*y)),this._point=Ke.subtract(P.getPixelOrigin()),this._radius=isNaN(Tt)?0:Ke.x-P.project([it,u-Tt]).x,this._radiusY=Ke.y-Se.y}else{var Zt=z.unproject(z.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(Zt).x}this._updateBounds()}});function uf(u,y,P){return new Da(u,y,P)}var Ls=Xs.extend({options:{smoothFactor:1,noClip:!1},initialize:function(u,y){ie(this,y),this._setLatLngs(u)},getLatLngs:function(){return this._latlngs},setLatLngs:function(u){return this._setLatLngs(u),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(u){for(var y=1/0,P=null,z=ks,F,ne,Se=0,Be=this._parts.length;Se<Be;Se++)for(var Ke=this._parts[Se],it=1,Tt=Ke.length;it<Tt;it++){F=Ke[it-1],ne=Ke[it];var Zt=z(u,F,ne,!0);Zt<y&&(y=Zt,P=z(u,F,ne))}return P&&(P.distance=Math.sqrt(y)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Eu(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(u,y){return y=y||this._defaultShape(),u=Pt(u),y.push(u),this._bounds.extend(u),this.redraw()},_setLatLngs:function(u){this._bounds=new Bt,this._latlngs=this._convertLatLngs(u)},_defaultShape:function(){return Pi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(u){for(var y=[],P=Pi(u),z=0,F=u.length;z<F;z++)P?(y[z]=Pt(u[z]),this._bounds.extend(y[z])):y[z]=this._convertLatLngs(u[z]);return y},_project:function(){var u=new nt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,u),this._bounds.isValid()&&u.isValid()&&(this._rawPxBounds=u,this._updateBounds())},_updateBounds:function(){var u=this._clickTolerance(),y=new Ne(u,u);this._rawPxBounds&&(this._pxBounds=new nt([this._rawPxBounds.min.subtract(y),this._rawPxBounds.max.add(y)]))},_projectLatlngs:function(u,y,P){var z=u[0]instanceof Ut,F=u.length,ne,Se;if(z){for(Se=[],ne=0;ne<F;ne++)Se[ne]=this._map.latLngToLayerPoint(u[ne]),P.extend(Se[ne]);y.push(Se)}else for(ne=0;ne<F;ne++)this._projectLatlngs(u[ne],y,P)},_clipPoints:function(){var u=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}var y=this._parts,P,z,F,ne,Se,Be,Ke;for(P=0,F=0,ne=this._rings.length;P<ne;P++)for(Ke=this._rings[P],z=0,Se=Ke.length;z<Se-1;z++)Be=Sh(Ke[z],Ke[z+1],u,z,!0),Be&&(y[F]=y[F]||[],y[F].push(Be[0]),(Be[1]!==Ke[z+1]||z===Se-2)&&(y[F].push(Be[1]),F++))}},_simplifyPoints:function(){for(var u=this._parts,y=this.options.smoothFactor,P=0,z=u.length;P<z;P++)u[P]=Ra(u[P],y)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(u,y){var P,z,F,ne,Se,Be,Ke=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(P=0,ne=this._parts.length;P<ne;P++)for(Be=this._parts[P],z=0,Se=Be.length,F=Se-1;z<Se;F=z++)if(!(!y&&z===0)&&Is(u,Be[F],Be[z])<=Ke)return!0;return!1}});function Mu(u,y){return new Ls(u,y)}Ls._flat=Wi;var Xo=Ls.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ni(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(u){var y=Ls.prototype._convertLatLngs.call(this,u),P=y.length;return P>=2&&y[0]instanceof Ut&&y[0].equals(y[P-1])&&y.pop(),y},_setLatLngs:function(u){Ls.prototype._setLatLngs.call(this,u),Pi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Pi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var u=this._renderer._bounds,y=this.options.weight,P=new Ne(y,y);if(u=new nt(u.min.subtract(P),u.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}for(var z=0,F=this._rings.length,ne;z<F;z++)ne=qo(this._rings[z],u,!0),ne.length&&this._parts.push(ne)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(u){var y=!1,P,z,F,ne,Se,Be,Ke,it;if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(ne=0,Ke=this._parts.length;ne<Ke;ne++)for(P=this._parts[ne],Se=0,it=P.length,Be=it-1;Se<it;Be=Se++)z=P[Se],F=P[Be],z.y>u.y!=F.y>u.y&&u.x<(F.x-z.x)*(u.y-z.y)/(F.y-z.y)+z.x&&(y=!y);return y||Ls.prototype._containsPoint.call(this,u,!0)}});function Mh(u,y){return new Xo(u,y)}var as=Ms.extend({initialize:function(u,y){ie(this,y),this._layers={},u&&this.addData(u)},addData:function(u){var y=te(u)?u:u.features,P,z,F;if(y){for(P=0,z=y.length;P<z;P++)F=y[P],(F.geometries||F.geometry||F.features||F.coordinates)&&this.addData(F);return this}var ne=this.options;if(ne.filter&&!ne.filter(u))return this;var Se=Na(u,ne);return Se?(Se.feature=ja(u),Se.defaultOptions=Se.options,this.resetStyle(Se),ne.onEachFeature&&ne.onEachFeature(u,Se),this.addLayer(Se)):this},resetStyle:function(u){return u===void 0?this.eachLayer(this.resetStyle,this):(u.options=f({},u.defaultOptions),this._setLayerStyle(u,this.options.style),this)},setStyle:function(u){return this.eachLayer(function(y){this._setLayerStyle(y,u)},this)},_setLayerStyle:function(u,y){u.setStyle&&(typeof y=="function"&&(y=y(u.feature)),u.setStyle(y))}});function Na(u,y){var P=u.type==="Feature"?u.geometry:u,z=P?P.coordinates:null,F=[],ne=y&&y.pointToLayer,Se=y&&y.coordsToLatLng||ls,Be,Ke,it,Tt;if(!z&&!P)return null;switch(P.type){case"Point":return Be=Se(z),El(ne,u,Be,y);case"MultiPoint":for(it=0,Tt=z.length;it<Tt;it++)Be=Se(z[it]),F.push(El(ne,u,Be,y));return new Ms(F);case"LineString":case"MultiLineString":return Ke=Oa(z,P.type==="LineString"?0:1,Se),new Ls(Ke,y);case"Polygon":case"MultiPolygon":return Ke=Oa(z,P.type==="Polygon"?1:2,Se),new Xo(Ke,y);case"GeometryCollection":for(it=0,Tt=P.geometries.length;it<Tt;it++){var Zt=Na({geometry:P.geometries[it],type:"Feature",properties:u.properties},y);Zt&&F.push(Zt)}return new Ms(F);case"FeatureCollection":for(it=0,Tt=P.features.length;it<Tt;it++){var ln=Na(P.features[it],y);ln&&F.push(ln)}return new Ms(F);default:throw new Error("Invalid GeoJSON object.")}}function El(u,y,P,z){return u?u(y,P):new As(P,z&&z.markersInheritOptions&&z)}function ls(u){return new Ut(u[1],u[0],u[2])}function Oa(u,y,P){for(var z=[],F=0,ne=u.length,Se;F<ne;F++)Se=y?Oa(u[F],y-1,P):(P||ls)(u[F]),z.push(Se);return z}function Cl(u,y){return u=Pt(u),u.alt!==void 0?[K(u.lng,y),K(u.lat,y),K(u.alt,y)]:[K(u.lng,y),K(u.lat,y)]}function dn(u,y,P,z){for(var F=[],ne=0,Se=u.length;ne<Se;ne++)F.push(y?dn(u[ne],Pi(u[ne])?0:y-1,P,z):Cl(u[ne],z));return!y&&P&&F.length>0&&F.push(F[0].slice()),F}function Yo(u,y){return u.feature?f({},u.feature,{geometry:y}):ja(y)}function ja(u){return u.type==="Feature"||u.type==="FeatureCollection"?u:{type:"Feature",properties:{},geometry:u}}var Ys={toGeoJSON:function(u){return Yo(this,{type:"Point",coordinates:Cl(this.getLatLng(),u)})}};As.include(Ys),Da.include(Ys),Rs.include(Ys),Ls.include({toGeoJSON:function(u){var y=!Pi(this._latlngs),P=dn(this._latlngs,y?1:0,!1,u);return Yo(this,{type:(y?"Multi":"")+"LineString",coordinates:P})}}),Xo.include({toGeoJSON:function(u){var y=!Pi(this._latlngs),P=y&&!Pi(this._latlngs[0]),z=dn(this._latlngs,P?2:y?1:0,!0,u);return y||(z=[z]),Yo(this,{type:(P?"Multi":"")+"Polygon",coordinates:z})}}),So.include({toMultiPoint:function(u){var y=[];return this.eachLayer(function(P){y.push(P.toGeoJSON(u).geometry.coordinates)}),Yo(this,{type:"MultiPoint",coordinates:y})},toGeoJSON:function(u){var y=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(y==="MultiPoint")return this.toMultiPoint(u);var P=y==="GeometryCollection",z=[];return this.eachLayer(function(F){if(F.toGeoJSON){var ne=F.toGeoJSON(u);if(P)z.push(ne.geometry);else{var Se=ja(ne);Se.type==="FeatureCollection"?z.push.apply(z,Se.features):z.push(Se)}}}),P?Yo(this,{geometries:z,type:"GeometryCollection"}):{type:"FeatureCollection",features:z}}});function dc(u,y){return new as(u,y)}var hf=dc,fc=Hi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(u,y,P){this._url=u,this._bounds=Ft(y),ie(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(rn(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){On(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(u){return this.options.opacity=u,this._image&&this._updateOpacity(),this},setStyle:function(u){return u.opacity&&this.setOpacity(u.opacity),this},bringToFront:function(){return this._map&&ss(this._image),this},bringToBack:function(){return this._map&&Uo(this._image),this},setUrl:function(u){return this._url=u,this._image&&(this._image.src=u),this},setBounds:function(u){return this._bounds=Ft(u),this._map&&this._reset(),this},getEvents:function(){var u={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var u=this._url.tagName==="IMG",y=this._image=u?this._url:vn("img");if(rn(y,"leaflet-image-layer"),this._zoomAnimated&&rn(y,"leaflet-zoom-animated"),this.options.className&&rn(y,this.options.className),y.onselectstart=W,y.onmousemove=W,y.onload=g(this.fire,this,"load"),y.onerror=g(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),u){this._url=y.src;return}y.src=this._url,y.alt=this.options.alt},_animateZoom:function(u){var y=this._map.getZoomScale(u.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,u.zoom,u.center).min;zi(this._image,P,y)},_reset:function(){var u=this._image,y=new nt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=y.getSize();Yn(u,y.min),u.style.width=P.x+"px",u.style.height=P.y+"px"},_updateOpacity:function(){Nr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var u=this.options.errorOverlayUrl;u&&this._url!==u&&(this._url=u,this._image.src=u)},getCenter:function(){return this._bounds.getCenter()}}),df=function(u,y,P){return new fc(u,y,P)},Ah=fc.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var u=this._url.tagName==="VIDEO",y=this._image=u?this._url:vn("video");if(rn(y,"leaflet-image-layer"),this._zoomAnimated&&rn(y,"leaflet-zoom-animated"),this.options.className&&rn(y,this.options.className),y.onselectstart=W,y.onmousemove=W,y.onloadeddata=g(this.fire,this,"load"),u){for(var P=y.getElementsByTagName("source"),z=[],F=0;F<P.length;F++)z.push(P[F].src);this._url=P.length>0?z:[y.src];return}te(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(y.style,"objectFit")&&(y.style.objectFit="fill"),y.autoplay=!!this.options.autoplay,y.loop=!!this.options.loop,y.muted=!!this.options.muted,y.playsInline=!!this.options.playsInline;for(var ne=0;ne<this._url.length;ne++){var Se=vn("source");Se.src=this._url[ne],y.appendChild(Se)}}});function Rh(u,y,P){return new Ah(u,y,P)}var Lh=fc.extend({_initImage:function(){var u=this._image=this._url;rn(u,"leaflet-image-layer"),this._zoomAnimated&&rn(u,"leaflet-zoom-animated"),this.options.className&&rn(u,this.options.className),u.onselectstart=W,u.onmousemove=W}});function zh(u,y,P){return new Lh(u,y,P)}var Oi=Hi.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(u,y){u&&(u instanceof Ut||te(u))?(this._latlng=Pt(u),ie(this,y)):(ie(this,u),this._source=y),this.options.content&&(this._content=this.options.content)},openOn:function(u){return u=arguments.length?u:this._source._map,u.hasLayer(this)||u.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(u){return this._map?this.close():(arguments.length?this._source=u:u=this._source,this._prepareOpen(),this.openOn(u._map)),this},onAdd:function(u){this._zoomAnimated=u._zoomAnimated,this._container||this._initLayout(),u._fadeAnimated&&Nr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),u._fadeAnimated&&Nr(this._container,1),this.bringToFront(),this.options.interactive&&(rn(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(u){u._fadeAnimated?(Nr(this._container,0),this._removeTimeout=setTimeout(g(On,void 0,this._container),200)):On(this._container),this.options.interactive&&(or(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(u){return this._latlng=Pt(u),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(u){return this._content=u,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var u={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ss(this._container),this},bringToBack:function(){return this._map&&Uo(this._container),this},_prepareOpen:function(u){var y=this._source;if(!y._map)return!1;if(y instanceof Ms){y=null;var P=this._source._layers;for(var z in P)if(P[z]._map){y=P[z];break}if(!y)return!1;this._source=y}if(!u)if(y.getCenter)u=y.getCenter();else if(y.getLatLng)u=y.getLatLng();else if(y.getBounds)u=y.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(u),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var u=this._contentNode,y=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof y=="string")u.innerHTML=y;else{for(;u.hasChildNodes();)u.removeChild(u.firstChild);u.appendChild(y)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var u=this._map.latLngToLayerPoint(this._latlng),y=We(this.options.offset),P=this._getAnchor();this._zoomAnimated?Yn(this._container,u.add(P)):y=y.add(u).add(P);var z=this._containerBottom=-y.y,F=this._containerLeft=-Math.round(this._containerWidth/2)+y.x;this._container.style.bottom=z+"px",this._container.style.left=F+"px"}},_getAnchor:function(){return[0,0]}});cn.include({_initOverlay:function(u,y,P,z){var F=y;return F instanceof u||(F=new u(z).setContent(y)),P&&F.setLatLng(P),F}}),Hi.include({_initOverlay:function(u,y,P,z){var F=P;return F instanceof u?(ie(F,z),F._source=this):(F=y&&!z?y:new u(z,this),F.setContent(P)),F}});var Jo=Oi.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(u){return u=arguments.length?u:this._source._map,!u.hasLayer(this)&&u._popup&&u._popup.options.autoClose&&u.removeLayer(u._popup),u._popup=this,Oi.prototype.openOn.call(this,u)},onAdd:function(u){Oi.prototype.onAdd.call(this,u),u.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Xs||this._source.on("preclick",pr))},onRemove:function(u){Oi.prototype.onRemove.call(this,u),u.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Xs||this._source.off("preclick",pr))},getEvents:function(){var u=Oi.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(u.preclick=this.close),this.options.keepInView&&(u.moveend=this._adjustPan),u},_initLayout:function(){var u="leaflet-popup",y=this._container=vn("div",u+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=vn("div",u+"-content-wrapper",y);if(this._contentNode=vn("div",u+"-content",P),xn(y),$o(this._contentNode),Dt(y,"contextmenu",pr),this._tipContainer=vn("div",u+"-tip-container",y),this._tip=vn("div",u+"-tip",this._tipContainer),this.options.closeButton){var z=this._closeButton=vn("a",u+"-close-button",y);z.setAttribute("role","button"),z.setAttribute("aria-label","Close popup"),z.href="#close",z.innerHTML='<span aria-hidden="true">&#215;</span>',Dt(z,"click",function(F){an(F),this.close()},this)}},_updateLayout:function(){var u=this._contentNode,y=u.style;y.width="",y.whiteSpace="nowrap";var P=u.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),y.width=P+1+"px",y.whiteSpace="",y.height="";var z=u.offsetHeight,F=this.options.maxHeight,ne="leaflet-popup-scrolled";F&&z>F?(y.height=F+"px",rn(u,ne)):or(u,ne),this._containerWidth=this._container.offsetWidth},_animateZoom:function(u){var y=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center),P=this._getAnchor();Yn(this._container,y.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var u=this._map,y=parseInt(Li(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+y,z=this._containerWidth,F=new Ne(this._containerLeft,-P-this._containerBottom);F._add(Vo(this._container));var ne=u.layerPointToContainerPoint(F),Se=We(this.options.autoPanPadding),Be=We(this.options.autoPanPaddingTopLeft||Se),Ke=We(this.options.autoPanPaddingBottomRight||Se),it=u.getSize(),Tt=0,Zt=0;ne.x+z+Ke.x>it.x&&(Tt=ne.x+z-it.x+Ke.x),ne.x-Tt-Be.x<0&&(Tt=ne.x-Be.x),ne.y+P+Ke.y>it.y&&(Zt=ne.y+P-it.y+Ke.y),ne.y-Zt-Be.y<0&&(Zt=ne.y-Be.y),(Tt||Zt)&&(this.options.keepInView&&(this._autopanning=!0),u.fire("autopanstart").panBy([Tt,Zt]))}},_getAnchor:function(){return We(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),pc=function(u,y){return new Jo(u,y)};cn.mergeOptions({closePopupOnClick:!0}),cn.include({openPopup:function(u,y,P){return this._initOverlay(Jo,u,y,P).openOn(this),this},closePopup:function(u){return u=arguments.length?u:this._popup,u&&u.close(),this}}),Hi.include({bindPopup:function(u,y){return this._popup=this._initOverlay(Jo,this._popup,u,y),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(u){return this._popup&&(this instanceof Ms||(this._popup._source=this),this._popup._prepareOpen(u||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(u){return this._popup&&this._popup.setContent(u),this},getPopup:function(){return this._popup},_openPopup:function(u){if(!(!this._popup||!this._map)){Kt(u);var y=u.layer||u.target;if(this._popup._source===y&&!(y instanceof Xs)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(u.latlng);return}this._popup._source=y,this.openPopup(u.latlng)}},_movePopup:function(u){this._popup.setLatLng(u.latlng)},_onKeyPress:function(u){u.originalEvent.keyCode===13&&this._openPopup(u)}});var Ba=Oi.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(u){Oi.prototype.onAdd.call(this,u),this.setOpacity(this.options.opacity),u.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(u){Oi.prototype.onRemove.call(this,u),u.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var u=Oi.prototype.getEvents.call(this);return this.options.permanent||(u.preclick=this.close),u},_initLayout:function(){var u="leaflet-tooltip",y=u+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=vn("div",y),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+A(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(u){var y,P,z=this._map,F=this._container,ne=z.latLngToContainerPoint(z.getCenter()),Se=z.layerPointToContainerPoint(u),Be=this.options.direction,Ke=F.offsetWidth,it=F.offsetHeight,Tt=We(this.options.offset),Zt=this._getAnchor();Be==="top"?(y=Ke/2,P=it):Be==="bottom"?(y=Ke/2,P=0):Be==="center"?(y=Ke/2,P=it/2):Be==="right"?(y=0,P=it/2):Be==="left"?(y=Ke,P=it/2):Se.x<ne.x?(Be="right",y=0,P=it/2):(Be="left",y=Ke+(Tt.x+Zt.x)*2,P=it/2),u=u.subtract(We(y,P,!0)).add(Tt).add(Zt),or(F,"leaflet-tooltip-right"),or(F,"leaflet-tooltip-left"),or(F,"leaflet-tooltip-top"),or(F,"leaflet-tooltip-bottom"),rn(F,"leaflet-tooltip-"+Be),Yn(F,u)},_updatePosition:function(){var u=this._map.latLngToLayerPoint(this._latlng);this._setPosition(u)},setOpacity:function(u){this.options.opacity=u,this._container&&Nr(this._container,u)},_animateZoom:function(u){var y=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center);this._setPosition(y)},_getAnchor:function(){return We(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Qo=function(u,y){return new Ba(u,y)};cn.include({openTooltip:function(u,y,P){return this._initOverlay(Ba,u,y,P).openOn(this),this},closeTooltip:function(u){return u.close(),this}}),Hi.include({bindTooltip:function(u,y){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ba,this._tooltip,u,y),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(u){if(!(!u&&this._tooltipHandlersAdded)){var y=u?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[y](P),this._tooltipHandlersAdded=!u}},openTooltip:function(u){return this._tooltip&&(this instanceof Ms||(this._tooltip._source=this),this._tooltip._prepareOpen(u)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(u){return this._tooltip&&this._tooltip.setContent(u),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(u){var y=typeof u.getElement=="function"&&u.getElement();y&&(Dt(y,"focus",function(){this._tooltip._source=u,this.openTooltip()},this),Dt(y,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(u){var y=typeof u.getElement=="function"&&u.getElement();y&&y.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(u){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var y=this;this._map.once("moveend",function(){y._openOnceFlag=!1,y._openTooltip(u)});return}this._tooltip._source=u.layer||u.target,this.openTooltip(this._tooltip.options.sticky?u.latlng:void 0)}},_moveTooltip:function(u){var y=u.latlng,P,z;this._tooltip.options.sticky&&u.originalEvent&&(P=this._map.mouseEventToContainerPoint(u.originalEvent),z=this._map.containerPointToLayerPoint(P),y=this._map.layerPointToLatLng(z)),this._tooltip.setLatLng(y)}});var Fa=Ko.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(u){var y=u&&u.tagName==="DIV"?u:document.createElement("div"),P=this.options;if(P.html instanceof Element?(vl(y),y.appendChild(P.html)):y.innerHTML=P.html!==!1?P.html:"",P.bgPos){var z=We(P.bgPos);y.style.backgroundPosition=-z.x+"px "+-z.y+"px"}return this._setIconStyles(y,"icon"),y},createShadow:function(){return null}});function Ua(u){return new Fa(u)}Ko.Default=Ks;var Yr=Hi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Fe.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(u){ie(this,u)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(u){u._addZoomLimit(this)},onRemove:function(u){this._removeAllTiles(),On(this._container),u._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ss(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Uo(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(u){return this.options.opacity=u,this._updateOpacity(),this},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var u=this._clampZoom(this._map.getZoom());u!==this._tileZoom&&(this._tileZoom=u,this._updateLevels()),this._update()}return this},getEvents:function(){var u={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=N(this._onMoveEnd,this.options.updateInterval,this)),u.move=this._onMove),this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},createTile:function(){return document.createElement("div")},getTileSize:function(){var u=this.options.tileSize;return u instanceof Ne?u:new Ne(u,u)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(u){for(var y=this.getPane().children,P=-u(-1/0,1/0),z=0,F=y.length,ne;z<F;z++)ne=y[z].style.zIndex,y[z]!==this._container&&ne&&(P=u(P,+ne));isFinite(P)&&(this.options.zIndex=P+u(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Fe.ielt9){Nr(this._container,this.options.opacity);var u=+new Date,y=!1,P=!1;for(var z in this._tiles){var F=this._tiles[z];if(!(!F.current||!F.loaded)){var ne=Math.min(1,(u-F.loaded)/200);Nr(F.el,ne),ne<1?y=!0:(F.active?P=!0:this._onOpaqueTile(F),F.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),y&&(ze(this._fadeFrame),this._fadeFrame=ht(this._updateOpacity,this))}},_onOpaqueTile:W,_initContainer:function(){this._container||(this._container=vn("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var u=this._tileZoom,y=this.options.maxZoom;if(u!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===u?(this._levels[P].el.style.zIndex=y-Math.abs(u-P),this._onUpdateLevel(P)):(On(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var z=this._levels[u],F=this._map;return z||(z=this._levels[u]={},z.el=vn("div","leaflet-tile-container leaflet-zoom-animated",this._container),z.el.style.zIndex=y,z.origin=F.project(F.unproject(F.getPixelOrigin()),u).round(),z.zoom=u,this._setZoomTransform(z,F.getCenter(),F.getZoom()),W(z.el.offsetWidth),this._onCreateLevel(z)),this._level=z,z}},_onUpdateLevel:W,_onRemoveLevel:W,_onCreateLevel:W,_pruneTiles:function(){if(this._map){var u,y,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(u in this._tiles)y=this._tiles[u],y.retain=y.current;for(u in this._tiles)if(y=this._tiles[u],y.current&&!y.active){var z=y.coords;this._retainParent(z.x,z.y,z.z,z.z-5)||this._retainChildren(z.x,z.y,z.z,z.z+2)}for(u in this._tiles)this._tiles[u].retain||this._removeTile(u)}},_removeTilesAtZoom:function(u){for(var y in this._tiles)this._tiles[y].coords.z===u&&this._removeTile(y)},_removeAllTiles:function(){for(var u in this._tiles)this._removeTile(u)},_invalidateAll:function(){for(var u in this._levels)On(this._levels[u].el),this._onRemoveLevel(Number(u)),delete this._levels[u];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(u,y,P,z){var F=Math.floor(u/2),ne=Math.floor(y/2),Se=P-1,Be=new Ne(+F,+ne);Be.z=+Se;var Ke=this._tileCoordsToKey(Be),it=this._tiles[Ke];return it&&it.active?(it.retain=!0,!0):(it&&it.loaded&&(it.retain=!0),Se>z?this._retainParent(F,ne,Se,z):!1)},_retainChildren:function(u,y,P,z){for(var F=2*u;F<2*u+2;F++)for(var ne=2*y;ne<2*y+2;ne++){var Se=new Ne(F,ne);Se.z=P+1;var Be=this._tileCoordsToKey(Se),Ke=this._tiles[Be];if(Ke&&Ke.active){Ke.retain=!0;continue}else Ke&&Ke.loaded&&(Ke.retain=!0);P+1<z&&this._retainChildren(F,ne,P+1,z)}},_resetView:function(u){var y=u&&(u.pinch||u.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),y,y)},_animateZoom:function(u){this._setView(u.center,u.zoom,!0,u.noUpdate)},_clampZoom:function(u){var y=this.options;return y.minNativeZoom!==void 0&&u<y.minNativeZoom?y.minNativeZoom:y.maxNativeZoom!==void 0&&y.maxNativeZoom<u?y.maxNativeZoom:u},_setView:function(u,y,P,z){var F=Math.round(y);this.options.maxZoom!==void 0&&F>this.options.maxZoom||this.options.minZoom!==void 0&&F<this.options.minZoom?F=void 0:F=this._clampZoom(F);var ne=this.options.updateWhenZooming&&F!==this._tileZoom;(!z||ne)&&(this._tileZoom=F,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),F!==void 0&&this._update(u),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(u,y)},_setZoomTransforms:function(u,y){for(var P in this._levels)this._setZoomTransform(this._levels[P],u,y)},_setZoomTransform:function(u,y,P){var z=this._map.getZoomScale(P,u.zoom),F=u.origin.multiplyBy(z).subtract(this._map._getNewPixelOrigin(y,P)).round();Fe.any3d?zi(u.el,F,z):Yn(u.el,F)},_resetGrid:function(){var u=this._map,y=u.options.crs,P=this._tileSize=this.getTileSize(),z=this._tileZoom,F=this._map.getPixelWorldBounds(this._tileZoom);F&&(this._globalTileRange=this._pxBoundsToTileRange(F)),this._wrapX=y.wrapLng&&!this.options.noWrap&&[Math.floor(u.project([0,y.wrapLng[0]],z).x/P.x),Math.ceil(u.project([0,y.wrapLng[1]],z).x/P.y)],this._wrapY=y.wrapLat&&!this.options.noWrap&&[Math.floor(u.project([y.wrapLat[0],0],z).y/P.x),Math.ceil(u.project([y.wrapLat[1],0],z).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(u){var y=this._map,P=y._animatingZoom?Math.max(y._animateToZoom,y.getZoom()):y.getZoom(),z=y.getZoomScale(P,this._tileZoom),F=y.project(u,this._tileZoom).floor(),ne=y.getSize().divideBy(z*2);return new nt(F.subtract(ne),F.add(ne))},_update:function(u){var y=this._map;if(y){var P=this._clampZoom(y.getZoom());if(u===void 0&&(u=y.getCenter()),this._tileZoom!==void 0){var z=this._getTiledPixelBounds(u),F=this._pxBoundsToTileRange(z),ne=F.getCenter(),Se=[],Be=this.options.keepBuffer,Ke=new nt(F.getBottomLeft().subtract([Be,-Be]),F.getTopRight().add([Be,-Be]));if(!(isFinite(F.min.x)&&isFinite(F.min.y)&&isFinite(F.max.x)&&isFinite(F.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var it in this._tiles){var Tt=this._tiles[it].coords;(Tt.z!==this._tileZoom||!Ke.contains(new Ne(Tt.x,Tt.y)))&&(this._tiles[it].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(u,P);return}for(var Zt=F.min.y;Zt<=F.max.y;Zt++)for(var ln=F.min.x;ln<=F.max.x;ln++){var Pr=new Ne(ln,Zt);if(Pr.z=this._tileZoom,!!this._isValidTile(Pr)){var ar=this._tiles[this._tileCoordsToKey(Pr)];ar?ar.current=!0:Se.push(Pr)}}if(Se.sort(function(Zr,cs){return Zr.distanceTo(ne)-cs.distanceTo(ne)}),Se.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var hi=document.createDocumentFragment();for(ln=0;ln<Se.length;ln++)this._addTile(Se[ln],hi);this._level.el.appendChild(hi)}}}},_isValidTile:function(u){var y=this._map.options.crs;if(!y.infinite){var P=this._globalTileRange;if(!y.wrapLng&&(u.x<P.min.x||u.x>P.max.x)||!y.wrapLat&&(u.y<P.min.y||u.y>P.max.y))return!1}if(!this.options.bounds)return!0;var z=this._tileCoordsToBounds(u);return Ft(this.options.bounds).overlaps(z)},_keyToBounds:function(u){return this._tileCoordsToBounds(this._keyToTileCoords(u))},_tileCoordsToNwSe:function(u){var y=this._map,P=this.getTileSize(),z=u.scaleBy(P),F=z.add(P),ne=y.unproject(z,u.z),Se=y.unproject(F,u.z);return[ne,Se]},_tileCoordsToBounds:function(u){var y=this._tileCoordsToNwSe(u),P=new Bt(y[0],y[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(u){return u.x+":"+u.y+":"+u.z},_keyToTileCoords:function(u){var y=u.split(":"),P=new Ne(+y[0],+y[1]);return P.z=+y[2],P},_removeTile:function(u){var y=this._tiles[u];y&&(On(y.el),delete this._tiles[u],this.fire("tileunload",{tile:y.el,coords:this._keyToTileCoords(u)}))},_initTile:function(u){rn(u,"leaflet-tile");var y=this.getTileSize();u.style.width=y.x+"px",u.style.height=y.y+"px",u.onselectstart=W,u.onmousemove=W,Fe.ielt9&&this.options.opacity<1&&Nr(u,this.options.opacity)},_addTile:function(u,y){var P=this._getTilePos(u),z=this._tileCoordsToKey(u),F=this.createTile(this._wrapCoords(u),g(this._tileReady,this,u));this._initTile(F),this.createTile.length<2&&ht(g(this._tileReady,this,u,null,F)),Yn(F,P),this._tiles[z]={el:F,coords:u,current:!0},y.appendChild(F),this.fire("tileloadstart",{tile:F,coords:u})},_tileReady:function(u,y,P){y&&this.fire("tileerror",{error:y,tile:P,coords:u});var z=this._tileCoordsToKey(u);P=this._tiles[z],P&&(P.loaded=+new Date,this._map._fadeAnimated?(Nr(P.el,0),ze(this._fadeFrame),this._fadeFrame=ht(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),y||(rn(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:u})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Fe.ielt9||!this._map._fadeAnimated?ht(this._pruneTiles,this):setTimeout(g(this._pruneTiles,this),250)))},_getTilePos:function(u){return u.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(u){var y=new Ne(this._wrapX?Z(u.x,this._wrapX):u.x,this._wrapY?Z(u.y,this._wrapY):u.y);return y.z=u.z,y},_pxBoundsToTileRange:function(u){var y=this.getTileSize();return new nt(u.min.unscaleBy(y).floor(),u.max.unscaleBy(y).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var u in this._tiles)if(!this._tiles[u].loaded)return!1;return!0}});function Dh(u){return new Yr(u)}var ea=Yr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(u,y){this._url=u,y=ie(this,y),y.detectRetina&&Fe.retina&&y.maxZoom>0?(y.tileSize=Math.floor(y.tileSize/2),y.zoomReverse?(y.zoomOffset--,y.minZoom=Math.min(y.maxZoom,y.minZoom+1)):(y.zoomOffset++,y.maxZoom=Math.max(y.minZoom,y.maxZoom-1)),y.minZoom=Math.max(0,y.minZoom)):y.zoomReverse?y.minZoom=Math.min(y.maxZoom,y.minZoom):y.maxZoom=Math.max(y.minZoom,y.maxZoom),typeof y.subdomains=="string"&&(y.subdomains=y.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(u,y){return this._url===u&&y===void 0&&(y=!0),this._url=u,y||this.redraw(),this},createTile:function(u,y){var P=document.createElement("img");return Dt(P,"load",g(this._tileOnLoad,this,y,P)),Dt(P,"error",g(this._tileOnError,this,y,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(u),P},getTileUrl:function(u){var y={r:Fe.retina?"@2x":"",s:this._getSubdomain(u),x:u.x,y:u.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-u.y;this.options.tms&&(y.y=P),y["-y"]=P}return $(this._url,f(y,this.options))},_tileOnLoad:function(u,y){Fe.ielt9?setTimeout(g(u,this,null,y),0):u(null,y)},_tileOnError:function(u,y,P){var z=this.options.errorTileUrl;z&&y.getAttribute("src")!==z&&(y.src=z),u(P,y)},_onTileRemove:function(u){u.tile.onload=null},_getZoomForUrl:function(){var u=this._tileZoom,y=this.options.maxZoom,P=this.options.zoomReverse,z=this.options.zoomOffset;return P&&(u=y-u),u+z},_getSubdomain:function(u){var y=Math.abs(u.x+u.y)%this.options.subdomains.length;return this.options.subdomains[y]},_abortLoading:function(){var u,y;for(u in this._tiles)if(this._tiles[u].coords.z!==this._tileZoom&&(y=this._tiles[u].el,y.onload=W,y.onerror=W,!y.complete)){y.src=pe;var P=this._tiles[u].coords;On(y),delete this._tiles[u],this.fire("tileabort",{tile:y,coords:P})}},_removeTile:function(u){var y=this._tiles[u];if(y)return y.el.setAttribute("src",pe),Yr.prototype._removeTile.call(this,u)},_tileReady:function(u,y,P){if(!(!this._map||P&&P.getAttribute("src")===pe))return Yr.prototype._tileReady.call(this,u,y,P)}});function mc(u,y){return new ea(u,y)}var Po=ea.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(u,y){this._url=u;var P=f({},this.defaultWmsParams);for(var z in y)z in this.options||(P[z]=y[z]);y=ie(this,y);var F=y.detectRetina&&Fe.retina?2:1,ne=this.getTileSize();P.width=ne.x*F,P.height=ne.y*F,this.wmsParams=P},onAdd:function(u){this._crs=this.options.crs||u.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var y=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[y]=this._crs.code,ea.prototype.onAdd.call(this,u)},getTileUrl:function(u){var y=this._tileCoordsToNwSe(u),P=this._crs,z=_t(P.project(y[0]),P.project(y[1])),F=z.min,ne=z.max,Se=(this._wmsVersion>=1.3&&this._crs===Ph?[F.y,F.x,ne.y,ne.x]:[F.x,F.y,ne.x,ne.y]).join(","),Be=ea.prototype.getTileUrl.call(this,u);return Be+oe(this.wmsParams,Be,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Se},setParams:function(u,y){return f(this.wmsParams,u),y||this.redraw(),this}});function gc(u,y){return new Po(u,y)}ea.WMS=Po,mc.wms=gc;var Ki=Hi.extend({options:{padding:.1},initialize:function(u){ie(this,u),A(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),rn(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var u={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(u.zoomanim=this._onAnimZoom),u},_onAnimZoom:function(u){this._updateTransform(u.center,u.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(u,y){var P=this._map.getZoomScale(y,this._zoom),z=this._map.getSize().multiplyBy(.5+this.options.padding),F=this._map.project(this._center,y),ne=z.multiplyBy(-P).add(F).subtract(this._map._getNewPixelOrigin(u,y));Fe.any3d?zi(this._container,ne,P):Yn(this._container,ne)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var u in this._layers)this._layers[u]._reset()},_onZoomEnd:function(){for(var u in this._layers)this._layers[u]._project()},_updatePaths:function(){for(var u in this._layers)this._layers[u]._update()},_update:function(){var u=this.options.padding,y=this._map.getSize(),P=this._map.containerPointToLayerPoint(y.multiplyBy(-u)).round();this._bounds=new nt(P,P.add(y.multiplyBy(1+u*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Va=Ki.extend({options:{tolerance:0},getEvents:function(){var u=Ki.prototype.getEvents.call(this);return u.viewprereset=this._onViewPreReset,u},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ki.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var u=this._container=document.createElement("canvas");Dt(u,"mousemove",this._onMouseMove,this),Dt(u,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Dt(u,"mouseout",this._handleMouseOut,this),u._leaflet_disable_events=!0,this._ctx=u.getContext("2d")},_destroyContainer:function(){ze(this._redrawRequest),delete this._ctx,On(this._container),en(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var u;this._redrawBounds=null;for(var y in this._layers)u=this._layers[y],u._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ki.prototype._update.call(this);var u=this._bounds,y=this._container,P=u.getSize(),z=Fe.retina?2:1;Yn(y,u.min),y.width=z*P.x,y.height=z*P.y,y.style.width=P.x+"px",y.style.height=P.y+"px",Fe.retina&&this._ctx.scale(2,2),this._ctx.translate(-u.min.x,-u.min.y),this.fire("update")}},_reset:function(){Ki.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(u){this._updateDashArray(u),this._layers[A(u)]=u;var y=u._order={layer:u,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=y),this._drawLast=y,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(u){this._requestRedraw(u)},_removePath:function(u){var y=u._order,P=y.next,z=y.prev;P?P.prev=z:this._drawLast=z,z?z.next=P:this._drawFirst=P,delete u._order,delete this._layers[A(u)],this._requestRedraw(u)},_updatePath:function(u){this._extendRedrawBounds(u),u._project(),u._update(),this._requestRedraw(u)},_updateStyle:function(u){this._updateDashArray(u),this._requestRedraw(u)},_updateDashArray:function(u){if(typeof u.options.dashArray=="string"){var y=u.options.dashArray.split(/[, ]+/),P=[],z,F;for(F=0;F<y.length;F++){if(z=Number(y[F]),isNaN(z))return;P.push(z)}u.options._dashArray=P}else u.options._dashArray=u.options.dashArray},_requestRedraw:function(u){this._map&&(this._extendRedrawBounds(u),this._redrawRequest=this._redrawRequest||ht(this._redraw,this))},_extendRedrawBounds:function(u){if(u._pxBounds){var y=(u.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new nt,this._redrawBounds.extend(u._pxBounds.min.subtract([y,y])),this._redrawBounds.extend(u._pxBounds.max.add([y,y]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var u=this._redrawBounds;if(u){var y=u.getSize();this._ctx.clearRect(u.min.x,u.min.y,y.x,y.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var u,y=this._redrawBounds;if(this._ctx.save(),y){var P=y.getSize();this._ctx.beginPath(),this._ctx.rect(y.min.x,y.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var z=this._drawFirst;z;z=z.next)u=z.layer,(!y||u._pxBounds&&u._pxBounds.intersects(y))&&u._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(u,y){if(this._drawing){var P,z,F,ne,Se=u._parts,Be=Se.length,Ke=this._ctx;if(Be){for(Ke.beginPath(),P=0;P<Be;P++){for(z=0,F=Se[P].length;z<F;z++)ne=Se[P][z],Ke[z?"lineTo":"moveTo"](ne.x,ne.y);y&&Ke.closePath()}this._fillStroke(Ke,u)}}},_updateCircle:function(u){if(!(!this._drawing||u._empty())){var y=u._point,P=this._ctx,z=Math.max(Math.round(u._radius),1),F=(Math.max(Math.round(u._radiusY),1)||z)/z;F!==1&&(P.save(),P.scale(1,F)),P.beginPath(),P.arc(y.x,y.y/F,z,0,Math.PI*2,!1),F!==1&&P.restore(),this._fillStroke(P,u)}},_fillStroke:function(u,y){var P=y.options;P.fill&&(u.globalAlpha=P.fillOpacity,u.fillStyle=P.fillColor||P.color,u.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(u.setLineDash&&u.setLineDash(y.options&&y.options._dashArray||[]),u.globalAlpha=P.opacity,u.lineWidth=P.weight,u.strokeStyle=P.color,u.lineCap=P.lineCap,u.lineJoin=P.lineJoin,u.stroke())},_onClick:function(u){for(var y=this._map.mouseEventToLayerPoint(u),P,z,F=this._drawFirst;F;F=F.next)P=F.layer,P.options.interactive&&P._containsPoint(y)&&(!(u.type==="click"||u.type==="preclick")||!this._map._draggableMoved(P))&&(z=P);this._fireEvent(z?[z]:!1,u)},_onMouseMove:function(u){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var y=this._map.mouseEventToLayerPoint(u);this._handleMouseHover(u,y)}},_handleMouseOut:function(u){var y=this._hoveredLayer;y&&(or(this._container,"leaflet-interactive"),this._fireEvent([y],u,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(u,y){if(!this._mouseHoverThrottled){for(var P,z,F=this._drawFirst;F;F=F.next)P=F.layer,P.options.interactive&&P._containsPoint(y)&&(z=P);z!==this._hoveredLayer&&(this._handleMouseOut(u),z&&(rn(this._container,"leaflet-interactive"),this._fireEvent([z],u,"mouseover"),this._hoveredLayer=z)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,u),this._mouseHoverThrottled=!0,setTimeout(g(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(u,y,P){this._map._fireDOMEvent(y,P||y.type,u)},_bringToFront:function(u){var y=u._order;if(y){var P=y.next,z=y.prev;if(P)P.prev=z;else return;z?z.next=P:P&&(this._drawFirst=P),y.prev=this._drawLast,this._drawLast.next=y,y.next=null,this._drawLast=y,this._requestRedraw(u)}},_bringToBack:function(u){var y=u._order;if(y){var P=y.next,z=y.prev;if(z)z.next=P;else return;P?P.prev=z:z&&(this._drawLast=z),y.prev=null,y.next=this._drawFirst,this._drawFirst.prev=y,this._drawFirst=y,this._requestRedraw(u)}}});function Il(u){return Fe.canvas?new Va(u):null}var $a=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(u){return document.createElement("<lvml:"+u+' class="lvml">')}}catch{}return function(u){return document.createElement("<"+u+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Za={_initContainer:function(){this._container=vn("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ki.prototype._update.call(this),this.fire("update"))},_initPath:function(u){var y=u._container=$a("shape");rn(y,"leaflet-vml-shape "+(this.options.className||"")),y.coordsize="1 1",u._path=$a("path"),y.appendChild(u._path),this._updateStyle(u),this._layers[A(u)]=u},_addPath:function(u){var y=u._container;this._container.appendChild(y),u.options.interactive&&u.addInteractiveTarget(y)},_removePath:function(u){var y=u._container;On(y),u.removeInteractiveTarget(y),delete this._layers[A(u)]},_updateStyle:function(u){var y=u._stroke,P=u._fill,z=u.options,F=u._container;F.stroked=!!z.stroke,F.filled=!!z.fill,z.stroke?(y||(y=u._stroke=$a("stroke")),F.appendChild(y),y.weight=z.weight+"px",y.color=z.color,y.opacity=z.opacity,z.dashArray?y.dashStyle=te(z.dashArray)?z.dashArray.join(" "):z.dashArray.replace(/( *, *)/g," "):y.dashStyle="",y.endcap=z.lineCap.replace("butt","flat"),y.joinstyle=z.lineJoin):y&&(F.removeChild(y),u._stroke=null),z.fill?(P||(P=u._fill=$a("fill")),F.appendChild(P),P.color=z.fillColor||z.color,P.opacity=z.fillOpacity):P&&(F.removeChild(P),u._fill=null)},_updateCircle:function(u){var y=u._point.round(),P=Math.round(u._radius),z=Math.round(u._radiusY||P);this._setPath(u,u._empty()?"M0 0":"AL "+y.x+","+y.y+" "+P+","+z+" 0,"+65535*360)},_setPath:function(u,y){u._path.v=y},_bringToFront:function(u){ss(u._container)},_bringToBack:function(u){Uo(u._container)}},Js=Fe.vml?$a:vi,Ga=Ki.extend({_initContainer:function(){this._container=Js("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Js("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){On(this._container),en(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ki.prototype._update.call(this);var u=this._bounds,y=u.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(y))&&(this._svgSize=y,P.setAttribute("width",y.x),P.setAttribute("height",y.y)),Yn(P,u.min),P.setAttribute("viewBox",[u.min.x,u.min.y,y.x,y.y].join(" ")),this.fire("update")}},_initPath:function(u){var y=u._path=Js("path");u.options.className&&rn(y,u.options.className),u.options.interactive&&rn(y,"leaflet-interactive"),this._updateStyle(u),this._layers[A(u)]=u},_addPath:function(u){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(u._path),u.addInteractiveTarget(u._path)},_removePath:function(u){On(u._path),u.removeInteractiveTarget(u._path),delete this._layers[A(u)]},_updatePath:function(u){u._project(),u._update()},_updateStyle:function(u){var y=u._path,P=u.options;y&&(P.stroke?(y.setAttribute("stroke",P.color),y.setAttribute("stroke-opacity",P.opacity),y.setAttribute("stroke-width",P.weight),y.setAttribute("stroke-linecap",P.lineCap),y.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?y.setAttribute("stroke-dasharray",P.dashArray):y.removeAttribute("stroke-dasharray"),P.dashOffset?y.setAttribute("stroke-dashoffset",P.dashOffset):y.removeAttribute("stroke-dashoffset")):y.setAttribute("stroke","none"),P.fill?(y.setAttribute("fill",P.fillColor||P.color),y.setAttribute("fill-opacity",P.fillOpacity),y.setAttribute("fill-rule",P.fillRule||"evenodd")):y.setAttribute("fill","none"))},_updatePoly:function(u,y){this._setPath(u,Dr(u._parts,y))},_updateCircle:function(u){var y=u._point,P=Math.max(Math.round(u._radius),1),z=Math.max(Math.round(u._radiusY),1)||P,F="a"+P+","+z+" 0 1,0 ",ne=u._empty()?"M0 0":"M"+(y.x-P)+","+y.y+F+P*2+",0 "+F+-P*2+",0 ";this._setPath(u,ne)},_setPath:function(u,y){u._path.setAttribute("d",y)},_bringToFront:function(u){ss(u._path)},_bringToBack:function(u){Uo(u._path)}});Fe.vml&&Ga.include(Za);function qa(u){return Fe.svg||Fe.vml?new Ga(u):null}cn.include({getRenderer:function(u){var y=u.options.renderer||this._getPaneRenderer(u.options.pane)||this.options.renderer||this._renderer;return y||(y=this._renderer=this._createRenderer()),this.hasLayer(y)||this.addLayer(y),y},_getPaneRenderer:function(u){if(u==="overlayPane"||u===void 0)return!1;var y=this._paneRenderers[u];return y===void 0&&(y=this._createRenderer({pane:u}),this._paneRenderers[u]=y),y},_createRenderer:function(u){return this.options.preferCanvas&&Il(u)||qa(u)}});var tn=Xo.extend({initialize:function(u,y){Xo.prototype.initialize.call(this,this._boundsToLatLngs(u),y)},setBounds:function(u){return this.setLatLngs(this._boundsToLatLngs(u))},_boundsToLatLngs:function(u){return u=Ft(u),[u.getSouthWest(),u.getNorthWest(),u.getNorthEast(),u.getSouthEast()]}});function _c(u,y){return new tn(u,y)}Ga.create=Js,Ga.pointsToPath=Dr,as.geometryToLayer=Na,as.coordsToLatLng=ls,as.coordsToLatLngs=Oa,as.latLngToCoords=Cl,as.latLngsToCoords=dn,as.getFeature=Yo,as.asFeature=ja,cn.mergeOptions({boxZoom:!0});var Nh=Di.extend({initialize:function(u){this._map=u,this._container=u._container,this._pane=u._panes.overlayPane,this._resetStateTimeout=0,u.on("unload",this._destroy,this)},addHooks:function(){Dt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){en(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){On(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(u){if(!u.shiftKey||u.which!==1&&u.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Gs(),sn(),this._startPoint=this._map.mouseEventToContainerPoint(u),Dt(document,{contextmenu:Kt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(u){this._moved||(this._moved=!0,this._box=vn("div","leaflet-zoom-box",this._container),rn(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(u);var y=new nt(this._point,this._startPoint),P=y.getSize();Yn(this._box,y.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(On(this._box),or(this._container,"leaflet-crosshair")),qs(),_o(),en(document,{contextmenu:Kt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(u){if(!(u.which!==1&&u.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(g(this._resetState,this),0);var y=new Bt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(y).fire("boxzoomend",{boxZoomBounds:y})}},_onKeyDown:function(u){u.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});cn.addInitHook("addHandler","boxZoom",Nh),cn.mergeOptions({doubleClickZoom:!0});var yc=Di.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(u){var y=this._map,P=y.getZoom(),z=y.options.zoomDelta,F=u.originalEvent.shiftKey?P-z:P+z;y.options.doubleClickZoom==="center"?y.setZoom(F):y.setZoomAround(u.containerPoint,F)}});cn.addInitHook("addHandler","doubleClickZoom",yc),cn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Wa=Di.extend({addHooks:function(){if(!this._draggable){var u=this._map;this._draggable=new zn(u._mapPane,u._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),u.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),u.on("zoomend",this._onZoomEnd,this),u.whenReady(this._onZoomEnd,this))}rn(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){or(this._map._container,"leaflet-grab"),or(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var u=this._map;if(u._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var y=Ft(this._map.options.maxBounds);this._offsetLimit=_t(this._map.latLngToContainerPoint(y.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(y.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;u.fire("movestart").fire("dragstart"),u.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(u){if(this._map.options.inertia){var y=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(y),this._prunePositions(y)}this._map.fire("move",u).fire("drag",u)},_prunePositions:function(u){for(;this._positions.length>1&&u-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var u=this._map.getSize().divideBy(2),y=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=y.subtract(u).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(u,y){return u-(u-y)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var u=this._draggable._newPos.subtract(this._draggable._startPos),y=this._offsetLimit;u.x<y.min.x&&(u.x=this._viscousLimit(u.x,y.min.x)),u.y<y.min.y&&(u.y=this._viscousLimit(u.y,y.min.y)),u.x>y.max.x&&(u.x=this._viscousLimit(u.x,y.max.x)),u.y>y.max.y&&(u.y=this._viscousLimit(u.y,y.max.y)),this._draggable._newPos=this._draggable._startPos.add(u)}},_onPreDragWrap:function(){var u=this._worldWidth,y=Math.round(u/2),P=this._initialWorldOffset,z=this._draggable._newPos.x,F=(z-y+P)%u+y-P,ne=(z+y+P)%u-y-P,Se=Math.abs(F+P)<Math.abs(ne+P)?F:ne;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Se},_onDragEnd:function(u){var y=this._map,P=y.options,z=!P.inertia||u.noInertia||this._times.length<2;if(y.fire("dragend",u),z)y.fire("moveend");else{this._prunePositions(+new Date);var F=this._lastPos.subtract(this._positions[0]),ne=(this._lastTime-this._times[0])/1e3,Se=P.easeLinearity,Be=F.multiplyBy(Se/ne),Ke=Be.distanceTo([0,0]),it=Math.min(P.inertiaMaxSpeed,Ke),Tt=Be.multiplyBy(it/Ke),Zt=it/(P.inertiaDeceleration*Se),ln=Tt.multiplyBy(-Zt/2).round();!ln.x&&!ln.y?y.fire("moveend"):(ln=y._limitOffset(ln,y.options.maxBounds),ht(function(){y.panBy(ln,{duration:Zt,easeLinearity:Se,noMoveStart:!0,animate:!0})}))}}});cn.addInitHook("addHandler","dragging",Wa),cn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Oh=Di.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(u){this._map=u,this._setPanDelta(u.options.keyboardPanDelta),this._setZoomDelta(u.options.zoomDelta)},addHooks:function(){var u=this._map._container;u.tabIndex<=0&&(u.tabIndex="0"),Dt(u,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),en(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var u=document.body,y=document.documentElement,P=u.scrollTop||y.scrollTop,z=u.scrollLeft||y.scrollLeft;this._map._container.focus(),window.scrollTo(z,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(u){var y=this._panKeys={},P=this.keyCodes,z,F;for(z=0,F=P.left.length;z<F;z++)y[P.left[z]]=[-1*u,0];for(z=0,F=P.right.length;z<F;z++)y[P.right[z]]=[u,0];for(z=0,F=P.down.length;z<F;z++)y[P.down[z]]=[0,u];for(z=0,F=P.up.length;z<F;z++)y[P.up[z]]=[0,-1*u]},_setZoomDelta:function(u){var y=this._zoomKeys={},P=this.keyCodes,z,F;for(z=0,F=P.zoomIn.length;z<F;z++)y[P.zoomIn[z]]=u;for(z=0,F=P.zoomOut.length;z<F;z++)y[P.zoomOut[z]]=-u},_addHooks:function(){Dt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){en(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(u){if(!(u.altKey||u.ctrlKey||u.metaKey)){var y=u.keyCode,P=this._map,z;if(y in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(z=this._panKeys[y],u.shiftKey&&(z=We(z).multiplyBy(3)),P.options.maxBounds&&(z=P._limitOffset(We(z),P.options.maxBounds)),P.options.worldCopyJump){var F=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(z)));P.panTo(F)}else P.panBy(z)}else if(y in this._zoomKeys)P.setZoom(P.getZoom()+(u.shiftKey?3:1)*this._zoomKeys[y]);else if(y===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;Kt(u)}}});cn.addInitHook("addHandler","keyboard",Oh),cn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var kl=Di.extend({addHooks:function(){Dt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){en(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(u){var y=wl(u),P=this._map.options.wheelDebounceTime;this._delta+=y,this._lastMousePos=this._map.mouseEventToContainerPoint(u),this._startTime||(this._startTime=+new Date);var z=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(g(this._performZoom,this),z),Kt(u)},_performZoom:function(){var u=this._map,y=u.getZoom(),P=this._map.options.zoomSnap||0;u._stop();var z=this._delta/(this._map.options.wheelPxPerZoomLevel*4),F=4*Math.log(2/(1+Math.exp(-Math.abs(z))))/Math.LN2,ne=P?Math.ceil(F/P)*P:F,Se=u._limitZoom(y+(this._delta>0?ne:-ne))-y;this._delta=0,this._startTime=null,Se&&(u.options.scrollWheelZoom==="center"?u.setZoom(y+Se):u.setZoomAround(this._lastMousePos,y+Se))}});cn.addInitHook("addHandler","scrollWheelZoom",kl);var Au=600;cn.mergeOptions({tapHold:Fe.touchNative&&Fe.safari&&Fe.mobile,tapTolerance:15});var jh=Di.extend({addHooks:function(){Dt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){en(this._map._container,"touchstart",this._onDown,this)},_onDown:function(u){if(clearTimeout(this._holdTimeout),u.touches.length===1){var y=u.touches[0];this._startPos=this._newPos=new Ne(y.clientX,y.clientY),this._holdTimeout=setTimeout(g(function(){this._cancel(),this._isTapValid()&&(Dt(document,"touchend",an),Dt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",y))},this),Au),Dt(document,"touchend touchcancel contextmenu",this._cancel,this),Dt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function u(){en(document,"touchend",an),en(document,"touchend touchcancel",u)},_cancel:function(){clearTimeout(this._holdTimeout),en(document,"touchend touchcancel contextmenu",this._cancel,this),en(document,"touchmove",this._onMove,this)},_onMove:function(u){var y=u.touches[0];this._newPos=new Ne(y.clientX,y.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(u,y){var P=new MouseEvent(u,{bubbles:!0,cancelable:!0,view:window,screenX:y.screenX,screenY:y.screenY,clientX:y.clientX,clientY:y.clientY});P._simulated=!0,y.target.dispatchEvent(P)}});cn.addInitHook("addHandler","tapHold",jh),cn.mergeOptions({touchZoom:Fe.touch,bounceAtZoomLimits:!0});var vc=Di.extend({addHooks:function(){rn(this._map._container,"leaflet-touch-zoom"),Dt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){or(this._map._container,"leaflet-touch-zoom"),en(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(u){var y=this._map;if(!(!u.touches||u.touches.length!==2||y._animatingZoom||this._zooming)){var P=y.mouseEventToContainerPoint(u.touches[0]),z=y.mouseEventToContainerPoint(u.touches[1]);this._centerPoint=y.getSize()._divideBy(2),this._startLatLng=y.containerPointToLatLng(this._centerPoint),y.options.touchZoom!=="center"&&(this._pinchStartLatLng=y.containerPointToLatLng(P.add(z)._divideBy(2))),this._startDist=P.distanceTo(z),this._startZoom=y.getZoom(),this._moved=!1,this._zooming=!0,y._stop(),Dt(document,"touchmove",this._onTouchMove,this),Dt(document,"touchend touchcancel",this._onTouchEnd,this),an(u)}},_onTouchMove:function(u){if(!(!u.touches||u.touches.length!==2||!this._zooming)){var y=this._map,P=y.mouseEventToContainerPoint(u.touches[0]),z=y.mouseEventToContainerPoint(u.touches[1]),F=P.distanceTo(z)/this._startDist;if(this._zoom=y.getScaleZoom(F,this._startZoom),!y.options.bounceAtZoomLimits&&(this._zoom<y.getMinZoom()&&F<1||this._zoom>y.getMaxZoom()&&F>1)&&(this._zoom=y._limitZoom(this._zoom)),y.options.touchZoom==="center"){if(this._center=this._startLatLng,F===1)return}else{var ne=P._add(z)._divideBy(2)._subtract(this._centerPoint);if(F===1&&ne.x===0&&ne.y===0)return;this._center=y.unproject(y.project(this._pinchStartLatLng,this._zoom).subtract(ne),this._zoom)}this._moved||(y._moveStart(!0,!1),this._moved=!0),ze(this._animRequest);var Se=g(y._move,y,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ht(Se,this,!0),an(u)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ze(this._animRequest),en(document,"touchmove",this._onTouchMove,this),en(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});cn.addInitHook("addHandler","touchZoom",vc),cn.BoxZoom=Nh,cn.DoubleClickZoom=yc,cn.Drag=Wa,cn.Keyboard=Oh,cn.ScrollWheelZoom=kl,cn.TapHold=jh,cn.TouchZoom=vc,i.Bounds=nt,i.Browser=Fe,i.CRS=Un,i.Canvas=Va,i.Circle=Da,i.CircleMarker=Rs,i.Class=at,i.Control=ui,i.DivIcon=Fa,i.DivOverlay=Oi,i.DomEvent=Su,i.DomUtil=Si,i.Draggable=zn,i.Evented=jt,i.FeatureGroup=Ms,i.GeoJSON=as,i.GridLayer=Yr,i.Handler=Di,i.Icon=Ko,i.ImageOverlay=fc,i.LatLng=Ut,i.LatLngBounds=Bt,i.Layer=Hi,i.LayerGroup=So,i.LineUtil=Cu,i.Map=cn,i.Marker=As,i.Mixin=bh,i.Path=Xs,i.Point=Ne,i.PolyUtil=Pu,i.Polygon=Xo,i.Polyline=Ls,i.Popup=Jo,i.PosAnimation=ka,i.Projection=cf,i.Rectangle=tn,i.Renderer=Ki,i.SVG=Ga,i.SVGOverlay=Lh,i.TileLayer=ea,i.Tooltip=Ba,i.Transformation=Ts,i.Util=vt,i.VideoOverlay=Ah,i.bind=g,i.bounds=_t,i.canvas=Il,i.circle=uf,i.circleMarker=kh,i.control=Go,i.divIcon=Ua,i.extend=f,i.featureGroup=Iu,i.geoJSON=dc,i.geoJson=hf,i.gridLayer=Dh,i.icon=Ch,i.imageOverlay=df,i.latLng=Pt,i.latLngBounds=Ft,i.layerGroup=Eh,i.map=Ma,i.marker=Ih,i.point=We,i.polygon=Mh,i.polyline=Mu,i.popup=pc,i.rectangle=_c,i.setOptions=ie,i.stamp=A,i.svg=qa,i.svgOverlay=zh,i.tileLayer=mc,i.tooltip=Qo,i.transformation=xr,i.version=l,i.videoOverlay=Rh;var xc=window.L;i.noConflict=function(){return window.L=xc,this},window.L=i})})(C0,C0.exports);var af=C0.exports;const f6=z_(af),p6=TP({__proto__:null,default:f6},[af]);function ow(t,e,i){return Object.freeze({instance:t,context:e,container:i})}function Zk(t,e){return e==null?function(l,f){const v=se.useRef();return v.current||(v.current=t(l,f)),v}:function(l,f){const v=se.useRef();v.current||(v.current=t(l,f));const g=se.useRef(l),{instance:c}=v.current;return se.useEffect(function(){g.current!==l&&(e(c,l,g.current),g.current=l)},[c,l,f]),v}}function Gk(t,e){se.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){var v;(v=e.layerContainer)==null||v.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function m6(t){return function(i){const l=iw(),f=t(sw(i,l),l);return a6(l.map,i.attribution),$k(f.current,i.eventHandlers),Gk(f.current,l),f}}function g6(t,e){const i=se.useRef();se.useEffect(function(){if(e.pathOptions!==i.current){const f=e.pathOptions??{};t.instance.setStyle(f),i.current=f}},[t,e])}function _6(t){return function(i){const l=iw(),f=t(sw(i,l),l);return $k(f.current,i.eventHandlers),Gk(f.current,l),g6(f.current,i),f}}function qk(t,e){const i=Zk(t,e),l=_6(i);return h6(l)}function y6(t,e){const i=Zk(t,e),l=m6(i);return d6(l)}function v6(t,e,i){const{opacity:l,zIndex:f}=e;l!=null&&l!==i.opacity&&t.setOpacity(l),f!=null&&f!==i.zIndex&&t.setZIndex(f)}function x6(){return iw().map}const bP=qk(function({center:e,children:i,...l},f){const v=new af.CircleMarker(e,l);return ow(v,Fk(f,{overlayContainer:v}))},l6);function I0(){return I0=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(t[l]=i[l])}return t},I0.apply(this,arguments)}function b6({bounds:t,boundsOptions:e,center:i,children:l,className:f,id:v,placeholder:g,style:c,whenReady:A,zoom:N,...Z},W){const[K]=se.useState({className:f,id:v,style:c}),[J,ce]=se.useState(null);se.useImperativeHandle(W,()=>(J==null?void 0:J.map)??null,[J]);const ie=se.useCallback(re=>{if(re!==null&&J===null){const $=new af.Map(re,Z);i!=null&&N!=null?$.setView(i,N):t!=null&&$.fitBounds(t,e),A!=null&&$.whenReady(A),ce(u6($))}},[]);se.useEffect(()=>()=>{J==null||J.map.remove()},[J]);const oe=J?pa.createElement(Vk,{value:J},l):g??null;return pa.createElement("div",I0({},K,{ref:ie}),oe)}const w6=se.forwardRef(b6),T6=qk(function({positions:e,...i},l){const f=new af.Polyline(e,i);return ow(f,Fk(l,{overlayContainer:f}))},function(e,i,l){i.positions!==l.positions&&e.setLatLngs(i.positions)}),S6=y6(function({url:e,...i},l){const f=new af.TileLayer(e,sw(i,l));return ow(f,l)},function(e,i,l){v6(e,i,l);const{url:f}=i;f!=null&&f!==l.url&&e.setUrl(f)}),P6=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Wk={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.9.0/LICENSE.txt
 */(function(t,e){(function(i,l){t.exports=l()})(SP,function(){var i={},l={};function f(g,c,A){if(l[g]=A,g==="index"){var N="var sharedModule = {}; ("+l.shared+")(sharedModule); ("+l.worker+")(sharedModule);",Z={};return l.shared(Z),l.index(i,Z),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([N],{type:"text/javascript"}))),i}}f("shared",["exports"],function(g){function c(o,r,s,h){return new(s||(s=Promise))(function(p,x){function w(M){try{E(h.next(M))}catch(R){x(R)}}function S(M){try{E(h.throw(M))}catch(R){x(R)}}function E(M){var R;M.done?p(M.value):(R=M.value,R instanceof s?R:new s(function(j){j(R)})).then(w,S)}E((h=h.apply(o,r||[])).next())})}function A(o,r){this.x=o,this.y=r}function N(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Z,W;typeof SuppressedError=="function"&&SuppressedError,A.prototype={clone(){return new A(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,r){return this.clone()._rotateAround(o,r)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const r=o.x-this.x,s=o.y-this.y;return r*r+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult(o){const r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const r=Math.cos(o),s=Math.sin(o),h=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=h,this},_rotateAround(o,r){const s=Math.cos(o),h=Math.sin(o),p=r.y+h*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-h*(this.y-r.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:A},A.convert=function(o){if(o instanceof A)return o;if(Array.isArray(o))return new A(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new A(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};var K=function(){if(W)return Z;function o(r,s,h,p){this.cx=3*r,this.bx=3*(h-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=h,this.p2y=p}return W=1,Z=o,o.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var h=r,p=0;p<8;p++){var x=this.sampleCurveX(h)-r;if(Math.abs(x)<s)return h;var w=this.sampleCurveDerivativeX(h);if(Math.abs(w)<1e-6)break;h-=x/w}var S=0,E=1;for(h=r,p=0;p<20&&(x=this.sampleCurveX(h),!(Math.abs(x-r)<s));p++)r>x?S=h:E=h,h=.5*(E-S)+S;return h},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},Z}(),J=N(K);let ce,ie;function oe(){return ce==null&&(ce=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ce}function re(){if(ie==null&&(ie=!1,oe())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let h=0;h<5*5;h++){const p=4*h;r.fillStyle=`rgb(${p},${p+1},${p+2})`,r.fillRect(h%5,Math.floor(h/5),1,1)}const s=r.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&s[h]!==h){ie=!0;break}}}return ie||!1}var $=1e-6,te=typeof Float32Array<"u"?Float32Array:Array;function fe(){var o=new te(9);return te!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function pe(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ie(){var o=new te(3);return te!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Ge(o){var r=o[0],s=o[1],h=o[2];return Math.sqrt(r*r+s*s+h*h)}function Le(o,r,s){var h=new te(3);return h[0]=o,h[1]=r,h[2]=s,h}function xt(o,r,s){return o[0]=r[0]+s[0],o[1]=r[1]+s[1],o[2]=r[2]+s[2],o}function ct(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o[2]=r[2]*s,o}function ht(o,r,s){var h=r[0],p=r[1],x=r[2],w=s[0],S=s[1],E=s[2];return o[0]=p*E-x*S,o[1]=x*w-h*E,o[2]=h*S-p*w,o}var ze,vt=Ge;function at(o,r,s){var h=r[0],p=r[1],x=r[2],w=r[3];return o[0]=s[0]*h+s[4]*p+s[8]*x+s[12]*w,o[1]=s[1]*h+s[5]*p+s[9]*x+s[13]*w,o[2]=s[2]*h+s[6]*p+s[10]*x+s[14]*w,o[3]=s[3]*h+s[7]*p+s[11]*x+s[15]*w,o}function Mt(){var o=new te(4);return te!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function wt(o,r,s,h){var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",x=Math.PI/360;r*=x,h*=x,s*=x;var w=Math.sin(r),S=Math.cos(r),E=Math.sin(s),M=Math.cos(s),R=Math.sin(h),j=Math.cos(h);switch(p){case"xyz":o[0]=w*M*j+S*E*R,o[1]=S*E*j-w*M*R,o[2]=S*M*R+w*E*j,o[3]=S*M*j-w*E*R;break;case"xzy":o[0]=w*M*j-S*E*R,o[1]=S*E*j-w*M*R,o[2]=S*M*R+w*E*j,o[3]=S*M*j+w*E*R;break;case"yxz":o[0]=w*M*j+S*E*R,o[1]=S*E*j-w*M*R,o[2]=S*M*R-w*E*j,o[3]=S*M*j+w*E*R;break;case"yzx":o[0]=w*M*j+S*E*R,o[1]=S*E*j+w*M*R,o[2]=S*M*R-w*E*j,o[3]=S*M*j-w*E*R;break;case"zxy":o[0]=w*M*j-S*E*R,o[1]=S*E*j+w*M*R,o[2]=S*M*R+w*E*j,o[3]=S*M*j-w*E*R;break;case"zyx":o[0]=w*M*j-S*E*R,o[1]=S*E*j+w*M*R,o[2]=S*M*R-w*E*j,o[3]=S*M*j+w*E*R;break;default:throw new Error("Unknown angle order "+p)}return o}function jt(){var o=new te(2);return te!=Float32Array&&(o[0]=0,o[1]=0),o}function Ne(o,r){var s=new te(2);return s[0]=o,s[1]=r,s}Ie(),ze=new te(4),te!=Float32Array&&(ze[0]=0,ze[1]=0,ze[2]=0,ze[3]=0),Ie(),Le(1,0,0),Le(0,1,0),Mt(),Mt(),fe(),jt();const Oe=8192;function We(o,r,s){return r*(Oe/(o.tileSize*Math.pow(2,s-o.tileID.overscaledZ)))}function nt(o,r){return(o%r+r)%r}function _t(o,r,s){return o*(1-s)+r*s}function Bt(o){if(o<=0)return 0;if(o>=1)return 1;const r=o*o,s=r*o;return 4*(o<.5?s:3*(o-r)+s-.75)}function Ft(o,r,s,h){const p=new J(o,r,s,h);return x=>p.solve(x)}const Ut=Ft(.25,.1,.25,1);function Pt(o,r,s){return Math.min(s,Math.max(r,o))}function Un(o,r,s){const h=s-r,p=((o-r)%h+h)%h+r;return p===r?s:p}function Vn(o,...r){for(const s of r)for(const h in s)o[h]=s[h];return o}let yi=1;function ws(o,r,s){const h={};for(const p in o)h[p]=r.call(this,o[p],p,o);return h}function Ts(o,r,s){const h={};for(const p in o)r.call(this,o[p],p,o)&&(h[p]=o[p]);return h}function xr(o){return Array.isArray(o)?o.map(xr):typeof o=="object"&&o?ws(o,xr):o}const In={};function $n(o){In[o]||(typeof console<"u"&&console.warn(o),In[o]=!0)}function vi(o,r,s){return(s.y-o.y)*(r.x-o.x)>(r.y-o.y)*(s.x-o.x)}function Dr(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let Vt=null;function _n(o){if(Vt==null){const r=o.navigator?o.navigator.userAgent:null;Vt=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Vt}function mn(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const dr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ai(o,r,s,h,p){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(o,{timestamp:0});try{const w=x==null?void 0:x.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const S=w.startsWith("BGR"),E=new Uint8ClampedArray(h*p*4);if(yield x.copyTo(E,function(M,R,j,V,G){const H=4*Math.max(-R,0),ee=(Math.max(0,j)-j)*V*4+H,le=4*V,me=Math.max(0,R),Re=Math.max(0,j);return{rect:{x:me,y:Re,width:Math.min(M.width,R+V)-me,height:Math.min(M.height,j+G)-Re},layout:[{offset:ee,stride:le}]}}(o,r,s,h,p)),S)for(let M=0;M<E.length;M+=4){const R=E[M];E[M]=E[M+2],E[M+2]=R}return E}finally{x.close()}})}let Gi,xi;function Ss(o,r,s,h){return o.addEventListener(r,s,h),{unsubscribe:()=>{o.removeEventListener(r,s,h)}}}function li(o){return o*Math.PI/180}function Hn(o){return o/Math.PI*180}const br={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Kn={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ce="AbortError";function X(){return new Error(Ce)}const Y={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ae(o){return Y.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const ye="global-dispatcher";class we extends Error{constructor(r,s,h,p){super(`AJAXError: ${s} (${r}): ${h}`),this.status=r,this.statusText=s,this.url=h,this.body=p}}const Me=()=>Dr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,je=function(o,r){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const h=ae(o.url);if(h)return h(o,r);if(Dr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:ye},r)}if(!(/^file:/.test(s=o.url)||/^file:/.test(Me())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(h,p){return c(this,void 0,void 0,function*(){const x=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:Me(),signal:p.signal});let w,S;h.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");try{w=yield fetch(x)}catch(M){throw new we(0,M.message,h.url,new Blob)}if(!w.ok){const M=yield w.blob();throw new we(w.status,w.statusText,h.url,M)}S=h.type==="arrayBuffer"||h.type==="image"?w.arrayBuffer():h.type==="json"?w.json():w.text();const E=yield S;if(p.signal.aborted)throw X();return{data:E,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(o,r);if(Dr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:ye},r)}var s;return function(h,p){return new Promise((x,w)=>{var S;const E=new XMLHttpRequest;E.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(E.responseType="arraybuffer");for(const M in h.headers)E.setRequestHeader(M,h.headers[M]);h.type==="json"&&(E.responseType="text",!((S=h.headers)===null||S===void 0)&&S.Accept||E.setRequestHeader("Accept","application/json")),E.withCredentials=h.credentials==="include",E.onerror=()=>{w(new Error(E.statusText))},E.onload=()=>{if(!p.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let M=E.response;if(h.type==="json")try{M=JSON.parse(E.response)}catch(R){return void w(R)}x({data:M,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const M=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});w(new we(E.status,E.statusText,h.url,M))}},p.signal.addEventListener("abort",()=>{E.abort(),w(X())}),E.send(h.body)})}(o,r)};function ke(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const r=new URL(o),s=window.location;return r.protocol===s.protocol&&r.host===s.host}function He(o,r,s){s[o]&&s[o].indexOf(r)!==-1||(s[o]=s[o]||[],s[o].push(r))}function et(o,r,s){if(s&&s[o]){const h=s[o].indexOf(r);h!==-1&&s[o].splice(h,1)}}class Ye{constructor(r,s={}){Vn(this,s),this.type=r}}class bt extends Ye{constructor(r,s={}){super("error",Vn({error:r},s))}}class Ct{on(r,s){return this._listeners=this._listeners||{},He(r,s,this._listeners),{unsubscribe:()=>{this.off(r,s)}}}off(r,s){return et(r,s,this._listeners),et(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},He(r,s,this._oneTimeListeners),this):new Promise(h=>this.once(r,h))}fire(r,s){typeof r=="string"&&(r=new Ye(r,s||{}));const h=r.type;if(this.listens(h)){r.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const S of p)S.call(this,r);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const S of x)et(h,S,this._oneTimeListeners),S.call(this,r);const w=this._eventedParent;w&&(Vn(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(r))}else r instanceof bt&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}var De={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ht=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yn(o,r){const s={};for(const h in o)h!=="ref"&&(s[h]=o[h]);return Ht.forEach(h=>{h in r&&(s[h]=r[h])}),s}function St(o,r){if(Array.isArray(o)){if(!Array.isArray(r)||o.length!==r.length)return!1;for(let s=0;s<o.length;s++)if(!St(o[s],r[s]))return!1;return!0}if(typeof o=="object"&&o!==null&&r!==null){if(typeof r!="object"||Object.keys(o).length!==Object.keys(r).length)return!1;for(const s in o)if(!St(o[s],r[s]))return!1;return!0}return o===r}function on(o,r){o.push(r)}function ir(o,r,s){on(s,{command:"addSource",args:[o,r[o]]})}function Zn(o,r,s){on(r,{command:"removeSource",args:[o]}),s[o]=!0}function Xn(o,r,s,h){Zn(o,s,h),ir(o,r,s)}function wr(o,r,s){let h;for(h in o[s])if(Object.prototype.hasOwnProperty.call(o[s],h)&&h!=="data"&&!St(o[s][h],r[s][h]))return!1;for(h in r[s])if(Object.prototype.hasOwnProperty.call(r[s],h)&&h!=="data"&&!St(o[s][h],r[s][h]))return!1;return!0}function En(o,r,s,h,p,x){o=o||{},r=r||{};for(const w in o)Object.prototype.hasOwnProperty.call(o,w)&&(St(o[w],r[w])||s.push({command:x,args:[h,w,r[w],p]}));for(const w in r)Object.prototype.hasOwnProperty.call(r,w)&&!Object.prototype.hasOwnProperty.call(o,w)&&(St(o[w],r[w])||s.push({command:x,args:[h,w,r[w],p]}))}function Tr(o){return o.id}function nn(o,r){return o[r.id]=r,o}class Fe{constructor(r,s,h,p){this.message=(r?`${r}: `:"")+h,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function is(o,...r){for(const s of r)for(const h in s)o[h]=s[h];return o}class bi extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class wi{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[h,p]of s)this.bindings[h]=p}concat(r){return new wi(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const fr={kind:"null"},ut={kind:"number"},Jt={kind:"string"},qt={kind:"boolean"},Ti={kind:"color"},Ps={kind:"projectionDefinition"},Es={kind:"object"},Xt={kind:"value"},Pa={kind:"collator"},Ea={kind:"formatted"},jo={kind:"padding"},mo={kind:"colorArray"},Zs={kind:"numberArray"},Bo={kind:"resolvedImage"},sr={kind:"variableAnchorOffsetCollection"};function Ri(o,r){return{kind:"array",itemType:o,N:r}}function Nn(o){if(o.kind==="array"){const r=Nn(o.itemType);return typeof o.N=="number"?`array<${r}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${r}>`}return o.kind}const Fo=[fr,ut,Jt,qt,Ti,Ps,Ea,Es,Ri(Xt),jo,Zs,mo,Bo,sr];function Cs(o,r){if(r.kind==="error")return null;if(o.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Cs(o.itemType,r.itemType))&&(typeof o.N!="number"||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if(o.kind==="value"){for(const s of Fo)if(!Cs(s,r))return null}}return`Expected ${Nn(o)} but found ${Nn(r)} instead.`}function oc(o,r){return r.some(s=>s.kind===o.kind)}function go(o,r){return r.some(s=>s==="null"?o===null:s==="array"?Array.isArray(o):s==="object"?o&&!Array.isArray(o)&&typeof o=="object":s===typeof o)}function Li(o,r){return o.kind==="array"&&r.kind==="array"?o.itemType.kind===r.itemType.kind&&typeof o.N=="number":o.kind===r.kind}const vn=.96422,On=.82521,vl=4/29,ss=6/29,Uo=3*ss*ss,wu=ss*ss*ss,rn=Math.PI/180,or=180/Math.PI;function ac(o){return(o%=360)<0&&(o+=360),o}function Ca([o,r,s,h]){let p,x;const w=Tu((.2225045*(o=Nr(o))+.7168786*(r=Nr(r))+.0606169*(s=Nr(s)))/1);o===r&&r===s?p=x=w:(p=Tu((.4360747*o+.3850649*r+.1430804*s)/vn),x=Tu((.0139322*o+.0971045*r+.7141733*s)/On));const S=116*w-16;return[S<0?0:S,500*(p-w),200*(w-x),h]}function Nr(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Tu(o){return o>wu?Math.pow(o,1/3):o/Uo+vl}function xl([o,r,s,h]){let p=(o+16)/116,x=isNaN(r)?p:p+r/500,w=isNaN(s)?p:p-s/200;return p=1*Yn(p),x=vn*Yn(x),w=On*Yn(w),[zi(3.1338561*x-1.6168667*p-.4906146*w),zi(-.9787684*x+1.9161415*p+.033454*w),zi(.0719453*x-.2289914*p+1.4052427*w),h]}function zi(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function Yn(o){return o>ss?o*o*o:Uo*(o-vl)}const Vo=Object.hasOwn||function(o,r){return Object.prototype.hasOwnProperty.call(o,r)};function Gs(o,r){return Vo(o,r)?o[r]:void 0}function qs(o){return parseInt(o.padEnd(2,o),16)/255}function bl(o,r){return Sr(r?o/100:o,0,1)}function Sr(o,r,s){return Math.min(Math.max(r,o),s)}function sn(o){return!o.some(Number.isNaN)}const _o={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Or(o,r,s){return o+s*(r-o)}function Ws(o,r,s){return o.map((h,p)=>Or(h,r[p],s))}class Qt{constructor(r,s,h,p=1,x=!0){this.r=r,this.g=s,this.b=h,this.a=p,x||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[r,s,h,p]))}static parse(r){if(r instanceof Qt)return r;if(typeof r!="string")return;const s=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Gs(_o,h);if(p){const[w,S,E]=p;return[w/255,S/255,E/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const w=h.length<6?1:2;let S=1;return[qs(h.slice(S,S+=w)),qs(h.slice(S,S+=w)),qs(h.slice(S,S+=w)),qs(h.slice(S,S+w)||"ff")]}if(h.startsWith("rgb")){const w=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[S,E,M,R,j,V,G,H,ee,le,me,Re]=w,be=[R||" ",G||" ",le].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Pe=[M,V,ee].join(""),Ve=Pe==="%%%"?100:Pe===""?255:0;if(Ve){const Xe=[Sr(+E/Ve,0,1),Sr(+j/Ve,0,1),Sr(+H/Ve,0,1),me?bl(+me,Re):1];if(sn(Xe))return Xe}}return}}const x=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,S,E,M,R,j,V,G,H]=x,ee=[E||" ",R||" ",V].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const le=[+S,Sr(+M,0,100),Sr(+j,0,100),G?bl(+G,H):1];if(sn(le))return function([me,Re,be,Pe]){function Ve(Xe){const rt=(Xe+me/30)%12,gt=Re*Math.min(be,1-be);return be-gt*Math.max(-1,Math.min(rt-3,9-rt,1))}return me=ac(me),Re/=100,be/=100,[Ve(0),Ve(8),Ve(4),Pe]}(le)}}}(r);return s?new Qt(...s,!1):void 0}get rgb(){const{r,g:s,b:h,a:p}=this,x=p||1/0;return this.overwriteGetter("rgb",[r/x,s/x,h/x,p])}get hcl(){return this.overwriteGetter("hcl",function(r){const[s,h,p,x]=Ca(r),w=Math.sqrt(h*h+p*p);return[Math.round(1e4*w)?ac(Math.atan2(p,h)*or):NaN,w,s,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ca(this.rgb))}overwriteGetter(r,s){return Object.defineProperty(this,r,{value:s}),s}toString(){const[r,s,h,p]=this.rgb;return`rgba(${[r,s,h].map(x=>Math.round(255*x)).join(",")},${p})`}static interpolate(r,s,h,p="rgb"){switch(p){case"rgb":{const[x,w,S,E]=Ws(r.rgb,s.rgb,h);return new Qt(x,w,S,E,!1)}case"hcl":{const[x,w,S,E]=r.hcl,[M,R,j,V]=s.hcl;let G,H;if(isNaN(x)||isNaN(M))isNaN(x)?isNaN(M)?G=NaN:(G=M,S!==1&&S!==0||(H=R)):(G=x,j!==1&&j!==0||(H=w));else{let be=M-x;M>x&&be>180?be-=360:M<x&&x-M>180&&(be+=360),G=x+h*be}const[ee,le,me,Re]=function([be,Pe,Ve,Xe]){return be=isNaN(be)?0:be*rn,xl([Ve,Math.cos(be)*Pe,Math.sin(be)*Pe,Xe])}([G,H??Or(w,R,h),Or(S,j,h),Or(E,V,h)]);return new Qt(ee,le,me,Re,!1)}case"lab":{const[x,w,S,E]=xl(Ws(r.lab,s.lab,h));return new Qt(x,w,S,E,!1)}}}}Qt.black=new Qt(0,0,0,1),Qt.white=new Qt(1,1,1,1),Qt.transparent=new Qt(0,0,0,0),Qt.red=new Qt(1,0,0,1);class yo{constructor(r,s,h){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ia=["bottom","center","top"];class vo{constructor(r,s,h,p,x,w){this.text=r,this.image=s,this.scale=h,this.fontStack=p,this.textColor=x,this.verticalAlign=w}}class Si{constructor(r){this.sections=r}static fromString(r){return new Si([new vo(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof Si?r:Si.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class Dt{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Dt)return r;if(typeof r=="number")return new Dt([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const s of r)if(typeof s!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new Dt(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,h){return new Dt(Ws(r.values,s.values,h))}}class kn{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof kn)return r;if(typeof r=="number")return new kn([r]);if(Array.isArray(r)){for(const s of r)if(typeof s!="number")return;return new kn(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,h){return new kn(Ws(r.values,s.values,h))}}class en{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof en)return r;if(typeof r=="string"){const h=Qt.parse(r);return h?new en([h]):void 0}if(!Array.isArray(r))return;const s=[];for(const h of r){if(typeof h!="string")return;const p=Qt.parse(h);if(!p)return;s.push(p)}return new en(s)}toString(){return JSON.stringify(this.values)}static interpolate(r,s,h,p="rgb"){const x=[];if(r.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${r.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let w=0;w<r.values.length;w++)x.push(Qt.interpolate(r.values[w],s.values[w],h,p));return new en(x)}}class Mn extends Error{constructor(r){super(r),this.name="RuntimeError"}toJSON(){return this.message}}const xo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class $r{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof $r)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let s=0;s<r.length;s+=2){const h=r[s],p=r[s+1];if(typeof h!="string"||!xo.has(h)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new $r(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,h){const p=r.values,x=s.values;if(p.length!==x.length)throw new Mn(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${s.toString()}`);const w=[];for(let S=0;S<p.length;S+=2){if(p[S]!==x[S])throw new Mn(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${p[S]}, to[${S}]: ${x[S]}`);w.push(p[S]);const[E,M]=p[S+1],[R,j]=x[S+1];w.push([Or(E,R,h),Or(M,j,h)])}return new $r(w)}}class ci{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new ci({name:r,available:!1}):null}}class pr{constructor(r,s,h){this.from=r,this.to=s,this.transition=h}static interpolate(r,s,h){return new pr(r,s,h)}static parse(r){return r instanceof pr?r:Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number"?new pr(r[0],r[1],r[2]):typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number"?new pr(r.from,r.to,r.transition):typeof r=="string"?new pr(r,r,1):void 0}}function $o(o,r,s,h){return typeof o=="number"&&o>=0&&o<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[o,r,s,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[o,r,s,h]:[o,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xn(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof pr||o instanceof Qt||o instanceof yo||o instanceof Si||o instanceof Dt||o instanceof kn||o instanceof en||o instanceof $r||o instanceof ci)return!0;if(Array.isArray(o)){for(const r of o)if(!xn(r))return!1;return!0}if(typeof o=="object"){for(const r in o)if(!xn(o[r]))return!1;return!0}return!1}function an(o){if(o===null)return fr;if(typeof o=="string")return Jt;if(typeof o=="boolean")return qt;if(typeof o=="number")return ut;if(o instanceof Qt)return Ti;if(o instanceof pr)return Ps;if(o instanceof yo)return Pa;if(o instanceof Si)return Ea;if(o instanceof Dt)return jo;if(o instanceof kn)return Zs;if(o instanceof en)return mo;if(o instanceof $r)return sr;if(o instanceof ci)return Bo;if(Array.isArray(o)){const r=o.length;let s;for(const h of o){const p=an(h);if(s){if(s===p)continue;s=Xt;break}s=p}return Ri(s||Xt,r)}return Es}function Kt(o){const r=typeof o;return o===null?"":r==="string"||r==="number"||r==="boolean"?String(o):o instanceof Qt||o instanceof pr||o instanceof Si||o instanceof Dt||o instanceof kn||o instanceof en||o instanceof $r||o instanceof ci?o.toString():JSON.stringify(o)}class $t{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!xn(r[1]))return s.error("invalid value");const h=r[1];let p=an(h);const x=s.expectedType;return p.kind!=="array"||p.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(p=x),new $t(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Zo={string:Jt,number:ut,boolean:qt,object:Es};class Yt{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let h,p=1;const x=r[0];if(x==="array"){let S,E;if(r.length>2){const M=r[1];if(typeof M!="string"||!(M in Zo)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);S=Zo[M],p++}else S=Xt;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=r[2],p++}h=Ri(S,E)}else{if(!Zo[x])throw new Error(`Types doesn't contain name = ${x}`);h=Zo[x]}const w=[];for(;p<r.length;p++){const S=s.parse(r[p],p,Xt);if(!S)return null;w.push(S)}return new Yt(h,w)}evaluate(r){for(let s=0;s<this.args.length;s++){const h=this.args[s].evaluate(r);if(!Cs(this.type,an(h)))return h;if(s===this.args.length-1)throw new Mn(`Expected value to be of type ${Nn(this.type)}, but found ${Nn(an(h))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const wl={"to-boolean":qt,"to-color":Ti,"to-number":ut,"to-string":Jt};class jr{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const h=r[0];if(!wl[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&r.length!==2)return s.error("Expected one argument.");const p=wl[h],x=[];for(let w=1;w<r.length;w++){const S=s.parse(r[w],w,Xt);if(!S)return null;x.push(S)}return new jr(p,x)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let s,h;for(const p of this.args){if(s=p.evaluate(r),h=null,s instanceof Qt)return s;if(typeof s=="string"){const x=r.parseColor(s);if(x)return x}else if(Array.isArray(s)&&(h=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:$o(s[0],s[1],s[2],s[3]),!h))return new Qt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Mn(h||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const h of this.args){s=h.evaluate(r);const p=Dt.parse(s);if(p)return p}throw new Mn(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const h of this.args){s=h.evaluate(r);const p=kn.parse(s);if(p)return p}throw new Mn(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const h of this.args){s=h.evaluate(r);const p=en.parse(s);if(p)return p}throw new Mn(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const h of this.args){s=h.evaluate(r);const p=$r.parse(s);if(p)return p}throw new Mn(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const h of this.args){if(s=h.evaluate(r),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new Mn(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Si.fromString(Kt(this.args[0].evaluate(r)));case"resolvedImage":return ci.fromString(Kt(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return Kt(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Su=["Unknown","Point","LineString","Polygon"];class ka{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Su[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let s=this._parseColorCache.get(r);return s||(s=Qt.parse(r),this._parseColorCache.set(r,s)),s}}class cn{constructor(r,s,h=[],p,x=new wi,w=[]){this.registry=r,this.path=h,this.key=h.map(S=>`[${S}]`).join(""),this.scope=x,this.errors=w,this.expectedType=p,this._isConstant=s}parse(r,s,h,p,x={}){return s?this.concat(s,h,p)._parse(r,x):this._parse(r,x)}_parse(r,s){function h(p,x,w){return w==="assert"?new Yt(x,[p]):w==="coerce"?new jr(x,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[p];if(x){let w=x.parse(r,this);if(!w)return null;if(this.expectedType){const S=this.expectedType,E=w.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||E.kind!=="value"){if(S.kind==="projectionDefinition"&&["string","array"].includes(E.kind)||["color","formatted","resolvedImage"].includes(S.kind)&&["value","string"].includes(E.kind)||["padding","numberArray"].includes(S.kind)&&["value","number","array"].includes(E.kind)||S.kind==="colorArray"&&["value","string","array"].includes(E.kind)||S.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(E.kind))w=h(w,S,s.typeAnnotation||"coerce");else if(this.checkSubtype(S,E))return null}else w=h(w,S,s.typeAnnotation||"assert")}if(!(w instanceof $t)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const S=new ka;try{w=new $t(w.type,w.evaluate(S))}catch(E){return this.error(E.message),null}}return w}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,h){const p=typeof r=="number"?this.path.concat(r):this.path,x=h?this.scope.concat(h):this.scope;return new cn(this.registry,this._isConstant,p,s||null,x,this.errors)}error(r,...s){const h=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new bi(h,r))}checkSubtype(r,s){const h=Cs(r,s);return h&&this.error(h),h}}class Ma{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let x=1;x<r.length-1;x+=2){const w=r[x];if(typeof w!="string")return s.error(`Expected string, but found ${typeof w} instead.`,x);if(/[^a-zA-Z0-9_]/.test(w))return s.error("Variable names must contain only alphanumeric characters or '_'.",x);const S=s.parse(r[x+1],x+1);if(!S)return null;h.push([w,S])}const p=s.parse(r[r.length-1],r.length-1,s.expectedType,h);return p?new Ma(h,p):null}outputDefined(){return this.result.outputDefined()}}class ui{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const h=r[1];return s.scope.has(h)?new ui(h,s.scope.get(h)):s.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Go{constructor(r,s,h){this.type=r,this.index=s,this.input=h}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=s.parse(r[1],1,ut),p=s.parse(r[2],2,Ri(s.expectedType||Xt));return h&&p?new Go(p.type.itemType,h,p):null}evaluate(r){const s=this.index.evaluate(r),h=this.input.evaluate(r);if(s<0)throw new Mn(`Array index out of bounds: ${s} < 0.`);if(s>=h.length)throw new Mn(`Array index out of bounds: ${s} > ${h.length-1}.`);if(s!==Math.floor(s))throw new Mn(`Array index must be an integer, but found ${s} instead.`);return h[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Tl{constructor(r,s){this.type=qt,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=s.parse(r[1],1,Xt),p=s.parse(r[2],2,Xt);return h&&p?oc(h.type,[qt,Jt,ut,fr,Xt])?new Tl(h,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(h.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!h)return!1;if(!go(s,["boolean","string","number","null"]))throw new Mn(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(an(s))} instead.`);if(!go(h,["string","array"]))throw new Mn(`Expected second argument to be of type array or string, but found ${Nn(an(h))} instead.`);return h.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Sl{constructor(r,s,h){this.type=ut,this.needle=r,this.haystack=s,this.fromIndex=h}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 2 or 3 arguments, but found ${r.length-1} instead.`);const h=s.parse(r[1],1,Xt),p=s.parse(r[2],2,Xt);if(!h||!p)return null;if(!oc(h.type,[qt,Jt,ut,fr,Xt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(h.type)} instead`);if(r.length===4){const x=s.parse(r[3],3,ut);return x?new Sl(h,p,x):null}return new Sl(h,p)}evaluate(r){const s=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!go(s,["boolean","string","number","null"]))throw new Mn(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(an(s))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(r)),go(h,["string"])){const x=h.indexOf(s,p);return x===-1?-1:[...h.slice(0,x)].length}if(go(h,["array"]))return h.indexOf(s,p);throw new Mn(`Expected second argument to be of type array or string, but found ${Nn(an(h))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class qi{constructor(r,s,h,p,x,w){this.inputType=r,this.type=s,this.input=h,this.cases=p,this.outputs=x,this.otherwise=w}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let h,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const x={},w=[];for(let M=2;M<r.length-1;M+=2){let R=r[M];const j=r[M+1];Array.isArray(R)||(R=[R]);const V=s.concat(M);if(R.length===0)return V.error("Expected at least one branch label.");for(const H of R){if(typeof H!="number"&&typeof H!="string")return V.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return V.error("Numeric branch labels must be integer values.");if(h){if(V.checkSubtype(h,an(H)))return null}else h=an(H);if(x[String(H)]!==void 0)return V.error("Branch labels must be unique.");x[String(H)]=w.length}const G=s.parse(j,M,p);if(!G)return null;p=p||G.type,w.push(G)}const S=s.parse(r[1],1,Xt);if(!S)return null;const E=s.parse(r[r.length-1],r.length-1,p);return E?S.type.kind!=="value"&&s.concat(1).checkSubtype(h,S.type)?null:new qi(h,p,S,x,w,E):null}evaluate(r){const s=this.input.evaluate(r);return(an(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class Br{constructor(r,s,h){this.type=r,this.branches=s,this.otherwise=h}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const p=[];for(let w=1;w<r.length-1;w+=2){const S=s.parse(r[w],w,qt);if(!S)return null;const E=s.parse(r[w+1],w+1,h);if(!E)return null;p.push([S,E]),h=h||E.type}const x=s.parse(r[r.length-1],r.length-1,h);if(!x)return null;if(!h)throw new Error("Can't infer output type");return new Br(h,p,x)}evaluate(r){for(const[s,h]of this.branches)if(s.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,h]of this.branches)r(s),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class bo{constructor(r,s,h,p){this.type=r,this.input=s,this.beginIndex=h,this.endIndex=p}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 2 or 3 arguments, but found ${r.length-1} instead.`);const h=s.parse(r[1],1,Xt),p=s.parse(r[2],2,ut);if(!h||!p)return null;if(!oc(h.type,[Ri(Xt),Jt,Xt]))return s.error(`Expected first argument to be of type array or string, but found ${Nn(h.type)} instead`);if(r.length===4){const x=s.parse(r[3],3,ut);return x?new bo(h.type,h,p,x):null}return new bo(h.type,h,p)}evaluate(r){const s=this.input.evaluate(r),h=this.beginIndex.evaluate(r);let p;if(this.endIndex&&(p=this.endIndex.evaluate(r)),go(s,["string"]))return[...s].slice(h,p).join("");if(go(s,["array"]))return s.slice(h,p);throw new Mn(`Expected first argument to be of type array or string, but found ${Nn(an(s))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Pl(o,r){const s=o.length-1;let h,p,x=0,w=s,S=0;for(;x<=w;)if(S=Math.floor((x+w)/2),h=o[S],p=o[S+1],h<=r){if(S===s||r<p)return S;x=S+1}else{if(!(h>r))throw new Mn("Input is not a number.");w=S-1}return 0}class wo{constructor(r,s,h){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[p,x]of h)this.labels.push(p),this.outputs.push(x)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const h=s.parse(r[1],1,ut);if(!h)return null;const p=[];let x=null;s.expectedType&&s.expectedType.kind!=="value"&&(x=s.expectedType);for(let w=1;w<r.length;w+=2){const S=w===1?-1/0:r[w],E=r[w+1],M=w,R=w+1;if(typeof S!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=S)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const j=s.parse(E,R,x);if(!j)return null;x=x||j.type,p.push([S,j])}return new wo(x,h,p)}evaluate(r){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=s[0])return h[0].evaluate(r);const x=s.length;return p>=s[x-1]?h[x-1].evaluate(r):h[Pl(s,p)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function mr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var lc,Di,bh=function(){if(Di)return lc;function o(r,s,h,p){this.cx=3*r,this.bx=3*(h-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=h,this.p2y=p}return Di=1,lc=o,o.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var h=r,p=0;p<8;p++){var x=this.sampleCurveX(h)-r;if(Math.abs(x)<s)return h;var w=this.sampleCurveDerivativeX(h);if(Math.abs(w)<1e-6)break;h-=x/w}var S=0,E=1;for(h=r,p=0;p<20&&(x=this.sampleCurveX(h),!(Math.abs(x-r)<s));p++)r>x?S=h:E=h,h=.5*(E-S)+S;return h},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},lc}(),wh=mr(bh);class zn{constructor(r,s,h,p,x){this.type=r,this.operator=s,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[w,S]of x)this.labels.push(w),this.outputs.push(S)}static interpolationFactor(r,s,h,p){let x=0;if(r.name==="exponential")x=qo(s,r.base,h,p);else if(r.name==="linear")x=qo(s,1,h,p);else if(r.name==="cubic-bezier"){const w=r.controlPoints;x=new wh(w[0],w[1],w[2],w[3]).solve(qo(s,1,h,p))}return x}static parse(r,s){let[h,p,x,...w]=r;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const M=p[1];if(typeof M!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(M.length!==4||M.some(R=>typeof R!="number"||R<0||R>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(x=s.parse(x,2,ut),!x)return null;const S=[];let E=null;h!=="interpolate-hcl"&&h!=="interpolate-lab"||s.expectedType==mo?s.expectedType&&s.expectedType.kind!=="value"&&(E=s.expectedType):E=Ti;for(let M=0;M<w.length;M+=2){const R=w[M],j=w[M+1],V=M+3,G=M+4;if(typeof R!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(S.length&&S[S.length-1][0]>=R)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const H=s.parse(j,G,E);if(!H)return null;E=E||H.type,S.push([R,H])}return Li(E,ut)||Li(E,Ps)||Li(E,Ti)||Li(E,jo)||Li(E,Zs)||Li(E,mo)||Li(E,sr)||Li(E,Ri(ut))?new zn(E,h,p,x,S):s.error(`Type ${Nn(E)} is not interpolatable.`)}evaluate(r){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=s[0])return h[0].evaluate(r);const x=s.length;if(p>=s[x-1])return h[x-1].evaluate(r);const w=Pl(s,p),S=zn.interpolationFactor(this.interpolation,p,s[w],s[w+1]),E=h[w].evaluate(r),M=h[w+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Or(E,M,S);case"color":return Qt.interpolate(E,M,S);case"padding":return Dt.interpolate(E,M,S);case"colorArray":return en.interpolate(E,M,S);case"numberArray":return kn.interpolate(E,M,S);case"variableAnchorOffsetCollection":return $r.interpolate(E,M,S);case"array":return Ws(E,M,S);case"projectionDefinition":return pr.interpolate(E,M,S)}case"interpolate-hcl":switch(this.type.kind){case"color":return Qt.interpolate(E,M,S,"hcl");case"colorArray":return en.interpolate(E,M,S,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Qt.interpolate(E,M,S,"lab");case"colorArray":return en.interpolate(E,M,S,"lab")}}}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function qo(o,r,s,h){const p=h-s,x=o-s;return p===0?0:r===1?x/p:(Math.pow(r,x)-1)/(Math.pow(r,p)-1)}const Ni={color:Qt.interpolate,number:Or,padding:Dt.interpolate,numberArray:kn.interpolate,colorArray:en.interpolate,variableAnchorOffsetCollection:$r.interpolate,array:Ws};class Aa{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let h=null;const p=s.expectedType;p&&p.kind!=="value"&&(h=p);const x=[];for(const S of r.slice(1)){const E=s.parse(S,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!E)return null;h=h||E.type,x.push(E)}if(!h)throw new Error("No output type");const w=p&&x.some(S=>Cs(p,S.type));return new Aa(w?Xt:h,x)}evaluate(r){let s,h=null,p=0;for(const x of this.args)if(p++,h=x.evaluate(r),h&&h instanceof ci&&!h.available&&(s||(s=h.name),h=null,p===this.args.length&&(h=s)),h!==null)break;return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}function Pu(o,r){return o==="=="||o==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Ra(o,r,s,h){return h.compare(r,s)===0}function Is(o,r,s){const h=o!=="=="&&o!=="!=";return class Hk{constructor(x,w,S){this.type=qt,this.lhs=x,this.rhs=w,this.collator=S,this.hasUntypedArgument=x.type.kind==="value"||w.type.kind==="value"}static parse(x,w){if(x.length!==3&&x.length!==4)return w.error("Expected two or three arguments.");const S=x[0];let E=w.parse(x[1],1,Xt);if(!E)return null;if(!Pu(S,E.type))return w.concat(1).error(`"${S}" comparisons are not supported for type '${Nn(E.type)}'.`);let M=w.parse(x[2],2,Xt);if(!M)return null;if(!Pu(S,M.type))return w.concat(2).error(`"${S}" comparisons are not supported for type '${Nn(M.type)}'.`);if(E.type.kind!==M.type.kind&&E.type.kind!=="value"&&M.type.kind!=="value")return w.error(`Cannot compare types '${Nn(E.type)}' and '${Nn(M.type)}'.`);h&&(E.type.kind==="value"&&M.type.kind!=="value"?E=new Yt(M.type,[E]):E.type.kind!=="value"&&M.type.kind==="value"&&(M=new Yt(E.type,[M])));let R=null;if(x.length===4){if(E.type.kind!=="string"&&M.type.kind!=="string"&&E.type.kind!=="value"&&M.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(R=w.parse(x[3],3,Pa),!R)return null}return new Hk(E,M,R)}evaluate(x){const w=this.lhs.evaluate(x),S=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const E=an(w),M=an(S);if(E.kind!==M.kind||E.kind!=="string"&&E.kind!=="number")throw new Mn(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${M.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const E=an(w),M=an(S);if(E.kind!=="string"||M.kind!=="string")return r(x,w,S)}return this.collator?s(x,w,S,this.collator.evaluate(x)):r(x,w,S)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const os=Is("==",function(o,r,s){return r===s},Ra),Th=Is("!=",function(o,r,s){return r!==s},function(o,r,s,h){return!Ra(0,r,s,h)}),La=Is("<",function(o,r,s){return r<s},function(o,r,s,h){return h.compare(r,s)<0}),lf=Is(">",function(o,r,s){return r>s},function(o,r,s,h){return h.compare(r,s)>0}),cc=Is("<=",function(o,r,s){return r<=s},function(o,r,s,h){return h.compare(r,s)<=0}),Sh=Is(">=",function(o,r,s){return r>=s},function(o,r,s,h){return h.compare(r,s)>=0});class Wo{constructor(r,s,h){this.type=Pa,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return s.error("Collator options argument must be an object.");const p=s.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,qt);if(!p)return null;const x=s.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,qt);if(!x)return null;let w=null;return h.locale&&(w=s.parse(h.locale,1,Jt),!w)?null:new Wo(p,x,w)}evaluate(r){return new yo(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class Hs{constructor(r,s,h,p,x){this.type=Jt,this.number=r,this.locale=s,this.currency=h,this.minFractionDigits=p,this.maxFractionDigits=x}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const h=s.parse(r[1],1,ut);if(!h)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let x=null;if(p.locale&&(x=s.parse(p.locale,1,Jt),!x))return null;let w=null;if(p.currency&&(w=s.parse(p.currency,1,Jt),!w))return null;let S=null;if(p["min-fraction-digits"]&&(S=s.parse(p["min-fraction-digits"],1,ut),!S))return null;let E=null;return p["max-fraction-digits"]&&(E=s.parse(p["max-fraction-digits"],1,ut),!E)?null:new Hs(h,x,w,S,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class uc{constructor(r){this.type=Ea,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return s.error("First argument must be an image or text section.");const p=[];let x=!1;for(let w=1;w<=r.length-1;++w){const S=r[w];if(x&&typeof S=="object"&&!Array.isArray(S)){x=!1;let E=null;if(S["font-scale"]&&(E=s.parse(S["font-scale"],1,ut),!E))return null;let M=null;if(S["text-font"]&&(M=s.parse(S["text-font"],1,Ri(Jt)),!M))return null;let R=null;if(S["text-color"]&&(R=s.parse(S["text-color"],1,Ti),!R))return null;let j=null;if(S["vertical-align"]){if(typeof S["vertical-align"]=="string"&&!Ia.includes(S["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${S["vertical-align"]}' instead.`);if(j=s.parse(S["vertical-align"],1,Jt),!j)return null}const V=p[p.length-1];V.scale=E,V.font=M,V.textColor=R,V.verticalAlign=j}else{const E=s.parse(r[w],1,Xt);if(!E)return null;const M=E.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new uc(p)}evaluate(r){return new Si(this.sections.map(s=>{const h=s.content.evaluate(r);return an(h)===Bo?new vo("",h,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(r):null):new vo(Kt(h),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null,s.verticalAlign?s.verticalAlign.evaluate(r):null)}))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor),s.verticalAlign&&r(s.verticalAlign)}outputDefined(){return!1}}class ks{constructor(r){this.type=Bo,this.input=r}static parse(r,s){if(r.length!==2)return s.error("Expected two arguments.");const h=s.parse(r[1],1,Jt);return h?new ks(h):s.error("No image name provided.")}evaluate(r){const s=this.input.evaluate(r),h=ci.fromString(s);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(s)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}}class Pi{constructor(r){this.type=ut,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=s.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Nn(h.type)} instead.`):new Pi(h):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new Mn(`Expected value to be of type string or array, but found ${Nn(an(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const Wi=8192;function Eu(o,r){const s=(180+o[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(s*p*Wi),Math.round(h*p*Wi)]}function Cu(o,r){const s=Math.pow(2,r.z);return[(p=(o[0]/Wi+r.x)/s,360*p-180),(h=(o[1]/Wi+r.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,p}function To(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function Ho(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function cf(o,r,s){const h=o[0]-r[0],p=o[1]-r[1],x=o[0]-s[0],w=o[1]-s[1];return h*w-x*p==0&&h*x<=0&&p*w<=0}function hc(o,r,s,h){return(p=[h[0]-s[0],h[1]-s[1]])[0]*(x=[r[0]-o[0],r[1]-o[1]])[1]-p[1]*x[0]!=0&&!(!Ms(o,r,s,h)||!Ms(s,h,o,r));var p,x}function Ph(o,r,s){for(const h of s)for(let p=0;p<h.length-1;++p)if(hc(o,r,h[p],h[p+1]))return!0;return!1}function za(o,r,s=!1){let h=!1;for(const S of r)for(let E=0;E<S.length-1;E++){if(cf(o,S[E],S[E+1]))return s;(x=S[E])[1]>(p=o)[1]!=(w=S[E+1])[1]>p[1]&&p[0]<(w[0]-x[0])*(p[1]-x[1])/(w[1]-x[1])+x[0]&&(h=!h)}var p,x,w;return h}function Hi(o,r){for(const s of r)if(za(o,s))return!0;return!1}function So(o,r){for(const s of o)if(!za(s,r))return!1;for(let s=0;s<o.length-1;++s)if(Ph(o[s],o[s+1],r))return!1;return!0}function Eh(o,r){for(const s of r)if(So(o,s))return!0;return!1}function Ms(o,r,s,h){const p=h[0]-s[0],x=h[1]-s[1],w=(o[0]-s[0])*x-p*(o[1]-s[1]),S=(r[0]-s[0])*x-p*(r[1]-s[1]);return w>0&&S<0||w<0&&S>0}function Iu(o,r,s){const h=[];for(let p=0;p<o.length;p++){const x=[];for(let w=0;w<o[p].length;w++){const S=Eu(o[p][w],s);To(r,S),x.push(S)}h.push(x)}return h}function Ko(o,r,s){const h=[];for(let p=0;p<o.length;p++){const x=Iu(o[p],r,s);h.push(x)}return h}function Ch(o,r,s,h){if(o[0]<s[0]||o[0]>s[2]){const p=.5*h;let x=o[0]-s[0]>p?-h:s[0]-o[0]>p?h:0;x===0&&(x=o[0]-s[2]>p?-h:s[2]-o[0]>p?h:0),o[0]+=x}To(r,o)}function Ks(o,r,s,h){const p=Math.pow(2,h.z)*Wi,x=[h.x*Wi,h.y*Wi],w=[];for(const S of o)for(const E of S){const M=[E.x+x[0],E.y+x[1]];Ch(M,r,s,p),w.push(M)}return w}function ku(o,r,s,h){const p=Math.pow(2,h.z)*Wi,x=[h.x*Wi,h.y*Wi],w=[];for(const E of o){const M=[];for(const R of E){const j=[R.x+x[0],R.y+x[1]];To(r,j),M.push(j)}w.push(M)}if(r[2]-r[0]<=p/2){(S=r)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const E of w)for(const M of E)Ch(M,r,s,p)}var S;return w}class As{constructor(r,s){this.type=qt,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(xn(r[1])){const h=r[1];if(h.type==="FeatureCollection"){const p=[];for(const x of h.features){const{type:w,coordinates:S}=x.geometry;w==="Polygon"&&p.push(S),w==="MultiPolygon"&&p.push(...S)}if(p.length)return new As(h,{type:"MultiPolygon",coordinates:p})}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new As(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new As(h,h)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(s,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=s.canonicalID();if(h.type==="Polygon"){const S=Iu(h.coordinates,x,w),E=Ks(s.geometry(),p,x,w);if(!Ho(p,x))return!1;for(const M of E)if(!za(M,S))return!1}if(h.type==="MultiPolygon"){const S=Ko(h.coordinates,x,w),E=Ks(s.geometry(),p,x,w);if(!Ho(p,x))return!1;for(const M of E)if(!Hi(M,S))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(s,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=s.canonicalID();if(h.type==="Polygon"){const S=Iu(h.coordinates,x,w),E=ku(s.geometry(),p,x,w);if(!Ho(p,x))return!1;for(const M of E)if(!So(M,S))return!1}if(h.type==="MultiPolygon"){const S=Ko(h.coordinates,x,w),E=ku(s.geometry(),p,x,w);if(!Ho(p,x))return!1;for(const M of E)if(!Eh(M,S))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ih=class{constructor(o=[],r=(s,h)=>s<h?-1:s>h?1:0){if(this.data=o,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:r,compare:s}=this,h=r[o];for(;o>0;){const p=o-1>>1,x=r[p];if(s(h,x)>=0)break;r[o]=x,o=p}r[o]=h}_down(o){const{data:r,compare:s}=this,h=this.length>>1,p=r[o];for(;o<h;){let x=1+(o<<1);const w=x+1;if(w<this.length&&s(r[w],r[x])<0&&(x=w),s(r[x],p)>=0)break;r[o]=r[x],o=x}r[o]=p}};function Xs(o,r,s=0,h=o.length-1,p=kh){for(;h>s;){if(h-s>600){const E=h-s+1,M=r-s+1,R=Math.log(E),j=.5*Math.exp(2*R/3),V=.5*Math.sqrt(R*j*(E-j)/E)*(M-E/2<0?-1:1);Xs(o,r,Math.max(s,Math.floor(r-M*j/E+V)),Math.min(h,Math.floor(r+(E-M)*j/E+V)),p)}const x=o[r];let w=s,S=h;for(Rs(o,s,r),p(o[h],x)>0&&Rs(o,s,h);w<S;){for(Rs(o,w,S),w++,S--;p(o[w],x)<0;)w++;for(;p(o[S],x)>0;)S--}p(o[s],x)===0?Rs(o,s,S):(S++,Rs(o,S,h)),S<=r&&(s=S+1),r<=S&&(h=S-1)}}function Rs(o,r,s){const h=o[r];o[r]=o[s],o[s]=h}function kh(o,r){return o<r?-1:o>r?1:0}function Da(o,r){if(o.length<=1)return[o];const s=[];let h,p;for(const x of o){const w=Ls(x);w!==0&&(x.area=Math.abs(w),p===void 0&&(p=w<0),p===w<0?(h&&s.push(h),h=[x]):h.push(x))}if(h&&s.push(h),r>1)for(let x=0;x<s.length;x++)s[x].length<=r||(Xs(s[x],r,1,s[x].length-1,uf),s[x]=s[x].slice(0,r));return s}function uf(o,r){return r.area-o.area}function Ls(o){let r=0;for(let s,h,p=0,x=o.length,w=x-1;p<x;w=p++)s=o[p],h=o[w],r+=(h.x-s.x)*(s.y+h.y);return r}const Mu=1/298.257223563,Xo=Mu*(2-Mu),Mh=Math.PI/180;class as{constructor(r){const s=6378.137*Mh*1e3,h=Math.cos(r*Mh),p=1/(1-Xo*(1-h*h)),x=Math.sqrt(p);this.kx=s*x*h,this.ky=s*x*p*(1-Xo)}distance(r,s){const h=this.wrap(r[0]-s[0])*this.kx,p=(r[1]-s[1])*this.ky;return Math.sqrt(h*h+p*p)}pointOnLine(r,s){let h,p,x,w,S=1/0;for(let E=0;E<r.length-1;E++){let M=r[E][0],R=r[E][1],j=this.wrap(r[E+1][0]-M)*this.kx,V=(r[E+1][1]-R)*this.ky,G=0;j===0&&V===0||(G=(this.wrap(s[0]-M)*this.kx*j+(s[1]-R)*this.ky*V)/(j*j+V*V),G>1?(M=r[E+1][0],R=r[E+1][1]):G>0&&(M+=j/this.kx*G,R+=V/this.ky*G)),j=this.wrap(s[0]-M)*this.kx,V=(s[1]-R)*this.ky;const H=j*j+V*V;H<S&&(S=H,h=M,p=R,x=E,w=G)}return{point:[h,p],index:x,t:Math.max(0,Math.min(1,w))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function Na(o,r){return r[0]-o[0]}function El(o){return o[1]-o[0]+1}function ls(o,r){return o[1]>=o[0]&&o[1]<r}function Oa(o,r){if(o[0]>o[1])return[null,null];const s=El(o);if(r){if(s===2)return[o,null];const p=Math.floor(s/2);return[[o[0],o[0]+p],[o[0]+p,o[1]]]}if(s===1)return[o,null];const h=Math.floor(s/2)-1;return[[o[0],o[0]+h],[o[0]+h+1,o[1]]]}function Cl(o,r){if(!ls(r,o.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let h=r[0];h<=r[1];++h)To(s,o[h]);return s}function dn(o){const r=[1/0,1/0,-1/0,-1/0];for(const s of o)for(const h of s)To(r,h);return r}function Yo(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function ja(o,r,s){if(!Yo(o)||!Yo(r))return NaN;let h=0,p=0;return o[2]<r[0]&&(h=r[0]-o[2]),o[0]>r[2]&&(h=o[0]-r[2]),o[1]>r[3]&&(p=o[1]-r[3]),o[3]<r[1]&&(p=r[1]-o[3]),s.distance([0,0],[h,p])}function Ys(o,r,s){const h=s.pointOnLine(r,o);return s.distance(o,h.point)}function dc(o,r,s,h,p){const x=Math.min(Ys(o,[s,h],p),Ys(r,[s,h],p)),w=Math.min(Ys(s,[o,r],p),Ys(h,[o,r],p));return Math.min(x,w)}function hf(o,r,s,h,p){if(!ls(r,o.length)||!ls(h,s.length))return 1/0;let x=1/0;for(let w=r[0];w<r[1];++w){const S=o[w],E=o[w+1];for(let M=h[0];M<h[1];++M){const R=s[M],j=s[M+1];if(hc(S,E,R,j))return 0;x=Math.min(x,dc(S,E,R,j,p))}}return x}function fc(o,r,s,h,p){if(!ls(r,o.length)||!ls(h,s.length))return NaN;let x=1/0;for(let w=r[0];w<=r[1];++w)for(let S=h[0];S<=h[1];++S)if(x=Math.min(x,p.distance(o[w],s[S])),x===0)return x;return x}function df(o,r,s){if(za(o,r,!0))return 0;let h=1/0;for(const p of r){const x=p[0],w=p[p.length-1];if(x!==w&&(h=Math.min(h,Ys(o,[w,x],s)),h===0))return h;const S=s.pointOnLine(p,o);if(h=Math.min(h,s.distance(o,S.point)),h===0)return h}return h}function Ah(o,r,s,h){if(!ls(r,o.length))return NaN;for(let x=r[0];x<=r[1];++x)if(za(o[x],s,!0))return 0;let p=1/0;for(let x=r[0];x<r[1];++x){const w=o[x],S=o[x+1];for(const E of s)for(let M=0,R=E.length,j=R-1;M<R;j=M++){const V=E[j],G=E[M];if(hc(w,S,V,G))return 0;p=Math.min(p,dc(w,S,V,G,h))}}return p}function Rh(o,r){for(const s of o)for(const h of s)if(za(h,r,!0))return!0;return!1}function Lh(o,r,s,h=1/0){const p=dn(o),x=dn(r);if(h!==1/0&&ja(p,x,s)>=h)return h;if(Ho(p,x)){if(Rh(o,r))return 0}else if(Rh(r,o))return 0;let w=1/0;for(const S of o)for(let E=0,M=S.length,R=M-1;E<M;R=E++){const j=S[R],V=S[E];for(const G of r)for(let H=0,ee=G.length,le=ee-1;H<ee;le=H++){const me=G[le],Re=G[H];if(hc(j,V,me,Re))return 0;w=Math.min(w,dc(j,V,me,Re,s))}}return w}function zh(o,r,s,h,p,x){if(!x)return;const w=ja(Cl(h,x),p,s);w<r&&o.push([w,x,[0,0]])}function Oi(o,r,s,h,p,x,w){if(!x||!w)return;const S=ja(Cl(h,x),Cl(p,w),s);S<r&&o.push([S,x,w])}function Jo(o,r,s,h,p=1/0){let x=Math.min(h.distance(o[0],s[0][0]),p);if(x===0)return x;const w=new Ih([[0,[0,o.length-1],[0,0]]],Na),S=dn(s);for(;w.length>0;){const E=w.pop();if(E[0]>=x)continue;const M=E[1],R=r?50:100;if(El(M)<=R){if(!ls(M,o.length))return NaN;if(r){const j=Ah(o,M,s,h);if(isNaN(j)||j===0)return j;x=Math.min(x,j)}else for(let j=M[0];j<=M[1];++j){const V=df(o[j],s,h);if(x=Math.min(x,V),x===0)return 0}}else{const j=Oa(M,r);zh(w,x,h,o,S,j[0]),zh(w,x,h,o,S,j[1])}}return x}function pc(o,r,s,h,p,x=1/0){let w=Math.min(x,p.distance(o[0],s[0]));if(w===0)return w;const S=new Ih([[0,[0,o.length-1],[0,s.length-1]]],Na);for(;S.length>0;){const E=S.pop();if(E[0]>=w)continue;const M=E[1],R=E[2],j=r?50:100,V=h?50:100;if(El(M)<=j&&El(R)<=V){if(!ls(M,o.length)&&ls(R,s.length))return NaN;let G;if(r&&h)G=hf(o,M,s,R,p),w=Math.min(w,G);else if(r&&!h){const H=o.slice(M[0],M[1]+1);for(let ee=R[0];ee<=R[1];++ee)if(G=Ys(s[ee],H,p),w=Math.min(w,G),w===0)return w}else if(!r&&h){const H=s.slice(R[0],R[1]+1);for(let ee=M[0];ee<=M[1];++ee)if(G=Ys(o[ee],H,p),w=Math.min(w,G),w===0)return w}else G=fc(o,M,s,R,p),w=Math.min(w,G)}else{const G=Oa(M,r),H=Oa(R,h);Oi(S,w,p,o,s,G[0],H[0]),Oi(S,w,p,o,s,G[0],H[1]),Oi(S,w,p,o,s,G[1],H[0]),Oi(S,w,p,o,s,G[1],H[1])}}return w}function Ba(o){return o.type==="MultiPolygon"?o.coordinates.map(r=>({type:"Polygon",coordinates:r})):o.type==="MultiLineString"?o.coordinates.map(r=>({type:"LineString",coordinates:r})):o.type==="MultiPoint"?o.coordinates.map(r=>({type:"Point",coordinates:r})):[o]}class Qo{constructor(r,s){this.type=ut,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(xn(r[1])){const h=r[1];if(h.type==="FeatureCollection")return new Qo(h,h.features.map(p=>Ba(p.geometry)).flat());if(h.type==="Feature")return new Qo(h,Ba(h.geometry));if("type"in h&&"coordinates"in h)return new Qo(h,Ba(h))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(s,h){const p=s.geometry(),x=p.flat().map(E=>Cu([E.x,E.y],s.canonical));if(p.length===0)return NaN;const w=new as(x[0][1]);let S=1/0;for(const E of h){switch(E.type){case"Point":S=Math.min(S,pc(x,!1,[E.coordinates],!1,w,S));break;case"LineString":S=Math.min(S,pc(x,!1,E.coordinates,!0,w,S));break;case"Polygon":S=Math.min(S,Jo(x,!1,E.coordinates,w,S))}if(S===0)return S}return S}(r,this.geometries);if(r.geometryType()==="LineString")return function(s,h){const p=s.geometry(),x=p.flat().map(E=>Cu([E.x,E.y],s.canonical));if(p.length===0)return NaN;const w=new as(x[0][1]);let S=1/0;for(const E of h){switch(E.type){case"Point":S=Math.min(S,pc(x,!0,[E.coordinates],!1,w,S));break;case"LineString":S=Math.min(S,pc(x,!0,E.coordinates,!0,w,S));break;case"Polygon":S=Math.min(S,Jo(x,!0,E.coordinates,w,S))}if(S===0)return S}return S}(r,this.geometries);if(r.geometryType()==="Polygon")return function(s,h){const p=s.geometry();if(p.length===0||p[0].length===0)return NaN;const x=Da(p,0).map(E=>E.map(M=>M.map(R=>Cu([R.x,R.y],s.canonical)))),w=new as(x[0][0][0][1]);let S=1/0;for(const E of h)for(const M of x){switch(E.type){case"Point":S=Math.min(S,Jo([E.coordinates],!1,M,w,S));break;case"LineString":S=Math.min(S,Jo(E.coordinates,!0,M,w,S));break;case"Polygon":S=Math.min(S,Lh(M,E.coordinates,w,S))}if(S===0)return S}return S}(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Fa{constructor(r){this.type=Xt,this.key=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=r[1];return h==null?s.error("Global state property must be defined."):typeof h!="string"?s.error(`Global state property must be string, but found ${typeof r[1]} instead.`):new Fa(h)}evaluate(r){var s;const h=(s=r.globals)===null||s===void 0?void 0:s.globalState;return h&&Object.keys(h).length!==0?Gs(h,this.key):null}eachChild(){}outputDefined(){return!1}}const Ua={"==":os,"!=":Th,">":lf,"<":La,">=":Sh,"<=":cc,array:Yt,at:Go,boolean:Yt,case:Br,coalesce:Aa,collator:Wo,format:uc,image:ks,in:Tl,"index-of":Sl,interpolate:zn,"interpolate-hcl":zn,"interpolate-lab":zn,length:Pi,let:Ma,literal:$t,match:qi,number:Yt,"number-format":Hs,object:Yt,slice:bo,step:wo,string:Yt,"to-boolean":jr,"to-color":jr,"to-number":jr,"to-string":jr,var:ui,within:As,distance:Qo,"global-state":Fa};class Yr{constructor(r,s,h,p){this.name=r,this.type=s,this._evaluate=h,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,s){const h=r[0],p=Yr.definitions[h];if(!p)return s.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(p)?p[0]:p.type,w=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,S=w.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let E=null;for(const[M,R]of S){E=new cn(s.registry,gc,s.path,null,s.scope);const j=[];let V=!1;for(let G=1;G<r.length;G++){const H=r[G],ee=Array.isArray(M)?M[G-1]:M.type,le=E.parse(H,1+j.length,ee);if(!le){V=!0;break}j.push(le)}if(!V)if(Array.isArray(M)&&M.length!==j.length)E.error(`Expected ${M.length} arguments, but found ${j.length} instead.`);else{for(let G=0;G<j.length;G++){const H=Array.isArray(M)?M[G]:M.type,ee=j[G];E.concat(G+1).checkSubtype(H,ee.type)}if(E.errors.length===0)return new Yr(h,x,R,j)}}if(S.length===1)s.errors.push(...E.errors);else{const M=(S.length?S:w).map(([j])=>{return V=j,Array.isArray(V)?`(${V.map(Nn).join(", ")})`:`(${Nn(V.type)}...)`;var V}).join(" | "),R=[];for(let j=1;j<r.length;j++){const V=s.parse(r[j],1+R.length);if(!V)return null;R.push(Nn(V.type))}s.error(`Expected arguments of type ${M}, but found (${R.join(", ")}) instead.`)}return null}static register(r,s){Yr.definitions=s;for(const h in s)r[h]=Yr}}function Dh(o,[r,s,h,p]){r=r.evaluate(o),s=s.evaluate(o),h=h.evaluate(o);const x=p?p.evaluate(o):1,w=$o(r,s,h,x);if(w)throw new Mn(w);return new Qt(r/255,s/255,h/255,x,!1)}function ea(o,r){return o in r}function mc(o,r){const s=r[o];return s===void 0?null:s}function Po(o){return{type:o}}function gc(o){if(o instanceof ui)return gc(o.boundExpression);if(o instanceof Yr&&o.name==="error"||o instanceof Wo||o instanceof As||o instanceof Qo||o instanceof Fa)return!1;const r=o instanceof jr||o instanceof Yt;let s=!0;return o.eachChild(h=>{s=r?s&&gc(h):s&&h instanceof $t}),!!s&&Ki(o)&&Il(o,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ki(o){if(o instanceof Yr&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof As||o instanceof Qo)return!1;let r=!0;return o.eachChild(s=>{r&&!Ki(s)&&(r=!1)}),r}function Va(o){if(o instanceof Yr&&o.name==="feature-state")return!1;let r=!0;return o.eachChild(s=>{r&&!Va(s)&&(r=!1)}),r}function Il(o,r){if(o instanceof Yr&&r.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(h=>{s&&!Il(h,r)&&(s=!1)}),s}function $a(o){return{result:"success",value:o}}function Za(o){return{result:"error",value:o}}function Js(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Ga(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function qa(o){return!!o.expression&&o.expression.interpolated}function tn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function _c(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)&&an(o)===Es}function Nh(o){return o}function yc(o,r){const s=o.stops&&typeof o.stops[0][0]=="object",h=s||!(s||o.property!==void 0),p=o.type||(qa(r)?"exponential":"interval"),x=function(R){switch(R.type){case"color":return Qt.parse;case"padding":return Dt.parse;case"numberArray":return kn.parse;case"colorArray":return en.parse;default:return null}}(r);if(x&&((o=is({},o)).stops&&(o.stops=o.stops.map(R=>[R[0],x(R[1])])),o.default=x(o.default?o.default:r.default)),o.colorSpace&&(w=o.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var w;const S=function(R){switch(R){case"exponential":return Au;case"interval":return kl;case"categorical":return Oh;case"identity":return jh;default:throw new Error(`Unknown function type "${R}"`)}}(p);let E,M;if(p==="categorical"){E=Object.create(null);for(const R of o.stops)E[R[0]]=R[1];M=typeof o.stops[0][0]}if(s){const R={},j=[];for(let H=0;H<o.stops.length;H++){const ee=o.stops[H],le=ee[0].zoom;R[le]===void 0&&(R[le]={zoom:le,type:o.type,property:o.property,default:o.default,stops:[]},j.push(le)),R[le].stops.push([ee[0].value,ee[1]])}const V=[];for(const H of j)V.push([R[H].zoom,yc(R[H],r)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:zn.interpolationFactor.bind(void 0,G),zoomStops:V.map(H=>H[0]),evaluate:({zoom:H},ee)=>Au({stops:V,base:o.base},r,H).evaluate(H,ee)}}if(h){const R=p==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:zn.interpolationFactor.bind(void 0,R),zoomStops:o.stops.map(j=>j[0]),evaluate:({zoom:j})=>S(o,r,j,E,M)}}return{kind:"source",evaluate(R,j){const V=j&&j.properties?j.properties[o.property]:void 0;return V===void 0?Wa(o.default,r.default):S(o,r,V,E,M)}}}function Wa(o,r,s){return o!==void 0?o:r!==void 0?r:s!==void 0?s:void 0}function Oh(o,r,s,h,p){return Wa(typeof s===p?h[s]:void 0,o.default,r.default)}function kl(o,r,s){if(tn(s)!=="number")return Wa(o.default,r.default);const h=o.stops.length;if(h===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[h-1][0])return o.stops[h-1][1];const p=Pl(o.stops.map(x=>x[0]),s);return o.stops[p][1]}function Au(o,r,s){const h=o.base!==void 0?o.base:1;if(tn(s)!=="number")return Wa(o.default,r.default);const p=o.stops.length;if(p===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[p-1][0])return o.stops[p-1][1];const x=Pl(o.stops.map(R=>R[0]),s),w=function(R,j,V,G){const H=G-V,ee=R-V;return H===0?0:j===1?ee/H:(Math.pow(j,ee)-1)/(Math.pow(j,H)-1)}(s,h,o.stops[x][0],o.stops[x+1][0]),S=o.stops[x][1],E=o.stops[x+1][1],M=Ni[r.type]||Nh;return typeof S.evaluate=="function"?{evaluate(...R){const j=S.evaluate.apply(void 0,R),V=E.evaluate.apply(void 0,R);if(j!==void 0&&V!==void 0)return M(j,V,w,o.colorSpace)}}:M(S,E,w,o.colorSpace)}function jh(o,r,s){switch(r.type){case"color":s=Qt.parse(s);break;case"formatted":s=Si.fromString(s.toString());break;case"resolvedImage":s=ci.fromString(s.toString());break;case"padding":s=Dt.parse(s);break;case"colorArray":s=en.parse(s);break;case"numberArray":s=kn.parse(s);break;default:tn(s)===r.type||r.type==="enum"&&r.values[s]||(s=void 0)}return Wa(s,o.default,r.default)}Yr.register(Ua,{error:[{kind:"error"},[Jt],(o,[r])=>{throw new Mn(r.evaluate(o))}],typeof:[Jt,[Xt],(o,[r])=>Nn(an(r.evaluate(o)))],"to-rgba":[Ri(ut,4),[Ti],(o,[r])=>{const[s,h,p,x]=r.evaluate(o).rgb;return[255*s,255*h,255*p,x]}],rgb:[Ti,[ut,ut,ut],Dh],rgba:[Ti,[ut,ut,ut,ut],Dh],has:{type:qt,overloads:[[[Jt],(o,[r])=>ea(r.evaluate(o),o.properties())],[[Jt,Es],(o,[r,s])=>ea(r.evaluate(o),s.evaluate(o))]]},get:{type:Xt,overloads:[[[Jt],(o,[r])=>mc(r.evaluate(o),o.properties())],[[Jt,Es],(o,[r,s])=>mc(r.evaluate(o),s.evaluate(o))]]},"feature-state":[Xt,[Jt],(o,[r])=>mc(r.evaluate(o),o.featureState||{})],properties:[Es,[],o=>o.properties()],"geometry-type":[Jt,[],o=>o.geometryType()],id:[Xt,[],o=>o.id()],zoom:[ut,[],o=>o.globals.zoom],"heatmap-density":[ut,[],o=>o.globals.heatmapDensity||0],elevation:[ut,[],o=>o.globals.elevation||0],"line-progress":[ut,[],o=>o.globals.lineProgress||0],accumulated:[Xt,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[ut,Po(ut),(o,r)=>{let s=0;for(const h of r)s+=h.evaluate(o);return s}],"*":[ut,Po(ut),(o,r)=>{let s=1;for(const h of r)s*=h.evaluate(o);return s}],"-":{type:ut,overloads:[[[ut,ut],(o,[r,s])=>r.evaluate(o)-s.evaluate(o)],[[ut],(o,[r])=>-r.evaluate(o)]]},"/":[ut,[ut,ut],(o,[r,s])=>r.evaluate(o)/s.evaluate(o)],"%":[ut,[ut,ut],(o,[r,s])=>r.evaluate(o)%s.evaluate(o)],ln2:[ut,[],()=>Math.LN2],pi:[ut,[],()=>Math.PI],e:[ut,[],()=>Math.E],"^":[ut,[ut,ut],(o,[r,s])=>Math.pow(r.evaluate(o),s.evaluate(o))],sqrt:[ut,[ut],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[ut,[ut],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[ut,[ut],(o,[r])=>Math.log(r.evaluate(o))],log2:[ut,[ut],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[ut,[ut],(o,[r])=>Math.sin(r.evaluate(o))],cos:[ut,[ut],(o,[r])=>Math.cos(r.evaluate(o))],tan:[ut,[ut],(o,[r])=>Math.tan(r.evaluate(o))],asin:[ut,[ut],(o,[r])=>Math.asin(r.evaluate(o))],acos:[ut,[ut],(o,[r])=>Math.acos(r.evaluate(o))],atan:[ut,[ut],(o,[r])=>Math.atan(r.evaluate(o))],min:[ut,Po(ut),(o,r)=>Math.min(...r.map(s=>s.evaluate(o)))],max:[ut,Po(ut),(o,r)=>Math.max(...r.map(s=>s.evaluate(o)))],abs:[ut,[ut],(o,[r])=>Math.abs(r.evaluate(o))],round:[ut,[ut],(o,[r])=>{const s=r.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[ut,[ut],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[ut,[ut],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[qt,[Jt,Xt],(o,[r,s])=>o.properties()[r.value]===s.value],"filter-id-==":[qt,[Xt],(o,[r])=>o.id()===r.value],"filter-type-==":[qt,[Jt],(o,[r])=>o.geometryType()===r.value],"filter-<":[qt,[Jt,Xt],(o,[r,s])=>{const h=o.properties()[r.value],p=s.value;return typeof h==typeof p&&h<p}],"filter-id-<":[qt,[Xt],(o,[r])=>{const s=o.id(),h=r.value;return typeof s==typeof h&&s<h}],"filter->":[qt,[Jt,Xt],(o,[r,s])=>{const h=o.properties()[r.value],p=s.value;return typeof h==typeof p&&h>p}],"filter-id->":[qt,[Xt],(o,[r])=>{const s=o.id(),h=r.value;return typeof s==typeof h&&s>h}],"filter-<=":[qt,[Jt,Xt],(o,[r,s])=>{const h=o.properties()[r.value],p=s.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[qt,[Xt],(o,[r])=>{const s=o.id(),h=r.value;return typeof s==typeof h&&s<=h}],"filter->=":[qt,[Jt,Xt],(o,[r,s])=>{const h=o.properties()[r.value],p=s.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[qt,[Xt],(o,[r])=>{const s=o.id(),h=r.value;return typeof s==typeof h&&s>=h}],"filter-has":[qt,[Xt],(o,[r])=>r.value in o.properties()],"filter-has-id":[qt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[qt,[Ri(Jt)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[qt,[Ri(Xt)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[qt,[Jt,Ri(Xt)],(o,[r,s])=>s.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[qt,[Jt,Ri(Xt)],(o,[r,s])=>function(h,p,x,w){for(;x<=w;){const S=x+w>>1;if(p[S]===h)return!0;p[S]>h?w=S-1:x=S+1}return!1}(o.properties()[r.value],s.value,0,s.value.length-1)],all:{type:qt,overloads:[[[qt,qt],(o,[r,s])=>r.evaluate(o)&&s.evaluate(o)],[Po(qt),(o,r)=>{for(const s of r)if(!s.evaluate(o))return!1;return!0}]]},any:{type:qt,overloads:[[[qt,qt],(o,[r,s])=>r.evaluate(o)||s.evaluate(o)],[Po(qt),(o,r)=>{for(const s of r)if(s.evaluate(o))return!0;return!1}]]},"!":[qt,[qt],(o,[r])=>!r.evaluate(o)],"is-supported-script":[qt,[Jt],(o,[r])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(r.evaluate(o))}],upcase:[Jt,[Jt],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[Jt,[Jt],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[Jt,Po(Xt),(o,r)=>r.map(s=>Kt(s.evaluate(o))).join("")],"resolved-locale":[Jt,[Pa],(o,[r])=>r.evaluate(o).resolvedLocale()]});class vc{constructor(r,s,h){this.expression=r,this._warningHistory={},this._evaluator=new ka,this._defaultValue=s?function(p){if(p.type==="color"&&_c(p.default))return new Qt(0,0,0,0);switch(p.type){case"color":return Qt.parse(p.default)||null;case"padding":return Dt.parse(p.default)||null;case"numberArray":return kn.parse(p.default)||null;case"colorArray":return en.parse(p.default)||null;case"variableAnchorOffsetCollection":return $r.parse(p.default)||null;case"projectionDefinition":return pr.parse(p.default)||null;default:return p.default===void 0?null:p.default}}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this._globalState=h}evaluateWithoutErrorHandling(r,s,h,p,x,w){return this._globalState&&(r=Be(r,this._globalState)),this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=h,this._evaluator.canonical=p,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(r,s,h,p,x,w){this._globalState&&(r=Be(r,this._globalState)),this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Mn(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function xc(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Ua}function u(o,r,s){const h=new cn(Ua,gc,[],r?function(x){const w={color:Ti,string:Jt,number:ut,enum:Jt,boolean:qt,formatted:Ea,padding:jo,numberArray:Zs,colorArray:mo,projectionDefinition:Ps,resolvedImage:Bo,variableAnchorOffsetCollection:sr};return x.type==="array"?Ri(w[x.value]||Xt,x.length):w[x.type]}(r):void 0),p=h.parse(o,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?$a(new vc(p,r,s)):Za(h.errors)}class y{constructor(r,s,h){this.kind=r,this._styleExpression=s,this.isStateDependent=r!=="constant"&&!Va(s.expression),this.globalStateRefs=Se(s.expression),this._globalState=h}evaluateWithoutErrorHandling(r,s,h,p,x,w){return this._globalState&&(r=Be(r,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(r,s,h,p,x,w)}evaluate(r,s,h,p,x,w){return this._globalState&&(r=Be(r,this._globalState)),this._styleExpression.evaluate(r,s,h,p,x,w)}}class P{constructor(r,s,h,p,x){this.kind=r,this.zoomStops=h,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!Va(s.expression),this.globalStateRefs=Se(s.expression),this.interpolationType=p,this._globalState=x}evaluateWithoutErrorHandling(r,s,h,p,x,w){return this._globalState&&(r=Be(r,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(r,s,h,p,x,w)}evaluate(r,s,h,p,x,w){return this._globalState&&(r=Be(r,this._globalState)),this._styleExpression.evaluate(r,s,h,p,x,w)}interpolationFactor(r,s,h){return this.interpolationType?zn.interpolationFactor(this.interpolationType,r,s,h):0}}function z(o,r,s){const h=u(o,r,s);if(h.result==="error")return h;const p=h.value.expression,x=Ki(p);if(!x&&!Js(r))return Za([new bi("","data expressions not supported")]);const w=Il(p,["zoom"]);if(!w&&!Ga(r))return Za([new bi("","zoom expressions not supported")]);const S=ne(p);return S||w?S instanceof bi?Za([S]):S instanceof zn&&!qa(r)?Za([new bi("",'"interpolate" expressions cannot be used with this property')]):$a(S?new P(x?"camera":"composite",h.value,S.labels,S instanceof zn?S.interpolation:void 0,s):new y(x?"constant":"source",h.value,s)):Za([new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class F{constructor(r,s){this._parameters=r,this._specification=s,is(this,yc(this._parameters,this._specification))}static deserialize(r){return new F(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ne(o){let r=null;if(o instanceof Ma)r=ne(o.result);else if(o instanceof Aa){for(const s of o.args)if(r=ne(s),r)break}else(o instanceof wo||o instanceof zn)&&o.input instanceof Yr&&o.input.name==="zoom"&&(r=o);return r instanceof bi||o.eachChild(s=>{const h=ne(s);h instanceof bi?r=h:!r&&h?r=new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Se(o,r=new Set){return o instanceof Fa&&r.add(o.key),o.eachChild(s=>{Se(s,r)}),r}function Be(o,r){const{zoom:s,heatmapDensity:h,elevation:p,lineProgress:x,isSupportedScript:w,accumulated:S}=o??{};return{zoom:s,heatmapDensity:h,elevation:p,lineProgress:x,isSupportedScript:w,accumulated:S,globalState:r}}function Ke(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!Ke(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const it={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tt(o,r){if(o==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ke(o)||(o=Pr(o));const s=u(o,it,r);if(s.result==="error")throw new Error(s.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,x)=>s.value.evaluate(h,p,{},x),needGeometry:ln(o),getGlobalStateRefs:()=>Se(s.value.expression)}}function Zt(o,r){return o<r?-1:o>r?1:0}function ln(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let r=1;r<o.length;r++)if(ln(o[r]))return!0;return!1}function Pr(o){if(!o)return!0;const r=o[0];return o.length<=1?r!=="any":r==="=="?ar(o[1],o[2],"=="):r==="!="?cs(ar(o[1],o[2],"==")):r==="<"||r===">"||r==="<="||r===">="?ar(o[1],o[2],r):r==="any"?(s=o.slice(1),["any"].concat(s.map(Pr))):r==="all"?["all"].concat(o.slice(1).map(Pr)):r==="none"?["all"].concat(o.slice(1).map(Pr).map(cs)):r==="in"?hi(o[1],o.slice(2)):r==="!in"?cs(hi(o[1],o.slice(2))):r==="has"?Zr(o[1]):r!=="!has"||cs(Zr(o[1]));var s}function ar(o,r,s){switch(o){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,o,r]}}function hi(o,r){if(r.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",o,["literal",r.sort(Zt)]]:["filter-in-small",o,["literal",r]]}}function Zr(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function cs(o){return["!",o]}function Ml(o){const r=typeof o;if(r==="number"||r==="boolean"||r==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let p="[";for(const x of o)p+=`${Ml(x)},`;return`${p}]`}const s=Object.keys(o).sort();let h="{";for(let p=0;p<s.length;p++)h+=`${JSON.stringify(s[p])}:${Ml(o[s[p]])},`;return`${h}}`}function bc(o){let r="";for(const s of Ht)r+=`/${Ml(o[s])}`;return r}function Bh(o){const r=o.value;return r?[new Fe(o.key,r,"constants have been deprecated as of v8")]:[]}function Gn(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function ta(o){if(Array.isArray(o))return o.map(ta);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const s in o)r[s]=ta(o[s]);return r}return Gn(o)}function ji(o){const r=o.key,s=o.value,h=o.valueSpec||{},p=o.objectElementValidators||{},x=o.style,w=o.styleSpec,S=o.validateSpec;let E=[];const M=tn(s);if(M!=="object")return[new Fe(r,s,`object expected, ${M} found`)];for(const R in s){const j=R.split(".")[0],V=Gs(h,j)||h["*"];let G;if(Gs(p,j))G=p[j];else if(Gs(h,j))G=S;else if(p["*"])G=p["*"];else{if(!h["*"]){E.push(new Fe(r,s[R],`unknown property "${R}"`));continue}G=S}E=E.concat(G({key:(r&&`${r}.`)+R,value:s[R],valueSpec:V,style:x,styleSpec:w,object:s,objectKey:R,validateSpec:S},s))}for(const R in h)p[R]||h[R].required&&h[R].default===void 0&&s[R]===void 0&&E.push(new Fe(r,s,`missing required property "${R}"`));return E}function Jn(o){const r=o.value,s=o.valueSpec,h=o.style,p=o.styleSpec,x=o.key,w=o.arrayElementValidator||o.validateSpec;if(tn(r)!=="array")return[new Fe(x,r,`array expected, ${tn(r)} found`)];if(s.length&&r.length!==s.length)return[new Fe(x,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new Fe(x,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let S={type:s.value,values:s.values};p.$version<7&&(S.function=s.function),tn(s.value)==="object"&&(S=s.value);let E=[];for(let M=0;M<r.length;M++)E=E.concat(w({array:r,arrayIndex:M,value:r[M],valueSpec:S,validateSpec:o.validateSpec,style:h,styleSpec:p,key:`${x}[${M}]`}));return E}function na(o){const r=o.key,s=o.value,h=o.valueSpec;let p=tn(s);return p==="number"&&s!=s&&(p="NaN"),p!=="number"?[new Fe(r,s,`number expected, ${p} found`)]:"minimum"in h&&s<h.minimum?[new Fe(r,s,`${s} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&s>h.maximum?[new Fe(r,s,`${s} is greater than the maximum value ${h.maximum}`)]:[]}function Ru(o){const r=o.valueSpec,s=Gn(o.value.type);let h,p,x,w={};const S=s!=="categorical"&&o.value.property===void 0,E=!S,M=tn(o.value.stops)==="array"&&tn(o.value.stops[0])==="array"&&tn(o.value.stops[0][0])==="object",R=ji({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(G){if(s==="identity")return[new Fe(G.key,G.value,'identity function may not have a "stops" property')];let H=[];const ee=G.value;return H=H.concat(Jn({key:G.key,value:ee,valueSpec:G.valueSpec,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:j})),tn(ee)==="array"&&ee.length===0&&H.push(new Fe(G.key,ee,"array must have at least one stop")),H},default:function(G){return G.validateSpec({key:G.key,value:G.value,valueSpec:r,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec})}}});return s==="identity"&&S&&R.push(new Fe(o.key,o.value,'missing required property "property"')),s==="identity"||o.value.stops||R.push(new Fe(o.key,o.value,'missing required property "stops"')),s==="exponential"&&o.valueSpec.expression&&!qa(o.valueSpec)&&R.push(new Fe(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!Js(o.valueSpec)?R.push(new Fe(o.key,o.value,"property functions not supported")):S&&!Ga(o.valueSpec)&&R.push(new Fe(o.key,o.value,"zoom functions not supported"))),s!=="categorical"&&!M||o.value.property!==void 0||R.push(new Fe(o.key,o.value,'"property" property is required')),R;function j(G){let H=[];const ee=G.value,le=G.key;if(tn(ee)!=="array")return[new Fe(le,ee,`array expected, ${tn(ee)} found`)];if(ee.length!==2)return[new Fe(le,ee,`array length 2 expected, length ${ee.length} found`)];if(M){if(tn(ee[0])!=="object")return[new Fe(le,ee,`object expected, ${tn(ee[0])} found`)];if(ee[0].zoom===void 0)return[new Fe(le,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new Fe(le,ee,"object stop key must have value")];if(x&&x>Gn(ee[0].zoom))return[new Fe(le,ee[0].zoom,"stop zoom values must appear in ascending order")];Gn(ee[0].zoom)!==x&&(x=Gn(ee[0].zoom),p=void 0,w={}),H=H.concat(ji({key:`${le}[0]`,value:ee[0],valueSpec:{zoom:{}},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:na,value:V}}))}else H=H.concat(V({key:`${le}[0]`,value:ee[0],validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec},ee));return xc(ta(ee[1]))?H.concat([new Fe(`${le}[1]`,ee[1],"expressions are not allowed in function stops.")]):H.concat(G.validateSpec({key:`${le}[1]`,value:ee[1],valueSpec:r,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec}))}function V(G,H){const ee=tn(G.value),le=Gn(G.value),me=G.value!==null?G.value:H;if(h){if(ee!==h)return[new Fe(G.key,me,`${ee} stop domain type must match previous stop domain type ${h}`)]}else h=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean")return[new Fe(G.key,me,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&s!=="categorical"){let Re=`number expected, ${ee} found`;return Js(r)&&s===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(G.key,me,Re)]}return s!=="categorical"||ee!=="number"||isFinite(le)&&Math.floor(le)===le?s!=="categorical"&&ee==="number"&&p!==void 0&&le<p?[new Fe(G.key,me,"stop domain values must appear in ascending order")]:(p=le,s==="categorical"&&le in w?[new Fe(G.key,me,"stop domain values must be unique")]:(w[le]=!0,[])):[new Fe(G.key,me,`integer expected, found ${le}`)]}}function ra(o){const r=(o.expressionContext==="property"?z:u)(ta(o.value),o.valueSpec);if(r.result==="error")return r.value.map(h=>new Fe(`${o.key}${h.key}`,o.value,h.message));const s=r.value.expression||r.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!s.outputDefined())return[new Fe(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Va(s))return[new Fe(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Va(s))return[new Fe(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Il(s,["zoom","feature-state"]))return[new Fe(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Ki(s))return[new Fe(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ha(o){const r=o.key,s=o.value,h=tn(s);return h!=="string"?[new Fe(r,s,`color expected, ${h} found`)]:Qt.parse(String(s))?[]:[new Fe(r,s,`color expected, "${s}" found`)]}function ia(o){const r=o.key,s=o.value,h=o.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(Gn(s))===-1&&p.push(new Fe(r,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(Gn(s))===-1&&p.push(new Fe(r,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function Al(o){return Ke(ta(o.value))?ra(is({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lu(o)}function Lu(o){const r=o.value,s=o.key;if(tn(r)!=="array")return[new Fe(s,r,`array expected, ${tn(r)} found`)];const h=o.styleSpec;let p,x=[];if(r.length<1)return[new Fe(s,r,"filter array must have at least 1 element")];switch(x=x.concat(ia({key:`${s}[0]`,value:r[0],valueSpec:h.filter_operator,style:o.style,styleSpec:o.styleSpec})),Gn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Gn(r[1])==="$type"&&x.push(new Fe(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new Fe(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=tn(r[1]),p!=="string"&&x.push(new Fe(`${s}[1]`,r[1],`string expected, ${p} found`)));for(let w=2;w<r.length;w++)p=tn(r[w]),Gn(r[1])==="$type"?x=x.concat(ia({key:`${s}[${w}]`,value:r[w],valueSpec:h.geometry_type,style:o.style,styleSpec:o.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&x.push(new Fe(`${s}[${w}]`,r[w],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let w=1;w<r.length;w++)x=x.concat(Lu({key:`${s}[${w}]`,value:r[w],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=tn(r[1]),r.length!==2?x.push(new Fe(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&x.push(new Fe(`${s}[1]`,r[1],`string expected, ${p} found`))}return x}function vm(o,r){const s=o.key,h=o.validateSpec,p=o.style,x=o.styleSpec,w=o.value,S=o.objectKey,E=x[`${r}_${o.layerType}`];if(!E)return[];const M=S.match(/^(.*)-transition$/);if(r==="paint"&&M&&E[M[1]]&&E[M[1]].transition)return h({key:s,value:w,valueSpec:x.transition,style:p,styleSpec:x});const R=o.valueSpec||E[S];if(!R)return[new Fe(s,w,`unknown property "${S}"`)];let j;if(tn(w)==="string"&&Js(R)&&!R.tokens&&(j=/^{([^}]+)}$/.exec(w)))return[new Fe(s,w,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const V=[];return o.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&V.push(new Fe(s,w,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&_c(ta(w))&&Gn(w.type)==="identity"&&V.push(new Fe(s,w,'"text-font" does not support identity functions'))),V.concat(h({key:o.key,value:w,valueSpec:R,style:p,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:S}))}function ff(o){return vm(o,"paint")}function pf(o){return vm(o,"layout")}function wc(o){let r=[];const s=o.value,h=o.key,p=o.style,x=o.styleSpec;if(tn(s)!=="object")return[new Fe(h,s,`object expected, ${tn(s)} found`)];s.type||s.ref||r.push(new Fe(h,s,'either "type" or "ref" is required'));let w=Gn(s.type);const S=Gn(s.ref);if(s.id){const E=Gn(s.id);for(let M=0;M<o.arrayIndex;M++){const R=p.layers[M];Gn(R.id)===E&&r.push(new Fe(h,s.id,`duplicate layer id "${s.id}", previously used at line ${R.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(M=>{M in s&&r.push(new Fe(h,s[M],`"${M}" is prohibited for ref layers`))}),p.layers.forEach(M=>{Gn(M.id)===S&&(E=M)}),E?E.ref?r.push(new Fe(h,s.ref,"ref cannot reference another ref layer")):w=Gn(E.type):r.push(new Fe(h,s.ref,`ref layer "${S}" not found`))}else if(w!=="background")if(s.source){const E=p.sources&&p.sources[s.source],M=E&&Gn(E.type);E?M==="vector"&&w==="raster"?r.push(new Fe(h,s.source,`layer "${s.id}" requires a raster source`)):M!=="raster-dem"&&w==="hillshade"||M!=="raster-dem"&&w==="color-relief"?r.push(new Fe(h,s.source,`layer "${s.id}" requires a raster-dem source`)):M==="raster"&&w!=="raster"?r.push(new Fe(h,s.source,`layer "${s.id}" requires a vector source`)):M!=="vector"||s["source-layer"]?M==="raster-dem"&&w!=="hillshade"&&w!=="color-relief"?r.push(new Fe(h,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):w!=="line"||!s.paint||!s.paint["line-gradient"]||M==="geojson"&&E.lineMetrics||r.push(new Fe(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Fe(h,s,`layer "${s.id}" must specify a "source-layer"`)):r.push(new Fe(h,s.source,`source "${s.source}" not found`))}else r.push(new Fe(h,s,'missing required property "source"'));return r=r.concat(ji({key:h,value:s,valueSpec:x.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${h}.type`,value:s.type,valueSpec:x.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:s,objectKey:"type"}),filter:Al,layout:E=>ji({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":M=>pf(is({layerType:w},M))}}),paint:E=>ji({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":M=>ff(is({layerType:w},M))}})}})),r}function Rl(o){const r=o.value,s=o.key,h=tn(r);return h!=="string"?[new Fe(s,r,`string expected, ${h} found`)]:[]}const xm={promoteId:function({key:o,value:r}){if(tn(r)==="string")return Rl({key:o,value:r});{const s=[];for(const h in r)s.push(...Rl({key:`${o}.${h}`,value:r[h]}));return s}}};function bm(o){const r=o.value,s=o.key,h=o.styleSpec,p=o.style,x=o.validateSpec;if(!r.type)return[new Fe(s,r,'"type" is required')];const w=Gn(r.type);let S;switch(w){case"vector":case"raster":return S=ji({key:s,value:r,valueSpec:h[`source_${w.replace("-","_")}`],style:o.style,styleSpec:h,objectElementValidators:xm,validateSpec:x}),S;case"raster-dem":return S=function(E){var M;const R=(M=E.sourceName)!==null&&M!==void 0?M:"",j=E.value,V=E.styleSpec,G=V.source_raster_dem,H=E.style;let ee=[];const le=tn(j);if(j===void 0)return ee;if(le!=="object")return ee.push(new Fe("source_raster_dem",j,`object expected, ${le} found`)),ee;const me=Gn(j.encoding)==="custom",Re=["redFactor","greenFactor","blueFactor","baseShift"],be=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const Pe in j)!me&&Re.includes(Pe)?ee.push(new Fe(Pe,j[Pe],`In "${R}": "${Pe}" is only valid when "encoding" is set to "custom". ${be} encoding found`)):G[Pe]?ee=ee.concat(E.validateSpec({key:Pe,value:j[Pe],valueSpec:G[Pe],validateSpec:E.validateSpec,style:H,styleSpec:V})):ee.push(new Fe(Pe,j[Pe],`unknown property "${Pe}"`));return ee}({sourceName:s,value:r,style:o.style,styleSpec:h,validateSpec:x}),S;case"geojson":if(S=ji({key:s,value:r,valueSpec:h.source_geojson,style:p,styleSpec:h,validateSpec:x,objectElementValidators:xm}),r.cluster)for(const E in r.clusterProperties){const[M,R]=r.clusterProperties[E],j=typeof M=="string"?[M,["accumulated"],["get",E]]:M;S.push(...ra({key:`${s}.${E}.map`,value:R,expressionContext:"cluster-map"})),S.push(...ra({key:`${s}.${E}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return S;case"video":return ji({key:s,value:r,valueSpec:h.source_video,style:p,validateSpec:x,styleSpec:h});case"image":return ji({key:s,value:r,valueSpec:h.source_image,style:p,validateSpec:x,styleSpec:h});case"canvas":return[new Fe(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ia({key:`${s}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function wm(o){const r=o.value,s=o.styleSpec,h=s.light,p=o.style;let x=[];const w=tn(r);if(r===void 0)return x;if(w!=="object")return x=x.concat([new Fe("light",r,`object expected, ${w} found`)]),x;for(const S in r){const E=S.match(/^(.*)-transition$/);x=x.concat(E&&h[E[1]]&&h[E[1]].transition?o.validateSpec({key:S,value:r[S],valueSpec:s.transition,validateSpec:o.validateSpec,style:p,styleSpec:s}):h[S]?o.validateSpec({key:S,value:r[S],valueSpec:h[S],validateSpec:o.validateSpec,style:p,styleSpec:s}):[new Fe(S,r[S],`unknown property "${S}"`)])}return x}function Tm(o){const r=o.value,s=o.styleSpec,h=s.sky,p=o.style,x=tn(r);if(r===void 0)return[];if(x!=="object")return[new Fe("sky",r,`object expected, ${x} found`)];let w=[];for(const S in r)w=w.concat(h[S]?o.validateSpec({key:S,value:r[S],valueSpec:h[S],style:p,styleSpec:s}):[new Fe(S,r[S],`unknown property "${S}"`)]);return w}function Sm(o){const r=o.value,s=o.styleSpec,h=s.terrain,p=o.style;let x=[];const w=tn(r);if(r===void 0)return x;if(w!=="object")return x=x.concat([new Fe("terrain",r,`object expected, ${w} found`)]),x;for(const S in r)x=x.concat(h[S]?o.validateSpec({key:S,value:r[S],valueSpec:h[S],validateSpec:o.validateSpec,style:p,styleSpec:s}):[new Fe(S,r[S],`unknown property "${S}"`)]);return x}function Tc(o){let r=[];const s=o.value,h=o.key;if(Array.isArray(s)){const p=[],x=[];for(const w in s)s[w].id&&p.includes(s[w].id)&&r.push(new Fe(h,s,`all the sprites' ids must be unique, but ${s[w].id} is duplicated`)),p.push(s[w].id),s[w].url&&x.includes(s[w].url)&&r.push(new Fe(h,s,`all the sprites' URLs must be unique, but ${s[w].url} is duplicated`)),x.push(s[w].url),r=r.concat(ji({key:`${h}[${w}]`,value:s[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return r}return Rl({key:h,value:s})}function Sc(o){return r=o.value,r&&r.constructor===Object?[]:[new Fe(o.key,o.value,`object expected, ${tn(o.value)} found`)];var r}const Xi={"*":()=>[],array:Jn,boolean:function(o){const r=o.value,s=o.key,h=tn(r);return h!=="boolean"?[new Fe(s,r,`boolean expected, ${h} found`)]:[]},number:na,color:Ha,constants:Bh,enum:ia,filter:Al,function:Ru,layer:wc,object:ji,source:bm,light:wm,sky:Tm,terrain:Sm,projection:function(o){const r=o.value,s=o.styleSpec,h=s.projection,p=o.style,x=tn(r);if(r===void 0)return[];if(x!=="object")return[new Fe("projection",r,`object expected, ${x} found`)];let w=[];for(const S in r)w=w.concat(h[S]?o.validateSpec({key:S,value:r[S],valueSpec:h[S],style:p,styleSpec:s}):[new Fe(S,r[S],`unknown property "${S}"`)]);return w},projectionDefinition:function(o){const r=o.key;let s=o.value;s=s instanceof String?s.valueOf():s;const h=tn(s);return h!=="array"||function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"}(s)||function(p){return!!["interpolate","step","literal"].includes(p[0])}(s)?["array","string"].includes(h)?[]:[new Fe(r,s,`projection expected, invalid type "${h}" found`)]:[new Fe(r,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:Rl,formatted:function(o){return Rl(o).length===0?[]:ra(o)},resolvedImage:function(o){return Rl(o).length===0?[]:ra(o)},padding:function(o){const r=o.key,s=o.value;if(tn(s)==="array"){if(s.length<1||s.length>4)return[new Fe(r,s,`padding requires 1 to 4 values; ${s.length} values found`)];const h={type:"number"};let p=[];for(let x=0;x<s.length;x++)p=p.concat(o.validateSpec({key:`${r}[${x}]`,value:s[x],validateSpec:o.validateSpec,valueSpec:h}));return p}return na({key:r,value:s,valueSpec:{}})},numberArray:function(o){const r=o.key,s=o.value;if(tn(s)==="array"){const h={type:"number"};if(s.length<1)return[new Fe(r,s,"array length at least 1 expected, length 0 found")];let p=[];for(let x=0;x<s.length;x++)p=p.concat(o.validateSpec({key:`${r}[${x}]`,value:s[x],validateSpec:o.validateSpec,valueSpec:h}));return p}return na({key:r,value:s,valueSpec:{}})},colorArray:function(o){const r=o.key,s=o.value;if(tn(s)==="array"){if(s.length<1)return[new Fe(r,s,"array length at least 1 expected, length 0 found")];let h=[];for(let p=0;p<s.length;p++)h=h.concat(Ha({key:`${r}[${p}]`,value:s[p]}));return h}return Ha({key:r,value:s})},variableAnchorOffsetCollection:function(o){const r=o.key,s=o.value,h=tn(s),p=o.styleSpec;if(h!=="array"||s.length<1||s.length%2!=0)return[new Fe(r,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let w=0;w<s.length;w+=2)x=x.concat(ia({key:`${r}[${w}]`,value:s[w],valueSpec:p.layout_symbol["text-anchor"]})),x=x.concat(Jn({key:`${r}[${w+1}]`,value:s[w+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:p}));return x},sprite:Tc,state:Sc};function Ka(o){const r=o.value,s=o.valueSpec,h=o.styleSpec;return o.validateSpec=Ka,s.expression&&_c(Gn(r))?Ru(o):s.expression&&xc(ta(r))?ra(o):s.type&&Xi[s.type]?Xi[s.type](o):ji(is({},o,{valueSpec:s.type?h[s.type]:s}))}function mf(o){const r=o.value,s=o.key,h=Rl(o);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new Fe(s,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new Fe(s,r,'"glyphs" url must include a "{range}" token'))),h}function zs(o,r=De){let s=[];return s=s.concat(Ka({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,validateSpec:Ka,objectElementValidators:{glyphs:mf,"*":()=>[]}})),o.constants&&(s=s.concat(Bh({key:"constants",value:o.constants}))),Pc(s)}function Qs(o){return function(r){return o(Object.assign({},r,{validateSpec:Ka}))}}function Pc(o){return[].concat(o).sort((r,s)=>r.line-s.line)}function Ds(o){return function(...r){return Pc(o.apply(this,r))}}zs.source=Ds(Qs(bm)),zs.sprite=Ds(Qs(Tc)),zs.glyphs=Ds(Qs(mf)),zs.light=Ds(Qs(wm)),zs.sky=Ds(Qs(Tm)),zs.terrain=Ds(Qs(Sm)),zs.state=Ds(Qs(Sc)),zs.layer=Ds(Qs(wc)),zs.filter=Ds(Qs(Al)),zs.paintProperty=Ds(Qs(ff)),zs.layoutProperty=Ds(Qs(pf));const Xa=zs,py=Xa.light,gf=Xa.sky,my=Xa.paintProperty,zu=Xa.layoutProperty;function Pm(o,r){let s=!1;if(r&&r.length)for(const h of r)o.fire(new bt(new Error(h.message))),s=!0;return s}class Du{constructor(r,s,h){const p=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const w=new Int32Array(this.arrayBuffer);r=w[0],this.d=(s=w[1])+2*(h=w[2]);for(let E=0;E<this.d*this.d;E++){const M=w[3+E],R=w[3+E+1];p.push(M===R?null:w.subarray(M,R))}const S=w[3+p.length+1];this.keys=w.subarray(w[3+p.length],S),this.bboxes=w.subarray(S),this.insert=this._insertReadonly}else{this.d=s+2*h;for(let w=0;w<this.d*this.d;w++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=r,this.padding=h,this.scale=s/r,this.uid=0;const x=h/s*r;this.min=-x,this.max=r+x}insert(r,s,h,p,x){this._forEachCell(s,h,p,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,s,h,p,x,w){this.cells[x].push(w)}query(r,s,h,p,x){const w=this.min,S=this.max;if(r<=w&&s<=w&&S<=h&&S<=p&&!x)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(r,s,h,p,this._queryCell,E,{},x),E}}_queryCell(r,s,h,p,x,w,S,E){const M=this.cells[x];if(M!==null){const R=this.keys,j=this.bboxes;for(let V=0;V<M.length;V++){const G=M[V];if(S[G]===void 0){const H=4*G;(E?E(j[H+0],j[H+1],j[H+2],j[H+3]):r<=j[H+2]&&s<=j[H+3]&&h>=j[H+0]&&p>=j[H+1])?(S[G]=!0,w.push(R[G])):S[G]=!1}}}}_forEachCell(r,s,h,p,x,w,S,E){const M=this._convertToCellCoord(r),R=this._convertToCellCoord(s),j=this._convertToCellCoord(h),V=this._convertToCellCoord(p);for(let G=M;G<=j;G++)for(let H=R;H<=V;H++){const ee=this.d*H+G;if((!E||E(this._convertFromCellCoord(G),this._convertFromCellCoord(H),this._convertFromCellCoord(G+1),this._convertFromCellCoord(H+1)))&&x.call(this,r,s,h,p,ee,w,S,E))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,s=3+this.cells.length+1+1;let h=0;for(let w=0;w<this.cells.length;w++)h+=this.cells[w].length;const p=new Int32Array(s+h+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let x=s;for(let w=0;w<r.length;w++){const S=r[w];p[3+w]=x,p.set(S,x),x+=S.length}return p[3+r.length]=x,p.set(this.keys,x),x+=this.keys.length,p[3+r.length+1]=x,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer}static serialize(r,s){const h=r.toArrayBuffer();return s&&s.push(h),{buffer:h}}static deserialize(r){return new Du(r.buffer)}}const sa={};function yt(o,r,s={}){if(sa[o])throw new Error(`${o} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:o,writeable:!1}),sa[o]={klass:r,omit:s.omit||[],shallow:s.shallow||[]}}yt("Object",Object),yt("Set",Set),yt("TransferableGridIndex",Du),yt("Color",Qt),yt("Error",Error),yt("AJAXError",we),yt("ResolvedImage",ci),yt("StylePropertyFunction",F),yt("StyleExpression",vc,{omit:["_evaluator"]}),yt("ZoomDependentExpression",P),yt("ZoomConstantExpression",y),yt("CompoundExpression",Yr,{omit:["_evaluate"]});for(const o in Ua)Ua[o]._classRegistryKey||yt(`Expression_${o}`,Ua[o]);function Em(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function _f(o){return o.$name||o.constructor._classRegistryKey}function Nu(o){return!function(r){if(r===null||typeof r!="object")return!1;const s=_f(r);return!(!s||s==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||Em(o)||mn(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function Ou(o,r){if(Nu(o))return(Em(o)||mn(o))&&r&&r.push(o),ArrayBuffer.isView(o)&&r&&r.push(o.buffer),o instanceof ImageData&&r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const x=[];for(const w of o)x.push(Ou(w,r));return x}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const s=_f(o);if(!s)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!sa[s])throw new Error(`${s} is not registered.`);const{klass:h}=sa[s],p=h.serialize?h.serialize(o,r):{};if(h.serialize){if(r&&p===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in o){if(!o.hasOwnProperty(x)||sa[s].omit.indexOf(x)>=0)continue;const w=o[x];p[x]=sa[s].shallow.indexOf(x)>=0?w:Ou(w,r)}o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(p.$name=s),p}function Ll(o){if(Nu(o))return o;if(Array.isArray(o))return o.map(Ll);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const r=_f(o)||"Object";if(!sa[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:s}=sa[r];if(!s)throw new Error(`can't deserialize unregistered class ${r}`);if(s.deserialize)return s.deserialize(o);const h=Object.create(s.prototype);for(const p of Object.keys(o)){if(p==="$name")continue;const x=o[p];h[p]=sa[r].shallow.indexOf(p)>=0?x:Ll(x)}return h}class Ec{constructor(){this.first=!0}update(r,s){const h=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=s),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=h,!0))}}const un={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Hangul Syllables":o=>o>=44032&&o<=55215,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Fh(o){for(const r of o)if(Vh(r.charCodeAt(0)))return!0;return!1}function Cm(o){for(const r of o)if(!Im(r.charCodeAt(0)))return!1;return!0}function Uh(o){const r=o.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(r.join("|"),"u")}const yf=Uh(["Arab","Dupl","Mong","Ougr","Syrc"]);function Im(o){return!yf.test(String.fromCodePoint(o))}const km=Uh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Vh(o){return!(o!==746&&o!==747&&(o<4352||!(un["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||un["CJK Compatibility"](o)||un["CJK Strokes"](o)||!(!un["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||un["Enclosed CJK Letters and Months"](o)||un["Ideographic Description Characters"](o)||un.Kanbun(o)||un.Katakana(o)&&o!==12540||!(!un["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!un["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||un["Vertical Forms"](o)||un["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||km.test(String.fromCodePoint(o)))))}function Mm(o){return!(Vh(o)||function(r){return!!(un["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||un["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||un["Letterlike Symbols"](r)||un["Number Forms"](r)||un["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||un["Control Pictures"](r)&&r!==9251||un["Optical Character Recognition"](r)||un["Enclosed Alphanumerics"](r)||un["Geometric Shapes"](r)||un["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||un["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||un["CJK Symbols and Punctuation"](r)||un.Katakana(r)||un["Private Use Area"](r)||un["CJK Compatibility Forms"](r)||un["Small Form Variants"](r)||un["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(o))}const Am=Uh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Rm(o){return Am.test(String.fromCodePoint(o))}function Lm(o,r){return!(!r&&Rm(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||un.Khmer(o))}function zm(o){for(const r of o)if(Rm(r.charCodeAt(0)))return!0;return!1}const Ya=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){if(Ya.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(o,r){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(o.pluginStatus!=="loading")return this.setState(o),o;const s=o.pluginURL,h=new Promise(x=>{this.loadScriptResolve=x});r(s);const p=new Promise(x=>setTimeout(()=>x(),this.TIMEOUT));if(yield Promise.race([h,p]),this.isParsed()){const x={pluginStatus:"loaded",pluginURL:s};return this.setState(x),x}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)})}};class Dn{constructor(r,s){this.isSupportedScript=Dm,this.zoom=r,s?(this.now=s.now||0,this.fadeDuration=s.fadeDuration||0,this.zoomHistory=s.zoomHistory||new Ec,this.transition=s.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ec,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,s=r-Math.floor(r),h=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*s}}}function Dm(o){return function(r,s){for(const h of r)if(!Lm(h.charCodeAt(0),s))return!1;return!0}(o,Ya.getRTLTextPluginStatus()==="loaded")}class ju{constructor(r,s,h){this.property=r,this.value=s,this.expression=function(p,x,w){if(_c(p))return new F(p,x);if(xc(p)){const S=z(p,x,w);if(S.result==="error")throw new Error(S.value.map(E=>`${E.key}: ${E.message}`).join(", "));return S.value}{let S=p;return x.type==="color"&&typeof p=="string"?S=Qt.parse(p):x.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?x.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?x.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?x.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?S=$r.parse(p):x.type==="projectionDefinition"&&typeof p=="string"&&(S=pr.parse(p)):S=en.parse(p):S=kn.parse(p):S=Dt.parse(p),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>S}}}(s===void 0?r.specification.default:s,r.specification,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(r,s,h){return this.property.possiblyEvaluate(this,r,s,h)}}class $h{constructor(r,s){this.property=r,this.value=new ju(r,void 0,s)}transitioned(r,s){return new Bu(this.property,this.value,s,Vn({},r.transition,this.transition),r.now)}untransitioned(){return new Bu(this.property,this.value,null,{},0)}}class vf{constructor(r,s){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._globalState=s}getValue(r){return xr(this._values[r].value.value)}setValue(r,s){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new $h(this._values[r].property,this._globalState)),this._values[r].value=new ju(this._values[r].property,s===null?void 0:xr(s),this._globalState)}getTransition(r){return xr(this._values[r].transition)}setTransition(r,s){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new $h(this._values[r].property,this._globalState)),this._values[r].transition=xr(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(r[s]=h);const p=this.getTransition(s);p!==void 0&&(r[`${s}-transition`]=p)}return r}transitioned(r,s){const h=new Nm(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(r,s._values[p]);return h}untransitioned(){const r=new Nm(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}}class Bu{constructor(r,s,h,p,x){this.property=r,this.value=s,this.begin=x+p.delay||0,this.end=this.begin+p.duration||0,r.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(r,s,h){const p=r.now||0,x=this.value.possiblyEvaluate(r,s,h),w=this.prior;if(w){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return w.possiblyEvaluate(r,s,h);{const S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(r,s,h),x,Bt(S))}}return x}}class Nm{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,h){const p=new Zh(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,s,h);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class xf{constructor(r,s){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._globalState=s}hasValue(r){return this._values[r].value!==void 0}getValue(r){return xr(this._values[r].value)}setValue(r,s){this._values[r]=new ju(this._values[r].property,s===null?void 0:xr(s),this._globalState)}serialize(){const r={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(r[s]=h)}return r}possiblyEvaluate(r,s,h){const p=new Zh(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,s,h);return p}}class Eo{constructor(r,s,h){this.property=r,this.value=s,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,s,h,p){return this.property.evaluate(this.value,this.parameters,r,s,h,p)}}class Zh{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class It{constructor(r){this.specification=r}possiblyEvaluate(r,s){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(s)}interpolate(r,s,h){const p=Ni[this.specification.type];return p?p(r,s,h):r}}class Nt{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,h,p){return new Eo(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(s,null,{},h,p)}:r.expression,s)}interpolate(r,s,h){if(r.value.kind!=="constant"||s.value.kind!=="constant")return r;if(r.value.value===void 0||s.value.value===void 0)return new Eo(this,{kind:"constant",value:void 0},r.parameters);const p=Ni[this.specification.type];if(p){const x=p(r.value.value,s.value.value,h);return new Eo(this,{kind:"constant",value:x},r.parameters)}return r}evaluate(r,s,h,p,x,w){return r.kind==="constant"?r.value:r.evaluate(s,h,p,x,w)}}class Cc extends Nt{possiblyEvaluate(r,s,h,p){if(r.value===void 0)return new Eo(this,{kind:"constant",value:void 0},s);if(r.expression.kind==="constant"){const x=r.expression.evaluate(s,null,{},h,p),w=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,S=this._calculate(w,w,w,s);return new Eo(this,{kind:"constant",value:S},s)}if(r.expression.kind==="camera"){const x=this._calculate(r.expression.evaluate({zoom:s.zoom-1}),r.expression.evaluate({zoom:s.zoom}),r.expression.evaluate({zoom:s.zoom+1}),s);return new Eo(this,{kind:"constant",value:x},s)}return new Eo(this,r.expression,s)}evaluate(r,s,h,p,x,w){if(r.kind==="source"){const S=r.evaluate(s,h,p,x,w);return this._calculate(S,S,S,s)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(s.zoom)-1},h,p),r.evaluate({zoom:Math.floor(s.zoom)},h,p),r.evaluate({zoom:Math.floor(s.zoom)+1},h,p),s):r.value}_calculate(r,s,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:h,to:s}}interpolate(r){return r}}class Om{constructor(r){this.specification=r}possiblyEvaluate(r,s,h,p){if(r.value!==void 0){if(r.expression.kind==="constant"){const x=r.expression.evaluate(s,null,{},h,p);return this._calculate(x,x,x,s)}return this._calculate(r.expression.evaluate(new Dn(Math.floor(s.zoom-1),s)),r.expression.evaluate(new Dn(Math.floor(s.zoom),s)),r.expression.evaluate(new Dn(Math.floor(s.zoom+1),s)),s)}}_calculate(r,s,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:h,to:s}}interpolate(r){return r}}class Gh{constructor(r){this.specification=r}possiblyEvaluate(r,s,h,p){return!!r.expression.evaluate(s,null,{},h,p)}interpolate(){return!1}}class Bi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in r){const h=r[s];h.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new ju(h,void 0,void 0),x=this.defaultTransitionablePropertyValues[s]=new $h(h,void 0);this.defaultTransitioningPropertyValues[s]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}}}yt("DataDrivenProperty",Nt),yt("DataConstantProperty",It),yt("CrossFadedDataDrivenProperty",Cc),yt("CrossFadedProperty",Om),yt("ColorRampProperty",Gh);const jm="-transition";class eo extends Ct{constructor(r,s,h){if(super(),this.id=r.id,this.type=r.type,this._globalState=h,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter,this._featureFilter=Tt(r.filter,h)),s.layout&&(this._unevaluatedLayout=new xf(s.layout,h)),s.paint)){this._transitionablePaint=new vf(s.paint,h);for(const p in r.paint)this.setPaintProperty(p,r.paint[p],{validate:!1});for(const p in r.layout)this.setLayoutProperty(p,r.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zh(s.paint)}}setFilter(r){this.filter=r,this._featureFilter=Tt(r,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}getLayoutAffectingGlobalStateRefs(){const r=new Set;if(this._unevaluatedLayout)for(const s in this._unevaluatedLayout._values){const h=this._unevaluatedLayout._values[s];for(const p of h.getGlobalStateRefs())r.add(p)}for(const s of this._featureFilter.getGlobalStateRefs())r.add(s);return r}getPaintAffectingGlobalStateRefs(){var r;const s=new globalThis.Map;if(this._transitionablePaint)for(const h in this._transitionablePaint._values){const p=this._transitionablePaint._values[h].value;for(const x of p.getGlobalStateRefs()){const w=(r=s.get(x))!==null&&r!==void 0?r:[];w.push({name:h,value:p.value}),s.set(x,w)}}return s}setLayoutProperty(r,s,h={}){s!=null&&this._validate(zu,`layers.${this.id}.layout.${r}`,r,s,h)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,s):this.visibility=s)}getPaintProperty(r){return r.endsWith(jm)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,s,h={}){if(s!=null&&this._validate(my,`layers.${this.id}.paint.${r}`,r,s,h))return!1;if(r.endsWith(jm))return this._transitionablePaint.setTransition(r.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[r],x=p.property.specification["property-type"]==="cross-faded-data-driven",w=p.value.isDataDriven(),S=p.value;this._transitionablePaint.setValue(r,s),this._handleSpecialPaintPropertyUpdate(r);const E=this._transitionablePaint._values[r].value;return E.isDataDriven()||w||x||this._handleOverridablePaintPropertyUpdate(r,S,E)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,s,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ts(r,(s,h)=>!(s===void 0||h==="layout"&&!Object.keys(s).length||h==="paint"&&!Object.keys(s).length))}_validate(r,s,h,p,x={}){return(!x||x.validate!==!1)&&Pm(this,r.call(Xa,{key:s,layerType:this.type,objectKey:h,value:p,styleSpec:De,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof Eo&&Js(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}let zl;var gy={get paint(){return zl=zl||new Bi({"raster-opacity":new It(De.paint_raster["raster-opacity"]),"raster-hue-rotate":new It(De.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(De.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(De.paint_raster["raster-brightness-max"]),"raster-saturation":new It(De.paint_raster["raster-saturation"]),"raster-contrast":new It(De.paint_raster["raster-contrast"]),"raster-resampling":new It(De.paint_raster["raster-resampling"]),"raster-fade-duration":new It(De.paint_raster["raster-fade-duration"])})}};class _y extends eo{constructor(r,s){super(r,gy,s)}}const yy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ic{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&(r.isTransferred=!0,s.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function gr(o,r=1){let s=0,h=0;return{members:o.map(p=>{const x=yy[p.type].BYTES_PER_ELEMENT,w=s=Ja(s,Math.max(r,x)),S=p.components||1;return h=Math.max(h,x),s+=x*S,{name:p.name,type:p.type,components:S,offset:w}}),size:Ja(s,Math.max(h,r)),alignment:r}}function Ja(o,r){return Math.ceil(o/r)*r}class kc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const h=this.length;return this.resize(h+1),this.emplace(h,r,s)}emplace(r,s,h){const p=2*r;return this.int16[p+0]=s,this.int16[p+1]=h,r}}kc.prototype.bytesPerElement=4,yt("StructArrayLayout2i4",kc);class Mc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,s,h)}emplace(r,s,h,p){const x=3*r;return this.int16[x+0]=s,this.int16[x+1]=h,this.int16[x+2]=p,r}}Mc.prototype.bytesPerElement=6,yt("StructArrayLayout3i6",Mc);class qh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,s,h,p)}emplace(r,s,h,p,x){const w=4*r;return this.int16[w+0]=s,this.int16[w+1]=h,this.int16[w+2]=p,this.int16[w+3]=x,r}}qh.prototype.bytesPerElement=8,yt("StructArrayLayout4i8",qh);class Fu extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w){const S=this.length;return this.resize(S+1),this.emplace(S,r,s,h,p,x,w)}emplace(r,s,h,p,x,w,S){const E=6*r;return this.int16[E+0]=s,this.int16[E+1]=h,this.int16[E+2]=p,this.int16[E+3]=x,this.int16[E+4]=w,this.int16[E+5]=S,r}}Fu.prototype.bytesPerElement=12,yt("StructArrayLayout2i4i12",Fu);class bf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w){const S=this.length;return this.resize(S+1),this.emplace(S,r,s,h,p,x,w)}emplace(r,s,h,p,x,w,S){const E=4*r,M=8*r;return this.int16[E+0]=s,this.int16[E+1]=h,this.uint8[M+4]=p,this.uint8[M+5]=x,this.uint8[M+6]=w,this.uint8[M+7]=S,r}}bf.prototype.bytesPerElement=8,yt("StructArrayLayout2i4ub8",bf);class Qa extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const h=this.length;return this.resize(h+1),this.emplace(h,r,s)}emplace(r,s,h){const p=2*r;return this.float32[p+0]=s,this.float32[p+1]=h,r}}Qa.prototype.bytesPerElement=8,yt("StructArrayLayout2f8",Qa);class Dl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w,S,E,M,R){const j=this.length;return this.resize(j+1),this.emplace(j,r,s,h,p,x,w,S,E,M,R)}emplace(r,s,h,p,x,w,S,E,M,R,j){const V=10*r;return this.uint16[V+0]=s,this.uint16[V+1]=h,this.uint16[V+2]=p,this.uint16[V+3]=x,this.uint16[V+4]=w,this.uint16[V+5]=S,this.uint16[V+6]=E,this.uint16[V+7]=M,this.uint16[V+8]=R,this.uint16[V+9]=j,r}}Dl.prototype.bytesPerElement=20,yt("StructArrayLayout10ui20",Dl);class wf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w,S,E){const M=this.length;return this.resize(M+1),this.emplace(M,r,s,h,p,x,w,S,E)}emplace(r,s,h,p,x,w,S,E,M){const R=8*r;return this.uint16[R+0]=s,this.uint16[R+1]=h,this.uint16[R+2]=p,this.uint16[R+3]=x,this.uint16[R+4]=w,this.uint16[R+5]=S,this.uint16[R+6]=E,this.uint16[R+7]=M,r}}wf.prototype.bytesPerElement=16,yt("StructArrayLayout8ui16",wf);class Wh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w,S,E,M,R,j,V){const G=this.length;return this.resize(G+1),this.emplace(G,r,s,h,p,x,w,S,E,M,R,j,V)}emplace(r,s,h,p,x,w,S,E,M,R,j,V,G){const H=12*r;return this.int16[H+0]=s,this.int16[H+1]=h,this.int16[H+2]=p,this.int16[H+3]=x,this.uint16[H+4]=w,this.uint16[H+5]=S,this.uint16[H+6]=E,this.uint16[H+7]=M,this.int16[H+8]=R,this.int16[H+9]=j,this.int16[H+10]=V,this.int16[H+11]=G,r}}Wh.prototype.bytesPerElement=24,yt("StructArrayLayout4i4ui4i24",Wh);class Nl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,s,h)}emplace(r,s,h,p){const x=3*r;return this.float32[x+0]=s,this.float32[x+1]=h,this.float32[x+2]=p,r}}Nl.prototype.bytesPerElement=12,yt("StructArrayLayout3f12",Nl);class Tf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}Tf.prototype.bytesPerElement=4,yt("StructArrayLayout1ul4",Tf);class Sf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w,S,E,M){const R=this.length;return this.resize(R+1),this.emplace(R,r,s,h,p,x,w,S,E,M)}emplace(r,s,h,p,x,w,S,E,M,R){const j=10*r,V=5*r;return this.int16[j+0]=s,this.int16[j+1]=h,this.int16[j+2]=p,this.int16[j+3]=x,this.int16[j+4]=w,this.int16[j+5]=S,this.uint32[V+3]=E,this.uint16[j+8]=M,this.uint16[j+9]=R,r}}Sf.prototype.bytesPerElement=20,yt("StructArrayLayout6i1ul2ui20",Sf);class Hh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w){const S=this.length;return this.resize(S+1),this.emplace(S,r,s,h,p,x,w)}emplace(r,s,h,p,x,w,S){const E=6*r;return this.int16[E+0]=s,this.int16[E+1]=h,this.int16[E+2]=p,this.int16[E+3]=x,this.int16[E+4]=w,this.int16[E+5]=S,r}}Hh.prototype.bytesPerElement=12,yt("StructArrayLayout2i2i2i12",Hh);class Pf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,s,h,p,x)}emplace(r,s,h,p,x,w){const S=4*r,E=8*r;return this.float32[S+0]=s,this.float32[S+1]=h,this.float32[S+2]=p,this.int16[E+6]=x,this.int16[E+7]=w,r}}Pf.prototype.bytesPerElement=16,yt("StructArrayLayout2f1f2i16",Pf);class _ extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w){const S=this.length;return this.resize(S+1),this.emplace(S,r,s,h,p,x,w)}emplace(r,s,h,p,x,w,S){const E=16*r,M=4*r,R=8*r;return this.uint8[E+0]=s,this.uint8[E+1]=h,this.float32[M+1]=p,this.float32[M+2]=x,this.int16[R+6]=w,this.int16[R+7]=S,r}}_.prototype.bytesPerElement=16,yt("StructArrayLayout2ub2f2i16",_);class n extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,s,h)}emplace(r,s,h,p){const x=3*r;return this.uint16[x+0]=s,this.uint16[x+1]=h,this.uint16[x+2]=p,r}}n.prototype.bytesPerElement=6,yt("StructArrayLayout3ui6",n);class a extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w,S,E,M,R,j,V,G,H,ee,le,me){const Re=this.length;return this.resize(Re+1),this.emplace(Re,r,s,h,p,x,w,S,E,M,R,j,V,G,H,ee,le,me)}emplace(r,s,h,p,x,w,S,E,M,R,j,V,G,H,ee,le,me,Re){const be=24*r,Pe=12*r,Ve=48*r;return this.int16[be+0]=s,this.int16[be+1]=h,this.uint16[be+2]=p,this.uint16[be+3]=x,this.uint32[Pe+2]=w,this.uint32[Pe+3]=S,this.uint32[Pe+4]=E,this.uint16[be+10]=M,this.uint16[be+11]=R,this.uint16[be+12]=j,this.float32[Pe+7]=V,this.float32[Pe+8]=G,this.uint8[Ve+36]=H,this.uint8[Ve+37]=ee,this.uint8[Ve+38]=le,this.uint32[Pe+10]=me,this.int16[be+22]=Re,r}}a.prototype.bytesPerElement=48,yt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",a);class d extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,h,p,x,w,S,E,M,R,j,V,G,H,ee,le,me,Re,be,Pe,Ve,Xe,rt,gt,lt,ft,At,dt){const pt=this.length;return this.resize(pt+1),this.emplace(pt,r,s,h,p,x,w,S,E,M,R,j,V,G,H,ee,le,me,Re,be,Pe,Ve,Xe,rt,gt,lt,ft,At,dt)}emplace(r,s,h,p,x,w,S,E,M,R,j,V,G,H,ee,le,me,Re,be,Pe,Ve,Xe,rt,gt,lt,ft,At,dt,pt){const Qe=32*r,Ot=16*r;return this.int16[Qe+0]=s,this.int16[Qe+1]=h,this.int16[Qe+2]=p,this.int16[Qe+3]=x,this.int16[Qe+4]=w,this.int16[Qe+5]=S,this.int16[Qe+6]=E,this.int16[Qe+7]=M,this.uint16[Qe+8]=R,this.uint16[Qe+9]=j,this.uint16[Qe+10]=V,this.uint16[Qe+11]=G,this.uint16[Qe+12]=H,this.uint16[Qe+13]=ee,this.uint16[Qe+14]=le,this.uint16[Qe+15]=me,this.uint16[Qe+16]=Re,this.uint16[Qe+17]=be,this.uint16[Qe+18]=Pe,this.uint16[Qe+19]=Ve,this.uint16[Qe+20]=Xe,this.uint16[Qe+21]=rt,this.uint16[Qe+22]=gt,this.uint32[Ot+12]=lt,this.float32[Ot+13]=ft,this.float32[Ot+14]=At,this.uint16[Qe+30]=dt,this.uint16[Qe+31]=pt,r}}d.prototype.bytesPerElement=64,yt("StructArrayLayout8i15ui1ul2f2ui64",d);class m extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}m.prototype.bytesPerElement=4,yt("StructArrayLayout1f4",m);class b extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,s,h)}emplace(r,s,h,p){const x=3*r;return this.uint16[6*r+0]=s,this.float32[x+1]=h,this.float32[x+2]=p,r}}b.prototype.bytesPerElement=12,yt("StructArrayLayout1ui2f12",b);class T extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,s,h)}emplace(r,s,h,p){const x=4*r;return this.uint32[2*r+0]=s,this.uint16[x+2]=h,this.uint16[x+3]=p,r}}T.prototype.bytesPerElement=8,yt("StructArrayLayout1ul2ui8",T);class C extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const h=this.length;return this.resize(h+1),this.emplace(h,r,s)}emplace(r,s,h){const p=2*r;return this.uint16[p+0]=s,this.uint16[p+1]=h,r}}C.prototype.bytesPerElement=4,yt("StructArrayLayout2ui4",C);class k extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}k.prototype.bytesPerElement=2,yt("StructArrayLayout1ui2",k);class D extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,s,h,p)}emplace(r,s,h,p,x){const w=4*r;return this.float32[w+0]=s,this.float32[w+1]=h,this.float32[w+2]=p,this.float32[w+3]=x,r}}D.prototype.bytesPerElement=16,yt("StructArrayLayout4f16",D);class O extends Ic{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new A(this.anchorPointX,this.anchorPointY)}}O.prototype.size=20;class U extends Sf{get(r){return new O(this,r)}}yt("CollisionBoxArray",U);class B extends Ic{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}B.prototype.size=48;class q extends a{get(r){return new B(this,r)}}yt("PlacedSymbolArray",q);class Q extends Ic{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Q.prototype.size=64;class ue extends d{get(r){return new Q(this,r)}}yt("SymbolInstanceArray",ue);class he extends m{getoffsetX(r){return this.float32[1*r+0]}}yt("GlyphOffsetArray",he);class de extends Mc{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}yt("SymbolLineVertexArray",de);class ge extends Ic{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ge.prototype.size=12;class ve extends b{get(r){return new ge(this,r)}}yt("TextAnchorOffsetArray",ve);class _e extends Ic{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}_e.prototype.size=8;class Te extends T{get(r){return new _e(this,r)}}yt("FeatureIndexArray",Te);class Ee extends kc{}class xe extends kc{}class Ae extends kc{}class qe extends Fu{}class Ue extends bf{}class $e extends Qa{}class Ze extends Dl{}class st extends wf{}class ot extends Wh{}class tt extends Nl{}class Et extends Tf{}class Wt extends Hh{}class Tn extends _{}class Sn extends n{}class An extends C{}const er=gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:jn}=er;class gn{constructor(r=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=r}prepareSegment(r,s,h,p){const x=this.segments[this.segments.length-1];return r>gn.MAX_VERTEX_ARRAY_LENGTH&&$n(`Max vertices per segment is ${gn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${gn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!x||x.vertexLength+r>gn.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p?this.createNewSegment(s,h,p):x}createNewSegment(r,s,h){const p={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return h!==void 0&&(p.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(r,s,h){return this.prepareSegment(0,r,s,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,h,p){return new gn([{vertexOffset:r,primitiveOffset:s,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function qn(o,r){return 256*(o=Pt(Math.floor(o),0,255))+Pt(Math.floor(r),0,255)}gn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt("SegmentVector",gn);const di=gr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Er=gr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Cr,Fi,el,to={exports:{}},tl={exports:{}},Ol={exports:{}},Kh=function(){if(el)return to.exports;el=1;var o=(Cr||(Cr=1,tl.exports=function(s,h){var p,x,w,S,E,M,R,j;for(x=s.length-(p=3&s.length),w=h,E=3432918353,M=461845907,j=0;j<x;)R=255&s.charCodeAt(j)|(255&s.charCodeAt(++j))<<8|(255&s.charCodeAt(++j))<<16|(255&s.charCodeAt(++j))<<24,++j,w=27492+(65535&(S=5*(65535&(w=(w^=R=(65535&(R=(R=(65535&R)*E+(((R>>>16)*E&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295)<<13|w>>>19))+((5*(w>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(R=0,p){case 3:R^=(255&s.charCodeAt(j+2))<<16;case 2:R^=(255&s.charCodeAt(j+1))<<8;case 1:w^=R=(65535&(R=(R=(65535&(R^=255&s.charCodeAt(j)))*E+(((R>>>16)*E&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295}return w^=s.length,w=2246822507*(65535&(w^=w>>>16))+((2246822507*(w>>>16)&65535)<<16)&4294967295,w=3266489909*(65535&(w^=w>>>13))+((3266489909*(w>>>16)&65535)<<16)&4294967295,(w^=w>>>16)>>>0}),tl.exports),r=(Fi||(Fi=1,Ol.exports=function(s,h){for(var p,x=s.length,w=h^x,S=0;x>=4;)p=1540483477*(65535&(p=255&s.charCodeAt(S)|(255&s.charCodeAt(++S))<<8|(255&s.charCodeAt(++S))<<16|(255&s.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),w=1540483477*(65535&w)+((1540483477*(w>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),x-=4,++S;switch(x){case 3:w^=(255&s.charCodeAt(S+2))<<16;case 2:w^=(255&s.charCodeAt(S+1))<<8;case 1:w=1540483477*(65535&(w^=255&s.charCodeAt(S)))+((1540483477*(w>>>16)&65535)<<16)}return w=1540483477*(65535&(w^=w>>>13))+((1540483477*(w>>>16)&65535)<<16),(w^=w>>>15)>>>0}),Ol.exports);return to.exports=o,to.exports.murmur3=o,to.exports.murmur2=r,to.exports}(),Ac=N(Kh);class oa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,s,h,p){this.ids.push(us(r)),this.positions.push(s,h,p)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=us(r);let h=0,p=this.ids.length-1;for(;h<p;){const w=h+p>>1;this.ids[w]>=s?p=w:h=w+1}const x=[];for(;this.ids[h]===s;)x.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return x}static serialize(r,s){const h=new Float64Array(r.ids),p=new Uint32Array(r.positions);return Co(h,p,0,h.length-1),s&&s.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(r){const s=new oa;return s.ids=r.ids,s.positions=r.positions,s.indexed=!0,s}}function us(o){const r=+o;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Ac(String(o))}function Co(o,r,s,h){for(;s<h;){const p=o[s+h>>1];let x=s-1,w=h+1;for(;;){do x++;while(o[x]<p);do w--;while(o[w]>p);if(x>=w)break;Io(o,x,w),Io(r,3*x,3*w),Io(r,3*x+1,3*w+1),Io(r,3*x+2,3*w+2)}w-s<h-w?(Co(o,r,s,w),s=w+1):(Co(o,r,w+1,h),h=w)}}function Io(o,r,s){const h=o[r];o[r]=o[s],o[s]=h}yt("FeaturePositionMap",oa);class hs{constructor(r,s){this.gl=r.gl,this.location=s}}class _r extends hs{constructor(r,s){super(r,s),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Gr extends hs{constructor(r,s){super(r,s),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class ds extends hs{constructor(r,s){super(r,s),this.current=Qt.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Jr=new Float32Array(16);function Ef(o){return[qn(255*o.r,255*o.g),qn(255*o.b,255*o.a)]}class Uu{constructor(r,s,h){this.value=r,this.uniformNames=s.map(p=>`u_${p}`),this.type=h}setUniform(r,s,h){r.set(h.constantOr(this.value))}getBinding(r,s,h){return this.type==="color"?new ds(r,s):new _r(r,s)}}class jl{constructor(r,s){this.uniformNames=s.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=r.tlbr}setConstantDashPositions(r,s){this.dashTo=[0,r.y,r.height,r.width],this.dashFrom=[0,s.y,s.height,s.width]}setUniform(r,s,h,p){let x=null;p==="u_pattern_to"?x=this.patternTo:p==="u_pattern_from"?x=this.patternFrom:p==="u_dasharray_to"?x=this.dashTo:p==="u_dasharray_from"?x=this.dashFrom:p==="u_pixel_ratio_to"?x=this.pixelRatioTo:p==="u_pixel_ratio_from"&&(x=this.pixelRatioFrom),x!==null&&r.set(x)}getBinding(r,s,h){return h.substr(0,9)==="u_pattern"||h.substr(0,12)==="u_dasharray_"?new Gr(r,s):new _r(r,s)}}class aa{constructor(r,s,h,p){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(r,s,h){const p=this.paintVertexArray.length,x=this.expression.evaluate(new Dn(0,h),s,{},h.canonical,[],h.formattedSection);this.paintVertexArray.resize(r),this._setPaintValue(p,r,x)}updatePaintArray(r,s,h,p,x){const w=this.expression.evaluate(new Dn(0,x),h,p);this._setPaintValue(r,s,w)}_setPaintValue(r,s,h){if(this.type==="color"){const p=Ef(h);for(let x=r;x<s;x++)this.paintVertexArray.emplace(x,p[0],p[1])}else{for(let p=r;p<s;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class no{constructor(r,s,h,p,x,w){this.expression=r,this.uniformNames=s.map(S=>`u_${S}_t`),this.type=h,this.useIntegerZoom=p,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=s.map(S=>({name:`a_${S}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(r,s,h){const p=this.expression.evaluate(new Dn(this.zoom,h),s,{},h.canonical,[],h.formattedSection),x=this.expression.evaluate(new Dn(this.zoom+1,h),s,{},h.canonical,[],h.formattedSection),w=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(w,r,p,x)}updatePaintArray(r,s,h,p,x){const w=this.expression.evaluate(new Dn(this.zoom,x),h,p),S=this.expression.evaluate(new Dn(this.zoom+1,x),h,p);this._setPaintValue(r,s,w,S)}_setPaintValue(r,s,h,p){if(this.type==="color"){const x=Ef(h),w=Ef(p);for(let S=r;S<s;S++)this.paintVertexArray.emplace(S,x[0],x[1],w[0],w[1])}else{for(let x=r;x<s;x++)this.paintVertexArray.emplace(x,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=Pt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);r.set(p)}getBinding(r,s,h){return new _r(r,s)}}class nl{constructor(r,s,h,p,x,w){this.expression=r,this.type=s,this.useIntegerZoom=h,this.zoom=p,this.layerId=w,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(r,s,h){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(p,r,this.getPositionIds(s),h)}updatePaintArray(r,s,h,p,x){this._setPaintValues(r,s,this.getPositionIds(h),x)}_setPaintValues(r,s,h,p){const x=this.getPositions(p);if(!x||!h)return;const w=x[h.min],S=x[h.mid],E=x[h.max];if(w&&S&&E)for(let M=r;M<s;M++)this.emplace(this.zoomInPaintVertexArray,M,S,w),this.emplace(this.zoomOutPaintVertexArray,M,S,E)}upload(r){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const s=this.getVertexAttributes();this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,s,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,s,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class rl extends nl{getPositions(r){return r.imagePositions}getPositionIds(r){return r.patterns&&r.patterns[this.layerId]}getVertexAttributes(){return di.members}emplace(r,s,h,p){r.emplace(s,h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],h.pixelRatio,p.pixelRatio)}}class Cf extends nl{getPositions(r){return r.dashPositions}getPositionIds(r){return r.dashes&&r.dashes[this.layerId]}getVertexAttributes(){return Er.members}emplace(r,s,h,p){r.emplace(s,0,h.y,h.height,h.width,0,p.y,p.height,p.width)}}class If{constructor(r,s,h){this.binders={},this._buffers=[];const p=[];for(const x in r.paint._values){if(!h(x))continue;const w=r.paint.get(x);if(!(w instanceof Eo&&Js(w.property.specification)))continue;const S=kf(x,r.type),E=w.value,M=w.property.specification.type,R=w.property.useIntegerZoom,j=w.property.specification["property-type"],V=j==="cross-faded"||j==="cross-faded-data-driven";if(E.kind==="constant")this.binders[x]=V?new jl(E.value,S):new Uu(E.value,S,M),p.push(`/u_${x}`);else if(E.kind==="source"||V){const G=Mf(x,M,"source");this.binders[x]=V?x==="line-dasharray"?new Cf(E,M,R,s,G,r.id):new rl(E,M,R,s,G,r.id):new aa(E,S,M,G),p.push(`/a_${x}`)}else{const G=Mf(x,M,"composite");this.binders[x]=new no(E,S,M,R,s,G),p.push(`/z_${x}`)}}this.cacheKey=p.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof aa||s instanceof no?s.maxValue:0}populatePaintArrays(r,s,h){for(const p in this.binders){const x=this.binders[p];(x instanceof aa||x instanceof no||x instanceof nl)&&x.populatePaintArray(r,s,h)}}setConstantPatternPositions(r,s){for(const h in this.binders){const p=this.binders[h];p instanceof jl&&p.setConstantPatternPositions(r,s)}}setConstantDashPositions(r,s){for(const h in this.binders){const p=this.binders[h];p instanceof jl&&p.setConstantDashPositions(r,s)}}updatePaintArrays(r,s,h,p,x){let w=!1;for(const S in r){const E=s.getPositions(S);for(const M of E){const R=h.feature(M.index);for(const j in this.binders){const V=this.binders[j];if((V instanceof aa||V instanceof no||V instanceof nl)&&V.expression.isStateDependent===!0){const G=p.paint.get(j);V.expression=G.value,V.updatePaintArray(M.start,M.end,R,r[S],x),w=!0}}}}return w}defines(){const r=[];for(const s in this.binders){const h=this.binders[s];(h instanceof Uu||h instanceof jl)&&r.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return r}getBinderAttributes(){const r=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof aa||h instanceof no)for(let p=0;p<h.paintVertexAttributes.length;p++)r.push(h.paintVertexAttributes[p].name);else if(h instanceof nl){const p=h.getVertexAttributes();for(const x of p)r.push(x.name)}}return r}getBinderUniforms(){const r=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Uu||h instanceof jl||h instanceof no)for(const p of h.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,s){const h=[];for(const p in this.binders){const x=this.binders[p];if(x instanceof Uu||x instanceof jl||x instanceof no){for(const w of x.uniformNames)if(s[w]){const S=x.getBinding(r,s[w],w);h.push({name:w,property:p,binding:S})}}}return h}setUniforms(r,s,h,p){for(const{name:x,property:w,binding:S}of s)this.binders[w].setUniform(S,p,h.get(w),x)}updatePaintBuffers(r){this._buffers=[];for(const s in this.binders){const h=this.binders[s];if(r&&h instanceof nl){const p=r.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(h instanceof aa||h instanceof no)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(r){for(const s in this.binders){const h=this.binders[s];(h instanceof aa||h instanceof no||h instanceof nl)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof aa||s instanceof no||s instanceof nl)&&s.destroy()}}}class il{constructor(r,s,h=()=>!0){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new If(p,s,h);this.needsUpload=!1,this._featureMap=new oa,this._bufferOffset=0}populatePaintArrays(r,s,h,p){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(r,s,p);s.id!==void 0&&this._featureMap.add(s.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,h,p){for(const x of h)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(r,this._featureMap,s,x,p)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function kf(o,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}function Mf(o,r,s){const h={color:{source:Qa,composite:D},number:{source:m,composite:Qa}},p=function(x){return{"line-pattern":{source:Ze,composite:Ze},"fill-pattern":{source:Ze,composite:Ze},"fill-extrusion-pattern":{source:Ze,composite:Ze},"line-dasharray":{source:st,composite:st}}[x]}(o);return p&&p[s]||h[r][s]}yt("ConstantBinder",Uu),yt("CrossFadedConstantBinder",jl),yt("SourceExpressionBinder",aa),yt("CrossFadedPatternBinder",rl),yt("CrossFadedDasharrayBinder",Cf),yt("CompositeExpressionBinder",no),yt("ProgramConfiguration",If,{omit:["_buffers"]}),yt("ProgramConfigurationSet",il);const Vu=Math.pow(2,14)-1,cw=-Vu-1;function $u(o){const r=Oe/o.extent,s=o.loadGeometry();for(let h=0;h<s.length;h++){const p=s[h];for(let x=0;x<p.length;x++){const w=p[x],S=Math.round(w.x*r),E=Math.round(w.y*r);w.x=Pt(S,cw,Vu),w.y=Pt(E,cw,Vu),(S<w.x||S>w.x+1||E<w.y||E>w.y+1)&&$n("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Zu(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?$u(o):[]}}const uw=-32768;function Xk(o,r,s,h,p){o.emplaceBack(uw+8*r+h,uw+8*s+p)}class vy{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasDependencies=!1,this.layoutVertexArray=new xe,this.indexArray=new Sn,this.segments=new gn,this.programConfigurations=new il(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,h){const p=this.layers[0],x=[];let w=null,S=!1,E=p.type==="heatmap";if(p.type==="circle"){const R=p;w=R.layout.get("circle-sort-key"),S=!w.isConstant(),E=E||R.paint.get("circle-pitch-alignment")==="map"}const M=E?s.subdivisionGranularity.circle:1;for(const{feature:R,id:j,index:V,sourceLayerIndex:G}of r){const H=this.layers[0]._featureFilter.needGeometry,ee=Zu(R,H);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom),ee,h))continue;const le=S?w.evaluate(ee,{},h):void 0,me={id:j,properties:R.properties,type:R.type,sourceLayerIndex:G,index:V,geometry:H?ee.geometry:$u(R),patterns:{},sortKey:le};x.push(me)}S&&x.sort((R,j)=>R.sortKey-j.sortKey);for(const R of x){const{geometry:j,index:V,sourceLayerIndex:G}=R,H=r[V].feature;this.addFeature(R,j,V,h,M),s.featureIndex.insert(H,j,V,G,this.index)}}update(r,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,jn),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,h,p,x=1){let w;switch(x){case 1:w=[0,7];break;case 3:w=[0,2,5,7];break;case 5:w=[0,1,3,4,6,7];break;case 7:w=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${x}; valid values are 1, 3, 5, 7.`)}const S=w.length;for(const E of s)for(const M of E){const R=M.x,j=M.y;if(R<0||R>=Oe||j<0||j>=Oe)continue;const V=this.segments.prepareSegment(S*S,this.layoutVertexArray,this.indexArray,r.sortKey),G=V.vertexLength;for(let H=0;H<S;H++)for(let ee=0;ee<S;ee++)Xk(this.layoutVertexArray,R,j,w[ee],w[H]);for(let H=0;H<S-1;H++)for(let ee=0;ee<S-1;ee++){const le=G+H*S+ee,me=G+(H+1)*S+ee;this.indexArray.emplaceBack(le,me+1,le+1),this.indexArray.emplaceBack(le,me,me+1)}V.vertexLength+=S*S,V.primitiveLength+=(S-1)*(S-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{imagePositions:{},canonical:p})}}function hw(o,r){for(let s=0;s<o.length;s++)if(Xh(r,o[s]))return!0;for(let s=0;s<r.length;s++)if(Xh(o,r[s]))return!0;return!!xy(o,r)}function Bm(o,r,s){return!!Xh(o,r)||!!by(r,o,s)}function dw(o,r){if(o.length===1)return pw(r,o[0]);for(let s=0;s<r.length;s++){const h=r[s];for(let p=0;p<h.length;p++)if(Xh(o,h[p]))return!0}for(let s=0;s<o.length;s++)if(pw(r,o[s]))return!0;for(let s=0;s<r.length;s++)if(xy(o,r[s]))return!0;return!1}function Yk(o,r,s){if(o.length>1){if(xy(o,r))return!0;for(let h=0;h<r.length;h++)if(by(r[h],o,s))return!0}for(let h=0;h<o.length;h++)if(by(o[h],r,s))return!0;return!1}function xy(o,r){if(o.length===0||r.length===0)return!1;for(let s=0;s<o.length-1;s++){const h=o[s],p=o[s+1];for(let x=0;x<r.length-1;x++)if(Jk(h,p,r[x],r[x+1]))return!0}return!1}function Jk(o,r,s,h){return vi(o,s,h)!==vi(r,s,h)&&vi(o,r,s)!==vi(o,r,h)}function by(o,r,s){const h=s*s;if(r.length===1)return o.distSqr(r[0])<h;for(let p=1;p<r.length;p++)if(fw(o,r[p-1],r[p])<h)return!0;return!1}function fw(o,r,s){const h=r.distSqr(s);if(h===0)return o.distSqr(r);const p=((o.x-r.x)*(s.x-r.x)+(o.y-r.y)*(s.y-r.y))/h;return o.distSqr(p<0?r:p>1?s:s.sub(r)._mult(p)._add(r))}function pw(o,r){let s,h,p,x=!1;for(let w=0;w<o.length;w++){s=o[w];for(let S=0,E=s.length-1;S<s.length;E=S++)h=s[S],p=s[E],h.y>r.y!=p.y>r.y&&r.x<(p.x-h.x)*(r.y-h.y)/(p.y-h.y)+h.x&&(x=!x)}return x}function Xh(o,r){let s=!1;for(let h=0,p=o.length-1;h<o.length;p=h++){const x=o[h],w=o[p];x.y>r.y!=w.y>r.y&&r.x<(w.x-x.x)*(r.y-x.y)/(w.y-x.y)+x.x&&(s=!s)}return s}function Qk(o,r,s){const h=s[0],p=s[2];if(o.x<h.x&&r.x<h.x||o.x>p.x&&r.x>p.x||o.y<h.y&&r.y<h.y||o.y>p.y&&r.y>p.y)return!1;const x=vi(o,r,s[0]);return x!==vi(o,r,s[1])||x!==vi(o,r,s[2])||x!==vi(o,r,s[3])}function Yh(o,r,s){const h=r.paint.get(o).value;return h.kind==="constant"?h.value:s.programConfigurations.get(r.id).getMaxValue(o)}function Fm(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Um(o,r,s,h,p){if(!r[0]&&!r[1])return o;const x=A.convert(r)._mult(p);s==="viewport"&&x._rotate(-h);const w=[];for(let S=0;S<o.length;S++)w.push(o[S].sub(x));return w}function eM({queryGeometry:o,size:r},s){return Bm(o,s,r)}function tM({queryGeometry:o,size:r,transform:s,unwrappedTileID:h,getElevation:p},x){return Bm(o,x,r*(s.projectTileCoordinates(x.x,x.y,h,p).signedDistanceFromCamera/s.cameraToCenterDistance))}function nM({queryGeometry:o,size:r,transform:s,unwrappedTileID:h,getElevation:p},x){const w=s.projectTileCoordinates(x.x,x.y,h,p).signedDistanceFromCamera,S=r*(s.cameraToCenterDistance/w);return Bm(o,wy(x,s,h,p),S)}function rM({queryGeometry:o,size:r,transform:s,unwrappedTileID:h,getElevation:p},x){return Bm(o,wy(x,s,h,p),r)}function mw({queryGeometry:o,size:r,transform:s,unwrappedTileID:h,getElevation:p,pitchAlignment:x="map",pitchScale:w="map"},S){const E=x==="map"?w==="map"?eM:tM:w==="map"?nM:rM,M={queryGeometry:o,size:r,transform:s,unwrappedTileID:h,getElevation:p};for(const R of S)for(const j of R)if(E(M,j))return!0;return!1}function wy(o,r,s,h){const p=r.projectTileCoordinates(o.x,o.y,s,h).point;return new A((.5*p.x+.5)*r.width,(.5*-p.y+.5)*r.height)}let gw,_w;yt("CircleBucket",vy,{omit:["layers"]});var iM={get paint(){return _w=_w||new Bi({"circle-radius":new Nt(De.paint_circle["circle-radius"]),"circle-color":new Nt(De.paint_circle["circle-color"]),"circle-blur":new Nt(De.paint_circle["circle-blur"]),"circle-opacity":new Nt(De.paint_circle["circle-opacity"]),"circle-translate":new It(De.paint_circle["circle-translate"]),"circle-translate-anchor":new It(De.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(De.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(De.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nt(De.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nt(De.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nt(De.paint_circle["circle-stroke-opacity"])})},get layout(){return gw=gw||new Bi({"circle-sort-key":new Nt(De.layout_circle["circle-sort-key"])})}};class sM extends eo{constructor(r,s){super(r,iM,s)}createBucket(r){return new vy(r)}queryRadius(r){const s=r;return Yh("circle-radius",this,s)+Yh("circle-stroke-width",this,s)+Fm(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:r,feature:s,featureState:h,geometry:p,transform:x,pixelsToTileUnits:w,unwrappedTileID:S,getElevation:E}){const M=Um(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-x.bearingInRadians,w),R=this.paint.get("circle-radius").evaluate(s,h)+this.paint.get("circle-stroke-width").evaluate(s,h),j=this.paint.get("circle-pitch-scale"),V=this.paint.get("circle-pitch-alignment");let G,H;return V==="map"?(G=M,H=R*w):(G=function(ee,le,me,Re){return ee.map(be=>wy(be,le,me,Re))}(M,x,S,E),H=R),mw({queryGeometry:G,size:H,transform:x,unwrappedTileID:S,getElevation:E,pitchAlignment:V,pitchScale:j},p)}}class yw extends vy{}let vw;yt("HeatmapBucket",yw,{omit:["layers"]});var oM={get paint(){return vw=vw||new Bi({"heatmap-radius":new Nt(De.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nt(De.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(De.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gh(De.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(De.paint_heatmap["heatmap-opacity"])})}};function Ty(o,{width:r,height:s},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*s*h)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${r*s*h}`)}else p=new Uint8Array(r*s*h);return o.width=r,o.height=s,o.data=p,o}function xw(o,{width:r,height:s},h){if(r===o.width&&s===o.height)return;const p=Ty({},{width:r,height:s},h);Sy(o,p,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,r),height:Math.min(o.height,s)},h),o.width=r,o.height=s,o.data=p.data}function Sy(o,r,s,h,p,x){if(p.width===0||p.height===0)return r;if(p.width>o.width||p.height>o.height||s.x>o.width-p.width||s.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||h.x>r.width-p.width||h.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const w=o.data,S=r.data;if(w===S)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<p.height;E++){const M=((s.y+E)*o.width+s.x)*x,R=((h.y+E)*r.width+h.x)*x;for(let j=0;j<p.width*x;j++)S[R+j]=w[M+j]}return r}class Af{constructor(r,s){Ty(this,r,1,s)}resize(r){xw(this,r,1)}clone(){return new Af({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,h,p,x){Sy(r,s,h,p,x,1)}}class fs{constructor(r,s){Ty(this,r,4,s)}resize(r){xw(this,r,4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,h,p,x){Sy(r,s,h,p,x,4)}setPixel(r,s,h){const p=4*(r*this.width+s);this.data[p+0]=Math.round(255*h.r/h.a),this.data[p+1]=Math.round(255*h.g/h.a),this.data[p+2]=Math.round(255*h.b/h.a),this.data[p+3]=Math.round(255*h.a)}}function bw(o){const r={},s=o.resolution||256,h=o.clips?o.clips.length:1,p=o.image||new fs({width:s,height:h});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const x=(w,S,E)=>{r[o.evaluationKey]=E;const M=o.expression.evaluate(r);p.setPixel(w/4/s,S/4,M)};if(o.clips)for(let w=0,S=0;w<h;++w,S+=4*s)for(let E=0,M=0;E<s;E++,M+=4){const R=E/(s-1),{start:j,end:V}=o.clips[w];x(S,M,j*(1-R)+V*R)}else for(let w=0,S=0;w<s;w++,S+=4)x(0,S,w/(s-1));return p}yt("AlphaImage",Af),yt("RGBAImage",fs);const Py="big-fb";class aM extends eo{createBucket(r){return new yw(r)}constructor(r,s){super(r,oM,s),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Py)&&this.heatmapFbos.delete(Py)}queryRadius(r){return Yh("heatmap-radius",this,r)}queryIntersectsFeature({queryGeometry:r,feature:s,featureState:h,geometry:p,transform:x,pixelsToTileUnits:w,unwrappedTileID:S,getElevation:E}){return mw({queryGeometry:r,size:this.paint.get("heatmap-radius").evaluate(s,h)*w,transform:x,unwrappedTileID:S,getElevation:E},p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ww;var lM={get paint(){return ww=ww||new Bi({"hillshade-illumination-direction":new It(De.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new It(De.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new It(De.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(De.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(De.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(De.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(De.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new It(De.paint_hillshade["hillshade-method"])})}};class cM extends eo{constructor(r,s){super(r,lM,s),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let r=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values;const x=Math.max(r.length,s.length,h.length,p.length);r=r.concat(Array(x-r.length).fill(r.at(-1))),s=s.concat(Array(x-s.length).fill(s.at(-1))),h=h.concat(Array(x-h.length).fill(h.at(-1))),p=p.concat(Array(x-p.length).fill(p.at(-1)));const w=s.map(li);return{directionRadians:r.map(li),altitudeRadians:w,shadowColor:p,highlightColor:h}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Tw;var uM={get paint(){return Tw=Tw||new Bi({"color-relief-opacity":new It(De["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Gh(De["paint_color-relief"]["color-relief-color"])})}};class Ey{constructor(r,s,h,p){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(s,p)}update(r,s,h){const{width:p,height:x}=r,w=!(this.size&&this.size[0]===p&&this.size[1]===x||h),{context:S}=this,{gl:E}=S;if(this.useMipmap=!!(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),w)this.size=[p,x],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||mn(r)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,r):E.texImage2D(E.TEXTURE_2D,0,this.format,p,x,0,this.format,E.UNSIGNED_BYTE,r.data);else{const{x:M,y:R}=h||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||mn(r)?E.texSubImage2D(E.TEXTURE_2D,0,M,R,E.RGBA,E.UNSIGNED_BYTE,r):E.texSubImage2D(E.TEXTURE_2D,0,M,R,p,x,E.RGBA,E.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D),S.pixelStoreUnpackFlipY.setDefault(),S.pixelStoreUnpack.setDefault(),S.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(r,s,h){const{context:p}=this,{gl:x}=p;x.bindTexture(x.TEXTURE_2D,this.texture),h!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=x.LINEAR),r!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,r),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,h||r),this.filter=r),s!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,s),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Sw{constructor(r,s,h,p=1,x=1,w=1,S=0){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void $n(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const E=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=x,this.blueFactor=w,this.baseShift=S;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<E;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(E,M)]=this.data[this._idx(E-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,E)]=this.data[this._idx(M,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<E;M++)for(let R=0;R<E;R++){const j=this.get(M,R);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(r,s){const h=new Uint8Array(this.data.buffer),p=4*this._idx(r,s);return this.unpack(h[p],h[p+1],h[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}unpack(r,s,h){return r*this.redFactor+s*this.greenFactor+h*this.blueFactor-this.baseShift}pack(r){return Pw(r,this.getUnpackVector())}getPixels(){return new fs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,s,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,x=s*this.dim+this.dim,w=h*this.dim,S=h*this.dim+this.dim;switch(s){case-1:p=x-1;break;case 1:x=p+1}switch(h){case-1:w=S-1;break;case 1:S=w+1}const E=-s*this.dim,M=-h*this.dim;for(let R=w;R<S;R++)for(let j=p;j<x;j++)this.data[this._idx(j,R)]=r.data[this._idx(j+E,R+M)]}}function Pw(o,r){const s=r[0],h=r[1],p=r[2],x=r[3],w=Math.min(s,h,p),S=Math.round((o+x)/w);return{r:Math.floor(S*w/s)%256,g:Math.floor(S*w/h)%256,b:Math.floor(S*w/p)%256}}yt("DEMData",Sw);class hM extends eo{constructor(r,s){super(r,uM,s)}_createColorRamp(r){const s={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof y&&h._styleExpression.expression instanceof zn){this.colorRampExpression=h;const w=h._styleExpression.expression;s.elevationStops=w.labels,s.colorStops=[];for(const S of s.elevationStops)s.colorStops.push(w.evaluate({globals:{elevation:S}}))}if(s.elevationStops.length<1&&(s.elevationStops=[0],s.colorStops=[Qt.transparent]),s.elevationStops.length<2&&(s.elevationStops.push(s.elevationStops[0]+1),s.colorStops.push(s.colorStops[0])),s.elevationStops.length<=r)return s;const p={elevationStops:[],colorStops:[]},x=(s.elevationStops.length-1)/(r-1);for(let w=0;w<s.elevationStops.length-.5;w+=x)p.elevationStops.push(s.elevationStops[Math.round(w)]),p.colorStops.push(s.colorStops[Math.round(w)]);return $n(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(r,s,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const p=this._createColorRamp(s),x=new fs({width:p.colorStops.length,height:1}),w=new fs({width:p.colorStops.length,height:1});for(let S=0;S<p.elevationStops.length;S++){const E=Pw(p.elevationStops[S],h);w.setPixel(0,S,new Qt(E.r/255,E.g/255,E.b/255,1)),x.setPixel(0,S,p.colorStops[S])}return this.colorRampTextures={elevationTexture:new Ey(r,w,r.gl.RGBA),colorTexture:new Ey(r,x,r.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const dM=gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:fM}=dM;function Vm(o,r,s){const h=s.patternDependencies;let p=!1;for(const x of r){const w=x.paint.get(`${o}-pattern`);w.isConstant()||(p=!0);const S=w.constantOr(null);S&&(p=!0,h[S.to]=!0,h[S.from]=!0)}return p}function Cy(o,r,s,h,p){const{zoom:x}=h,w=p.patternDependencies;for(const S of r){const E=S.paint.get(`${o}-pattern`).value;if(E.kind!=="constant"){let M=E.evaluate({zoom:x-1},s,{},p.availableImages),R=E.evaluate({zoom:x},s,{},p.availableImages),j=E.evaluate({zoom:x+1},s,{},p.availableImages);M=M&&M.name?M.name:M,R=R&&R.name?R.name:R,j=j&&j.name?j.name:j,w[M]=!0,w[R]=!0,w[j]=!0,s.patterns[S.id]={min:M,mid:R,max:j}}}return s}function Ew(o,r,s,h,p){let x;if(p===function(w,S,E,M){let R=0;for(let j=S,V=E-M;j<E;j+=M)R+=(w[V]-w[j])*(w[j+1]+w[V+1]),V=j;return R}(o,r,s,h)>0)for(let w=r;w<s;w+=h)x=Mw(w/h|0,o[w],o[w+1],x);else for(let w=s-h;w>=r;w-=h)x=Mw(w/h|0,o[w],o[w+1],x);return x&&Jh(x,x.next)&&(Df(x),x=x.next),x}function Gu(o,r){if(!o)return o;r||(r=o);let s,h=o;do if(s=!1,h.steiner||!Jh(h,h.next)&&Ir(h.prev,h,h.next)!==0)h=h.next;else{if(Df(h),h=r=h.prev,h===h.next)break;s=!0}while(s||h!==r);return r}function Rf(o,r,s,h,p,x,w){if(!o)return;!w&&x&&function(E,M,R,j){let V=E;do V.z===0&&(V.z=Iy(V.x,V.y,M,R,j)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==E);V.prevZ.nextZ=null,V.prevZ=null,function(G){let H,ee=1;do{let le,me=G;G=null;let Re=null;for(H=0;me;){H++;let be=me,Pe=0;for(let Xe=0;Xe<ee&&(Pe++,be=be.nextZ,be);Xe++);let Ve=ee;for(;Pe>0||Ve>0&&be;)Pe!==0&&(Ve===0||!be||me.z<=be.z)?(le=me,me=me.nextZ,Pe--):(le=be,be=be.nextZ,Ve--),Re?Re.nextZ=le:G=le,le.prevZ=Re,Re=le;me=be}Re.nextZ=null,ee*=2}while(H>1)}(V)}(o,h,p,x);let S=o;for(;o.prev!==o.next;){const E=o.prev,M=o.next;if(x?mM(o,h,p,x):pM(o))r.push(E.i,o.i,M.i),Df(o),o=M.next,S=M.next;else if((o=M)===S){w?w===1?Rf(o=gM(Gu(o),r),r,s,h,p,x,2):w===2&&_M(o,r,s,h,p,x):Rf(Gu(o),r,s,h,p,x,1);break}}}function pM(o){const r=o.prev,s=o,h=o.next;if(Ir(r,s,h)>=0)return!1;const p=r.x,x=s.x,w=h.x,S=r.y,E=s.y,M=h.y,R=Math.min(p,x,w),j=Math.min(S,E,M),V=Math.max(p,x,w),G=Math.max(S,E,M);let H=h.next;for(;H!==r;){if(H.x>=R&&H.x<=V&&H.y>=j&&H.y<=G&&Lf(p,S,x,E,w,M,H.x,H.y)&&Ir(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function mM(o,r,s,h){const p=o.prev,x=o,w=o.next;if(Ir(p,x,w)>=0)return!1;const S=p.x,E=x.x,M=w.x,R=p.y,j=x.y,V=w.y,G=Math.min(S,E,M),H=Math.min(R,j,V),ee=Math.max(S,E,M),le=Math.max(R,j,V),me=Iy(G,H,r,s,h),Re=Iy(ee,le,r,s,h);let be=o.prevZ,Pe=o.nextZ;for(;be&&be.z>=me&&Pe&&Pe.z<=Re;){if(be.x>=G&&be.x<=ee&&be.y>=H&&be.y<=le&&be!==p&&be!==w&&Lf(S,R,E,j,M,V,be.x,be.y)&&Ir(be.prev,be,be.next)>=0||(be=be.prevZ,Pe.x>=G&&Pe.x<=ee&&Pe.y>=H&&Pe.y<=le&&Pe!==p&&Pe!==w&&Lf(S,R,E,j,M,V,Pe.x,Pe.y)&&Ir(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;be&&be.z>=me;){if(be.x>=G&&be.x<=ee&&be.y>=H&&be.y<=le&&be!==p&&be!==w&&Lf(S,R,E,j,M,V,be.x,be.y)&&Ir(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;Pe&&Pe.z<=Re;){if(Pe.x>=G&&Pe.x<=ee&&Pe.y>=H&&Pe.y<=le&&Pe!==p&&Pe!==w&&Lf(S,R,E,j,M,V,Pe.x,Pe.y)&&Ir(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function gM(o,r){let s=o;do{const h=s.prev,p=s.next.next;!Jh(h,p)&&Iw(h,s,s.next,p)&&zf(h,p)&&zf(p,h)&&(r.push(h.i,s.i,p.i),Df(s),Df(s.next),s=o=p),s=s.next}while(s!==o);return Gu(s)}function _M(o,r,s,h,p,x){let w=o;do{let S=w.next.next;for(;S!==w.prev;){if(w.i!==S.i&&wM(w,S)){let E=kw(w,S);return w=Gu(w,w.next),E=Gu(E,E.next),Rf(w,r,s,h,p,x,0),void Rf(E,r,s,h,p,x,0)}S=S.next}w=w.next}while(w!==o)}function yM(o,r){let s=o.x-r.x;return s===0&&(s=o.y-r.y,s===0)&&(s=(o.next.y-o.y)/(o.next.x-o.x)-(r.next.y-r.y)/(r.next.x-r.x)),s}function vM(o,r){const s=function(p,x){let w=x;const S=p.x,E=p.y;let M,R=-1/0;if(Jh(p,w))return w;do{if(Jh(p,w.next))return w.next;if(E<=w.y&&E>=w.next.y&&w.next.y!==w.y){const ee=w.x+(E-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(ee<=S&&ee>R&&(R=ee,M=w.x<w.next.x?w:w.next,ee===S))return M}w=w.next}while(w!==x);if(!M)return null;const j=M,V=M.x,G=M.y;let H=1/0;w=M;do{if(S>=w.x&&w.x>=V&&S!==w.x&&Cw(E<G?S:R,E,V,G,E<G?R:S,E,w.x,w.y)){const ee=Math.abs(E-w.y)/(S-w.x);zf(w,p)&&(ee<H||ee===H&&(w.x>M.x||w.x===M.x&&xM(M,w)))&&(M=w,H=ee)}w=w.next}while(w!==j);return M}(o,r);if(!s)return r;const h=kw(s,o);return Gu(h,h.next),Gu(s,s.next)}function xM(o,r){return Ir(o.prev,o,r.prev)<0&&Ir(r.next,o,o.next)<0}function Iy(o,r,s,h,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function bM(o){let r=o,s=o;do(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next;while(r!==o);return s}function Cw(o,r,s,h,p,x,w,S){return(p-w)*(r-S)>=(o-w)*(x-S)&&(o-w)*(h-S)>=(s-w)*(r-S)&&(s-w)*(x-S)>=(p-w)*(h-S)}function Lf(o,r,s,h,p,x,w,S){return!(o===w&&r===S)&&Cw(o,r,s,h,p,x,w,S)}function wM(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!function(s,h){let p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==h.i&&p.next.i!==h.i&&Iw(p,p.next,s,h))return!0;p=p.next}while(p!==s);return!1}(o,r)&&(zf(o,r)&&zf(r,o)&&function(s,h){let p=s,x=!1;const w=(s.x+h.x)/2,S=(s.y+h.y)/2;do p.y>S!=p.next.y>S&&p.next.y!==p.y&&w<(p.next.x-p.x)*(S-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==s);return x}(o,r)&&(Ir(o.prev,o,r.prev)||Ir(o,r.prev,r))||Jh(o,r)&&Ir(o.prev,o,o.next)>0&&Ir(r.prev,r,r.next)>0)}function Ir(o,r,s){return(r.y-o.y)*(s.x-r.x)-(r.x-o.x)*(s.y-r.y)}function Jh(o,r){return o.x===r.x&&o.y===r.y}function Iw(o,r,s,h){const p=Zm(Ir(o,r,s)),x=Zm(Ir(o,r,h)),w=Zm(Ir(s,h,o)),S=Zm(Ir(s,h,r));return p!==x&&w!==S||!(p!==0||!$m(o,s,r))||!(x!==0||!$m(o,h,r))||!(w!==0||!$m(s,o,h))||!(S!==0||!$m(s,r,h))}function $m(o,r,s){return r.x<=Math.max(o.x,s.x)&&r.x>=Math.min(o.x,s.x)&&r.y<=Math.max(o.y,s.y)&&r.y>=Math.min(o.y,s.y)}function Zm(o){return o>0?1:o<0?-1:0}function zf(o,r){return Ir(o.prev,o,o.next)<0?Ir(o,r,o.next)>=0&&Ir(o,o.prev,r)>=0:Ir(o,r,o.prev)<0||Ir(o,o.next,r)<0}function kw(o,r){const s=ky(o.i,o.x,o.y),h=ky(r.i,r.x,r.y),p=o.next,x=r.prev;return o.next=r,r.prev=o,s.next=p,p.prev=s,h.next=s,s.prev=h,x.next=h,h.prev=x,h}function Mw(o,r,s,h){const p=ky(o,r,s);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function Df(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function ky(o,r,s){return{i:o,x:r,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Qh{constructor(r,s){if(s>r)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=r,this._minGranularity=s}getGranularityForZoomLevel(r){return Math.max(Math.floor(this._baseZoomGranularity/(1<<r)),this._minGranularity,1)}}class Gm{constructor(r){this.fill=r.fill,this.line=r.line,this.tile=r.tile,this.stencil=r.stencil,this.circle=r.circle}}Gm.noSubdivision=new Gm({fill:new Qh(0,0),line:new Qh(0,0),tile:new Qh(0,0),stencil:new Qh(0,0),circle:1}),yt("SubdivisionGranularityExpression",Qh),yt("SubdivisionGranularitySetting",Gm);const ed=-32768,Nf=32767;class TM{constructor(r,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=r,this._granularityCellSize=Oe/r,this._canonical=s}_getKey(r,s){return(r+=32768)<<16|s+32768}_vertexToIndex(r,s){if(r<-32768||s<-32768||r>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const h=0|Math.round(r),p=0|Math.round(s),x=this._getKey(h,p);if(this._vertexDictionary.has(x))return this._vertexDictionary.get(x);const w=this._vertexBuffer.length/2;return this._vertexDictionary.set(x,w),this._vertexBuffer.push(h,p),w}_subdivideTrianglesScanline(r){if(this._granularity<2)return function(p,x){const w=[];for(let S=0;S<x.length;S+=3){const E=x[S],M=x[S+1],R=x[S+2],j=p[2*E],V=p[2*E+1];(p[2*M]-j)*(p[2*R+1]-V)-(p[2*M+1]-V)*(p[2*R]-j)>0?(w.push(E),w.push(R),w.push(M)):(w.push(E),w.push(M),w.push(R))}return w}(this._vertexBuffer,r);const s=[],h=r.length;for(let p=0;p<h;p+=3){const x=[r[p+0],r[p+1],r[p+2]],w=[this._vertexBuffer[2*r[p+0]+0],this._vertexBuffer[2*r[p+0]+1],this._vertexBuffer[2*r[p+1]+0],this._vertexBuffer[2*r[p+1]+1],this._vertexBuffer[2*r[p+2]+0],this._vertexBuffer[2*r[p+2]+1]];let S=1/0,E=1/0,M=-1/0,R=-1/0;for(let ee=0;ee<3;ee++){const le=w[2*ee],me=w[2*ee+1];S=Math.min(S,le),M=Math.max(M,le),E=Math.min(E,me),R=Math.max(R,me)}if(S===M||E===R)continue;const j=Math.floor(S/this._granularityCellSize),V=Math.ceil(M/this._granularityCellSize),G=Math.floor(E/this._granularityCellSize),H=Math.ceil(R/this._granularityCellSize);if(j!==V||G!==H)for(let ee=G;ee<H;ee++){const le=this._scanlineGenerateVertexRingForCellRow(ee,w,x);SM(this._vertexBuffer,le,s)}else s.push(...x)}return s}_scanlineGenerateVertexRingForCellRow(r,s,h){const p=r*this._granularityCellSize,x=p+this._granularityCellSize,w=[];for(let S=0;S<3;S++){const E=s[2*S],M=s[2*S+1],R=s[2*(S+1)%6],j=s[(2*(S+1)+1)%6],V=s[2*(S+2)%6],G=s[(2*(S+2)+1)%6],H=R-E,ee=j-M,le=H===0,me=ee===0,Re=(p-M)/ee,be=(x-M)/ee,Pe=Math.min(Re,be),Ve=Math.max(Re,be);if(!me&&(Pe>=1||Ve<=0)||me&&(M<p||M>x)){j>=p&&j<=x&&w.push(h[(S+1)%3]);continue}!me&&Pe>0&&w.push(this._vertexToIndex(E+H*Pe,M+ee*Pe));const Xe=E+H*Math.max(Pe,0),rt=E+H*Math.min(Ve,1);le||this._generateIntraEdgeVertices(w,E,M,R,j,Xe,rt),!me&&Ve<1&&w.push(this._vertexToIndex(E+H*Ve,M+ee*Ve)),(me||j>=p&&j<=x)&&w.push(h[(S+1)%3]),!me&&(j<=p||j>=x)&&this._generateInterEdgeVertices(w,E,M,R,j,V,G,rt,p,x)}return w}_generateIntraEdgeVertices(r,s,h,p,x,w,S){const E=p-s,M=x-h,R=M===0,j=R?Math.min(s,p):Math.min(w,S),V=R?Math.max(s,p):Math.max(w,S),G=Math.floor(j/this._granularityCellSize)+1,H=Math.ceil(V/this._granularityCellSize)-1;if(R?s<p:w<S)for(let ee=G;ee<=H;ee++){const le=ee*this._granularityCellSize;r.push(this._vertexToIndex(le,h+M*(le-s)/E))}else for(let ee=H;ee>=G;ee--){const le=ee*this._granularityCellSize;r.push(this._vertexToIndex(le,h+M*(le-s)/E))}}_generateInterEdgeVertices(r,s,h,p,x,w,S,E,M,R){const j=x-h,V=w-p,G=S-x,H=(M-x)/G,ee=(R-x)/G,le=Math.min(H,ee),me=Math.max(H,ee),Re=p+V*le;let be=Math.floor(Math.min(Re,E)/this._granularityCellSize)+1,Pe=Math.ceil(Math.max(Re,E)/this._granularityCellSize)-1,Ve=E<Re;const Xe=G===0;if(Xe&&(S===M||S===R))return;if(Xe||le>=1||me<=0){const gt=h-S,lt=w+(s-w)*Math.min((M-S)/gt,(R-S)/gt);be=Math.floor(Math.min(lt,E)/this._granularityCellSize)+1,Pe=Math.ceil(Math.max(lt,E)/this._granularityCellSize)-1,Ve=E<lt}const rt=j>0?R:M;if(Ve)for(let gt=be;gt<=Pe;gt++)r.push(this._vertexToIndex(gt*this._granularityCellSize,rt));else for(let gt=Pe;gt>=be;gt--)r.push(this._vertexToIndex(gt*this._granularityCellSize,rt))}_generateOutline(r){const s=[];for(const h of r){const p=qu(h,this._granularity,!0),x=this._pointArrayToIndices(p),w=[];for(let S=1;S<x.length;S++)w.push(x[S-1]),w.push(x[S]);s.push(w)}return s}_handlePoles(r){let s=!1,h=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(s||h)&&this._fillPoles(r,s,h)}_ensureNoPoleVertices(){const r=this._vertexBuffer;for(let s=0;s<r.length;s+=2){const h=r[s+1];h===ed&&(r[s+1]=-32767),h===Nf&&(r[s+1]=32766)}}_generatePoleQuad(r,s,h,p,x,w){p>x!=(w===ed)?(r.push(s),r.push(h),r.push(this._vertexToIndex(p,w)),r.push(h),r.push(this._vertexToIndex(x,w)),r.push(this._vertexToIndex(p,w))):(r.push(h),r.push(s),r.push(this._vertexToIndex(p,w)),r.push(this._vertexToIndex(x,w)),r.push(h),r.push(this._vertexToIndex(p,w)))}_fillPoles(r,s,h){const p=this._vertexBuffer,x=Oe,w=r.length;for(let S=2;S<w;S+=3){const E=r[S-2],M=r[S-1],R=r[S],j=p[2*E],V=p[2*E+1],G=p[2*M],H=p[2*M+1],ee=p[2*R],le=p[2*R+1];s&&(V===0&&H===0&&this._generatePoleQuad(r,E,M,j,G,ed),H===0&&le===0&&this._generatePoleQuad(r,M,R,G,ee,ed),le===0&&V===0&&this._generatePoleQuad(r,R,E,ee,j,ed)),h&&(V===x&&H===x&&this._generatePoleQuad(r,E,M,j,G,Nf),H===x&&le===x&&this._generatePoleQuad(r,M,R,G,ee,Nf),le===x&&V===x&&this._generatePoleQuad(r,R,E,ee,j,Nf))}}_initializeVertices(r){for(let s=0;s<r.length;s+=2)this._vertexToIndex(r[s],r[s+1])}subdividePolygonInternal(r,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:h,holeIndices:p}=function(S){const E=[],M=[];for(const R of S)if(R.length!==0){R!==S[0]&&E.push(M.length/2);for(let j=0;j<R.length;j++)M.push(R[j].x),M.push(R[j].y)}return{flattened:M,holeIndices:E}}(r);let x;this._initializeVertices(h);try{const S=function(M,R,j=2){const V=R&&R.length,G=V?R[0]*j:M.length;let H=Ew(M,0,G,j,!0);const ee=[];if(!H||H.next===H.prev)return ee;let le,me,Re;if(V&&(H=function(be,Pe,Ve,Xe){const rt=[];for(let gt=0,lt=Pe.length;gt<lt;gt++){const ft=Ew(be,Pe[gt]*Xe,gt<lt-1?Pe[gt+1]*Xe:be.length,Xe,!1);ft===ft.next&&(ft.steiner=!0),rt.push(bM(ft))}rt.sort(yM);for(let gt=0;gt<rt.length;gt++)Ve=vM(rt[gt],Ve);return Ve}(M,R,H,j)),M.length>80*j){le=M[0],me=M[1];let be=le,Pe=me;for(let Ve=j;Ve<G;Ve+=j){const Xe=M[Ve],rt=M[Ve+1];Xe<le&&(le=Xe),rt<me&&(me=rt),Xe>be&&(be=Xe),rt>Pe&&(Pe=rt)}Re=Math.max(be-le,Pe-me),Re=Re!==0?32767/Re:0}return Rf(H,ee,j,le,me,Re,0),ee}(h,p),E=this._convertIndices(h,S);x=this._subdivideTrianglesScanline(E)}catch(S){console.error(S)}let w=[];return s&&(w=this._generateOutline(r)),this._ensureNoPoleVertices(),this._handlePoles(x),{verticesFlattened:this._vertexBuffer,indicesTriangles:x,indicesLineList:w}}_convertIndices(r,s){const h=[];for(let p=0;p<s.length;p++)h.push(this._vertexToIndex(r[2*s[p]],r[2*s[p]+1]));return h}_pointArrayToIndices(r){const s=[];for(let h=0;h<r.length;h++){const p=r[h];s.push(this._vertexToIndex(p.x,p.y))}return s}}function Aw(o,r,s,h=!0){return new TM(s,r).subdividePolygonInternal(o,h)}function qu(o,r,s=!1){if(!o||o.length<1)return[];if(o.length<2)return[];const h=o[0],p=o[o.length-1],x=s&&(h.x!==p.x||h.y!==p.y);if(r<2)return x?[...o,o[0]]:[...o];const w=Math.floor(Oe/r),S=[];S.push(new A(o[0].x,o[0].y));const E=o.length,M=x?E:E-1;for(let R=0;R<M;R++){const j=o[R],V=R<E-1?o[R+1]:o[0],G=j.x,H=j.y,ee=V.x,le=V.y,me=G!==ee,Re=H!==le;if(!me&&!Re)continue;const be=ee-G,Pe=le-H,Ve=Math.abs(be),Xe=Math.abs(Pe);let rt=G,gt=H;for(;;){const ft=be>0?(Math.floor(rt/w)+1)*w:(Math.ceil(rt/w)-1)*w,At=Pe>0?(Math.floor(gt/w)+1)*w:(Math.ceil(gt/w)-1)*w,dt=Math.abs(rt-ft),pt=Math.abs(gt-At),Qe=Math.abs(rt-ee),Ot=Math.abs(gt-le),Gt=me?dt/Ve:Number.POSITIVE_INFINITY,zt=Re?pt/Xe:Number.POSITIVE_INFINITY;if((Qe<=dt||!me)&&(Ot<=pt||!Re))break;if(Gt<zt&&me||!Re){rt=ft,gt+=Pe*Gt;const kt=new A(rt,Math.round(gt));S[S.length-1].x===kt.x&&S[S.length-1].y===kt.y||S.push(kt)}else{rt+=be*zt,gt=At;const kt=new A(Math.round(rt),gt);S[S.length-1].x===kt.x&&S[S.length-1].y===kt.y||S.push(kt)}}const lt=new A(ee,le);S[S.length-1].x===lt.x&&S[S.length-1].y===lt.y||S.push(lt)}return S}function SM(o,r,s){if(r.length===0)throw new Error("Subdivision vertex ring is empty.");let h=0,p=o[2*r[0]];for(let E=1;E<r.length;E++){const M=o[2*r[E]];M<p&&(p=M,h=E)}const x=r.length;let w=h,S=(w+1)%x;for(;;){const E=w-1>=0?w-1:x-1,M=(S+1)%x,R=o[2*r[E]],j=o[2*r[M]],V=o[2*r[w]],G=o[2*r[w]+1],H=o[2*r[S]+1];let ee=!1;if(R<j)ee=!0;else if(R>j)ee=!1;else{const le=H-G,me=-(o[2*r[S]]-V),Re=G<H?1:-1;((R-V)*le+(o[2*r[E]+1]-G)*me)*Re>((j-V)*le+(o[2*r[M]+1]-G)*me)*Re&&(ee=!0)}if(ee){const le=r[E],me=r[w],Re=r[S];le!==me&&le!==Re&&me!==Re&&s.push(Re,me,le),w--,w<0&&(w=x-1)}else{const le=r[M],me=r[w],Re=r[S];le!==me&&le!==Re&&me!==Re&&s.push(Re,me,le),S++,S>=x&&(S=0)}if(E===M)break}}function Rw(o,r,s,h,p,x,w,S,E){const M=p.length/2,R=w&&S&&E;if(M<gn.MAX_VERTEX_ARRAY_LENGTH){const j=r.prepareSegment(M,s,h),V=j.vertexLength;for(let ee=0;ee<x.length;ee+=3)h.emplaceBack(V+x[ee],V+x[ee+1],V+x[ee+2]);let G,H;j.vertexLength+=M,j.primitiveLength+=x.length/3,R&&(H=w.prepareSegment(M,s,S),G=H.vertexLength,H.vertexLength+=M);for(let ee=0;ee<p.length;ee+=2)o(p[ee],p[ee+1]);if(R)for(let ee=0;ee<E.length;ee++){const le=E[ee];for(let me=1;me<le.length;me+=2)S.emplaceBack(G+le[me-1],G+le[me]);H.primitiveLength+=le.length/2}}else(function(j,V,G,H,ee,le){const me=[];for(let Xe=0;Xe<H.length/2;Xe++)me.push(-1);const Re={count:0};let be=0,Pe=j.getOrCreateLatestSegment(V,G),Ve=Pe.vertexLength;for(let Xe=2;Xe<ee.length;Xe+=3){const rt=ee[Xe-2],gt=ee[Xe-1],lt=ee[Xe];let ft=me[rt]<be,At=me[gt]<be,dt=me[lt]<be;Pe.vertexLength+((ft?1:0)+(At?1:0)+(dt?1:0))>gn.MAX_VERTEX_ARRAY_LENGTH&&(Pe=j.createNewSegment(V,G),be=Re.count,ft=!0,At=!0,dt=!0,Ve=0);const pt=Of(me,H,le,Re,rt,ft,Pe),Qe=Of(me,H,le,Re,gt,At,Pe),Ot=Of(me,H,le,Re,lt,dt,Pe);G.emplaceBack(Ve+pt-be,Ve+Qe-be,Ve+Ot-be),Pe.primitiveLength++}})(r,s,h,p,x,o),R&&function(j,V,G,H,ee,le){const me=[];for(let Xe=0;Xe<H.length/2;Xe++)me.push(-1);const Re={count:0};let be=0,Pe=j.getOrCreateLatestSegment(V,G),Ve=Pe.vertexLength;for(let Xe=0;Xe<ee.length;Xe++){const rt=ee[Xe];for(let gt=1;gt<ee[Xe].length;gt+=2){const lt=rt[gt-1],ft=rt[gt];let At=me[lt]<be,dt=me[ft]<be;Pe.vertexLength+((At?1:0)+(dt?1:0))>gn.MAX_VERTEX_ARRAY_LENGTH&&(Pe=j.createNewSegment(V,G),be=Re.count,At=!0,dt=!0,Ve=0);const pt=Of(me,H,le,Re,lt,At,Pe),Qe=Of(me,H,le,Re,ft,dt,Pe);G.emplaceBack(Ve+pt-be,Ve+Qe-be),Pe.primitiveLength++}}}(w,s,S,p,E,o),r.forceNewSegmentOnNextPrepare(),w==null||w.forceNewSegmentOnNextPrepare()}function Of(o,r,s,h,p,x,w){if(x){const S=h.count;return s(r[2*p],r[2*p+1]),o[p]=h.count,h.count++,w.vertexLength++,S}return o[p]}class My{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Ae,this.indexArray=new Sn,this.indexArray2=new An,this.programConfigurations=new il(r.layers,r.zoom),this.segments=new gn,this.segments2=new gn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,h){this.hasDependencies=Vm("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),x=!p.isConstant(),w=[];for(const{feature:S,id:E,index:M,sourceLayerIndex:R}of r){const j=this.layers[0]._featureFilter.needGeometry,V=Zu(S,j);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom),V,h))continue;const G=x?p.evaluate(V,{},h,s.availableImages):void 0,H={id:E,properties:S.properties,type:S.type,sourceLayerIndex:R,index:M,geometry:j?V.geometry:$u(S),patterns:{},sortKey:G};w.push(H)}x&&w.sort((S,E)=>S.sortKey-E.sortKey);for(const S of w){const{geometry:E,index:M,sourceLayerIndex:R}=S;if(this.hasDependencies){const j=Cy("fill",this.layers,S,{zoom:this.zoom},s);this.patternFeatures.push(j)}else this.addFeature(S,E,M,h,{},s.subdivisionGranularity);s.featureIndex.insert(r[M].feature,E,M,R,this.index)}}update(r,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,{imagePositions:h})}addFeatures(r,s,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,h,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,fM),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,s,h,p,x,w){for(const S of Da(s,500)){const E=Aw(S,p,w.fill.getGranularityForZoomLevel(p.z)),M=this.layoutVertexArray;Rw((R,j)=>{M.emplaceBack(R,j)},this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles,this.segments2,this.indexArray2,E.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{imagePositions:x,canonical:p})}}let Lw,zw;yt("FillBucket",My,{omit:["layers","patternFeatures"]});var PM={get paint(){return zw=zw||new Bi({"fill-antialias":new It(De.paint_fill["fill-antialias"]),"fill-opacity":new Nt(De.paint_fill["fill-opacity"]),"fill-color":new Nt(De.paint_fill["fill-color"]),"fill-outline-color":new Nt(De.paint_fill["fill-outline-color"]),"fill-translate":new It(De.paint_fill["fill-translate"]),"fill-translate-anchor":new It(De.paint_fill["fill-translate-anchor"]),"fill-pattern":new Cc(De.paint_fill["fill-pattern"])})},get layout(){return Lw=Lw||new Bi({"fill-sort-key":new Nt(De.layout_fill["fill-sort-key"])})}};class EM extends eo{constructor(r,s){super(r,PM,s)}recalculate(r,s){super.recalculate(r,s);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new My(r)}queryRadius(){return Fm(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:r,geometry:s,transform:h,pixelsToTileUnits:p}){return dw(Um(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,p),s)}isTileClipped(){return!0}}const CM=gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),IM=gr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:kM}=CM;class td{constructor(r,s,h,p,x){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=p,this._values=x,r.readFields(MM,this,s)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const s=r.readVarint()+r.pos,h=[];let p,x=1,w=0,S=0,E=0;for(;r.pos<s;){if(w<=0){const M=r.readVarint();x=7&M,w=M>>3}if(w--,x===1||x===2)S+=r.readSVarint(),E+=r.readSVarint(),x===1&&(p&&h.push(p),p=[]),p&&p.push(new A(S,E));else{if(x!==7)throw new Error(`unknown command ${x}`);p&&p.push(p[0].clone())}}return p&&h.push(p),h}bbox(){const r=this._pbf;r.pos=this._geometry;const s=r.readVarint()+r.pos;let h=1,p=0,x=0,w=0,S=1/0,E=-1/0,M=1/0,R=-1/0;for(;r.pos<s;){if(p<=0){const j=r.readVarint();h=7&j,p=j>>3}if(p--,h===1||h===2)x+=r.readSVarint(),w+=r.readSVarint(),x<S&&(S=x),x>E&&(E=x),w<M&&(M=w),w>R&&(R=w);else if(h!==7)throw new Error(`unknown command ${h}`)}return[S,M,E,R]}toGeoJSON(r,s,h){const p=this.extent*Math.pow(2,h),x=this.extent*r,w=this.extent*s,S=this.loadGeometry();function E(V){return[360*(V.x+x)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(V.y+w)/p)*Math.PI))-90]}function M(V){return V.map(E)}let R;if(this.type===1){const V=[];for(const H of S)V.push(H[0]);const G=M(V);R=V.length===1?{type:"Point",coordinates:G[0]}:{type:"MultiPoint",coordinates:G}}else if(this.type===2){const V=S.map(M);R=V.length===1?{type:"LineString",coordinates:V[0]}:{type:"MultiLineString",coordinates:V}}else{if(this.type!==3)throw new Error("unknown feature type");{const V=function(H){const ee=H.length;if(ee<=1)return[H];const le=[];let me,Re;for(let be=0;be<ee;be++){const Pe=AM(H[be]);Pe!==0&&(Re===void 0&&(Re=Pe<0),Re===Pe<0?(me&&le.push(me),me=[H[be]]):me&&me.push(H[be]))}return me&&le.push(me),le}(S),G=[];for(const H of V)G.push(H.map(M));R=G.length===1?{type:"Polygon",coordinates:G[0]}:{type:"MultiPolygon",coordinates:G}}}const j={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(j.id=this.id),j}}function MM(o,r,s){o===1?r.id=s.readVarint():o===2?function(h,p){const x=h.readVarint()+h.pos;for(;h.pos<x;){const w=p._keys[h.readVarint()],S=p._values[h.readVarint()];p.properties[w]=S}}(s,r):o===3?r.type=s.readVarint():o===4&&(r._geometry=s.pos)}function AM(o){let r=0;for(let s,h,p=0,x=o.length,w=x-1;p<x;w=p++)s=o[p],h=o[w],r+=(h.x-s.x)*(s.y+h.y);return r}td.types=["Unknown","Point","LineString","Polygon"];class Dw{constructor(r,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(RM,this,s),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const s=this._pbf.readVarint()+this._pbf.pos;return new td(this._pbf,s,this.extent,this._keys,this._values)}}function RM(o,r,s){o===15?r.version=s.readVarint():o===1?r.name=s.readString():o===5?r.extent=s.readVarint():o===2?r._features.push(s.pos):o===3?r._keys.push(s.readString()):o===4&&r._values.push(function(h){let p=null;const x=h.readVarint()+h.pos;for(;h.pos<x;){const w=h.readVarint()>>3;p=w===1?h.readString():w===2?h.readFloat():w===3?h.readDouble():w===4?h.readVarint64():w===5?h.readVarint():w===6?h.readSVarint():w===7?h.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(s))}class Nw{constructor(r,s){this.layers=r.readFields(LM,{},s)}}function LM(o,r,s){if(o===3){const h=new Dw(s,s.readVarint()+s.pos);h.length&&(r[h.name]=h)}}const Ay=Math.pow(2,13);function jf(o,r,s,h,p,x,w,S){o.emplaceBack(r,s,2*Math.floor(h*Ay)+w,p*Ay*2,x*Ay*2,Math.round(S))}class Ry{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasDependencies=!1,this.layoutVertexArray=new qe,this.centroidVertexArray=new Ee,this.indexArray=new Sn,this.programConfigurations=new il(r.layers,r.zoom),this.segments=new gn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,h){this.features=[],this.hasDependencies=Vm("fill-extrusion",this.layers,s);for(const{feature:p,id:x,index:w,sourceLayerIndex:S}of r){const E=this.layers[0]._featureFilter.needGeometry,M=Zu(p,E);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom),M,h))continue;const R={id:x,sourceLayerIndex:S,index:w,geometry:E?M.geometry:$u(p),properties:p.properties,type:p.type,patterns:{}};this.hasDependencies?this.features.push(Cy("fill-extrusion",this.layers,R,{zoom:this.zoom},s)):this.addFeature(R,R.geometry,w,h,{},s.subdivisionGranularity),s.featureIndex.insert(p,R.geometry,w,S,this.index,!0)}}addFeatures(r,s,h){for(const p of this.features){const{geometry:x}=p;this.addFeature(p,x,p.index,s,h,r.subdivisionGranularity)}}update(r,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,kM),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,IM.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,s,h,p,x,w){for(const S of Da(s,500)){const E={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(E,p,r,S,w);const R=this.layoutVertexArray.length-M,j=Math.floor(E.x/E.sampleCount),V=Math.floor(E.y/E.sampleCount);for(let G=0;G<R;G++)this.centroidVertexArray.emplaceBack(j,V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{imagePositions:x,canonical:p})}processPolygon(r,s,h,p,x){if(p.length<1||Ow(p[0]))return;for(const j of p)j.length!==0&&zM(r,j);const w={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},S=x.fill.getGranularityForZoomLevel(s.z),E=td.types[h.type]==="Polygon";for(const j of p){if(j.length===0||Ow(j))continue;const V=qu(j,S,E);this._generateSideFaces(V,w)}if(!E)return;const M=Aw(p,s,S,!1),R=this.layoutVertexArray;Rw((j,V)=>{jf(R,j,V,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(r,s){let h=0;for(let p=1;p<r.length;p++){const x=r[p],w=r[p-1];if(DM(x,w))continue;s.segment.vertexLength+4>gn.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const S=x.sub(w)._perp()._unit(),E=w.dist(x);h+E>32768&&(h=0),jf(this.layoutVertexArray,x.x,x.y,S.x,S.y,0,0,h),jf(this.layoutVertexArray,x.x,x.y,S.x,S.y,0,1,h),h+=E,jf(this.layoutVertexArray,w.x,w.y,S.x,S.y,0,0,h),jf(this.layoutVertexArray,w.x,w.y,S.x,S.y,0,1,h);const M=s.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function zM(o,r){for(let s=0;s<r.length;s++){const h=r[s];s===r.length-1&&r[0].x===h.x&&r[0].y===h.y||(o.x+=h.x,o.y+=h.y,o.sampleCount++)}}function DM(o,r){return o.x===r.x&&(o.x<0||o.x>Oe)||o.y===r.y&&(o.y<0||o.y>Oe)}function Ow(o){return o.every(r=>r.x<0)||o.every(r=>r.x>Oe)||o.every(r=>r.y<0)||o.every(r=>r.y>Oe)}let jw;yt("FillExtrusionBucket",Ry,{omit:["layers","features"]});var NM={get paint(){return jw=jw||new Bi({"fill-extrusion-opacity":new It(De["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nt(De["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(De["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(De["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Cc(De["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Nt(De["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nt(De["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new It(De["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class OM extends eo{constructor(r,s){super(r,NM,s)}createBucket(r){return new Ry(r)}queryRadius(){return Fm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:r,feature:s,featureState:h,geometry:p,transform:x,pixelsToTileUnits:w,pixelPosMatrix:S}){const E=Um(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-x.bearingInRadians,w),M=this.paint.get("fill-extrusion-height").evaluate(s,h),R=this.paint.get("fill-extrusion-base").evaluate(s,h),j=function(G,H){const ee=[];for(const le of G){const me=[le.x,le.y,0,1];at(me,me,H),ee.push(new A(me[0]/me[3],me[1]/me[3]))}return ee}(E,S),V=function(G,H,ee,le){const me=[],Re=[],be=le[8]*H,Pe=le[9]*H,Ve=le[10]*H,Xe=le[11]*H,rt=le[8]*ee,gt=le[9]*ee,lt=le[10]*ee,ft=le[11]*ee;for(const At of G){const dt=[],pt=[];for(const Qe of At){const Ot=Qe.x,Gt=Qe.y,zt=le[0]*Ot+le[4]*Gt+le[12],kt=le[1]*Ot+le[5]*Gt+le[13],fn=le[2]*Ot+le[6]*Gt+le[14],lr=le[3]*Ot+le[7]*Gt+le[15],qr=fn+Ve,Ci=lr+Xe,io=zt+rt,ps=kt+gt,fi=fn+lt,tr=lr+ft,ei=new A((zt+be)/Ci,(kt+Pe)/Ci);ei.z=qr/Ci,dt.push(ei);const pi=new A(io/tr,ps/tr);pi.z=fi/tr,pt.push(pi)}me.push(dt),Re.push(pt)}return[me,Re]}(p,R,M,S);return function(G,H,ee){let le=1/0;dw(ee,H)&&(le=Bw(ee,H[0]));for(let me=0;me<H.length;me++){const Re=H[me],be=G[me];for(let Pe=0;Pe<Re.length-1;Pe++){const Ve=Re[Pe],Xe=[Ve,Re[Pe+1],be[Pe+1],be[Pe],Ve];hw(ee,Xe)&&(le=Math.min(le,Bw(ee,Xe)))}}return le!==1/0&&le}(V[0],V[1],j)}}function Bf(o,r){return o.x*r.x+o.y*r.y}function Bw(o,r){if(o.length===1){let s=0;const h=r[s++];let p;for(;!p||h.equals(p);)if(p=r[s++],!p)return 1/0;for(;s<r.length;s++){const x=r[s],w=o[0],S=p.sub(h),E=x.sub(h),M=w.sub(h),R=Bf(S,S),j=Bf(S,E),V=Bf(E,E),G=Bf(M,S),H=Bf(M,E),ee=R*V-j*j,le=(V*G-j*H)/ee,me=(R*H-j*G)/ee,Re=h.z*(1-le-me)+p.z*le+x.z*me;if(isFinite(Re))return Re}return 1/0}{let s=1/0;for(const h of r)s=Math.min(s,h.z);return s}}const jM=gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:BM}=jM,FM=gr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:UM}=FM,VM=Math.cos(Math.PI/180*37.5),Fw=Math.pow(2,14)/.5;class Ly{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Ue,this.layoutVertexArray2=new $e,this.indexArray=new Sn,this.programConfigurations=new il(r.layers,r.zoom),this.segments=new gn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,h){this.hasDependencies=Vm("line",this.layers,s)||this.hasLineDasharray(this.layers);const p=this.layers[0].layout.get("line-sort-key"),x=!p.isConstant(),w=[];for(const{feature:S,id:E,index:M,sourceLayerIndex:R}of r){const j=this.layers[0]._featureFilter.needGeometry,V=Zu(S,j);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom),V,h))continue;const G=x?p.evaluate(V,{},h):void 0,H={id:E,properties:S.properties,type:S.type,sourceLayerIndex:R,index:M,geometry:j?V.geometry:$u(S),patterns:{},dashes:{},sortKey:G};w.push(H)}x&&w.sort((S,E)=>S.sortKey-E.sortKey);for(const S of w){const{geometry:E,index:M,sourceLayerIndex:R}=S;this.hasDependencies?(Vm("line",this.layers,s)?Cy("line",this.layers,S,{zoom:this.zoom},s):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,S,this.zoom,s),this.patternFeatures.push(S)):this.addFeature(S,E,M,h,{},{},s.subdivisionGranularity),s.featureIndex.insert(r[M].feature,E,M,R,this.index)}}update(r,s,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,{imagePositions:h,dashPositions:p})}addFeatures(r,s,h,p){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,h,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,UM)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,BM),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,s,h,p,x,w,S){const E=this.layers[0].layout,M=E.get("line-join").evaluate(r,{}),R=E.get("line-cap"),j=E.get("line-miter-limit"),V=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const G of s)this.addLine(G,r,M,R,j,V,p,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{imagePositions:x,dashPositions:w,canonical:p})}addLine(r,s,h,p,x,w,S,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,r=qu(r,S?E.line.getGranularityForZoomLevel(S.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<r.length-1;be++)this.totalDistance+=r[be].dist(r[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=td.types[s.type]==="Polygon";let R=r.length;for(;R>=2&&r[R-1].equals(r[R-2]);)R--;let j=0;for(;j<R-1&&r[j].equals(r[j+1]);)j++;if(R<(M?3:2))return;h==="bevel"&&(x=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,G=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let H,ee,le,me,Re;this.e1=this.e2=-1,M&&(H=r[R-2],Re=r[j].sub(H)._unit()._perp());for(let be=j;be<R;be++){if(le=be===R-1?M?r[j+1]:void 0:r[be+1],le&&r[be].equals(le))continue;Re&&(me=Re),H&&(ee=H),H=r[be],Re=le?le.sub(H)._unit()._perp():me,me=me||Re;let Pe=me.add(Re);Pe.x===0&&Pe.y===0||Pe._unit();const Ve=me.x*Re.x+me.y*Re.y,Xe=Pe.x*Re.x+Pe.y*Re.y,rt=Xe!==0?1/Xe:1/0,gt=2*Math.sqrt(2-2*Xe),lt=Xe<VM&&ee&&le,ft=me.x*Re.y-me.y*Re.x>0;if(lt&&be>j){const pt=H.dist(ee);if(pt>2*V){const Qe=H.sub(H.sub(ee)._mult(V/pt)._round());this.updateDistance(ee,Qe),this.addCurrentVertex(Qe,me,0,0,G),ee=Qe}}const At=ee&&le;let dt=At?h:M?"butt":p;if(At&&dt==="round"&&(rt<w?dt="miter":rt<=2&&(dt="fakeround")),dt==="miter"&&rt>x&&(dt="bevel"),dt==="bevel"&&(rt>2&&(dt="flipbevel"),rt<x&&(dt="miter")),ee&&this.updateDistance(ee,H),dt==="miter")Pe._mult(rt),this.addCurrentVertex(H,Pe,0,0,G);else if(dt==="flipbevel"){if(rt>100)Pe=Re.mult(-1);else{const pt=rt*me.add(Re).mag()/me.sub(Re).mag();Pe._perp()._mult(pt*(ft?-1:1))}this.addCurrentVertex(H,Pe,0,0,G),this.addCurrentVertex(H,Pe.mult(-1),0,0,G)}else if(dt==="bevel"||dt==="fakeround"){const pt=-Math.sqrt(rt*rt-1),Qe=ft?pt:0,Ot=ft?0:pt;if(ee&&this.addCurrentVertex(H,me,Qe,Ot,G),dt==="fakeround"){const Gt=Math.round(180*gt/Math.PI/20);for(let zt=1;zt<Gt;zt++){let kt=zt/Gt;if(kt!==.5){const lr=kt-.5;kt+=kt*lr*(kt-1)*((1.0904+Ve*(Ve*(3.55645-1.43519*Ve)-3.2452))*lr*lr+(.848013+Ve*(.215638*Ve-1.06021)))}const fn=Re.sub(me)._mult(kt)._add(me)._unit()._mult(ft?-1:1);this.addHalfVertex(H,fn.x,fn.y,!1,ft,0,G)}}le&&this.addCurrentVertex(H,Re,-Qe,-Ot,G)}else if(dt==="butt")this.addCurrentVertex(H,Pe,0,0,G);else if(dt==="square"){const pt=ee?1:-1;this.addCurrentVertex(H,Pe,pt,pt,G)}else dt==="round"&&(ee&&(this.addCurrentVertex(H,me,0,0,G),this.addCurrentVertex(H,me,1,1,G,!0)),le&&(this.addCurrentVertex(H,Re,-1,-1,G,!0),this.addCurrentVertex(H,Re,0,0,G)));if(lt&&be<R-1){const pt=H.dist(le);if(pt>2*V){const Qe=H.add(le.sub(H)._mult(V/pt)._round());this.updateDistance(H,Qe),this.addCurrentVertex(Qe,Re,0,0,G),H=Qe}}}}addCurrentVertex(r,s,h,p,x,w=!1){const S=s.y*p-s.x,E=-s.y-s.x*p;this.addHalfVertex(r,s.x+s.y*h,s.y-s.x*h,w,!1,h,x),this.addHalfVertex(r,S,E,w,!0,-p,x),this.distance>Fw/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,s,h,p,x,w))}addHalfVertex({x:r,y:s},h,p,x,w,S,E){const M=.5*(this.lineClips?this.scaledDistance*(Fw-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(x?1:0),(s<<1)+(w?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(S===0?0:S<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,R,this.e2),E.primitiveLength++),w?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,s){this.distance+=r.dist(s),this.updateScaledDistance()}hasLineDasharray(r){for(const s of r){const h=s.paint.get("line-dasharray");if(h&&!h.isConstant())return!0}return!1}addLineDashDependencies(r,s,h,p){for(const x of r){const w=x.paint.get("line-dasharray");if(!w||w.value.kind==="constant")continue;const S=x.layout.get("line-cap")==="round",E={dasharray:w.value.evaluate({zoom:h-1},s,{}),round:S},M={dasharray:w.value.evaluate({zoom:h},s,{}),round:S},R={dasharray:w.value.evaluate({zoom:h+1},s,{}),round:S},j=`${E.dasharray.join(",")},${E.round}`,V=`${M.dasharray.join(",")},${M.round}`,G=`${R.dasharray.join(",")},${R.round}`;p.dashDependencies[j]=E,p.dashDependencies[V]=M,p.dashDependencies[G]=R,s.dashes[x.id]={min:j,mid:V,max:G}}}}let Uw,Vw;yt("LineBucket",Ly,{omit:["layers","patternFeatures"]});var $w={get paint(){return Vw=Vw||new Bi({"line-opacity":new Nt(De.paint_line["line-opacity"]),"line-color":new Nt(De.paint_line["line-color"]),"line-translate":new It(De.paint_line["line-translate"]),"line-translate-anchor":new It(De.paint_line["line-translate-anchor"]),"line-width":new Nt(De.paint_line["line-width"]),"line-gap-width":new Nt(De.paint_line["line-gap-width"]),"line-offset":new Nt(De.paint_line["line-offset"]),"line-blur":new Nt(De.paint_line["line-blur"]),"line-dasharray":new Cc(De.paint_line["line-dasharray"]),"line-pattern":new Cc(De.paint_line["line-pattern"]),"line-gradient":new Gh(De.paint_line["line-gradient"])})},get layout(){return Uw=Uw||new Bi({"line-cap":new It(De.layout_line["line-cap"]),"line-join":new Nt(De.layout_line["line-join"]),"line-miter-limit":new It(De.layout_line["line-miter-limit"]),"line-round-limit":new It(De.layout_line["line-round-limit"]),"line-sort-key":new Nt(De.layout_line["line-sort-key"])})}};class $M extends Nt{possiblyEvaluate(r,s){return s=new Dn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(r,s)}evaluate(r,s,h,p){return s=Vn({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(r,s,h,p)}}let qm;class ZM extends eo{constructor(r,s){super(r,$w,s),this.gradientVersion=0,qm||(qm=new $M($w.paint.properties["line-width"].specification),qm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof wo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,s){super.recalculate(r,s),this.paint._values["line-floorwidth"]=qm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Ly(r)}queryRadius(r){const s=r,h=Zw(Yh("line-width",this,s),Yh("line-gap-width",this,s)),p=Yh("line-offset",this,s);return h/2+Math.abs(p)+Fm(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:r,feature:s,featureState:h,geometry:p,transform:x,pixelsToTileUnits:w}){const S=Um(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-x.bearingInRadians,w),E=w/2*Zw(this.paint.get("line-width").evaluate(s,h),this.paint.get("line-gap-width").evaluate(s,h)),M=this.paint.get("line-offset").evaluate(s,h);return M&&(p=function(R,j){const V=[];for(let G=0;G<R.length;G++){const H=R[G],ee=[];for(let le=0;le<H.length;le++){const me=H[le-1],Re=H[le],be=H[le+1],Pe=le===0?new A(0,0):Re.sub(me)._unit()._perp(),Ve=le===H.length-1?new A(0,0):be.sub(Re)._unit()._perp(),Xe=Pe._add(Ve)._unit(),rt=Xe.x*Ve.x+Xe.y*Ve.y;rt!==0&&Xe._mult(1/rt),ee.push(Xe._mult(j)._add(Re))}V.push(ee)}return V}(p,M*w)),function(R,j,V){for(let G=0;G<j.length;G++){const H=j[G];if(R.length>=3){for(let ee=0;ee<H.length;ee++)if(Xh(R,H[ee]))return!0}if(Yk(R,H,V))return!0}return!1}(S,p,E)}isTileClipped(){return!0}}function Zw(o,r){return r>0?r+2*o:o}const GM=gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qM=gr([{name:"a_projected_pos",components:3,type:"Float32"}],4);gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const WM=gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);gr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gw=gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),HM=gr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function KM(o,r,s){return o.sections.forEach(h=>{h.text=function(p,x,w){const S=x.layout.get("text-transform").evaluate(w,{});return S==="uppercase"?p=p.toLocaleUpperCase():S==="lowercase"&&(p=p.toLocaleLowerCase()),Ya.applyArabicShaping&&(p=Ya.applyArabicShaping(p)),p}(h.text,r,s)}),o}gr([{name:"triangle",components:3,type:"Uint16"}]),gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),gr([{type:"Float32",name:"offsetX"}]),gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),gr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ff={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Qr=24;const zy=4294967296,qw=1/zy,Ww=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Dy{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,s,h=this.length){for(;this.pos<h;){const p=this.readVarint(),x=p>>3,w=this.pos;this.type=7&p,r(x,s,this),this.pos===w&&this.skip(p)}return s}readMessage(r,s){return this.readFields(r,s,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*zy;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*zy;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const s=this.buf;let h,p;return p=s[this.pos++],h=127&p,p<128?h:(p=s[this.pos++],h|=(127&p)<<7,p<128?h:(p=s[this.pos++],h|=(127&p)<<14,p<128?h:(p=s[this.pos++],h|=(127&p)<<21,p<128?h:(p=s[this.pos],h|=(15&p)<<28,function(x,w,S){const E=S.buf;let M,R;if(R=E[S.pos++],M=(112&R)>>4,R<128||(R=E[S.pos++],M|=(127&R)<<3,R<128)||(R=E[S.pos++],M|=(127&R)<<10,R<128)||(R=E[S.pos++],M|=(127&R)<<17,R<128)||(R=E[S.pos++],M|=(127&R)<<24,R<128)||(R=E[S.pos++],M|=(1&R)<<31,R<128))return nd(x,M,w);throw new Error("Expected varint not more than 10 bytes")}(h,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,s=this.pos;return this.pos=r,r-s>=12&&Ww?Ww.decode(this.buf.subarray(s,r)):function(h,p,x){let w="",S=p;for(;S<x;){const E=h[S];let M,R,j,V=null,G=E>239?4:E>223?3:E>191?2:1;if(S+G>x)break;G===1?E<128&&(V=E):G===2?(M=h[S+1],(192&M)==128&&(V=(31&E)<<6|63&M,V<=127&&(V=null))):G===3?(M=h[S+1],R=h[S+2],(192&M)==128&&(192&R)==128&&(V=(15&E)<<12|(63&M)<<6|63&R,(V<=2047||V>=55296&&V<=57343)&&(V=null))):G===4&&(M=h[S+1],R=h[S+2],j=h[S+3],(192&M)==128&&(192&R)==128&&(192&j)==128&&(V=(15&E)<<18|(63&M)<<12|(63&R)<<6|63&j,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,G=1):V>65535&&(V-=65536,w+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),w+=String.fromCharCode(V),S+=G}return w}(this.buf,s,r)}readBytes(){const r=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,r);return this.pos=r,s}readPackedVarint(r=[],s){const h=this.readPackedEnd();for(;this.pos<h;)r.push(this.readVarint(s));return r}readPackedSVarint(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const s=7&r;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(r,s){this.writeVarint(r<<3|s)}realloc(r){let s=this.length||16;for(;s<this.pos+r;)s*=2;if(s!==this.length){const h=new Uint8Array(s);h.set(this.buf),this.buf=h,this.dataView=new DataView(h.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*qw),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*qw),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?function(s,h){let p,x;if(s>=0?(p=s%4294967296|0,x=s/4294967296|0):(p=~(-s%4294967296),x=~(-s/4294967296),4294967295^p?p=p+1|0:(p=0,x=x+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(w,S,E){E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,E.buf[E.pos]=127&(w>>>=7)}(p,0,h),function(w,S){const E=(7&w)<<4;S.buf[S.pos++]|=E|((w>>>=3)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w)))))}(x,h)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const s=this.pos;this.pos=function(p,x,w){for(let S,E,M=0;M<x.length;M++){if(S=x.charCodeAt(M),S>55295&&S<57344){if(!E){S>56319||M+1===x.length?(p[w++]=239,p[w++]=191,p[w++]=189):E=S;continue}if(S<56320){p[w++]=239,p[w++]=191,p[w++]=189,E=S;continue}S=E-55296<<10|S-56320|65536,E=null}else E&&(p[w++]=239,p[w++]=191,p[w++]=189,E=null);S<128?p[w++]=S:(S<2048?p[w++]=S>>6|192:(S<65536?p[w++]=S>>12|224:(p[w++]=S>>18|240,p[w++]=S>>12&63|128),p[w++]=S>>6&63|128),p[w++]=63&S|128)}return w}(this.buf,r,this.pos);const h=this.pos-s;h>=128&&Hw(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const s=r.length;this.writeVarint(s),this.realloc(s);for(let h=0;h<s;h++)this.buf[this.pos++]=r[h]}writeRawMessage(r,s){this.pos++;const h=this.pos;r(s,this);const p=this.pos-h;p>=128&&Hw(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p}writeMessage(r,s,h){this.writeTag(r,2),this.writeRawMessage(s,h)}writePackedVarint(r,s){s.length&&this.writeMessage(r,XM,s)}writePackedSVarint(r,s){s.length&&this.writeMessage(r,YM,s)}writePackedBoolean(r,s){s.length&&this.writeMessage(r,eA,s)}writePackedFloat(r,s){s.length&&this.writeMessage(r,JM,s)}writePackedDouble(r,s){s.length&&this.writeMessage(r,QM,s)}writePackedFixed32(r,s){s.length&&this.writeMessage(r,tA,s)}writePackedSFixed32(r,s){s.length&&this.writeMessage(r,nA,s)}writePackedFixed64(r,s){s.length&&this.writeMessage(r,rA,s)}writePackedSFixed64(r,s){s.length&&this.writeMessage(r,iA,s)}writeBytesField(r,s){this.writeTag(r,2),this.writeBytes(s)}writeFixed32Field(r,s){this.writeTag(r,5),this.writeFixed32(s)}writeSFixed32Field(r,s){this.writeTag(r,5),this.writeSFixed32(s)}writeFixed64Field(r,s){this.writeTag(r,1),this.writeFixed64(s)}writeSFixed64Field(r,s){this.writeTag(r,1),this.writeSFixed64(s)}writeVarintField(r,s){this.writeTag(r,0),this.writeVarint(s)}writeSVarintField(r,s){this.writeTag(r,0),this.writeSVarint(s)}writeStringField(r,s){this.writeTag(r,2),this.writeString(s)}writeFloatField(r,s){this.writeTag(r,5),this.writeFloat(s)}writeDoubleField(r,s){this.writeTag(r,1),this.writeDouble(s)}writeBooleanField(r,s){this.writeVarintField(r,+s)}}function nd(o,r,s){return s?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}function Hw(o,r,s){const h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));s.realloc(h);for(let p=s.pos-1;p>=o;p--)s.buf[p+h]=s.buf[p]}function XM(o,r){for(let s=0;s<o.length;s++)r.writeVarint(o[s])}function YM(o,r){for(let s=0;s<o.length;s++)r.writeSVarint(o[s])}function JM(o,r){for(let s=0;s<o.length;s++)r.writeFloat(o[s])}function QM(o,r){for(let s=0;s<o.length;s++)r.writeDouble(o[s])}function eA(o,r){for(let s=0;s<o.length;s++)r.writeBoolean(o[s])}function tA(o,r){for(let s=0;s<o.length;s++)r.writeFixed32(o[s])}function nA(o,r){for(let s=0;s<o.length;s++)r.writeSFixed32(o[s])}function rA(o,r){for(let s=0;s<o.length;s++)r.writeFixed64(o[s])}function iA(o,r){for(let s=0;s<o.length;s++)r.writeSFixed64(o[s])}function sA(o,r,s){o===1&&s.readMessage(oA,r)}function oA(o,r,s){if(o===3){const{id:h,bitmap:p,width:x,height:w,left:S,top:E,advance:M}=s.readMessage(aA,{});r.push({id:h,bitmap:new Af({width:x+6,height:w+6},p),metrics:{width:x,height:w,left:S,top:E,advance:M}})}}function aA(o,r,s){o===1?r.id=s.readVarint():o===2?r.bitmap=s.readBytes():o===3?r.width=s.readVarint():o===4?r.height=s.readVarint():o===5?r.left=s.readSVarint():o===6?r.top=s.readSVarint():o===7&&(r.advance=s.readVarint())}function Kw(o){let r=0,s=0;for(const w of o)r+=w.w*w.h,s=Math.max(s,w.w);o.sort((w,S)=>S.h-w.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let p=0,x=0;for(const w of o)for(let S=h.length-1;S>=0;S--){const E=h[S];if(!(w.w>E.w||w.h>E.h)){if(w.x=E.x,w.y=E.y,x=Math.max(x,w.y+w.h),p=Math.max(p,w.x+w.w),w.w===E.w&&w.h===E.h){const M=h.pop();M&&S<h.length&&(h[S]=M)}else w.h===E.h?(E.x+=w.w,E.w-=w.w):w.w===E.w?(E.y+=w.h,E.h-=w.h):(h.push({x:E.x+w.w,y:E.y,w:E.w-w.w,h:w.h}),E.y+=w.h,E.h-=w.h);break}}return{w:p,h:x,fill:r/(p*x)||0}}class Ny{constructor(r,{pixelRatio:s,version:h,stretchX:p,stretchY:x,content:w,textFitWidth:S,textFitHeight:E}){this.paddedRect=r,this.pixelRatio=s,this.stretchX=p,this.stretchY=x,this.content=w,this.version=h,this.textFitWidth=S,this.textFitHeight=E}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Xw{constructor(r,s){const h={},p={};this.haveRenderCallbacks=[];const x=[];this.addImages(r,h,x),this.addImages(s,p,x);const{w,h:S}=Kw(x),E=new fs({width:w||1,height:S||1});for(const M in r){const R=r[M],j=h[M].paddedRect;fs.copy(R.data,E,{x:0,y:0},{x:j.x+1,y:j.y+1},R.data)}for(const M in s){const R=s[M],j=p[M].paddedRect,V=j.x+1,G=j.y+1,H=R.data.width,ee=R.data.height;fs.copy(R.data,E,{x:0,y:0},{x:V,y:G},R.data),fs.copy(R.data,E,{x:0,y:ee-1},{x:V,y:G-1},{width:H,height:1}),fs.copy(R.data,E,{x:0,y:0},{x:V,y:G+ee},{width:H,height:1}),fs.copy(R.data,E,{x:H-1,y:0},{x:V-1,y:G},{width:1,height:ee}),fs.copy(R.data,E,{x:0,y:0},{x:V+H,y:G},{width:1,height:ee})}this.image=E,this.iconPositions=h,this.patternPositions=p}addImages(r,s,h){for(const p in r){const x=r[p],w={x:0,y:0,w:x.data.width+2,h:x.data.height+2};h.push(w),s[p]=new Ny(w,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,s){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),s),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),s)}patchUpdatedImage(r,s,h){if(!r||!s||r.version===s.version)return;r.version=s.version;const[p,x]=r.tl;h.update(s.data,void 0,{x:p,y:x})}}var Rc;yt("ImagePosition",Ny),yt("ImageAtlas",Xw),g.ao=void 0,(Rc=g.ao||(g.ao={}))[Rc.none=0]="none",Rc[Rc.horizontal=1]="horizontal",Rc[Rc.vertical=2]="vertical",Rc[Rc.horizontalOnly=3]="horizontalOnly";class Uf{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(r,s,h){const p=new Uf;return p.scale=r||1,p.fontStack=s,p.verticalAlign=h||"bottom",p}static forImage(r,s){const h=new Uf;return h.imageName=r,h.verticalAlign=s||"bottom",h}}class rd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s){const h=new rd;for(let p=0;p<r.sections.length;p++){const x=r.sections[p];x.image?h.addImageSection(x):h.addTextSection(x,s)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let s="";for(let h=0;h<r.length;h++){const p=r.charCodeAt(h+1)||null,x=r.charCodeAt(h-1)||null;s+=p&&Mm(p)&&!Ff[r[h+1]]||x&&Mm(x)&&!Ff[r[h-1]]||!Ff[r[h]]?r[h]:Ff[r[h]]}return s}(this.text)}trim(){let r=0;for(let h=0;h<this.text.length&&Hm[this.text.charCodeAt(h)];h++)r++;let s=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&Hm[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const h=new rd;return h.text=this.text.substring(r,s),h.sectionIndex=this.sectionIndex.slice(r,s),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}getMaxImageSize(r){let s=0,h=0;for(let p=0;p<this.length();p++){const x=this.getSection(p);if(x.imageName){const w=r[x.imageName];if(!w)continue;const S=w.displaySize;s=Math.max(s,S[0]),h=Math.max(h,S[1])}}return{maxImageWidth:s,maxImageHeight:h}}addTextSection(r,s){this.text+=r.text,this.sections.push(Uf.forText(r.scale,r.fontStack||s,r.verticalAlign));const h=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(h)}addImageSection(r){const s=r.image?r.image.name:"";if(s.length===0)return void $n("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Uf.forImage(s,r.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):$n("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wm(o,r,s,h,p,x,w,S,E,M,R,j,V,G,H){const ee=rd.fromFeature(o,p);let le;j===g.ao.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:me,processStyledBidirectionalText:Re}=Ya;if(me&&ee.sections.length===1){le=[];const Ve=me(ee.toString(),Oy(ee,M,x,r,h,G));for(const Xe of Ve){const rt=new rd;rt.text=Xe,rt.sections=ee.sections;for(let gt=0;gt<Xe.length;gt++)rt.sectionIndex.push(0);le.push(rt)}}else if(Re){le=[];const Ve=Re(ee.text,ee.sectionIndex,Oy(ee,M,x,r,h,G));for(const Xe of Ve){const rt=new rd;rt.text=Xe[0],rt.sectionIndex=Xe[1],rt.sections=ee.sections,le.push(rt)}}else le=function(Ve,Xe){const rt=[],gt=Ve.text;let lt=0;for(const ft of Xe)rt.push(Ve.substring(lt,ft)),lt=ft;return lt<gt.length&&rt.push(Ve.substring(lt,gt.length)),rt}(ee,Oy(ee,M,x,r,h,G));const be=[],Pe={positionedLines:be,text:ee.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(Ve,Xe,rt,gt,lt,ft,At,dt,pt,Qe,Ot,Gt){let zt=0,kt=0,fn=0,lr=0;const qr=dt==="right"?1:dt==="left"?0:.5,Ci=Qr/Gt;let io=0;for(const tr of lt){tr.trim();const ei=tr.getMaxScale(),pi={positionedGlyphs:[],lineOffset:0};Ve.positionedLines[io]=pi;const mi=pi.positionedGlyphs;let Yi=0;if(!tr.length()){kt+=ft,++io;continue}const so=hA(gt,tr,Ci);for(let ms=0;ms<tr.length();ms++){const Wr=tr.getSection(ms),ni=tr.getSectionIndex(ms),ri=tr.getCharCode(ms),Fr=dA(pt,Ot,ri);let Fn;if(Wr.imageName){if(Ve.iconsInText=!0,Wr.scale=Wr.scale*Ci,Fn=pA(Wr,Fr,ei,so,gt),!Fn)continue;Yi=Math.max(Yi,Fn.imageOffset)}else if(Fn=fA(Wr,ri,Fr,so,Xe,rt),!Fn)continue;const{rect:la,metrics:ad,baselineOffset:ca}=Fn;mi.push({glyph:ri,imageName:Wr.imageName,x:zt,y:kt+ca+-17,vertical:Fr,scale:Wr.scale,fontStack:Wr.fontStack,sectionIndex:ni,metrics:ad,rect:la}),Fr?(Ve.verticalizable=!0,zt+=(Wr.imageName?ad.advance:Qr)*Wr.scale+Qe):zt+=ad.advance*Wr.scale+Qe}mi.length!==0&&(fn=Math.max(zt-Qe,fn),mA(mi,0,mi.length-1,qr)),zt=0,pi.lineOffset=Math.max(Yi,(ei-1)*Qr);const ti=ft*ei+Yi;kt+=ti,lr=Math.max(ti,lr),++io}const{horizontalAlign:ps,verticalAlign:fi}=jy(At);(function(tr,ei,pi,mi,Yi,so,ti,ms,Wr){const ni=(ei-pi)*Yi;let ri=0;ri=so!==ti?-ms*mi- -17:-mi*Wr*ti+.5*ti;for(const Fr of tr)for(const Fn of Fr.positionedGlyphs)Fn.x+=ni,Fn.y+=ri})(Ve.positionedLines,qr,ps,fi,fn,lr,ft,kt,lt.length),Ve.top+=-fi*kt,Ve.bottom=Ve.top+kt,Ve.left+=-ps*fn,Ve.right=Ve.left+fn}(Pe,r,s,h,le,w,S,E,j,M,V,H),!function(Ve){for(const Xe of Ve)if(Xe.positionedGlyphs.length!==0)return!1;return!0}(be)&&Pe}const Hm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lA={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},cA={40:!0};function Yw(o,r,s,h,p,x){if(r.imageName){const w=h[r.imageName];return w?w.displaySize[0]*r.scale*Qr/x+p:0}{const w=s[r.fontStack],S=w&&w[o];return S?S.metrics.advance*r.scale+p:0}}function Jw(o,r,s,h){const p=Math.pow(o-r,2);return h?o<r?p/2:2*p:p+Math.abs(s)*s}function uA(o,r,s){let h=0;return o===10&&(h-=1e4),s&&(h+=150),o!==40&&o!==65288||(h+=50),r!==41&&r!==65289||(h+=50),h}function Qw(o,r,s,h,p,x){let w=null,S=Jw(r,s,p,x);for(const E of h){const M=Jw(r-E.x,s,p,x)+E.badness;M<=S&&(w=E,S=M)}return{index:o,x:r,priorBreak:w,badness:S}}function e1(o){return o?e1(o.priorBreak).concat(o.index):[]}function Oy(o,r,s,h,p,x){if(!o)return[];const w=[],S=function(j,V,G,H,ee,le){let me=0;for(let Re=0;Re<j.length();Re++){const be=j.getSection(Re);me+=Yw(j.getCharCode(Re),be,H,ee,V,le)}return me/Math.max(1,Math.ceil(me/G))}(o,r,s,h,p,x),E=o.text.indexOf("")>=0;let M=0;for(let j=0;j<o.length();j++){const V=o.getSection(j),G=o.getCharCode(j);if(Hm[G]||(M+=Yw(G,V,h,p,r,x)),j<o.length()-1){const H=!((R=G)<11904)&&(!!un["CJK Compatibility Forms"](R)||!!un["CJK Compatibility"](R)||!!un["CJK Strokes"](R)||!!un["CJK Symbols and Punctuation"](R)||!!un["Enclosed CJK Letters and Months"](R)||!!un["Halfwidth and Fullwidth Forms"](R)||!!un["Ideographic Description Characters"](R)||!!un["Vertical Forms"](R)||km.test(String.fromCodePoint(R)));(lA[G]||H||V.imageName||j!==o.length()-2&&cA[o.getCharCode(j+1)])&&w.push(Qw(j+1,M,S,w,uA(G,o.getCharCode(j+1),H&&E),!1))}}var R;return e1(Qw(o.length(),M,S,w,0,!0))}function jy(o){let r=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function hA(o,r,s){const h=r.getMaxScale()*Qr,{maxImageWidth:p,maxImageHeight:x}=r.getMaxImageSize(o),w=Math.max(h,x*s);return{verticalLineContentWidth:Math.max(h,p*s),horizontalLineContentHeight:w}}function t1(o){switch(o){case"top":return 0;case"center":return .5;default:return 1}}function dA(o,r,s){return!(o===g.ao.horizontal||!r&&!Vh(s)||r&&(Hm[s]||(h=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function fA(o,r,s,h,p,x){const w=x[o.fontStack],S=function(M,R,j,V){if(M&&M.rect)return M;const G=R[j.fontStack],H=G&&G[V];return H?{rect:null,metrics:H.metrics}:null}(w&&w[r],p,o,r);if(S===null)return null;let E;if(s)E=h.verticalLineContentWidth-o.scale*Qr;else{const M=t1(o.verticalAlign);E=(h.horizontalLineContentHeight-o.scale*Qr)*M}return{rect:S.rect,metrics:S.metrics,baselineOffset:E}}function pA(o,r,s,h,p){const x=p[o.imageName];if(!x)return null;const w=x.paddedRect,S=x.displaySize,E={width:S[0],height:S[1],left:1,top:-3,advance:r?S[1]:S[0]};let M;if(r)M=h.verticalLineContentWidth-S[1]*o.scale;else{const R=t1(o.verticalAlign);M=(h.horizontalLineContentHeight-S[1]*o.scale)*R}return{rect:w,metrics:E,baselineOffset:M,imageOffset:(r?S[0]:S[1])*o.scale-Qr*s}}function mA(o,r,s,h){if(h===0)return;const p=o[s],x=(o[s].x+p.metrics.advance*p.scale)*h;for(let w=r;w<=s;w++)o[w].x-=x}function gA(o,r,s){const{horizontalAlign:h,verticalAlign:p}=jy(s),x=r[0]-o.displaySize[0]*h,w=r[1]-o.displaySize[1]*p;return{image:o,top:w,bottom:w+o.displaySize[1],left:x,right:x+o.displaySize[0]}}function n1(o){var r,s;let h=o.left,p=o.top,x=o.right-h,w=o.bottom-p;const S=(r=o.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",E=(s=o.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",M=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(E==="proportional"){if(S==="stretchOnly"&&x/w<M||S==="proportional"){const R=Math.ceil(w*M);h*=R/x,x=R}}else if(S==="proportional"&&E==="stretchOnly"&&M!==0&&x/w>M){const R=Math.ceil(x/M);p*=R/w,w=R}return{x1:h,y1:p,x2:h+x,y2:p+w}}function r1(o,r,s,h,p,x){const w=o.image;let S;if(w.content){const le=w.content,me=w.pixelRatio||1;S=[le[0]/me,le[1]/me,w.displaySize[0]-le[2]/me,w.displaySize[1]-le[3]/me]}const E=r.left*x,M=r.right*x;let R,j,V,G;s==="width"||s==="both"?(G=p[0]+E-h[3],j=p[0]+M+h[1]):(G=p[0]+(E+M-w.displaySize[0])/2,j=G+w.displaySize[0]);const H=r.top*x,ee=r.bottom*x;return s==="height"||s==="both"?(R=p[1]+H-h[0],V=p[1]+ee+h[2]):(R=p[1]+(H+ee-w.displaySize[1])/2,V=R+w.displaySize[1]),{image:w,top:R,right:j,bottom:V,left:G,collisionPadding:S}}const Bl=128,Lc=32640;function i1(o,r){const{expression:s}=r;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Dn(o+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=s;let x=0;for(;x<h.length&&h[x]<=o;)x++;x=Math.max(0,x-1);let w=x;for(;w<h.length&&h[w]<o+1;)w++;w=Math.min(h.length-1,w);const S=h[x],E=h[w];return s.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:S,maxZoom:E,minSize:s.evaluate(new Dn(S)),maxSize:s.evaluate(new Dn(E)),interpolationType:p}}}function By(o,r,s){let h="never";const p=o.get(r);return p?h=p:o.get(s)&&(h="always"),h}const _A=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Km(o,r,s,h,p,x,w,S,E,M,R,j,V){const G=S?Math.min(Lc,Math.round(S[0])):0,H=S?Math.min(Lc,Math.round(S[1])):0;o.emplaceBack(r,s,Math.round(32*h),Math.round(32*p),x,w,(G<<1)+(E?1:0),H,16*M,16*R,256*j,256*V)}function Fy(o,r,s){o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s)}function yA(o){for(const r of o.sections)if(zm(r.text))return!0;return!1}class Uy{constructor(r){this.layoutVertexArray=new ot,this.indexArray=new Sn,this.programConfigurations=r,this.segments=new gn,this.dynamicLayoutVertexArray=new tt,this.opacityVertexArray=new Et,this.hasVisibleVertices=!1,this.placedSymbolArray=new q}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,s,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,GM.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,qM.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,_A,!0),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}yt("SymbolBuffers",Uy);class Vy{constructor(r,s,h){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new h,this.segments=new gn,this.collisionVertexArray=new Tn}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,WM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}yt("CollisionBuffers",Vy);class id{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=_n(globalThis)?Math.min(r.overscaling,128):r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(w=>w.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i1(this.zoom,s["text-size"]),this.iconSizeData=i1(this.zoom,s["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.canOverlap=By(h,"text-overlap","text-allow-overlap")!=="never"||By(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(w=>g.ao[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=r.sourceID}createArrays(){this.text=new Uy(new il(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Uy(new il(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new he,this.lineVertexArray=new de,this.symbolInstances=new ue,this.textAnchorOffsets=new ve}calculateGlyphDependencies(r,s,h,p,x){for(let w=0;w<r.length;w++)if(s[r.charCodeAt(w)]=!0,(h||p)&&x){const S=Ff[r.charAt(w)];S&&(s[S.charCodeAt(0)]=!0)}}populate(r,s,h){const p=this.layers[0],x=p.layout,w=x.get("text-font"),S=x.get("text-field"),E=x.get("icon-image"),M=(S.value.kind!=="constant"||S.value.value instanceof Si&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),R=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,j=x.get("symbol-sort-key");if(this.features=[],!M&&!R)return;const V=s.iconDependencies,G=s.glyphDependencies,H=s.availableImages,ee=new Dn(this.zoom);for(const{feature:le,id:me,index:Re,sourceLayerIndex:be}of r){const Pe=p._featureFilter.needGeometry,Ve=Zu(le,Pe);if(!p._featureFilter.filter(ee,Ve,h))continue;let Xe,rt;if(Pe||(Ve.geometry=$u(le)),M){const lt=p.getValueAndResolveTokens("text-field",Ve,h,H),ft=Si.factory(lt),At=this.hasRTLText=this.hasRTLText||yA(ft);(!At||Ya.getRTLTextPluginStatus()==="unavailable"||At&&Ya.isParsed())&&(Xe=KM(ft,p,Ve))}if(R){const lt=p.getValueAndResolveTokens("icon-image",Ve,h,H);rt=lt instanceof ci?lt:ci.fromString(lt)}if(!Xe&&!rt)continue;const gt=this.sortFeaturesByKey?j.evaluate(Ve,{},h):void 0;if(this.features.push({id:me,text:Xe,icon:rt,index:Re,sourceLayerIndex:be,geometry:Ve.geometry,properties:le.properties,type:td.types[le.type],sortKey:gt}),rt&&(V[rt.name]=!0),Xe){const lt=w.evaluate(Ve,{},h).join(","),ft=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.ao.vertical)>=0;for(const At of Xe.sections)if(At.image)V[At.image.name]=!0;else{const dt=Fh(Xe.toString()),pt=At.fontStack||lt,Qe=G[pt]=G[pt]||{};this.calculateGlyphDependencies(At.text,Qe,ft,this.allowVerticalPlacement,dt)}}}x.get("symbol-placement")==="line"&&(this.features=function(le){const me={},Re={},be=[];let Pe=0;function Ve(lt){be.push(le[lt]),Pe++}function Xe(lt,ft,At){const dt=Re[lt];return delete Re[lt],Re[ft]=dt,be[dt].geometry[0].pop(),be[dt].geometry[0]=be[dt].geometry[0].concat(At[0]),dt}function rt(lt,ft,At){const dt=me[ft];return delete me[ft],me[lt]=dt,be[dt].geometry[0].shift(),be[dt].geometry[0]=At[0].concat(be[dt].geometry[0]),dt}function gt(lt,ft,At){const dt=At?ft[0][ft[0].length-1]:ft[0][0];return`${lt}:${dt.x}:${dt.y}`}for(let lt=0;lt<le.length;lt++){const ft=le[lt],At=ft.geometry,dt=ft.text?ft.text.toString():null;if(!dt){Ve(lt);continue}const pt=gt(dt,At),Qe=gt(dt,At,!0);if(pt in Re&&Qe in me&&Re[pt]!==me[Qe]){const Ot=rt(pt,Qe,At),Gt=Xe(pt,Qe,be[Ot].geometry);delete me[pt],delete Re[Qe],Re[gt(dt,be[Gt].geometry,!0)]=Gt,be[Ot].geometry=null}else pt in Re?Xe(pt,Qe,At):Qe in me?rt(pt,Qe,At):(Ve(lt),me[pt]=Pe-1,Re[Qe]=Pe-1)}return be.filter(lt=>lt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,me)=>le.sortKey-me.sortKey)}update(r,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,s,this.layers,{imagePositions:h}),this.icon.programConfigurations.updatePaintArrays(r,s,this.layers,{imagePositions:h}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const h=this.lineVertexArray.length;if(r.segment!==void 0){let p=r.dist(s[r.segment+1]),x=r.dist(s[r.segment]);const w={};for(let S=r.segment+1;S<s.length;S++)w[S]={x:s[S].x,y:s[S].y,tileUnitDistanceFromAnchor:p},S<s.length-1&&(p+=s[S+1].dist(s[S]));for(let S=r.segment||0;S>=0;S--)w[S]={x:s[S].x,y:s[S].y,tileUnitDistanceFromAnchor:x},S>0&&(x+=s[S-1].dist(s[S]));for(let S=0;S<s.length;S++){const E=w[S];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,s,h,p,x,w,S,E,M,R,j,V){const G=r.indexArray,H=r.layoutVertexArray,ee=r.segments.prepareSegment(4*s.length,H,G,this.canOverlap?w.sortKey:void 0),le=this.glyphOffsetArray.length,me=ee.vertexLength,Re=this.allowVerticalPlacement&&S===g.ao.vertical?Math.PI/2:0,be=w.text&&w.text.sections;for(let Pe=0;Pe<s.length;Pe++){const{tl:Ve,tr:Xe,bl:rt,br:gt,tex:lt,pixelOffsetTL:ft,pixelOffsetBR:At,minFontScaleX:dt,minFontScaleY:pt,glyphOffset:Qe,isSDF:Ot,sectionIndex:Gt}=s[Pe],zt=ee.vertexLength,kt=Qe[1];Km(H,E.x,E.y,Ve.x,kt+Ve.y,lt.x,lt.y,h,Ot,ft.x,ft.y,dt,pt),Km(H,E.x,E.y,Xe.x,kt+Xe.y,lt.x+lt.w,lt.y,h,Ot,At.x,ft.y,dt,pt),Km(H,E.x,E.y,rt.x,kt+rt.y,lt.x,lt.y+lt.h,h,Ot,ft.x,At.y,dt,pt),Km(H,E.x,E.y,gt.x,kt+gt.y,lt.x+lt.w,lt.y+lt.h,h,Ot,At.x,At.y,dt,pt),Fy(r.dynamicLayoutVertexArray,E,Re),G.emplaceBack(zt,zt+2,zt+1),G.emplaceBack(zt+1,zt+2,zt+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qe[0]),Pe!==s.length-1&&Gt===s[Pe+1].sectionIndex||r.programConfigurations.populatePaintArrays(H.length,w,w.index,{imagePositions:{},canonical:V,formattedSection:be&&be[Gt]})}r.placedSymbolArray.emplaceBack(E.x,E.y,le,this.glyphOffsetArray.length-le,me,M,R,E.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],S,0,!1,0,j)}_addCollisionDebugVertex(r,s,h,p,x,w){return s.emplaceBack(0,0),r.emplaceBack(h.x,h.y,p,x,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(r,s,h,p,x,w,S){const E=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),M=E.vertexLength,R=x.layoutVertexArray,j=x.collisionVertexArray,V=S.anchorX,G=S.anchorY;this._addCollisionDebugVertex(R,j,w,V,G,new A(r,s)),this._addCollisionDebugVertex(R,j,w,V,G,new A(h,s)),this._addCollisionDebugVertex(R,j,w,V,G,new A(h,p)),this._addCollisionDebugVertex(R,j,w,V,G,new A(r,p)),E.vertexLength+=4;const H=x.indexArray;H.emplaceBack(M,M+1),H.emplaceBack(M+1,M+2),H.emplaceBack(M+2,M+3),H.emplaceBack(M+3,M),E.primitiveLength+=4}addDebugCollisionBoxes(r,s,h,p){for(let x=r;x<s;x++){const w=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,p?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vy(Wt,Gw.members,An),this.iconCollisionBox=new Vy(Wt,Gw.members,An);for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(r,s,h,p,x,w,S,E,M){const R={};for(let j=s;j<h;j++){const V=r.get(j);R.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.textFeatureIndex=V.featureIndex;break}for(let j=p;j<x;j++){const V=r.get(j);R.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.verticalTextFeatureIndex=V.featureIndex;break}for(let j=w;j<S;j++){const V=r.get(j);R.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.iconFeatureIndex=V.featureIndex;break}for(let j=E;j<M;j++){const V=r.get(j);R.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.verticalIconFeatureIndex=V.featureIndex;break}return R}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,s){const h=r.placedSymbolArray.get(s),p=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<p;x+=4)r.indexArray.emplaceBack(x,x+2,x+1),r.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(r),h=Math.cos(r),p=[],x=[],w=[];for(let S=0;S<this.symbolInstances.length;++S){w.push(S);const E=this.symbolInstances.get(S);p.push(0|Math.round(s*E.anchorX+h*E.anchorY)),x.push(E.featureIndex)}return w.sort((S,E)=>p[S]-p[E]||x[E]-x[S]),w}addToSortKeyRanges(r,s){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===s?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const h=this.symbolInstances.get(s);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((p,x,w)=>{p>=0&&w.indexOf(p)===x&&this.addIndicesForPlacedSymbol(this.text,p)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let s1,o1;yt("SymbolBucket",id,{omit:["layers","collisionBoxArray","features","compareText"]}),id.MAX_GLYPHS=65535,id.addDynamicAttributes=Fy;var $y={get paint(){return o1=o1||new Bi({"icon-opacity":new Nt(De.paint_symbol["icon-opacity"]),"icon-color":new Nt(De.paint_symbol["icon-color"]),"icon-halo-color":new Nt(De.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nt(De.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nt(De.paint_symbol["icon-halo-blur"]),"icon-translate":new It(De.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(De.paint_symbol["icon-translate-anchor"]),"text-opacity":new Nt(De.paint_symbol["text-opacity"]),"text-color":new Nt(De.paint_symbol["text-color"],{runtimeType:Ti,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Nt(De.paint_symbol["text-halo-color"]),"text-halo-width":new Nt(De.paint_symbol["text-halo-width"]),"text-halo-blur":new Nt(De.paint_symbol["text-halo-blur"]),"text-translate":new It(De.paint_symbol["text-translate"]),"text-translate-anchor":new It(De.paint_symbol["text-translate-anchor"])})},get layout(){return s1=s1||new Bi({"symbol-placement":new It(De.layout_symbol["symbol-placement"]),"symbol-spacing":new It(De.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(De.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nt(De.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(De.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new It(De.layout_symbol["icon-allow-overlap"]),"icon-overlap":new It(De.layout_symbol["icon-overlap"]),"icon-ignore-placement":new It(De.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(De.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(De.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nt(De.layout_symbol["icon-size"]),"icon-text-fit":new It(De.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(De.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nt(De.layout_symbol["icon-image"]),"icon-rotate":new Nt(De.layout_symbol["icon-rotate"]),"icon-padding":new Nt(De.layout_symbol["icon-padding"]),"icon-keep-upright":new It(De.layout_symbol["icon-keep-upright"]),"icon-offset":new Nt(De.layout_symbol["icon-offset"]),"icon-anchor":new Nt(De.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(De.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(De.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(De.layout_symbol["text-rotation-alignment"]),"text-field":new Nt(De.layout_symbol["text-field"]),"text-font":new Nt(De.layout_symbol["text-font"]),"text-size":new Nt(De.layout_symbol["text-size"]),"text-max-width":new Nt(De.layout_symbol["text-max-width"]),"text-line-height":new It(De.layout_symbol["text-line-height"]),"text-letter-spacing":new Nt(De.layout_symbol["text-letter-spacing"]),"text-justify":new Nt(De.layout_symbol["text-justify"]),"text-radial-offset":new Nt(De.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(De.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Nt(De.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Nt(De.layout_symbol["text-anchor"]),"text-max-angle":new It(De.layout_symbol["text-max-angle"]),"text-writing-mode":new It(De.layout_symbol["text-writing-mode"]),"text-rotate":new Nt(De.layout_symbol["text-rotate"]),"text-padding":new It(De.layout_symbol["text-padding"]),"text-keep-upright":new It(De.layout_symbol["text-keep-upright"]),"text-transform":new Nt(De.layout_symbol["text-transform"]),"text-offset":new Nt(De.layout_symbol["text-offset"]),"text-allow-overlap":new It(De.layout_symbol["text-allow-overlap"]),"text-overlap":new It(De.layout_symbol["text-overlap"]),"text-ignore-placement":new It(De.layout_symbol["text-ignore-placement"]),"text-optional":new It(De.layout_symbol["text-optional"])})}};class a1{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:fr,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt("FormatSectionOverride",a1,{omit:["defaultValue"]});class Xm extends eo{constructor(r,s){super(r,$y,s)}recalculate(r,s){if(super.recalculate(r,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const x of h)p.indexOf(x)<0&&p.push(x);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,s,h,p){const x=this.layout.get(r).evaluate(s,{},h,p),w=this._unevaluatedLayout._values[r];return w.isDataDriven()||xc(w.value)||!x?x:function(S,E){return E.replace(/{([^{}]+)}/g,(M,R)=>S&&R in S?String(S[R]):"")}(s.properties,x)}createBucket(r){return new id(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of $y.paint.overridableProperties){if(!Xm.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),h=new a1(s),p=new vc(h,s.property.specification);let x=null;x=s.value.kind==="constant"||s.value.kind==="source"?new y("source",p):new P("composite",p,s.value.zoomStops),this.paint._values[r]=new Eo(s.property,x,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,h){return!(!this.layout||s.isDataDriven()||h.isDataDriven())&&Xm.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const h=r.get("text-field"),p=$y.paint.properties[s];let x=!1;const w=S=>{for(const E of S)if(p.overrides&&p.overrides.hasOverride(E))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Si)w(h.value.value.sections);else if(h.value.kind==="source"||h.value.kind==="composite"){const S=M=>{x||(M instanceof $t&&an(M.value)===Ea?w(M.value.sections):M instanceof uc?w(M.sections):M.eachChild(S))},E=h.value;E._styleExpression&&S(E._styleExpression.expression)}return x}}let l1;var vA={get paint(){return l1=l1||new Bi({"background-color":new It(De.paint_background["background-color"]),"background-pattern":new Om(De.paint_background["background-pattern"]),"background-opacity":new It(De.paint_background["background-opacity"])})}};class xA extends eo{constructor(r,s){super(r,vA,s)}}class bA extends eo{constructor(r,s){super(r,{},s),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class wA{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const TA={once:!0},Zy=63710088e-1;class zc{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zc(Un(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,h=this.lat*s,p=r.lat*s,x=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((r.lng-this.lng)*s);return Zy*Math.acos(Math.min(x,1))}static convert(r){if(r instanceof zc)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new zc(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new zc(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const c1=2*Math.PI*Zy;function u1(o){return c1*Math.cos(o*Math.PI/180)}function h1(o){return(180+o)/360}function d1(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function f1(o,r){return o/u1(r)}function Gy(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function p1(o,r){return o*u1(Gy(r))}class Vf{constructor(r,s,h=0){this.x=+r,this.y=+s,this.z=+h}static fromLngLat(r,s=0){const h=zc.convert(r);return new Vf(h1(h.lng),d1(h.lat),f1(s,h.lat))}toLngLat(){return new zc(360*this.x-180,Gy(this.y))}toAltitude(){return p1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/c1*(r=Gy(this.y),1/Math.cos(r*Math.PI/180));var r}}function m1(o,r,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[o*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class qy{constructor(r,s,h){if(!function(p,x,w){return!(p<0||p>25||w<0||w>=Math.pow(2,p)||x<0||x>=Math.pow(2,p))}(r,s,h))throw new Error(`x=${s}, y=${h}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=s,this.y=h,this.key=sd(0,r,r,s,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,s,h){const p=(w=this.y,S=this.z,E=m1(256*(x=this.x),256*(w=Math.pow(2,S)-w-1),S),M=m1(256*(x+1),256*(w+1),S),E[0]+","+E[1]+","+M[0]+","+M[1]);var x,w,S,E,M;const R=function(j,V,G){let H,ee="";for(let le=j;le>0;le--)H=1<<le-1,ee+=(V&H?1:0)+(G&H?2:0);return ee}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,p)}isChildOf(r){const s=this.z-r.z;return s>0&&r.x===this.x>>s&&r.y===this.y>>s}getTilePoint(r){const s=Math.pow(2,this.z);return new A((r.x*s-this.x)*Oe,(r.y*s-this.y)*Oe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class g1{constructor(r,s){this.wrap=r,this.canonical=s,this.key=sd(r,s.z,s.z,s.x,s.y)}}class ro{constructor(r,s,h,p,x){if(this.terrainRttPosMatrix32f=null,r<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${h}`);this.overscaledZ=r,this.wrap=s,this.canonical=new qy(h,+p,+x),this.key=sd(s,r,h,p,x)}clone(){return new ro(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-r;return r>this.canonical.z?new ro(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ro(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(r,s){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-r;return r>this.canonical.z?sd(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y):sd(this.wrap*+s,r,r,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(r){if(r.wrap!==this.wrap||this.overscaledZ-r.overscaledZ<=0)return!1;if(r.overscaledZ===0)return this.overscaledZ>0;const s=this.canonical.z-r.canonical.z;return!(s<0)&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new ro(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new ro(s,this.wrap,s,h,p),new ro(s,this.wrap,s,h+1,p),new ro(s,this.wrap,s,h,p+1),new ro(s,this.wrap,s,h+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new ro(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new ro(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new g1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Vf(r.x-this.wrap,r.y))}}function sd(o,r,s,h,p){(o*=2)<0&&(o=-1*o-1);const x=1<<s;return(x*x*o+x*p+h).toString(36)+s.toString(36)+r.toString(36)}function $f(o,r){return r?o.properties[r]:o.id}yt("CanonicalTileID",qy),yt("OverscaledTileID",ro,{omit:["terrainRttPosMatrix32f"]});class Wu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(r){return this.minX=Math.min(this.minX,r.x),this.minY=Math.min(this.minY,r.y),this.maxX=Math.max(this.maxX,r.x),this.maxY=Math.max(this.maxY,r.y),this}expandBy(r){return this.minX-=r,this.minY-=r,this.maxX+=r,this.maxY+=r,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(r){return this.expandBy(-r)}map(r){const s=new Wu;return s.extend(r(new A(this.minX,this.minY))),s.extend(r(new A(this.maxX,this.minY))),s.extend(r(new A(this.minX,this.maxY))),s.extend(r(new A(this.maxX,this.maxY))),s}static fromPoints(r){const s=new Wu;for(const h of r)s.extend(h);return s}contains(r){return r.x>=this.minX&&r.x<=this.maxX&&r.y>=this.minY&&r.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(r){return!this.empty()&&!r.empty()&&r.minX>=this.minX&&r.maxX<=this.maxX&&r.minY>=this.minY&&r.maxY<=this.maxY}intersects(r){return!this.empty()&&!r.empty()&&r.minX<=this.maxX&&r.maxX>=this.minX&&r.minY<=this.maxY&&r.maxY>=this.minY}}class _1{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const h=r[s];this._stringToNumber[h]=s,this._numberToString[s]=h}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class y1{constructor(r,s,h,p,x){this.type="Feature",this._vectorTileFeature=r,r._z=s,r._x=h,r._y=p,this.properties=r.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(r[s]=this[s]);return r}}class v1{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Du(Oe,16,0),this.grid3D=new Du(Oe,16,0),this.featureIndexArray=new Te,this.promoteId=s}insert(r,s,h,p,x,w){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,x);const E=w?this.grid3D:this.grid;for(let M=0;M<s.length;M++){const R=s[M],j=[1/0,1/0,-1/0,-1/0];for(let V=0;V<R.length;V++){const G=R[V];j[0]=Math.min(j[0],G.x),j[1]=Math.min(j[1],G.y),j[2]=Math.max(j[2],G.x),j[3]=Math.max(j[3],G.y)}j[0]<Oe&&j[1]<Oe&&j[2]>=0&&j[3]>=0&&E.insert(S,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Nw(new Dy(this.rawTileData)).layers,this.sourceLayerCoder=new _1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,s,h,p){this.loadVTLayers();const x=r.params,w=Oe/r.tileSize/r.scale,S=Tt(x.filter,x.globalState),E=r.queryGeometry,M=r.queryPadding*w,R=Wu.fromPoints(E),j=this.grid.query(R.minX-M,R.minY-M,R.maxX+M,R.maxY+M),V=Wu.fromPoints(r.cameraQueryGeometry).expandBy(M),G=this.grid3D.query(V.minX,V.minY,V.maxX,V.maxY,(le,me,Re,be)=>function(Pe,Ve,Xe,rt,gt){for(const ft of Pe)if(Ve<=ft.x&&Xe<=ft.y&&rt>=ft.x&&gt>=ft.y)return!0;const lt=[new A(Ve,Xe),new A(Ve,gt),new A(rt,gt),new A(rt,Xe)];if(Pe.length>2){for(const ft of lt)if(Xh(Pe,ft))return!0}for(let ft=0;ft<Pe.length-1;ft++)if(Qk(Pe[ft],Pe[ft+1],lt))return!0;return!1}(r.cameraQueryGeometry,le-M,me-M,Re+M,be+M));for(const le of G)j.push(le);j.sort(SA);const H={};let ee;for(let le=0;le<j.length;le++){const me=j[le];if(me===ee)continue;ee=me;const Re=this.featureIndexArray.get(me);let be=null;this.loadMatchingFeature(H,Re.bucketIndex,Re.sourceLayerIndex,Re.featureIndex,S,x.layers,x.availableImages,s,h,p,(Pe,Ve,Xe)=>(be||(be=$u(Pe)),Ve.queryIntersectsFeature({queryGeometry:E,feature:Pe,featureState:Xe,geometry:be,zoom:this.z,transform:r.transform,pixelsToTileUnits:w,pixelPosMatrix:r.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:r.getElevation})))}return H}loadMatchingFeature(r,s,h,p,x,w,S,E,M,R,j){const V=this.bucketLayerIDs[s];if(w&&!V.some(le=>w.has(le)))return;const G=this.sourceLayerCoder.decode(h),H=this.vtLayers[G].feature(p);if(x.needGeometry){const le=Zu(H,!0);if(!x.filter(new Dn(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!x.filter(new Dn(this.tileID.overscaledZ),H))return;const ee=this.getId(H,G);for(let le=0;le<V.length;le++){const me=V[le];if(w&&!w.has(me))continue;const Re=E[me];if(!Re)continue;let be={};ee&&R&&(be=R.getState(Re.sourceLayer||"_geojsonTileLayer",ee));const Pe=Vn({},M[me]);Pe.paint=x1(Pe.paint,Re.paint,H,be,S),Pe.layout=x1(Pe.layout,Re.layout,H,be,S);const Ve=!j||j(H,Re,be);if(!Ve)continue;const Xe=new y1(H,this.z,this.x,this.y,ee);Xe.layer=Pe;let rt=r[me];rt===void 0&&(rt=r[me]=[]),rt.push({featureIndex:p,feature:Xe,intersectionZ:Ve})}}lookupSymbolFeatures(r,s,h,p,x,w,S,E){const M={};this.loadVTLayers();const R=Tt(x.filterSpec,x.globalState);for(const j of r)this.loadMatchingFeature(M,h,p,j,R,w,S,E,s);return M}hasLayer(r){for(const s of this.bucketLayerIDs)for(const h of s)if(r===h)return!0;return!1}getId(r,s){var h;let p=r.id;return this.promoteId&&(p=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((h=r.properties)===null||h===void 0)&&h.cluster)&&this.promoteId&&(p=Number(r.properties.cluster_id))),p}}function x1(o,r,s,h,p){return ws(o,(x,w)=>{const S=r instanceof Zh?r.get(w):null;return S&&S.evaluate?S.evaluate(s,h,p):S})}function SA(o,r){return r-o}function b1(o,r,s,h,p){const x=[];for(let w=0;w<o.length;w++){const S=o[w];let E;for(let M=0;M<S.length-1;M++){let R=S[M],j=S[M+1];R.x<r&&j.x<r||(R.x<r?R=new A(r,R.y+(r-R.x)/(j.x-R.x)*(j.y-R.y))._round():j.x<r&&(j=new A(r,R.y+(r-R.x)/(j.x-R.x)*(j.y-R.y))._round()),R.y<s&&j.y<s||(R.y<s?R=new A(R.x+(s-R.y)/(j.y-R.y)*(j.x-R.x),s)._round():j.y<s&&(j=new A(R.x+(s-R.y)/(j.y-R.y)*(j.x-R.x),s)._round()),R.x>=h&&j.x>=h||(R.x>=h?R=new A(h,R.y+(h-R.x)/(j.x-R.x)*(j.y-R.y))._round():j.x>=h&&(j=new A(h,R.y+(h-R.x)/(j.x-R.x)*(j.y-R.y))._round()),R.y>=p&&j.y>=p||(R.y>=p?R=new A(R.x+(p-R.y)/(j.y-R.y)*(j.x-R.x),p)._round():j.y>=p&&(j=new A(R.x+(p-R.y)/(j.y-R.y)*(j.x-R.x),p)._round()),E&&R.equals(E[E.length-1])||(E=[R],x.push(E)),E.push(j)))))}}return x}yt("FeatureIndex",v1,{omit:["rawTileData","sourceLayerCoder"]});class Dc extends A{constructor(r,s,h,p){super(r,s),this.angle=h,p!==void 0&&(this.segment=p)}clone(){return new Dc(this.x,this.y,this.angle,this.segment)}}function w1(o,r,s,h,p){if(r.segment===void 0||s===0)return!0;let x=r,w=r.segment+1,S=0;for(;S>-s/2;){if(w--,w<0)return!1;S-=o[w].dist(x),x=o[w]}S+=o[w].dist(o[w+1]),w++;const E=[];let M=0;for(;S<s/2;){const R=o[w],j=o[w+1];if(!j)return!1;let V=o[w-1].angleTo(R)-R.angleTo(j);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:S,angleDelta:V}),M+=V;S-E[0].distance>h;)M-=E.shift().angleDelta;if(M>p)return!1;w++,S+=R.dist(j)}return!0}function T1(o){let r=0;for(let s=0;s<o.length-1;s++)r+=o[s].dist(o[s+1]);return r}function S1(o,r,s){return o?.6*r*s:0}function P1(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function PA(o,r,s,h,p,x){const w=S1(s,p,x),S=P1(s,h)*x;let E=0;const M=T1(o)/2;for(let R=0;R<o.length-1;R++){const j=o[R],V=o[R+1],G=j.dist(V);if(E+G>M){const H=(M-E)/G,ee=Ni.number(j.x,V.x,H),le=Ni.number(j.y,V.y,H),me=new Dc(ee,le,V.angleTo(j),R);return me._round(),!w||w1(o,me,S,w,r)?me:void 0}E+=G}}function EA(o,r,s,h,p,x,w,S,E){const M=S1(h,x,w),R=P1(h,p),j=R*w,V=o[0].x===0||o[0].x===E||o[0].y===0||o[0].y===E;return r-j<r/4&&(r=j+r/4),E1(o,V?r/2*S%r:(R/2+2*x)*w*S%r,r,M,s,j,V,!1,E)}function E1(o,r,s,h,p,x,w,S,E){const M=x/2,R=T1(o);let j=0,V=r-s,G=[];for(let H=0;H<o.length-1;H++){const ee=o[H],le=o[H+1],me=ee.dist(le),Re=le.angleTo(ee);for(;V+s<j+me;){V+=s;const be=(V-j)/me,Pe=Ni.number(ee.x,le.x,be),Ve=Ni.number(ee.y,le.y,be);if(Pe>=0&&Pe<E&&Ve>=0&&Ve<E&&V-M>=0&&V+M<=R){const Xe=new Dc(Pe,Ve,Re,H);Xe._round(),h&&!w1(o,Xe,x,h,p)||G.push(Xe)}}j+=me}return S||G.length||w||(G=E1(o,j/2,s,h,p,x,w,!0,E)),G}function C1(o,r,s,h){const p=[],x=o.image,w=x.pixelRatio,S=x.paddedRect.w-2,E=x.paddedRect.h-2;let M={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const R=x.stretchX||[[0,S]],j=x.stretchY||[[0,E]],V=(Qe,Ot)=>Qe+Ot[1]-Ot[0],G=R.reduce(V,0),H=j.reduce(V,0),ee=S-G,le=E-H;let me=0,Re=G,be=0,Pe=H,Ve=0,Xe=ee,rt=0,gt=le;if(x.content&&h){const Qe=x.content,Ot=Qe[2]-Qe[0],Gt=Qe[3]-Qe[1];(x.textFitWidth||x.textFitHeight)&&(M=n1(o)),me=Ym(R,0,Qe[0]),be=Ym(j,0,Qe[1]),Re=Ym(R,Qe[0],Qe[2]),Pe=Ym(j,Qe[1],Qe[3]),Ve=Qe[0]-me,rt=Qe[1]-be,Xe=Ot-Re,gt=Gt-Pe}const lt=M.x1,ft=M.y1,At=M.x2-lt,dt=M.y2-ft,pt=(Qe,Ot,Gt,zt)=>{const kt=Jm(Qe.stretch-me,Re,At,lt),fn=Qm(Qe.fixed-Ve,Xe,Qe.stretch,G),lr=Jm(Ot.stretch-be,Pe,dt,ft),qr=Qm(Ot.fixed-rt,gt,Ot.stretch,H),Ci=Jm(Gt.stretch-me,Re,At,lt),io=Qm(Gt.fixed-Ve,Xe,Gt.stretch,G),ps=Jm(zt.stretch-be,Pe,dt,ft),fi=Qm(zt.fixed-rt,gt,zt.stretch,H),tr=new A(kt,lr),ei=new A(Ci,lr),pi=new A(Ci,ps),mi=new A(kt,ps),Yi=new A(fn/w,qr/w),so=new A(io/w,fi/w),ti=r*Math.PI/180;if(ti){const ni=Math.sin(ti),ri=Math.cos(ti),Fr=[ri,-ni,ni,ri];tr._matMult(Fr),ei._matMult(Fr),mi._matMult(Fr),pi._matMult(Fr)}const ms=Qe.stretch+Qe.fixed,Wr=Ot.stretch+Ot.fixed;return{tl:tr,tr:ei,bl:mi,br:pi,tex:{x:x.paddedRect.x+1+ms,y:x.paddedRect.y+1+Wr,w:Gt.stretch+Gt.fixed-ms,h:zt.stretch+zt.fixed-Wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yi,pixelOffsetBR:so,minFontScaleX:Xe/w/At,minFontScaleY:gt/w/dt,isSDF:s}};if(h&&(x.stretchX||x.stretchY)){const Qe=I1(R,ee,G),Ot=I1(j,le,H);for(let Gt=0;Gt<Qe.length-1;Gt++){const zt=Qe[Gt],kt=Qe[Gt+1];for(let fn=0;fn<Ot.length-1;fn++)p.push(pt(zt,Ot[fn],kt,Ot[fn+1]))}}else p.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:E+1}));return p}function Ym(o,r,s){let h=0;for(const p of o)h+=Math.max(r,Math.min(s,p[1]))-Math.max(r,Math.min(s,p[0]));return h}function I1(o,r,s){const h=[{fixed:-1,stretch:0}];for(const[p,x]of o){const w=h[h.length-1];h.push({fixed:p-w.stretch,stretch:w.stretch}),h.push({fixed:p-w.stretch,stretch:w.stretch+(x-p)})}return h.push({fixed:r+1,stretch:s}),h}function Jm(o,r,s,h){return o/r*s+h}function Qm(o,r,s,h){return o-r*s/h}yt("Anchor",Dc);class eg{constructor(r,s,h,p,x,w,S,E,M,R){var j;if(this.boxStartIndex=r.length,M){let V=w.top,G=w.bottom;const H=w.collisionPadding;H&&(V-=H[1],G+=H[3]);let ee=G-V;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{const V=!((j=w.image)===null||j===void 0)&&j.content&&(w.image.textFitWidth||w.image.textFitHeight)?n1(w):{x1:w.left,y1:w.top,x2:w.right,y2:w.bottom};V.y1=V.y1*S-E[0],V.y2=V.y2*S+E[2],V.x1=V.x1*S-E[3],V.x2=V.x2*S+E[1];const G=w.collisionPadding;if(G&&(V.x1-=G[0]*S,V.y1-=G[1]*S,V.x2+=G[2]*S,V.y2+=G[3]*S),R){const H=new A(V.x1,V.y1),ee=new A(V.x2,V.y1),le=new A(V.x1,V.y2),me=new A(V.x2,V.y2),Re=R*Math.PI/180;H._rotate(Re),ee._rotate(Re),le._rotate(Re),me._rotate(Re),V.x1=Math.min(H.x,ee.x,le.x,me.x),V.x2=Math.max(H.x,ee.x,le.x,me.x),V.y1=Math.min(H.y,ee.y,le.y,me.y),V.y2=Math.max(H.y,ee.y,le.y,me.y)}r.emplaceBack(s.x,s.y,V.x1,V.y1,V.x2,V.y2,h,p,x)}this.boxEndIndex=r.length}}class CA{constructor(r=[],s=(h,p)=>h<p?-1:h>p?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:h}=this,p=s[r];for(;r>0;){const x=r-1>>1,w=s[x];if(h(p,w)>=0)break;s[r]=w,r=x}s[r]=p}_down(r){const{data:s,compare:h}=this,p=this.length>>1,x=s[r];for(;r<p;){let w=1+(r<<1);const S=w+1;if(S<this.length&&h(s[S],s[w])<0&&(w=S),h(s[w],x)>=0)break;s[r]=s[w],r=w}s[r]=x}}function IA(o,r=1,s=!1){const h=Wu.fromPoints(o[0]),p=Math.min(h.width(),h.height());let x=p/2;const w=new CA([],kA),{minX:S,minY:E,maxX:M,maxY:R}=h;if(p===0)return new A(S,E);for(let G=S;G<M;G+=p)for(let H=E;H<R;H+=p)w.push(new od(G+x,H+x,x,o));let j=function(G){let H=0,ee=0,le=0;const me=G[0];for(let Re=0,be=me.length,Pe=be-1;Re<be;Pe=Re++){const Ve=me[Re],Xe=me[Pe],rt=Ve.x*Xe.y-Xe.x*Ve.y;ee+=(Ve.x+Xe.x)*rt,le+=(Ve.y+Xe.y)*rt,H+=3*rt}return new od(ee/H,le/H,0,G)}(o),V=w.length;for(;w.length;){const G=w.pop();(G.d>j.d||!j.d)&&(j=G,s&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,V)),G.max-j.d<=r||(x=G.h/2,w.push(new od(G.p.x-x,G.p.y-x,x,o)),w.push(new od(G.p.x+x,G.p.y-x,x,o)),w.push(new od(G.p.x-x,G.p.y+x,x,o)),w.push(new od(G.p.x+x,G.p.y+x,x,o)),V+=4)}return s&&(console.log(`num probes: ${V}`),console.log(`best distance: ${j.d}`)),j.p}function kA(o,r){return r.max-o.max}function od(o,r,s,h){this.p=new A(o,r),this.h=s,this.d=function(p,x){let w=!1,S=1/0;for(let E=0;E<x.length;E++){const M=x[E];for(let R=0,j=M.length,V=j-1;R<j;V=R++){const G=M[R],H=M[V];G.y>p.y!=H.y>p.y&&p.x<(H.x-G.x)*(p.y-G.y)/(H.y-G.y)+G.x&&(w=!w),S=Math.min(S,fw(p,G,H))}}return(w?1:-1)*Math.sqrt(S)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Ei;g.aE=void 0,(Ei=g.aE||(g.aE={}))[Ei.center=1]="center",Ei[Ei.left=2]="left",Ei[Ei.right=3]="right",Ei[Ei.top=4]="top",Ei[Ei.bottom=5]="bottom",Ei[Ei["top-left"]=6]="top-left",Ei[Ei["top-right"]=7]="top-right",Ei[Ei["bottom-left"]=8]="bottom-left",Ei[Ei["bottom-right"]=9]="bottom-right";const Wy=Number.POSITIVE_INFINITY;function k1(o,r){return r[1]!==Wy?function(s,h,p){let x=0,w=0;switch(h=Math.abs(h),p=Math.abs(p),s){case"top-right":case"top-left":case"top":w=p-7;break;case"bottom-right":case"bottom-left":case"bottom":w=7-p}switch(s){case"top-right":case"bottom-right":case"right":x=-h;break;case"top-left":case"bottom-left":case"left":x=h}return[x,w]}(o,r[0],r[1]):function(s,h){let p=0,x=0;h<0&&(h=0);const w=h/Math.SQRT2;switch(s){case"top-right":case"top-left":x=w-7;break;case"bottom-right":case"bottom-left":x=7-w;break;case"bottom":x=7-h;break;case"top":x=h-7}switch(s){case"top-right":case"bottom-right":p=-w;break;case"top-left":case"bottom-left":p=w;break;case"left":p=h;break;case"right":p=-h}return[p,x]}(o,r[0])}function M1(o,r,s){var h;const p=o.layout,x=(h=p.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(r,{},s);if(x){const S=x.values,E=[];for(let M=0;M<S.length;M+=2){const R=E[M]=S[M],j=S[M+1].map(V=>V*Qr);R.startsWith("top")?j[1]-=7:R.startsWith("bottom")&&(j[1]+=7),E[M+1]=j}return new $r(E)}const w=p.get("text-variable-anchor");if(w){let S;S=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(r,{},s)*Qr,Wy]:p.get("text-offset").evaluate(r,{},s).map(M=>M*Qr);const E=[];for(const M of w)E.push(M,k1(M,S));return new $r(E)}return null}function Hy(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function MA(o,r,s,h,p,x,w,S,E,M,R,j){let V=x.textMaxSize.evaluate(r,{});V===void 0&&(V=w);const G=o.layers[0].layout,H=G.get("icon-offset").evaluate(r,{},R),ee=R1(s.horizontal),le=w/24,me=o.tilePixelRatio*le,Re=o.tilePixelRatio*V/24,be=o.tilePixelRatio*S,Pe=o.tilePixelRatio*G.get("symbol-spacing"),Ve=G.get("text-padding")*o.tilePixelRatio,Xe=function(Gt,zt,kt,fn=1){const lr=Gt.get("icon-padding").evaluate(zt,{},kt),qr=lr&&lr.values;return[qr[0]*fn,qr[1]*fn,qr[2]*fn,qr[3]*fn]}(G,r,R,o.tilePixelRatio),rt=G.get("text-max-angle")/180*Math.PI,gt=G.get("text-rotation-alignment")!=="viewport"&&G.get("symbol-placement")!=="point",lt=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",ft=G.get("symbol-placement"),At=Pe/2,dt=G.get("icon-text-fit");let pt;h&&dt!=="none"&&(o.allowVerticalPlacement&&s.vertical&&(pt=r1(h,s.vertical,dt,G.get("icon-text-fit-padding"),H,le)),ee&&(h=r1(h,ee,dt,G.get("icon-text-fit-padding"),H,le)));const Qe=R?j.line.getGranularityForZoomLevel(R.z):1,Ot=(Gt,zt)=>{zt.x<0||zt.x>=Oe||zt.y<0||zt.y>=Oe||function(kt,fn,lr,qr,Ci,io,ps,fi,tr,ei,pi,mi,Yi,so,ti,ms,Wr,ni,ri,Fr,Fn,la,ad,ca,LA){const ld=kt.addToLineVertexArray(fn,lr);let Hu,cd,ud,hd,N1=0,O1=0,j1=0,B1=0,nv=-1,rv=-1;const Fl={};let F1=Ac("");if(kt.allowVerticalPlacement&&qr.vertical){const Ui=fi.layout.get("text-rotate").evaluate(Fn,{},ca)+90;ud=new eg(tr,fn,ei,pi,mi,qr.vertical,Yi,so,ti,Ui),ps&&(hd=new eg(tr,fn,ei,pi,mi,ps,Wr,ni,ti,Ui))}if(Ci){const Ui=fi.layout.get("icon-rotate").evaluate(Fn,{}),oo=fi.layout.get("icon-text-fit")!=="none",Ku=C1(Ci,Ui,ad,oo),ha=ps?C1(ps,Ui,ad,oo):void 0;cd=new eg(tr,fn,ei,pi,mi,Ci,Wr,ni,!1,Ui),N1=4*Ku.length;const Xu=kt.iconSizeData;let sl=null;Xu.kind==="source"?(sl=[Bl*fi.layout.get("icon-size").evaluate(Fn,{})],sl[0]>Lc&&$n(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Xu.kind==="composite"&&(sl=[Bl*la.compositeIconSizes[0].evaluate(Fn,{},ca),Bl*la.compositeIconSizes[1].evaluate(Fn,{},ca)],(sl[0]>Lc||sl[1]>Lc)&&$n(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),kt.addSymbols(kt.icon,Ku,sl,Fr,ri,Fn,g.ao.none,fn,ld.lineStartIndex,ld.lineLength,-1,ca),nv=kt.icon.placedSymbolArray.length-1,ha&&(O1=4*ha.length,kt.addSymbols(kt.icon,ha,sl,Fr,ri,Fn,g.ao.vertical,fn,ld.lineStartIndex,ld.lineLength,-1,ca),rv=kt.icon.placedSymbolArray.length-1)}const U1=Object.keys(qr.horizontal);for(const Ui of U1){const oo=qr.horizontal[Ui];if(!Hu){F1=Ac(oo.text);const ha=fi.layout.get("text-rotate").evaluate(Fn,{},ca);Hu=new eg(tr,fn,ei,pi,mi,oo,Yi,so,ti,ha)}const Ku=oo.positionedLines.length===1;if(j1+=A1(kt,fn,oo,io,fi,ti,Fn,ms,ld,qr.vertical?g.ao.horizontal:g.ao.horizontalOnly,Ku?U1:[Ui],Fl,nv,la,ca),Ku)break}qr.vertical&&(B1+=A1(kt,fn,qr.vertical,io,fi,ti,Fn,ms,ld,g.ao.vertical,["vertical"],Fl,rv,la,ca));const zA=Hu?Hu.boxStartIndex:kt.collisionBoxArray.length,DA=Hu?Hu.boxEndIndex:kt.collisionBoxArray.length,NA=ud?ud.boxStartIndex:kt.collisionBoxArray.length,OA=ud?ud.boxEndIndex:kt.collisionBoxArray.length,jA=cd?cd.boxStartIndex:kt.collisionBoxArray.length,BA=cd?cd.boxEndIndex:kt.collisionBoxArray.length,FA=hd?hd.boxStartIndex:kt.collisionBoxArray.length,UA=hd?hd.boxEndIndex:kt.collisionBoxArray.length;let ua=-1;const ng=(Ui,oo)=>Ui&&Ui.circleDiameter?Math.max(Ui.circleDiameter,oo):oo;ua=ng(Hu,ua),ua=ng(ud,ua),ua=ng(cd,ua),ua=ng(hd,ua);const V1=ua>-1?1:0;V1&&(ua*=LA/Qr),kt.glyphOffsetArray.length>=id.MAX_GLYPHS&&$n("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fn.sortKey!==void 0&&kt.addToSortKeyRanges(kt.symbolInstances.length,Fn.sortKey);const VA=M1(fi,Fn,ca),[$A,ZA]=function(Ui,oo){const Ku=Ui.length,ha=oo==null?void 0:oo.values;if((ha==null?void 0:ha.length)>0)for(let Xu=0;Xu<ha.length;Xu+=2){const sl=ha[Xu+1];Ui.emplaceBack(g.aE[ha[Xu]],sl[0],sl[1])}return[Ku,Ui.length]}(kt.textAnchorOffsets,VA);kt.symbolInstances.emplaceBack(fn.x,fn.y,Fl.right>=0?Fl.right:-1,Fl.center>=0?Fl.center:-1,Fl.left>=0?Fl.left:-1,Fl.vertical||-1,nv,rv,F1,zA,DA,NA,OA,jA,BA,FA,UA,ei,j1,B1,N1,O1,V1,0,Yi,ua,$A,ZA)}(o,zt,Gt,s,h,p,pt,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,me,[Ve,Ve,Ve,Ve],gt,E,be,Xe,lt,H,r,x,M,R,w)};if(ft==="line")for(const Gt of b1(r.geometry,0,0,Oe,Oe)){const zt=qu(Gt,Qe),kt=EA(zt,Pe,rt,s.vertical||ee,h,24,Re,o.overscaling,Oe);for(const fn of kt)ee&&AA(o,ee.text,At,fn)||Ot(zt,fn)}else if(ft==="line-center"){for(const Gt of r.geometry)if(Gt.length>1){const zt=qu(Gt,Qe),kt=PA(zt,rt,s.vertical||ee,h,24,Re);kt&&Ot(zt,kt)}}else if(r.type==="Polygon")for(const Gt of Da(r.geometry,0)){const zt=IA(Gt,16);Ot(qu(Gt[0],Qe,!0),new Dc(zt.x,zt.y,0))}else if(r.type==="LineString")for(const Gt of r.geometry){const zt=qu(Gt,Qe);Ot(zt,new Dc(zt[0].x,zt[0].y,0))}else if(r.type==="Point")for(const Gt of r.geometry)for(const zt of Gt)Ot([zt],new Dc(zt.x,zt.y,0))}function A1(o,r,s,h,p,x,w,S,E,M,R,j,V,G,H){const ee=function(Re,be,Pe,Ve,Xe,rt,gt,lt){const ft=Ve.layout.get("text-rotate").evaluate(rt,{})*Math.PI/180,At=[];for(const dt of be.positionedLines)for(const pt of dt.positionedGlyphs){if(!pt.rect)continue;const Qe=pt.rect||{};let Ot=4,Gt=!0,zt=1,kt=0;const fn=(Xe||lt)&&pt.vertical,lr=pt.metrics.advance*pt.scale/2;if(lt&&be.verticalizable&&(kt=dt.lineOffset/2-(pt.imageName?-(Qr-pt.metrics.width*pt.scale)/2:(pt.scale-1)*Qr)),pt.imageName){const ni=gt[pt.imageName];Gt=ni.sdf,zt=ni.pixelRatio,Ot=1/zt}const qr=Xe?[pt.x+lr,pt.y]:[0,0];let Ci=Xe?[0,0]:[pt.x+lr+Pe[0],pt.y+Pe[1]-kt],io=[0,0];fn&&(io=Ci,Ci=[0,0]);const ps=pt.metrics.isDoubleResolution?2:1,fi=(pt.metrics.left-Ot)*pt.scale-lr+Ci[0],tr=(-pt.metrics.top-Ot)*pt.scale+Ci[1],ei=fi+Qe.w/ps*pt.scale/zt,pi=tr+Qe.h/ps*pt.scale/zt,mi=new A(fi,tr),Yi=new A(ei,tr),so=new A(fi,pi),ti=new A(ei,pi);if(fn){const ni=new A(-lr,lr- -17),ri=-Math.PI/2,Fr=12-lr,Fn=new A(22-Fr,-(pt.imageName?Fr:0)),la=new A(...io);mi._rotateAround(ri,ni)._add(Fn)._add(la),Yi._rotateAround(ri,ni)._add(Fn)._add(la),so._rotateAround(ri,ni)._add(Fn)._add(la),ti._rotateAround(ri,ni)._add(Fn)._add(la)}if(ft){const ni=Math.sin(ft),ri=Math.cos(ft),Fr=[ri,-ni,ni,ri];mi._matMult(Fr),Yi._matMult(Fr),so._matMult(Fr),ti._matMult(Fr)}const ms=new A(0,0),Wr=new A(0,0);At.push({tl:mi,tr:Yi,bl:so,br:ti,tex:Qe,writingMode:be.writingMode,glyphOffset:qr,sectionIndex:pt.sectionIndex,isSDF:Gt,pixelOffsetTL:ms,pixelOffsetBR:Wr,minFontScaleX:0,minFontScaleY:0})}return At}(0,s,S,p,x,w,h,o.allowVerticalPlacement),le=o.textSizeData;let me=null;le.kind==="source"?(me=[Bl*p.layout.get("text-size").evaluate(w,{})],me[0]>Lc&&$n(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(me=[Bl*G.compositeTextSizes[0].evaluate(w,{},H),Bl*G.compositeTextSizes[1].evaluate(w,{},H)],(me[0]>Lc||me[1]>Lc)&&$n(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,ee,me,S,x,w,M,r,E.lineStartIndex,E.lineLength,V,H);for(const Re of R)j[Re]=o.text.placedSymbolArray.length-1;return 4*ee.length}function R1(o){for(const r in o)return o[r];return null}function AA(o,r,s,h){const p=o.compareText;if(r in p){const x=p[r];for(let w=x.length-1;w>=0;w--)if(h.dist(x[w])<s)return!0}else p[r]=[];return p[r].push(h),!1}const L1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ky{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,h]=new Uint8Array(r,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const x=L1[15&h];if(!x)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(r,2,1),[S]=new Uint32Array(r,4,1);return new Ky(S,w,x,r)}constructor(r,s=64,h=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const x=L1.indexOf(this.ArrayType),w=2*r*this.ArrayType.BYTES_PER_ELEMENT,S=r*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-S%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+S+E,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+w+S+E),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+S+E,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=r)}add(r,s){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=s,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Xy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,s,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:w,nodeSize:S}=this,E=[0,x.length-1,0],M=[];for(;E.length;){const R=E.pop()||0,j=E.pop()||0,V=E.pop()||0;if(j-V<=S){for(let le=V;le<=j;le++){const me=w[2*le],Re=w[2*le+1];me>=r&&me<=h&&Re>=s&&Re<=p&&M.push(x[le])}continue}const G=V+j>>1,H=w[2*G],ee=w[2*G+1];H>=r&&H<=h&&ee>=s&&ee<=p&&M.push(x[G]),(R===0?r<=H:s<=ee)&&(E.push(V),E.push(G-1),E.push(1-R)),(R===0?h>=H:p>=ee)&&(E.push(G+1),E.push(j),E.push(1-R))}return M}within(r,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:w}=this,S=[0,p.length-1,0],E=[],M=h*h;for(;S.length;){const R=S.pop()||0,j=S.pop()||0,V=S.pop()||0;if(j-V<=w){for(let le=V;le<=j;le++)D1(x[2*le],x[2*le+1],r,s)<=M&&E.push(p[le]);continue}const G=V+j>>1,H=x[2*G],ee=x[2*G+1];D1(H,ee,r,s)<=M&&E.push(p[G]),(R===0?r-h<=H:s-h<=ee)&&(S.push(V),S.push(G-1),S.push(1-R)),(R===0?r+h>=H:s+h>=ee)&&(S.push(G+1),S.push(j),S.push(1-R))}return E}}function Xy(o,r,s,h,p,x){if(p-h<=s)return;const w=h+p>>1;z1(o,r,w,h,p,x),Xy(o,r,s,h,w-1,1-x),Xy(o,r,s,w+1,p,1-x)}function z1(o,r,s,h,p,x){for(;p>h;){if(p-h>600){const M=p-h+1,R=s-h+1,j=Math.log(M),V=.5*Math.exp(2*j/3),G=.5*Math.sqrt(j*V*(M-V)/M)*(R-M/2<0?-1:1);z1(o,r,s,Math.max(h,Math.floor(s-R*V/M+G)),Math.min(p,Math.floor(s+(M-R)*V/M+G)),x)}const w=r[2*s+x];let S=h,E=p;for(Zf(o,r,h,s),r[2*p+x]>w&&Zf(o,r,h,p);S<E;){for(Zf(o,r,S,E),S++,E--;r[2*S+x]<w;)S++;for(;r[2*E+x]>w;)E--}r[2*h+x]===w?Zf(o,r,h,E):(E++,Zf(o,r,E,p)),E<=s&&(h=E+1),s<=E&&(p=E-1)}}function Zf(o,r,s,h){Yy(o,s,h),Yy(r,2*s,2*h),Yy(r,2*s+1,2*h+1)}function Yy(o,r,s){const h=o[r];o[r]=o[s],o[s]=h}function D1(o,r,s,h){const p=o-s,x=r-h;return p*p+x*x}var Jy;g.cx=void 0,(Jy=g.cx||(g.cx={})).create="create",Jy.load="load",Jy.fullLoad="fullLoad";let tg=null,Gf=[];const Qy=1e3/60,ev="loadTime",tv="fullLoadTime",RA={mark(o){performance.mark(o)},frame(o){const r=o;tg!=null&&Gf.push(r-tg),tg=r},clearMetrics(){tg=null,Gf=[],performance.clearMeasures(ev),performance.clearMeasures(tv);for(const o in g.cx)performance.clearMarks(g.cx[o])},getPerformanceMetrics(){performance.measure(ev,g.cx.create,g.cx.load),performance.measure(tv,g.cx.create,g.cx.fullLoad);const o=performance.getEntriesByName(ev)[0].duration,r=performance.getEntriesByName(tv)[0].duration,s=Gf.length,h=1/(Gf.reduce((x,w)=>x+w,0)/s/1e3),p=Gf.filter(x=>x>Qy).reduce((x,w)=>x+(w-Qy)/Qy,0);return{loadTime:o,fullLoadTime:r,fps:h,percentDroppedFrames:p/(s+p)*100,totalFrames:s}}};g.$=Oe,g.A=te,g.B=function([o,r,s]){return r+=90,r*=Math.PI/180,s*=Math.PI/180,{x:o*Math.cos(r)*Math.sin(s),y:o*Math.sin(r)*Math.sin(s),z:o*Math.cos(s)}},g.C=Ni,g.D=It,g.E=Ct,g.F=Dn,g.G=gf,g.H=_n,g.I=Ny,g.J=class{constructor(o,r){this.target=o,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new wA(()=>this.process()),this.subscription=Ss(this.target,"message",s=>this.receive(s),!1),this.globalScope=Dr(self)?o:window}registerMessageHandler(o,r){this.messageHandlers[o]=r}sendAsync(o,r){return new Promise((s,h)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),x=r?Ss(r.signal,"abort",()=>{x==null||x.unsubscribe(),delete this.resolveRejects[p];const E={id:p,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},TA):null;this.resolveRejects[p]={resolve:E=>{x==null||x.unsubscribe(),s(E)},reject:E=>{x==null||x.unsubscribe(),h(E)}};const w=[],S=Object.assign(Object.assign({},o),{id:p,sourceMapId:this.mapId,origin:location.origin,data:Ou(o.data,w)});this.target.postMessage(S,{transfer:w})})}receive(o){const r=o.data,s=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[s];const h=this.abortControllers[s];return delete this.abortControllers[s],void(h&&h.abort())}if(Dr(self)||r.mustQueue)return this.tasks[s]=r,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,r)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),r=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(o,r)}processTask(o,r){return c(this,void 0,void 0,function*(){if(r.type==="<response>"){const p=this.resolveRejects[o];return delete this.resolveRejects[o],p?void(r.error?p.reject(Ll(r.error)):p.resolve(Ll(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Ll(r.data),h=new AbortController;this.abortControllers[o]=h;try{const p=yield this.messageHandlers[r.type](r.sourceMapId,s,h);this.completeTask(o,null,p)}catch(p){this.completeTask(o,p)}})}completeTask(o,r,s){const h=[];delete this.abortControllers[o];const p={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?Ou(r):null,data:Ou(s,h)};this.target.postMessage(p,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},g.K=ye,g.L=function(){var o=new te(16);return te!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},g.M=function(o,r,s){var h,p,x,w,S,E,M,R,j,V,G,H,ee=s[0],le=s[1],me=s[2];return r===o?(o[12]=r[0]*ee+r[4]*le+r[8]*me+r[12],o[13]=r[1]*ee+r[5]*le+r[9]*me+r[13],o[14]=r[2]*ee+r[6]*le+r[10]*me+r[14],o[15]=r[3]*ee+r[7]*le+r[11]*me+r[15]):(p=r[1],x=r[2],w=r[3],S=r[4],E=r[5],M=r[6],R=r[7],j=r[8],V=r[9],G=r[10],H=r[11],o[0]=h=r[0],o[1]=p,o[2]=x,o[3]=w,o[4]=S,o[5]=E,o[6]=M,o[7]=R,o[8]=j,o[9]=V,o[10]=G,o[11]=H,o[12]=h*ee+S*le+j*me+r[12],o[13]=p*ee+E*le+V*me+r[13],o[14]=x*ee+M*le+G*me+r[14],o[15]=w*ee+R*le+H*me+r[15]),o},g.N=function(o,r,s){var h=s[0],p=s[1],x=s[2];return o[0]=r[0]*h,o[1]=r[1]*h,o[2]=r[2]*h,o[3]=r[3]*h,o[4]=r[4]*p,o[5]=r[5]*p,o[6]=r[6]*p,o[7]=r[7]*p,o[8]=r[8]*x,o[9]=r[9]*x,o[10]=r[10]*x,o[11]=r[11]*x,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o},g.O=function(o,r,s){var h=r[0],p=r[1],x=r[2],w=r[3],S=r[4],E=r[5],M=r[6],R=r[7],j=r[8],V=r[9],G=r[10],H=r[11],ee=r[12],le=r[13],me=r[14],Re=r[15],be=s[0],Pe=s[1],Ve=s[2],Xe=s[3];return o[0]=be*h+Pe*S+Ve*j+Xe*ee,o[1]=be*p+Pe*E+Ve*V+Xe*le,o[2]=be*x+Pe*M+Ve*G+Xe*me,o[3]=be*w+Pe*R+Ve*H+Xe*Re,o[4]=(be=s[4])*h+(Pe=s[5])*S+(Ve=s[6])*j+(Xe=s[7])*ee,o[5]=be*p+Pe*E+Ve*V+Xe*le,o[6]=be*x+Pe*M+Ve*G+Xe*me,o[7]=be*w+Pe*R+Ve*H+Xe*Re,o[8]=(be=s[8])*h+(Pe=s[9])*S+(Ve=s[10])*j+(Xe=s[11])*ee,o[9]=be*p+Pe*E+Ve*V+Xe*le,o[10]=be*x+Pe*M+Ve*G+Xe*me,o[11]=be*w+Pe*R+Ve*H+Xe*Re,o[12]=(be=s[12])*h+(Pe=s[13])*S+(Ve=s[14])*j+(Xe=s[15])*ee,o[13]=be*p+Pe*E+Ve*V+Xe*le,o[14]=be*x+Pe*M+Ve*G+Xe*me,o[15]=be*w+Pe*R+Ve*H+Xe*Re,o},g.P=A,g.Q=function(o,r){const s={};for(let h=0;h<r.length;h++){const p=r[h];p in o&&(s[p]=o[p])}return s},g.R=fs,g.S=zc,g.T=Ey,g.U=d1,g.V=h1,g.W=oe,g.X=re,g.Y=Ai,g.Z=ro,g._=c,g.a=Y,g.a$=vt,g.a0=function(o,r){var s,h,p,x,w;if(!o)return r??{};if(!r)return o;let S=Object.assign({},o);if(r.removeAll&&(S={removeAll:!0}),r.remove){const E=new Set(r.remove);S.add&&(S.add=S.add.filter(R=>!E.has(R.id))),S.update&&(S.update=S.update.filter(R=>!E.has(R.id)));const M=new Set(((s=o.add)!==null&&s!==void 0?s:[]).map(R=>R.id));r.remove=r.remove.filter(R=>!M.has(R))}if(r.remove){const E=new Set(S.remove?S.remove.concat(r.remove):r.remove);S.remove=Array.from(E.values())}if(r.add){const E=S.add?S.add.concat(r.add):r.add,M=new Map(E.map(R=>[R.id,R]));S.add=Array.from(M.values())}if(r.update){const E=new Map((h=S.update)===null||h===void 0?void 0:h.map(M=>[M.id,M]));for(const M of r.update){const R=(p=E.get(M.id))!==null&&p!==void 0?p:{id:M.id};M.newGeometry&&(R.newGeometry=M.newGeometry),M.addOrUpdateProperties&&(R.addOrUpdateProperties=((x=R.addOrUpdateProperties)!==null&&x!==void 0?x:[]).concat(M.addOrUpdateProperties)),M.removeProperties&&(R.removeProperties=((w=R.removeProperties)!==null&&w!==void 0?w:[]).concat(M.removeProperties)),M.removeAllProperties&&(R.removeAllProperties=!0),E.set(M.id,R)}S.update=Array.from(E.values())}return S.remove&&S.add&&(S.remove=S.remove.filter(E=>S.add.findIndex(M=>M.id===E)===-1)),S},g.a1=Vf,g.a2=Wu,g.a3=25,g.a4=qy,g.a5=o=>{const r=window.document.createElement("video");return r.muted=!0,new Promise(s=>{r.onloadstart=()=>{s(r)};for(const h of o){const p=window.document.createElement("source");ke(h)||(r.crossOrigin="Anonymous"),p.src=h,r.appendChild(p)}})},g.a6=Fe,g.a7=function(){return yi++},g.a8=U,g.a9=id,g.aA=function(o){let r=1/0,s=1/0,h=-1/0,p=-1/0;for(const x of o)r=Math.min(r,x.x),s=Math.min(s,x.y),h=Math.max(h,x.x),p=Math.max(p,x.y);return[r,s,h,p]},g.aB=Qr,g.aC=We,g.aD=function(o,r,s,h,p=!1){if(!s[0]&&!s[1])return[0,0];const x=p?h==="map"?-o.bearingInRadians:0:h==="viewport"?o.bearingInRadians:0;if(x){const w=Math.sin(x),S=Math.cos(x);s=[s[0]*S-s[1]*w,s[0]*w+s[1]*S]}return[p?s[0]:We(r,s[0],o.zoom),p?s[1]:We(r,s[1],o.zoom)]},g.aF=By,g.aG=Hy,g.aH=jy,g.aI=Ky,g.aJ=gr,g.aK=Gm,g.aL=Ee,g.aM=gn,g.aN=Sn,g.aO=Un,g.aP=Hn,g.aQ=p1,g.aR=ct,g.aS=xt,g.aT=function(o){var r=new te(3);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r},g.aU=function(o,r,s){return o[0]=r[0]-s[0],o[1]=r[1]-s[1],o[2]=r[2]-s[2],o},g.aV=function(o,r){var s=r[0],h=r[1],p=r[2],x=s*s+h*h+p*p;return x>0&&(x=1/Math.sqrt(x)),o[0]=r[0]*x,o[1]=r[1]*x,o[2]=r[2]*x,o},g.aW=ht,g.aX=function(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]},g.aY=function(o,r,s){return o[0]=r[0]*s[0],o[1]=r[1]*s[1],o[2]=r[2]*s[2],o[3]=r[3]*s[3],o},g.aZ=Ge,g.a_=function(o,r,s){const h=r[0]*s[0]+r[1]*s[1]+r[2]*s[2];return h===0?null:(-(o[0]*s[0]+o[1]*s[1]+o[2]*s[2])-s[3])/h},g.aa=Tt,g.ab=Zu,g.ac=y1,g.ad=function(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,h,p,x)=>{const w=p||x;return r[h]=!w||w.toLowerCase(),""}),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r},g.ae=li,g.af=function(o){return Math.pow(2,o)},g.ag=pe,g.ah=Pt,g.ai=85.051129,g.aj=f1,g.ak=function(o){return Math.log(o)/Math.LN2},g.al=function(o){var r=o[0],s=o[1];return r*r+s*s},g.am=function(o){if(!o.length)return new Set;const r=Math.max(...o.map(E=>E.canonical.z));let s=1/0,h=-1/0,p=1/0,x=-1/0;const w=[];for(const E of o){const{x:M,y:R,z:j}=E.canonical,V=Math.pow(2,r-j),G=M*V,H=R*V;w.push({id:E,x:G,y:H}),G<s&&(s=G),G>h&&(h=G),H<p&&(p=H),H>x&&(x=H)}const S=new Set;for(const E of w)E.x!==s&&E.x!==h&&E.y!==p&&E.y!==x||S.add(E.id);return S},g.an=function(o,r){let s=0,h=0;if(o.kind==="constant")h=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:p,minZoom:x,maxZoom:w}=o,S=p?Pt(zn.interpolationFactor(p,r,x,w),0,1):0;o.kind==="camera"?h=Ni.number(o.minSize,o.maxSize,S):s=S}return{uSizeT:s,uSize:h}},g.ap=function(o,{uSize:r,uSizeT:s},{lowerSize:h,upperSize:p}){return o.kind==="source"?h/Bl:o.kind==="composite"?Ni.number(h/Bl,p/Bl,s):r},g.aq=function(o,r){var s=r[0],h=r[1],p=r[2],x=r[3],w=r[4],S=r[5],E=r[6],M=r[7],R=r[8],j=r[9],V=r[10],G=r[11],H=r[12],ee=r[13],le=r[14],me=r[15],Re=s*S-h*w,be=s*E-p*w,Pe=s*M-x*w,Ve=h*E-p*S,Xe=h*M-x*S,rt=p*M-x*E,gt=R*ee-j*H,lt=R*le-V*H,ft=R*me-G*H,At=j*le-V*ee,dt=j*me-G*ee,pt=V*me-G*le,Qe=Re*pt-be*dt+Pe*At+Ve*ft-Xe*lt+rt*gt;return Qe?(o[0]=(S*pt-E*dt+M*At)*(Qe=1/Qe),o[1]=(p*dt-h*pt-x*At)*Qe,o[2]=(ee*rt-le*Xe+me*Ve)*Qe,o[3]=(V*Xe-j*rt-G*Ve)*Qe,o[4]=(E*ft-w*pt-M*lt)*Qe,o[5]=(s*pt-p*ft+x*lt)*Qe,o[6]=(le*Pe-H*rt-me*be)*Qe,o[7]=(R*rt-V*Pe+G*be)*Qe,o[8]=(w*dt-S*ft+M*gt)*Qe,o[9]=(h*ft-s*dt-x*gt)*Qe,o[10]=(H*Xe-ee*Pe+me*Re)*Qe,o[11]=(j*Pe-R*Xe-G*Re)*Qe,o[12]=(S*lt-w*At-E*gt)*Qe,o[13]=(s*At-h*lt+p*gt)*Qe,o[14]=(ee*be-H*Ve-le*Re)*Qe,o[15]=(R*Ve-j*be+V*Re)*Qe,o):null},g.ar=jt,g.as=function(o){var r=o[0],s=o[1];return Math.sqrt(r*r+s*s)},g.at=function(o){return o[0]=0,o[1]=0,o},g.au=function(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o},g.av=Fy,g.aw=at,g.ax=function(o,r,s,h){const p=r.y-o.y,x=r.x-o.x,w=h.y-s.y,S=h.x-s.x,E=w*x-S*p;if(E===0)return null;const M=(S*(o.y-s.y)-w*(o.x-s.x))/E;return new A(o.x+M*x,o.y+M*p)},g.ay=b1,g.az=hw,g.b=mn,g.b$=class extends hs{constructor(o,r){super(o,r),this.current=new Array}set(o){if(o!=this.current){this.current=o;const r=new Float32Array(o);this.gl.uniform1fv(this.location,r)}}},g.b0=function(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o[2]=r[2]*s,o[3]=r[3]*s,o},g.b1=function(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]+o[3]},g.b2=g1,g.b3=sd,g.b4=function(o,r,s,h,p){var x=1/Math.tan(r/2);if(o[0]=x/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,p!=null&&p!==1/0){var w=1/(h-p);o[10]=(p+h)*w,o[14]=2*p*h*w}else o[10]=-1,o[14]=-2*h;return o},g.b5=function(o){var r=new te(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},g.b6=function(o,r,s){var h=Math.sin(s),p=Math.cos(s),x=r[0],w=r[1],S=r[2],E=r[3],M=r[4],R=r[5],j=r[6],V=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=x*p+M*h,o[1]=w*p+R*h,o[2]=S*p+j*h,o[3]=E*p+V*h,o[4]=M*p-x*h,o[5]=R*p-w*h,o[6]=j*p-S*h,o[7]=V*p-E*h,o},g.b7=function(o,r,s){var h=Math.sin(s),p=Math.cos(s),x=r[4],w=r[5],S=r[6],E=r[7],M=r[8],R=r[9],j=r[10],V=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=x*p+M*h,o[5]=w*p+R*h,o[6]=S*p+j*h,o[7]=E*p+V*h,o[8]=M*p-x*h,o[9]=R*p-w*h,o[10]=j*p-S*h,o[11]=V*p-E*h,o},g.b8=function(){const o=new Float32Array(16);return pe(o),o},g.b9=function(){const o=new Float64Array(16);return pe(o),o},g.bA=function(o,r){const s=nt(o,360),h=nt(r,360),p=h-s,x=h>s?p-360:p+360;return Math.abs(p)<Math.abs(x)?p:x},g.bB=function(o){return o[0]=0,o[1]=0,o[2]=0,o},g.bC=function(o,r,s,h){const p=Math.sqrt(o*o+r*r),x=Math.sqrt(s*s+h*h);o/=p,r/=p,s/=x,h/=x;const w=Math.acos(o*s+r*h);return-r*s+o*h>0?w:-w},g.bD=function(o,r){const s=nt(o,2*Math.PI),h=nt(r,2*Math.PI);return Math.min(Math.abs(s-h),Math.abs(s-h+2*Math.PI),Math.abs(s-h-2*Math.PI))},g.bE=function(){const o={},r=De.$version;for(const s in De.$root){const h=De.$root[s];if(h.required){let p=null;p=s==="version"?r:h.type==="array"?[]:{},p!=null&&(o[s]=p)}}return o},g.bF=Ec,g.bG=Me,g.bH=function o(r,s){if(Array.isArray(r)){if(!Array.isArray(s)||r.length!==s.length)return!1;for(let h=0;h<r.length;h++)if(!o(r[h],s[h]))return!1;return!0}if(typeof r=="object"&&r!==null&&s!==null){if(typeof s!="object"||Object.keys(r).length!==Object.keys(s).length)return!1;for(const h in r)if(!o(r[h],s[h]))return!1;return!0}return r===s},g.bI=function(o){o=o.slice();const r=Object.create(null);for(let s=0;s<o.length;s++)r[o[s].id]=o[s];for(let s=0;s<o.length;s++)"ref"in o[s]&&(o[s]=yn(o[s],r[o[s].ref]));return o},g.bJ=function(o,r){if(o.type==="custom")return new bA(o,r);switch(o.type){case"background":return new xA(o,r);case"circle":return new sM(o,r);case"color-relief":return new hM(o,r);case"fill":return new EM(o,r);case"fill-extrusion":return new OM(o,r);case"heatmap":return new aM(o,r);case"hillshade":return new cM(o,r);case"line":return new ZM(o,r);case"raster":return new _y(o,r);case"symbol":return new Xm(o,r)}},g.bK=o=>o.type==="raster",g.bL=xr,g.bM=function(o,r){if(!o)return[{command:"setStyle",args:[r]}];let s=[];try{if(!St(o.version,r.version))return[{command:"setStyle",args:[r]}];St(o.center,r.center)||s.push({command:"setCenter",args:[r.center]}),St(o.state,r.state)||s.push({command:"setGlobalState",args:[r.state]}),St(o.centerAltitude,r.centerAltitude)||s.push({command:"setCenterAltitude",args:[r.centerAltitude]}),St(o.zoom,r.zoom)||s.push({command:"setZoom",args:[r.zoom]}),St(o.bearing,r.bearing)||s.push({command:"setBearing",args:[r.bearing]}),St(o.pitch,r.pitch)||s.push({command:"setPitch",args:[r.pitch]}),St(o.roll,r.roll)||s.push({command:"setRoll",args:[r.roll]}),St(o.sprite,r.sprite)||s.push({command:"setSprite",args:[r.sprite]}),St(o.glyphs,r.glyphs)||s.push({command:"setGlyphs",args:[r.glyphs]}),St(o.transition,r.transition)||s.push({command:"setTransition",args:[r.transition]}),St(o.light,r.light)||s.push({command:"setLight",args:[r.light]}),St(o.terrain,r.terrain)||s.push({command:"setTerrain",args:[r.terrain]}),St(o.sky,r.sky)||s.push({command:"setSky",args:[r.sky]}),St(o.projection,r.projection)||s.push({command:"setProjection",args:[r.projection]});const h={},p=[];(function(w,S,E,M){let R;for(R in S=S||{},w=w||{})Object.prototype.hasOwnProperty.call(w,R)&&(Object.prototype.hasOwnProperty.call(S,R)||Zn(R,E,M));for(R in S)Object.prototype.hasOwnProperty.call(S,R)&&(Object.prototype.hasOwnProperty.call(w,R)?St(w[R],S[R])||(w[R].type==="geojson"&&S[R].type==="geojson"&&wr(w,S,R)?on(E,{command:"setGeoJSONSourceData",args:[R,S[R].data]}):Xn(R,S,E,M)):ir(R,S,E))})(o.sources,r.sources,p,h);const x=[];o.layers&&o.layers.forEach(w=>{"source"in w&&h[w.source]?s.push({command:"removeLayer",args:[w.id]}):x.push(w)}),s=s.concat(p),function(w,S,E){S=S||[];const M=(w=w||[]).map(Tr),R=S.map(Tr),j=w.reduce(nn,{}),V=S.reduce(nn,{}),G=M.slice(),H=Object.create(null);let ee,le,me,Re,be;for(let Pe=0,Ve=0;Pe<M.length;Pe++)ee=M[Pe],Object.prototype.hasOwnProperty.call(V,ee)?Ve++:(on(E,{command:"removeLayer",args:[ee]}),G.splice(G.indexOf(ee,Ve),1));for(let Pe=0,Ve=0;Pe<R.length;Pe++)ee=R[R.length-1-Pe],G[G.length-1-Pe]!==ee&&(Object.prototype.hasOwnProperty.call(j,ee)?(on(E,{command:"removeLayer",args:[ee]}),G.splice(G.lastIndexOf(ee,G.length-Ve),1)):Ve++,Re=G[G.length-Pe],on(E,{command:"addLayer",args:[V[ee],Re]}),G.splice(G.length-Pe,0,ee),H[ee]=!0);for(let Pe=0;Pe<R.length;Pe++)if(ee=R[Pe],le=j[ee],me=V[ee],!H[ee]&&!St(le,me))if(St(le.source,me.source)&&St(le["source-layer"],me["source-layer"])&&St(le.type,me.type)){for(be in En(le.layout,me.layout,E,ee,null,"setLayoutProperty"),En(le.paint,me.paint,E,ee,null,"setPaintProperty"),St(le.filter,me.filter)||on(E,{command:"setFilter",args:[ee,me.filter]}),St(le.minzoom,me.minzoom)&&St(le.maxzoom,me.maxzoom)||on(E,{command:"setLayerZoomRange",args:[ee,me.minzoom,me.maxzoom]}),le)Object.prototype.hasOwnProperty.call(le,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?En(le[be],me[be],E,ee,be.slice(6),"setPaintProperty"):St(le[be],me[be])||on(E,{command:"setLayerProperty",args:[ee,be,me[be]]}));for(be in me)Object.prototype.hasOwnProperty.call(me,be)&&!Object.prototype.hasOwnProperty.call(le,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?En(le[be],me[be],E,ee,be.slice(6),"setPaintProperty"):St(le[be],me[be])||on(E,{command:"setLayerProperty",args:[ee,be,me[be]]}))}else on(E,{command:"removeLayer",args:[ee]}),Re=G[G.lastIndexOf(ee)+1],on(E,{command:"addLayer",args:[me,Re]})}(x,r.layers,s)}catch(h){console.warn("Unable to compute style diff:",h),s=[{command:"setStyle",args:[r]}]}return s},g.bN=function(o){const r=[],s=o.id;return s===void 0&&r.push({message:`layers.${s}: missing required property "id"`}),o.render===void 0&&r.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},g.bO=ws,g.bP=Ts,g.bQ=class extends hs{constructor(o,r){super(o,r),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},g.bR=ds,g.bS=class extends hs{constructor(o,r){super(o,r),this.current=Jr}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let r=1;r<16;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},g.bT=Gr,g.bU=class extends hs{constructor(o,r){super(o,r),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},g.bV=class extends hs{constructor(o,r){super(o,r),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},g.bW=fe,g.bX=function(o,r){var s=Math.sin(r),h=Math.cos(r);return o[0]=h,o[1]=s,o[2]=0,o[3]=-s,o[4]=h,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},g.bY=function(o,r,s){var h=r[0],p=r[1],x=r[2];return o[0]=h*s[0]+p*s[3]+x*s[6],o[1]=h*s[1]+p*s[4]+x*s[7],o[2]=h*s[2]+p*s[5]+x*s[8],o},g.bZ=function(o,r,s,h,p,x,w){var S=1/(r-s),E=1/(h-p),M=1/(x-w);return o[0]=-2*S,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*M,o[11]=0,o[12]=(r+s)*S,o[13]=(p+h)*E,o[14]=(w+x)*M,o[15]=1,o},g.b_=class extends hs{constructor(o,r){super(o,r),this.current=new Array}set(o){if(o!=this.current){this.current=o;const r=new Float32Array(4*o.length);for(let s=0;s<o.length;s++)r[4*s]=o[s].r,r[4*s+1]=o[s].g,r[4*s+2]=o[s].b,r[4*s+3]=o[s].a;this.gl.uniform4fv(this.location,r)}}},g.ba=function(){return new Float64Array(16)},g.bb=function(o,r,s){const h=new Float64Array(4);return wt(h,o,r-90,s),h},g.bc=function(o,r,s,h){var p,x,w,S,E,M=r[0],R=r[1],j=r[2],V=r[3],G=s[0],H=s[1],ee=s[2],le=s[3];return(x=M*G+R*H+j*ee+V*le)<0&&(x=-x,G=-G,H=-H,ee=-ee,le=-le),1-x>$?(p=Math.acos(x),w=Math.sin(p),S=Math.sin((1-h)*p)/w,E=Math.sin(h*p)/w):(S=1-h,E=h),o[0]=S*M+E*G,o[1]=S*R+E*H,o[2]=S*j+E*ee,o[3]=S*V+E*le,o},g.bd=function(o){const r=new Float64Array(9);var s,h,p,x,w,S,E,M,R,j,V,G,H,ee,le,me,Re,be;j=(p=(h=o)[0])*(E=p+p),V=(x=h[1])*E,H=(w=h[2])*E,ee=w*(M=x+x),me=(S=h[3])*E,Re=S*M,be=S*(R=w+w),(s=r)[0]=1-(G=x*M)-(le=w*R),s[3]=V-be,s[6]=H+Re,s[1]=V+be,s[4]=1-j-le,s[7]=ee-me,s[2]=H-Re,s[5]=ee+me,s[8]=1-j-G;const Pe=Hn(-Math.asin(Pt(r[2],-1,1)));let Ve,Xe;return Math.hypot(r[5],r[8])<.001?(Ve=0,Xe=-Hn(Math.atan2(r[3],r[4]))):(Ve=Hn(r[5]===0&&r[8]===0?0:Math.atan2(r[5],r[8])),Xe=Hn(r[1]===0&&r[0]===0?0:Math.atan2(r[1],r[0]))),{roll:Ve,pitch:Pe+90,bearing:Xe}},g.be=function(o,r){return o.roll==r.roll&&o.pitch==r.pitch&&o.bearing==r.bearing},g.bf=Qt,g.bg=_r,g.bh=ed,g.bi=Nf,g.bj=Qh,g.bk=_t,g.bl=Bt,g.bm=pr,g.bn=function(o,r,s,h,p){return _t(h,p,Pt((o-r)/(s-r),0,1))},g.bo=nt,g.bp=function(){return new Float64Array(3)},g.bq=function(o,r,s,h){return o[0]=r[0]+s[0]*h,o[1]=r[1]+s[1]*h,o[2]=r[2]+s[2]*h,o},g.br=wt,g.bs=function(o,r,s){var h=s[0],p=s[1],x=s[2],w=s[3],S=r[0],E=r[1],M=r[2],R=p*M-x*E,j=x*S-h*M,V=h*E-p*S;return o[0]=S+w*(R+=R)+p*(V+=V)-x*(j+=j),o[1]=E+w*j+x*R-h*V,o[2]=M+w*V+h*j-p*R,o},g.bt=function(o,r,s){const h=(p=[o[0],o[1],o[2],r[0],r[1],r[2],s[0],s[1],s[2]])[0]*((R=p[8])*(w=p[4])-(S=p[5])*(M=p[7]))+p[1]*(-R*(x=p[3])+S*(E=p[6]))+p[2]*(M*x-w*E);var p,x,w,S,E,M,R;if(h===0)return null;const j=ht([],[r[0],r[1],r[2]],[s[0],s[1],s[2]]),V=ht([],[s[0],s[1],s[2]],[o[0],o[1],o[2]]),G=ht([],[o[0],o[1],o[2]],[r[0],r[1],r[2]]),H=ct([],j,-o[3]);return xt(H,H,ct([],V,-r[3])),xt(H,H,ct([],G,-s[3])),ct(H,H,1/h),H},g.bu=Zy,g.bv=function(){return new Float64Array(4)},g.bw=function(o,r,s,h){var p=[],x=[];return p[0]=r[0]-s[0],p[1]=r[1]-s[1],p[2]=r[2]-s[2],x[0]=p[0]*Math.cos(h)-p[1]*Math.sin(h),x[1]=p[0]*Math.sin(h)+p[1]*Math.cos(h),x[2]=p[2],o[0]=x[0]+s[0],o[1]=x[1]+s[1],o[2]=x[2]+s[2],o},g.bx=function(o,r,s,h){var p=[],x=[];return p[0]=r[0]-s[0],p[1]=r[1]-s[1],p[2]=r[2]-s[2],x[0]=p[0],x[1]=p[1]*Math.cos(h)-p[2]*Math.sin(h),x[2]=p[1]*Math.sin(h)+p[2]*Math.cos(h),o[0]=x[0]+s[0],o[1]=x[1]+s[1],o[2]=x[2]+s[2],o},g.by=function(o,r,s,h){var p=[],x=[];return p[0]=r[0]-s[0],p[1]=r[1]-s[1],p[2]=r[2]-s[2],x[0]=p[2]*Math.sin(h)+p[0]*Math.cos(h),x[1]=p[1],x[2]=p[2]*Math.cos(h)-p[0]*Math.sin(h),o[0]=x[0]+s[0],o[1]=x[1]+s[1],o[2]=x[2]+s[2],o},g.bz=function(o,r,s){var h=Math.sin(s),p=Math.cos(s),x=r[0],w=r[1],S=r[2],E=r[3],M=r[8],R=r[9],j=r[10],V=r[11];return r!==o&&(o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=x*p-M*h,o[1]=w*p-R*h,o[2]=S*p-j*h,o[3]=E*p-V*h,o[8]=x*h+M*p,o[9]=w*h+R*p,o[10]=S*h+j*p,o[11]=E*h+V*p,o},g.c=X,g.c0=class extends Pf{},g.c1=HM,g.c2=class extends n{},g.c3=Py,g.c4=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},g.c5=bw,g.c6=function(o,r,s){var h=r[0],p=r[1],x=r[2],w=s[3]*h+s[7]*p+s[11]*x+s[15];return o[0]=(s[0]*h+s[4]*p+s[8]*x+s[12])/(w=w||1),o[1]=(s[1]*h+s[5]*p+s[9]*x+s[13])/w,o[2]=(s[2]*h+s[6]*p+s[10]*x+s[14])/w,o},g.c7=class extends qh{},g.c8=class extends k{},g.c9=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]&&o[4]===r[4]&&o[5]===r[5]&&o[6]===r[6]&&o[7]===r[7]&&o[8]===r[8]&&o[9]===r[9]&&o[10]===r[10]&&o[11]===r[11]&&o[12]===r[12]&&o[13]===r[13]&&o[14]===r[14]&&o[15]===r[15]},g.cA=function(o,r){Y.REGISTERED_PROTOCOLS[o]=r},g.cB=function(o){delete Y.REGISTERED_PROTOCOLS[o]},g.cC=function(o,r){const s={};for(let p=0;p<o.length;p++){const x=r&&r[o[p].id]||bc(o[p]);r&&(r[o[p].id]=x);let w=s[x];w||(w=s[x]=[]),w.push(o[p])}const h=[];for(const p in s)h.push(s[p]);return h},g.cD=yt,g.cE=_1,g.cF=v1,g.cG=Xw,g.cH=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=Oe/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const r=o.bucket.layers[0],s=r.layout,h=r._unevaluatedLayout._values,p={layoutIconSize:h["icon-size"].possiblyEvaluate(new Dn(o.bucket.zoom+1),o.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Dn(o.bucket.zoom+1),o.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Dn(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:R}=o.bucket.textSizeData;p.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Dn(M),o.canonical),h["text-size"].possiblyEvaluate(new Dn(R),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:R}=o.bucket.iconSizeData;p.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Dn(M),o.canonical),h["icon-size"].possiblyEvaluate(new Dn(R),o.canonical)]}const x=s.get("text-line-height")*Qr,w=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",S=s.get("text-keep-upright"),E=s.get("text-size");for(const M of o.bucket.features){const R=s.get("text-font").evaluate(M,{},o.canonical).join(","),j=E.evaluate(M,{},o.canonical),V=p.layoutTextSize.evaluate(M,{},o.canonical),G=p.layoutIconSize.evaluate(M,{},o.canonical),H={horizontal:{},vertical:void 0},ee=M.text;let le,me=[0,0];if(ee){const Pe=ee.toString(),Ve=s.get("text-letter-spacing").evaluate(M,{},o.canonical)*Qr,Xe=Cm(Pe)?Ve:0,rt=s.get("text-anchor").evaluate(M,{},o.canonical),gt=M1(r,M,o.canonical);if(!gt){const dt=s.get("text-radial-offset").evaluate(M,{},o.canonical);me=dt?k1(rt,[dt*Qr,Wy]):s.get("text-offset").evaluate(M,{},o.canonical).map(pt=>pt*Qr)}let lt=w?"center":s.get("text-justify").evaluate(M,{},o.canonical);const ft=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(M,{},o.canonical)*Qr:1/0,At=()=>{o.bucket.allowVerticalPlacement&&Fh(Pe)&&(H.vertical=Wm(ee,o.glyphMap,o.glyphPositions,o.imagePositions,R,ft,x,rt,"left",Xe,me,g.ao.vertical,!0,V,j))};if(!w&&gt){const dt=new Set;if(lt==="auto")for(let Qe=0;Qe<gt.values.length;Qe+=2)dt.add(Hy(gt.values[Qe]));else dt.add(lt);let pt=!1;for(const Qe of dt)if(!H.horizontal[Qe])if(pt)H.horizontal[Qe]=H.horizontal[0];else{const Ot=Wm(ee,o.glyphMap,o.glyphPositions,o.imagePositions,R,ft,x,"center",Qe,Xe,me,g.ao.horizontal,!1,V,j);Ot&&(H.horizontal[Qe]=Ot,pt=Ot.positionedLines.length===1)}At()}else{lt==="auto"&&(lt=Hy(rt));const dt=Wm(ee,o.glyphMap,o.glyphPositions,o.imagePositions,R,ft,x,rt,lt,Xe,me,g.ao.horizontal,!1,V,j);dt&&(H.horizontal[lt]=dt),At(),Fh(Pe)&&w&&S&&(H.vertical=Wm(ee,o.glyphMap,o.glyphPositions,o.imagePositions,R,ft,x,rt,lt,Xe,me,g.ao.vertical,!1,V,j))}}let Re=!1;if(M.icon&&M.icon.name){const Pe=o.imageMap[M.icon.name];Pe&&(le=gA(o.imagePositions[M.icon.name],s.get("icon-offset").evaluate(M,{},o.canonical),s.get("icon-anchor").evaluate(M,{},o.canonical)),Re=!!Pe.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=Re:o.bucket.sdfIcons!==Re&&$n("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==o.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const be=R1(H.horizontal)||H.vertical;o.bucket.iconsInText=!!be&&be.iconsInText,(be||le)&&MA(o.bucket,M,H,le,o.imageMap,p,V,G,me,Re,o.canonical,o.subdivisionGranularity)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},g.cI=My,g.cJ=Ry,g.cK=Ly,g.cL=Nw,g.cM=Dy,g.cN=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},g.cO=function(o,r,s,h,p){return c(this,void 0,void 0,function*(){if(re())try{return yield Ai(o,r,s,h,p)}catch{}return function(x,w,S,E,M){const R=x.width,j=x.height;Gi&&xi||(Gi=new OffscreenCanvas(R,j),xi=Gi.getContext("2d",{willReadFrequently:!0})),Gi.width=R,Gi.height=j,xi.drawImage(x,0,0,R,j);const V=xi.getImageData(w,S,E,M);return xi.clearRect(0,0,R,j),V.data}(o,r,s,h,p)})},g.cP=Sw,g.cQ=N,g.cR=Dw,g.cS=td,g.cT=u,g.cU=function(o,r){const s=new Map;if(o!=null)if(o.type==="Feature")s.set($f(o,r),o);else for(const h of o.features)s.set($f(h,r),h);return s},g.cV=function(o,r){if(o==null)return!0;if(o.type==="Feature")return $f(o,r)!=null;if(o.type==="FeatureCollection"){const s=new Set;for(const h of o.features){const p=$f(h,r);if(p==null||s.has(p))return!1;s.add(p)}return!0}return!1},g.cW=function(o,r,s){var h,p,x,w;if(r.removeAll&&o.clear(),r.remove)for(const S of r.remove)o.delete(S);if(r.add)for(const S of r.add){const E=$f(S,s);E!=null&&o.set(E,S)}if(r.update)for(const S of r.update){let E=o.get(S.id);if(E==null)continue;const M=!S.removeAllProperties&&(((h=S.removeProperties)===null||h===void 0?void 0:h.length)>0||((p=S.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0);if((S.newGeometry||S.removeAllProperties||M)&&(E=Object.assign({},E),o.set(S.id,E),M&&(E.properties=Object.assign({},E.properties))),S.newGeometry&&(E.geometry=S.newGeometry),S.removeAllProperties)E.properties={};else if(((x=S.removeProperties)===null||x===void 0?void 0:x.length)>0)for(const R of S.removeProperties)Object.prototype.hasOwnProperty.call(E.properties,R)&&delete E.properties[R];if(((w=S.addOrUpdateProperties)===null||w===void 0?void 0:w.length)>0)for(const{key:R,value:j}of S.addOrUpdateProperties)E.properties[R]=j}},g.cX=Ya,g.ca=function(o,r){var s=o[0],h=o[1],p=o[2],x=o[3],w=o[4],S=o[5],E=o[6],M=o[7],R=o[8],j=o[9],V=o[10],G=o[11],H=o[12],ee=o[13],le=o[14],me=o[15],Re=r[0],be=r[1],Pe=r[2],Ve=r[3],Xe=r[4],rt=r[5],gt=r[6],lt=r[7],ft=r[8],At=r[9],dt=r[10],pt=r[11],Qe=r[12],Ot=r[13],Gt=r[14],zt=r[15];return Math.abs(s-Re)<=$*Math.max(1,Math.abs(s),Math.abs(Re))&&Math.abs(h-be)<=$*Math.max(1,Math.abs(h),Math.abs(be))&&Math.abs(p-Pe)<=$*Math.max(1,Math.abs(p),Math.abs(Pe))&&Math.abs(x-Ve)<=$*Math.max(1,Math.abs(x),Math.abs(Ve))&&Math.abs(w-Xe)<=$*Math.max(1,Math.abs(w),Math.abs(Xe))&&Math.abs(S-rt)<=$*Math.max(1,Math.abs(S),Math.abs(rt))&&Math.abs(E-gt)<=$*Math.max(1,Math.abs(E),Math.abs(gt))&&Math.abs(M-lt)<=$*Math.max(1,Math.abs(M),Math.abs(lt))&&Math.abs(R-ft)<=$*Math.max(1,Math.abs(R),Math.abs(ft))&&Math.abs(j-At)<=$*Math.max(1,Math.abs(j),Math.abs(At))&&Math.abs(V-dt)<=$*Math.max(1,Math.abs(V),Math.abs(dt))&&Math.abs(G-pt)<=$*Math.max(1,Math.abs(G),Math.abs(pt))&&Math.abs(H-Qe)<=$*Math.max(1,Math.abs(H),Math.abs(Qe))&&Math.abs(ee-Ot)<=$*Math.max(1,Math.abs(ee),Math.abs(Ot))&&Math.abs(le-Gt)<=$*Math.max(1,Math.abs(le),Math.abs(Gt))&&Math.abs(me-zt)<=$*Math.max(1,Math.abs(me),Math.abs(zt))},g.cb=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o},g.cc=o=>o.type==="symbol",g.cd=o=>o.type==="circle",g.ce=o=>o.type==="heatmap",g.cf=o=>o.type==="line",g.cg=o=>o.type==="fill",g.ch=o=>o.type==="fill-extrusion",g.ci=o=>o.type==="hillshade",g.cj=o=>o.type==="color-relief",g.ck=o=>o.type==="background",g.cl=o=>o.type==="custom",g.cm=Ft,g.cn=function(o,r,s){const h=Ne(r.x-s.x,r.y-s.y),p=Ne(o.x-s.x,o.y-s.y);var x,w;return Hn(Math.atan2(h[0]*p[1]-h[1]*p[0],(x=h)[0]*(w=p)[0]+x[1]*w[1]))},g.co=Ut,g.cp=function(o,r){return Kn[r]&&(o instanceof MouseEvent||o instanceof WheelEvent)},g.cq=function(o,r){return br[r]&&"touches"in o},g.cr=function(o){return br[o]||Kn[o]},g.cs=function(o,r,s){var h=r[0],p=r[1];return o[0]=s[0]*h+s[4]*p+s[12],o[1]=s[1]*h+s[5]*p+s[13],o},g.ct=function(o,r){const{x:s,y:h}=Vf.fromLngLat(r);return!(o<0||o>25||h<0||h>=1||s<0||s>=1)},g.cu=function(o,r){return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},g.cv=class extends Mc{},g.cw=RA,g.cy=function(o){return o.message===Ce},g.cz=we,g.d=ke,g.e=Vn,g.f=o=>c(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(r)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),g.g=ae,g.h=o=>new Promise((r,s)=>{const h=new Image;h.onload=()=>{r(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=dr})},h.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(o)],{type:"image/png"});h.src=o.byteLength?URL.createObjectURL(p):dr}),g.i=Dr,g.j=(o,r)=>je(Vn(o,{type:"json"}),r),g.k=bt,g.l=Ye,g.m=je,g.n=(o,r)=>je(Vn(o,{type:"arrayBuffer"}),r),g.o=function(o){return new Dy(o).readFields(sA,[])},g.p=Kw,g.q=Af,g.r=Bi,g.s=Ss,g.t=vf,g.u=un,g.v=De,g.w=$n,g.x=py,g.y=Pm,g.z=Xa}),f("worker",["./shared"],function(g){class c{constructor(X,Y){this.keyCache={},X&&this.replace(X,Y)}replace(X,Y){this._layerConfigs={},this._layers={},this.update(X,[],Y)}update(X,Y,ae){for(const we of X){this._layerConfigs[we.id]=we;const Me=this._layers[we.id]=g.bJ(we,ae);Me._featureFilter=g.aa(Me.filter,ae),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of Y)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ye=g.cC(Object.values(this._layerConfigs),this.keyCache);for(const we of ye){const Me=we.map(bt=>this._layers[bt.id]),je=Me[0];if(je.visibility==="none")continue;const ke=je.source||"";let He=this.familiesBySource[ke];He||(He=this.familiesBySource[ke]={});const et=je.sourceLayer||"_geojsonTileLayer";let Ye=He[et];Ye||(Ye=He[et]=[]),Ye.push(Me)}}}class A{constructor(X){const Y={},ae=[];for(const je in X){const ke=X[je],He=Y[je]={};for(const et in ke){const Ye=ke[+et];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const bt={x:0,y:0,w:Ye.bitmap.width+2,h:Ye.bitmap.height+2};ae.push(bt),He[et]={rect:bt,metrics:Ye.metrics}}}const{w:ye,h:we}=g.p(ae),Me=new g.q({width:ye||1,height:we||1});for(const je in X){const ke=X[je];for(const He in ke){const et=ke[+He];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const Ye=Y[je][He].rect;g.q.copy(et.bitmap,Me,{x:0,y:0},{x:Ye.x+1,y:Ye.y+1},et.bitmap)}}this.image=Me,this.positions=Y}}g.cD("GlyphAtlas",A);class N{constructor(X){this.tileID=new g.Z(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId,this.inFlightDependencies=[]}parse(X,Y,ae,ye,we){return g._(this,void 0,void 0,function*(){this.status="parsing",this.data=X,this.collisionBoxArray=new g.a8;const Me=new g.cE(Object.keys(X.layers).sort()),je=new g.cF(this.tileID,this.promoteId);je.bucketLayerIDs=[];const ke={},He={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ae,subdivisionGranularity:we},et=Y.familiesBySource[this.source];for(const nn in et){const Fe=X.layers[nn];if(!Fe)continue;Fe.version===1&&g.w(`Vector tile source "${this.source}" layer "${nn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const is=Me.encode(nn),bi=[];for(let wi=0;wi<Fe.length;wi++){const fr=Fe.feature(wi),ut=je.getId(fr,nn);bi.push({feature:fr,id:ut,index:wi,sourceLayerIndex:is})}for(const wi of et[nn]){const fr=wi[0];fr.source!==this.source&&g.w(`layer.source = ${fr.source} does not equal this.source = ${this.source}`),fr.minzoom&&this.zoom<Math.floor(fr.minzoom)||fr.maxzoom&&this.zoom>=fr.maxzoom||fr.visibility!=="none"&&(Z(wi,this.zoom,ae),(ke[fr.id]=fr.createBucket({index:je.bucketLayerIDs.length,layers:wi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:is,sourceID:this.source})).populate(bi,He,this.tileID.canonical),je.bucketLayerIDs.push(wi.map(ut=>ut.id)))}}const Ye=g.bO(He.glyphDependencies,nn=>Object.keys(nn).map(Number));this.inFlightDependencies.forEach(nn=>nn==null?void 0:nn.abort()),this.inFlightDependencies=[];let bt=Promise.resolve({});if(Object.keys(Ye).length){const nn=new AbortController;this.inFlightDependencies.push(nn),bt=ye.sendAsync({type:"GG",data:{stacks:Ye,source:this.source,tileID:this.tileID,type:"glyphs"}},nn)}const Ct=Object.keys(He.iconDependencies);let De=Promise.resolve({});if(Ct.length){const nn=new AbortController;this.inFlightDependencies.push(nn),De=ye.sendAsync({type:"GI",data:{icons:Ct,source:this.source,tileID:this.tileID,type:"icons"}},nn)}const Ht=Object.keys(He.patternDependencies);let yn=Promise.resolve({});if(Ht.length){const nn=new AbortController;this.inFlightDependencies.push(nn),yn=ye.sendAsync({type:"GI",data:{icons:Ht,source:this.source,tileID:this.tileID,type:"patterns"}},nn)}const St=He.dashDependencies;let on=Promise.resolve({});if(Object.keys(St).length){const nn=new AbortController;this.inFlightDependencies.push(nn),on=ye.sendAsync({type:"GDA",data:{dashes:St}},nn)}const[ir,Zn,Xn,wr]=yield Promise.all([bt,De,yn,on]),En=new A(ir),Tr=new g.cG(Zn,Xn);for(const nn in ke){const Fe=ke[nn];Fe instanceof g.a9?(Z(Fe.layers,this.zoom,ae),g.cH({bucket:Fe,glyphMap:ir,glyphPositions:En.positions,imageMap:Zn,imagePositions:Tr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:He.subdivisionGranularity})):Fe.hasDependencies&&(Fe instanceof g.cI||Fe instanceof g.cJ||Fe instanceof g.cK)&&(Z(Fe.layers,this.zoom,ae),Fe.addFeatures(He,this.tileID.canonical,Tr.patternPositions,wr))}return this.status="done",{buckets:Object.values(ke).filter(nn=>!nn.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:En.image,imageAtlas:Tr,dashPositions:wr,glyphMap:this.returnDependencies?ir:null,iconMap:this.returnDependencies?Zn:null,glyphPositions:this.returnDependencies?En.positions:null}})}}function Z(Ce,X,Y){const ae=new g.F(X);for(const ye of Ce)ye.recalculate(ae,Y)}class W{constructor(X,Y,ae){this.actor=X,this.layerIndex=Y,this.availableImages=ae,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(X,Y){return g._(this,void 0,void 0,function*(){const ae=yield g.n(X.request,Y);try{return{vectorTile:new g.cL(new g.cM(ae.data)),rawData:ae.data,cacheControl:ae.cacheControl,expires:ae.expires}}catch(ye){const we=new Uint8Array(ae.data);let Me=`Unable to parse the tile at ${X.request.url}, `;throw Me+=we[0]===31&&we[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ye.message}`,new Error(Me)}})}loadTile(X){return g._(this,void 0,void 0,function*(){const Y=X.uid,ae=!!(X&&X.request&&X.request.collectResourceTiming)&&new g.cN(X.request),ye=new N(X);this.loading[Y]=ye;const we=new AbortController;ye.abort=we;try{const Me=yield this.loadVectorTile(X,we);if(delete this.loading[Y],!Me)return null;const je=Me.rawData,ke={};Me.expires&&(ke.expires=Me.expires),Me.cacheControl&&(ke.cacheControl=Me.cacheControl);const He={};if(ae){const Ye=ae.finish();Ye&&(He.resourceTiming=JSON.parse(JSON.stringify(Ye)))}ye.vectorTile=Me.vectorTile;const et=ye.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity);this.loaded[Y]=ye,this.fetching[Y]={rawTileData:je,cacheControl:ke,resourceTiming:He};try{const Ye=yield et;return g.e({rawTileData:je.slice(0)},Ye,ke,He)}finally{delete this.fetching[Y]}}catch(Me){throw delete this.loading[Y],ye.status="done",this.loaded[Y]=ye,Me}})}reloadTile(X){return g._(this,void 0,void 0,function*(){const Y=X.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ae=this.loaded[Y];if(ae.showCollisionBoxes=X.showCollisionBoxes,ae.status==="parsing"){const ye=yield ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity);let we;if(this.fetching[Y]){const{rawTileData:Me,cacheControl:je,resourceTiming:ke}=this.fetching[Y];delete this.fetching[Y],we=g.e({rawTileData:Me.slice(0)},ye,je,ke)}else we=ye;return we}if(ae.status==="done"&&ae.vectorTile)return ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity)})}abortTile(X){return g._(this,void 0,void 0,function*(){const Y=this.loading,ae=X.uid;Y&&Y[ae]&&Y[ae].abort&&(Y[ae].abort.abort(),delete Y[ae])})}removeTile(X){return g._(this,void 0,void 0,function*(){this.loaded&&this.loaded[X.uid]&&delete this.loaded[X.uid]})}}class K{constructor(){this.loaded={}}loadTile(X){return g._(this,void 0,void 0,function*(){const{uid:Y,encoding:ae,rawImageData:ye,redFactor:we,greenFactor:Me,blueFactor:je,baseShift:ke}=X,He=ye.width+2,et=ye.height+2,Ye=g.b(ye)?new g.R({width:He,height:et},yield g.cO(ye,-1,-1,He,et)):ye,bt=new g.cP(Y,Ye,ae,we,Me,je,ke);return this.loaded=this.loaded||{},this.loaded[Y]=bt,bt})}removeTile(X){const Y=this.loaded,ae=X.uid;Y&&Y[ae]&&delete Y[ae]}}var J,ce,ie=function(){if(ce)return J;function Ce(Y,ae){if(Y.length!==0){X(Y[0],ae);for(var ye=1;ye<Y.length;ye++)X(Y[ye],!ae)}}function X(Y,ae){for(var ye=0,we=0,Me=0,je=Y.length,ke=je-1;Me<je;ke=Me++){var He=(Y[Me][0]-Y[ke][0])*(Y[ke][1]+Y[Me][1]),et=ye+He;we+=Math.abs(ye)>=Math.abs(He)?ye-et+He:He-et+ye,ye=et}ye+we>=0!=!!ae&&Y.reverse()}return ce=1,J=function Y(ae,ye){var we,Me=ae&&ae.type;if(Me==="FeatureCollection")for(we=0;we<ae.features.length;we++)Y(ae.features[we],ye);else if(Me==="GeometryCollection")for(we=0;we<ae.geometries.length;we++)Y(ae.geometries[we],ye);else if(Me==="Feature")Y(ae.geometry,ye);else if(Me==="Polygon")Ce(ae.coordinates,ye);else if(Me==="MultiPolygon")for(we=0;we<ae.coordinates.length;we++)Ce(ae.coordinates[we],ye);return ae}}(),oe=g.cQ(ie);class re extends g.cS{constructor(X,Y){super(new g.cM,0,Y,[],[]),this.feature=X,this.type=X.type,this.properties=X.tags?X.tags:{},"id"in X&&(typeof X.id=="string"?this.id=parseInt(X.id,10):typeof X.id!="number"||isNaN(X.id)||(this.id=X.id))}loadGeometry(){const X=[],Y=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const ae of Y){const ye=[];for(const we of ae)ye.push(new g.P(we[0],we[1]));X.push(ye)}return X}}class $ extends g.cR{constructor(X,Y){super(new g.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=Y?Y.version:1,this.extent=Y?Y.extent:4096,this.length=X.length,this.features=X}feature(X){return new re(this.features[X],this.extent)}}function te(Ce,X){X.writeVarintField(15,Ce.version||1),X.writeStringField(1,Ce.name||""),X.writeVarintField(5,Ce.extent||4096);const Y={keys:[],values:[],keycache:{},valuecache:{}};for(let we=0;we<Ce.length;we++)Y.feature=Ce.feature(we),X.writeMessage(2,fe,Y);const ae=Y.keys;for(const we of ae)X.writeStringField(3,we);const ye=Y.values;for(const we of ye)X.writeMessage(4,xt,we)}function fe(Ce,X){if(!Ce.feature)return;const Y=Ce.feature;Y.id!==void 0&&X.writeVarintField(1,Y.id),X.writeMessage(2,pe,Ce),X.writeVarintField(3,Y.type),X.writeMessage(4,Le,Y)}function pe(Ce,X){var Y;for(const ae in(Y=Ce.feature)==null?void 0:Y.properties){let ye=Ce.feature.properties[ae],we=Ce.keycache[ae];if(ye===null)continue;we===void 0&&(Ce.keys.push(ae),we=Ce.keys.length-1,Ce.keycache[ae]=we),X.writeVarint(we),typeof ye!="string"&&typeof ye!="boolean"&&typeof ye!="number"&&(ye=JSON.stringify(ye));const Me=typeof ye+":"+ye;let je=Ce.valuecache[Me];je===void 0&&(Ce.values.push(ye),je=Ce.values.length-1,Ce.valuecache[Me]=je),X.writeVarint(je)}}function Ie(Ce,X){return(X<<3)+(7&Ce)}function Ge(Ce){return Ce<<1^Ce>>31}function Le(Ce,X){const Y=Ce.loadGeometry(),ae=Ce.type;let ye=0,we=0;for(const Me of Y){let je=1;ae===1&&(je=Me.length),X.writeVarint(Ie(1,je));const ke=ae===3?Me.length-1:Me.length;for(let He=0;He<ke;He++){He===1&&ae!==1&&X.writeVarint(Ie(2,ke-1));const et=Me[He].x-ye,Ye=Me[He].y-we;X.writeVarint(Ge(et)),X.writeVarint(Ge(Ye)),ye+=et,we+=Ye}Ce.type===3&&X.writeVarint(Ie(7,1))}}function xt(Ce,X){const Y=typeof Ce;Y==="string"?X.writeStringField(1,Ce):Y==="boolean"?X.writeBooleanField(7,Ce):Y==="number"&&(Ce%1!=0?X.writeDoubleField(3,Ce):Ce<0?X.writeSVarintField(6,Ce):X.writeVarintField(5,Ce))}const ct={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},ht=Math.fround||(ze=new Float32Array(1),Ce=>(ze[0]=+Ce,ze[0]));var ze;class vt{constructor(X){this.options=Object.assign(Object.create(ct),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:Y,minZoom:ae,maxZoom:ye}=this.options;Y&&console.time("total time");const we=`prepare ${X.length} points`;Y&&console.time(we),this.points=X;const Me=[];for(let ke=0;ke<X.length;ke++){const He=X[ke];if(!He.geometry)continue;const[et,Ye]=He.geometry.coordinates,bt=ht(wt(et)),Ct=ht(jt(Ye));Me.push(bt,Ct,1/0,ke,-1,1),this.options.reduce&&Me.push(0)}let je=this.trees[ye+1]=this._createTree(Me);Y&&console.timeEnd(we);for(let ke=ye;ke>=ae;ke--){const He=+Date.now();je=this.trees[ke]=this._createTree(this._cluster(je,ke)),Y&&console.log("z%d: %d clusters in %dms",ke,je.numItems,+Date.now()-He)}return Y&&console.timeEnd("total time"),this}getClusters(X,Y){let ae=((X[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,X[1]));let we=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)ae=-180,we=180;else if(ae>we){const Ye=this.getClusters([ae,ye,180,Me],Y),bt=this.getClusters([-180,ye,we,Me],Y);return Ye.concat(bt)}const je=this.trees[this._limitZoom(Y)],ke=je.range(wt(ae),jt(Me),wt(we),jt(ye)),He=je.data,et=[];for(const Ye of ke){const bt=this.stride*Ye;et.push(He[bt+5]>1?at(He,bt,this.clusterProps):this.points[He[bt+3]])}return et}getChildren(X){const Y=this._getOriginId(X),ae=this._getOriginZoom(X),ye="No cluster with the specified id.",we=this.trees[ae];if(!we)throw new Error(ye);const Me=we.data;if(Y*this.stride>=Me.length)throw new Error(ye);const je=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),ke=we.within(Me[Y*this.stride],Me[Y*this.stride+1],je),He=[];for(const et of ke){const Ye=et*this.stride;Me[Ye+4]===X&&He.push(Me[Ye+5]>1?at(Me,Ye,this.clusterProps):this.points[Me[Ye+3]])}if(He.length===0)throw new Error(ye);return He}getLeaves(X,Y,ae){const ye=[];return this._appendLeaves(ye,X,Y=Y||10,ae=ae||0,0),ye}getTile(X,Y,ae){const ye=this.trees[this._limitZoom(X)],we=Math.pow(2,X),{extent:Me,radius:je}=this.options,ke=je/Me,He=(ae-ke)/we,et=(ae+1+ke)/we,Ye={features:[]};return this._addTileFeatures(ye.range((Y-ke)/we,He,(Y+1+ke)/we,et),ye.data,Y,ae,we,Ye),Y===0&&this._addTileFeatures(ye.range(1-ke/we,He,1,et),ye.data,we,ae,we,Ye),Y===we-1&&this._addTileFeatures(ye.range(0,He,ke/we,et),ye.data,-1,ae,we,Ye),Ye.features.length?Ye:null}getClusterExpansionZoom(X){let Y=this._getOriginZoom(X)-1;for(;Y<=this.options.maxZoom;){const ae=this.getChildren(X);if(Y++,ae.length!==1)break;X=ae[0].properties.cluster_id}return Y}_appendLeaves(X,Y,ae,ye,we){const Me=this.getChildren(Y);for(const je of Me){const ke=je.properties;if(ke&&ke.cluster?we+ke.point_count<=ye?we+=ke.point_count:we=this._appendLeaves(X,ke.cluster_id,ae,ye,we):we<ye?we++:X.push(je),X.length===ae)break}return we}_createTree(X){const Y=new g.aI(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<X.length;ae+=this.stride)Y.add(X[ae],X[ae+1]);return Y.finish(),Y.data=X,Y}_addTileFeatures(X,Y,ae,ye,we,Me){for(const je of X){const ke=je*this.stride,He=Y[ke+5]>1;let et,Ye,bt;if(He)et=Mt(Y,ke,this.clusterProps),Ye=Y[ke],bt=Y[ke+1];else{const Ht=this.points[Y[ke+3]];et=Ht.properties;const[yn,St]=Ht.geometry.coordinates;Ye=wt(yn),bt=jt(St)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(Ye*we-ae)),Math.round(this.options.extent*(bt*we-ye))]],tags:et};let De;De=He||this.options.generateId?Y[ke+3]:this.points[Y[ke+3]].id,De!==void 0&&(Ct.id=De),Me.features.push(Ct)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,Y){const{radius:ae,extent:ye,reduce:we,minPoints:Me}=this.options,je=ae/(ye*Math.pow(2,Y)),ke=X.data,He=[],et=this.stride;for(let Ye=0;Ye<ke.length;Ye+=et){if(ke[Ye+2]<=Y)continue;ke[Ye+2]=Y;const bt=ke[Ye],Ct=ke[Ye+1],De=X.within(ke[Ye],ke[Ye+1],je),Ht=ke[Ye+5];let yn=Ht;for(const St of De){const on=St*et;ke[on+2]>Y&&(yn+=ke[on+5])}if(yn>Ht&&yn>=Me){let St,on=bt*Ht,ir=Ct*Ht,Zn=-1;const Xn=(Ye/et<<5)+(Y+1)+this.points.length;for(const wr of De){const En=wr*et;if(ke[En+2]<=Y)continue;ke[En+2]=Y;const Tr=ke[En+5];on+=ke[En]*Tr,ir+=ke[En+1]*Tr,ke[En+4]=Xn,we&&(St||(St=this._map(ke,Ye,!0),Zn=this.clusterProps.length,this.clusterProps.push(St)),we(St,this._map(ke,En)))}ke[Ye+4]=Xn,He.push(on/yn,ir/yn,1/0,Xn,-1,yn),we&&He.push(Zn)}else{for(let St=0;St<et;St++)He.push(ke[Ye+St]);if(yn>1)for(const St of De){const on=St*et;if(!(ke[on+2]<=Y)){ke[on+2]=Y;for(let ir=0;ir<et;ir++)He.push(ke[on+ir])}}}}return He}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,Y,ae){if(X[Y+5]>1){const Me=this.clusterProps[X[Y+6]];return ae?Object.assign({},Me):Me}const ye=this.points[X[Y+3]].properties,we=this.options.map(ye);return ae&&we===ye?Object.assign({},we):we}}function at(Ce,X,Y){return{type:"Feature",id:Ce[X+3],properties:Mt(Ce,X,Y),geometry:{type:"Point",coordinates:[(ae=Ce[X],360*(ae-.5)),Ne(Ce[X+1])]}};var ae}function Mt(Ce,X,Y){const ae=Ce[X+5],ye=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,we=Ce[X+6],Me=we===-1?{}:Object.assign({},Y[we]);return Object.assign(Me,{cluster:!0,cluster_id:Ce[X+3],point_count:ae,point_count_abbreviated:ye})}function wt(Ce){return Ce/360+.5}function jt(Ce){const X=Math.sin(Ce*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function Ne(Ce){const X=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function Oe(Ce,X,Y,ae){let ye=ae;const we=X+(Y-X>>1);let Me,je=Y-X;const ke=Ce[X],He=Ce[X+1],et=Ce[Y],Ye=Ce[Y+1];for(let bt=X+3;bt<Y;bt+=3){const Ct=We(Ce[bt],Ce[bt+1],ke,He,et,Ye);if(Ct>ye)Me=bt,ye=Ct;else if(Ct===ye){const De=Math.abs(bt-we);De<je&&(Me=bt,je=De)}}ye>ae&&(Me-X>3&&Oe(Ce,X,Me,ae),Ce[Me+2]=ye,Y-Me>3&&Oe(Ce,Me,Y,ae))}function We(Ce,X,Y,ae,ye,we){let Me=ye-Y,je=we-ae;if(Me!==0||je!==0){const ke=((Ce-Y)*Me+(X-ae)*je)/(Me*Me+je*je);ke>1?(Y=ye,ae=we):ke>0&&(Y+=Me*ke,ae+=je*ke)}return Me=Ce-Y,je=X-ae,Me*Me+je*je}function nt(Ce,X,Y,ae){const ye={id:Ce??null,type:X,geometry:Y,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(X==="Point"||X==="MultiPoint"||X==="LineString")_t(ye,Y);else if(X==="Polygon")_t(ye,Y[0]);else if(X==="MultiLineString")for(const we of Y)_t(ye,we);else if(X==="MultiPolygon")for(const we of Y)_t(ye,we[0]);return ye}function _t(Ce,X){for(let Y=0;Y<X.length;Y+=3)Ce.minX=Math.min(Ce.minX,X[Y]),Ce.minY=Math.min(Ce.minY,X[Y+1]),Ce.maxX=Math.max(Ce.maxX,X[Y]),Ce.maxY=Math.max(Ce.maxY,X[Y+1])}function Bt(Ce,X,Y,ae){if(!X.geometry)return;const ye=X.geometry.coordinates;if(ye&&ye.length===0)return;const we=X.geometry.type,Me=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let je=[],ke=X.id;if(Y.promoteId?ke=X.properties[Y.promoteId]:Y.generateId&&(ke=ae||0),we==="Point")Ft(ye,je);else if(we==="MultiPoint")for(const He of ye)Ft(He,je);else if(we==="LineString")Ut(ye,je,Me,!1);else if(we==="MultiLineString"){if(Y.lineMetrics){for(const He of ye)je=[],Ut(He,je,Me,!1),Ce.push(nt(ke,"LineString",je,X.properties));return}Pt(ye,je,Me,!1)}else if(we==="Polygon")Pt(ye,je,Me,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const He of X.geometry.geometries)Bt(Ce,{id:ke,geometry:He,properties:X.properties},Y,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of ye){const et=[];Pt(He,et,Me,!0),je.push(et)}}Ce.push(nt(ke,we,je,X.properties))}function Ft(Ce,X){X.push(Un(Ce[0]),Vn(Ce[1]),0)}function Ut(Ce,X,Y,ae){let ye,we,Me=0;for(let ke=0;ke<Ce.length;ke++){const He=Un(Ce[ke][0]),et=Vn(Ce[ke][1]);X.push(He,et,0),ke>0&&(Me+=ae?(ye*et-He*we)/2:Math.sqrt(Math.pow(He-ye,2)+Math.pow(et-we,2))),ye=He,we=et}const je=X.length-3;X[2]=1,Oe(X,0,je,Y),X[je+2]=1,X.size=Math.abs(Me),X.start=0,X.end=X.size}function Pt(Ce,X,Y,ae){for(let ye=0;ye<Ce.length;ye++){const we=[];Ut(Ce[ye],we,Y,ae),X.push(we)}}function Un(Ce){return Ce/360+.5}function Vn(Ce){const X=Math.sin(Ce*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function yi(Ce,X,Y,ae,ye,we,Me,je){if(ae/=X,we>=(Y/=X)&&Me<ae)return Ce;if(Me<Y||we>=ae)return null;const ke=[];for(const He of Ce){const et=He.geometry;let Ye=He.type;const bt=ye===0?He.minX:He.minY,Ct=ye===0?He.maxX:He.maxY;if(bt>=Y&&Ct<ae){ke.push(He);continue}if(Ct<Y||bt>=ae)continue;let De=[];if(Ye==="Point"||Ye==="MultiPoint")ws(et,De,Y,ae,ye);else if(Ye==="LineString")Ts(et,De,Y,ae,ye,!1,je.lineMetrics);else if(Ye==="MultiLineString")In(et,De,Y,ae,ye,!1);else if(Ye==="Polygon")In(et,De,Y,ae,ye,!0);else if(Ye==="MultiPolygon")for(const Ht of et){const yn=[];In(Ht,yn,Y,ae,ye,!0),yn.length&&De.push(yn)}if(De.length){if(je.lineMetrics&&Ye==="LineString"){for(const Ht of De)ke.push(nt(He.id,Ye,Ht,He.tags));continue}Ye!=="LineString"&&Ye!=="MultiLineString"||(De.length===1?(Ye="LineString",De=De[0]):Ye="MultiLineString"),Ye!=="Point"&&Ye!=="MultiPoint"||(Ye=De.length===3?"Point":"MultiPoint"),ke.push(nt(He.id,Ye,De,He.tags))}}return ke.length?ke:null}function ws(Ce,X,Y,ae,ye){for(let we=0;we<Ce.length;we+=3){const Me=Ce[we+ye];Me>=Y&&Me<=ae&&$n(X,Ce[we],Ce[we+1],Ce[we+2])}}function Ts(Ce,X,Y,ae,ye,we,Me){let je=xr(Ce);const ke=ye===0?vi:Dr;let He,et,Ye=Ce.start;for(let yn=0;yn<Ce.length-3;yn+=3){const St=Ce[yn],on=Ce[yn+1],ir=Ce[yn+2],Zn=Ce[yn+3],Xn=Ce[yn+4],wr=ye===0?St:on,En=ye===0?Zn:Xn;let Tr=!1;Me&&(He=Math.sqrt(Math.pow(St-Zn,2)+Math.pow(on-Xn,2))),wr<Y?En>Y&&(et=ke(je,St,on,Zn,Xn,Y),Me&&(je.start=Ye+He*et)):wr>ae?En<ae&&(et=ke(je,St,on,Zn,Xn,ae),Me&&(je.start=Ye+He*et)):$n(je,St,on,ir),En<Y&&wr>=Y&&(et=ke(je,St,on,Zn,Xn,Y),Tr=!0),En>ae&&wr<=ae&&(et=ke(je,St,on,Zn,Xn,ae),Tr=!0),!we&&Tr&&(Me&&(je.end=Ye+He*et),X.push(je),je=xr(Ce)),Me&&(Ye+=He)}let bt=Ce.length-3;const Ct=Ce[bt],De=Ce[bt+1],Ht=ye===0?Ct:De;Ht>=Y&&Ht<=ae&&$n(je,Ct,De,Ce[bt+2]),bt=je.length-3,we&&bt>=3&&(je[bt]!==je[0]||je[bt+1]!==je[1])&&$n(je,je[0],je[1],je[2]),je.length&&X.push(je)}function xr(Ce){const X=[];return X.size=Ce.size,X.start=Ce.start,X.end=Ce.end,X}function In(Ce,X,Y,ae,ye,we){for(const Me of Ce)Ts(Me,X,Y,ae,ye,we,!1)}function $n(Ce,X,Y,ae){Ce.push(X,Y,ae)}function vi(Ce,X,Y,ae,ye,we){const Me=(we-X)/(ae-X);return $n(Ce,we,Y+(ye-Y)*Me,1),Me}function Dr(Ce,X,Y,ae,ye,we){const Me=(we-Y)/(ye-Y);return $n(Ce,X+(ae-X)*Me,we,1),Me}function Vt(Ce,X){const Y=[];for(let ae=0;ae<Ce.length;ae++){const ye=Ce[ae],we=ye.type;let Me;if(we==="Point"||we==="MultiPoint"||we==="LineString")Me=_n(ye.geometry,X);else if(we==="MultiLineString"||we==="Polygon"){Me=[];for(const je of ye.geometry)Me.push(_n(je,X))}else if(we==="MultiPolygon"){Me=[];for(const je of ye.geometry){const ke=[];for(const He of je)ke.push(_n(He,X));Me.push(ke)}}Y.push(nt(ye.id,we,Me,ye.tags))}return Y}function _n(Ce,X){const Y=[];Y.size=Ce.size,Ce.start!==void 0&&(Y.start=Ce.start,Y.end=Ce.end);for(let ae=0;ae<Ce.length;ae+=3)Y.push(Ce[ae]+X,Ce[ae+1],Ce[ae+2]);return Y}function mn(Ce,X){if(Ce.transformed)return Ce;const Y=1<<Ce.z,ae=Ce.x,ye=Ce.y;for(const we of Ce.features){const Me=we.geometry,je=we.type;if(we.geometry=[],je===1)for(let ke=0;ke<Me.length;ke+=2)we.geometry.push(dr(Me[ke],Me[ke+1],X,Y,ae,ye));else for(let ke=0;ke<Me.length;ke++){const He=[];for(let et=0;et<Me[ke].length;et+=2)He.push(dr(Me[ke][et],Me[ke][et+1],X,Y,ae,ye));we.geometry.push(He)}}return Ce.transformed=!0,Ce}function dr(Ce,X,Y,ae,ye,we){return[Math.round(Y*(Ce*ae-ye)),Math.round(Y*(X*ae-we))]}function Ai(Ce,X,Y,ae,ye){const we=X===ye.maxZoom?0:ye.tolerance/((1<<X)*ye.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:Ce.length,source:null,x:Y,y:ae,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const je of Ce)Gi(Me,je,we,ye);return Me}function Gi(Ce,X,Y,ae){const ye=X.geometry,we=X.type,Me=[];if(Ce.minX=Math.min(Ce.minX,X.minX),Ce.minY=Math.min(Ce.minY,X.minY),Ce.maxX=Math.max(Ce.maxX,X.maxX),Ce.maxY=Math.max(Ce.maxY,X.maxY),we==="Point"||we==="MultiPoint")for(let je=0;je<ye.length;je+=3)Me.push(ye[je],ye[je+1]),Ce.numPoints++,Ce.numSimplified++;else if(we==="LineString")xi(Me,ye,Ce,Y,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let je=0;je<ye.length;je++)xi(Me,ye[je],Ce,Y,we==="Polygon",je===0);else if(we==="MultiPolygon")for(let je=0;je<ye.length;je++){const ke=ye[je];for(let He=0;He<ke.length;He++)xi(Me,ke[He],Ce,Y,!0,He===0)}if(Me.length){let je=X.tags||null;if(we==="LineString"&&ae.lineMetrics){je={};for(const He in X.tags)je[He]=X.tags[He];je.mapbox_clip_start=ye.start/ye.size,je.mapbox_clip_end=ye.end/ye.size}const ke={geometry:Me,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:je};X.id!==null&&(ke.id=X.id),Ce.features.push(ke)}}function xi(Ce,X,Y,ae,ye,we){const Me=ae*ae;if(ae>0&&X.size<(ye?Me:ae))return void(Y.numPoints+=X.length/3);const je=[];for(let ke=0;ke<X.length;ke+=3)(ae===0||X[ke+2]>Me)&&(Y.numSimplified++,je.push(X[ke],X[ke+1])),Y.numPoints++;ye&&function(ke,He){let et=0;for(let Ye=0,bt=ke.length,Ct=bt-2;Ye<bt;Ct=Ye,Ye+=2)et+=(ke[Ye]-ke[Ct])*(ke[Ye+1]+ke[Ct+1]);if(et>0===He)for(let Ye=0,bt=ke.length;Ye<bt/2;Ye+=2){const Ct=ke[Ye],De=ke[Ye+1];ke[Ye]=ke[bt-2-Ye],ke[Ye+1]=ke[bt-1-Ye],ke[bt-2-Ye]=Ct,ke[bt-1-Ye]=De}}(je,we),Ce.push(je)}const Ss={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class li{constructor(X,Y){const ae=(Y=this.options=function(we,Me){for(const je in Me)we[je]=Me[je];return we}(Object.create(Ss),Y)).debug;if(ae&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let ye=function(we,Me){const je=[];if(we.type==="FeatureCollection")for(let ke=0;ke<we.features.length;ke++)Bt(je,we.features[ke],Me,ke);else Bt(je,we.type==="Feature"?we:{geometry:we},Me);return je}(X,Y);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=function(we,Me){const je=Me.buffer/Me.extent;let ke=we;const He=yi(we,1,-1-je,je,0,-1,2,Me),et=yi(we,1,1-je,2+je,0,-1,2,Me);return(He||et)&&(ke=yi(we,1,-je,1+je,0,-1,2,Me)||[],He&&(ke=Vt(He,1).concat(ke)),et&&(ke=ke.concat(Vt(et,-1)))),ke}(ye,Y),ye.length&&this.splitTile(ye,0,0,0),ae&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(X,Y,ae,ye,we,Me,je){const ke=[X,Y,ae,ye],He=this.options,et=He.debug;for(;ke.length;){ye=ke.pop(),ae=ke.pop(),Y=ke.pop(),X=ke.pop();const Ye=1<<Y,bt=Hn(Y,ae,ye);let Ct=this.tiles[bt];if(!Ct&&(et>1&&console.time("creation"),Ct=this.tiles[bt]=Ai(X,Y,ae,ye,He),this.tileCoords.push({z:Y,x:ae,y:ye}),et)){et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,ae,ye,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));const Tr=`z${Y}`;this.stats[Tr]=(this.stats[Tr]||0)+1,this.total++}if(Ct.source=X,we==null){if(Y===He.indexMaxZoom||Ct.numPoints<=He.indexMaxPoints)continue}else{if(Y===He.maxZoom||Y===we)continue;if(we!=null){const Tr=we-Y;if(ae!==Me>>Tr||ye!==je>>Tr)continue}}if(Ct.source=null,X.length===0)continue;et>1&&console.time("clipping");const De=.5*He.buffer/He.extent,Ht=.5-De,yn=.5+De,St=1+De;let on=null,ir=null,Zn=null,Xn=null,wr=yi(X,Ye,ae-De,ae+yn,0,Ct.minX,Ct.maxX,He),En=yi(X,Ye,ae+Ht,ae+St,0,Ct.minX,Ct.maxX,He);X=null,wr&&(on=yi(wr,Ye,ye-De,ye+yn,1,Ct.minY,Ct.maxY,He),ir=yi(wr,Ye,ye+Ht,ye+St,1,Ct.minY,Ct.maxY,He),wr=null),En&&(Zn=yi(En,Ye,ye-De,ye+yn,1,Ct.minY,Ct.maxY,He),Xn=yi(En,Ye,ye+Ht,ye+St,1,Ct.minY,Ct.maxY,He),En=null),et>1&&console.timeEnd("clipping"),ke.push(on||[],Y+1,2*ae,2*ye),ke.push(ir||[],Y+1,2*ae,2*ye+1),ke.push(Zn||[],Y+1,2*ae+1,2*ye),ke.push(Xn||[],Y+1,2*ae+1,2*ye+1)}}getTile(X,Y,ae){X=+X,Y=+Y,ae=+ae;const ye=this.options,{extent:we,debug:Me}=ye;if(X<0||X>24)return null;const je=1<<X,ke=Hn(X,Y=Y+je&je-1,ae);if(this.tiles[ke])return mn(this.tiles[ke],we);Me>1&&console.log("drilling down to z%d-%d-%d",X,Y,ae);let He,et=X,Ye=Y,bt=ae;for(;!He&&et>0;)et--,Ye>>=1,bt>>=1,He=this.tiles[Hn(et,Ye,bt)];return He&&He.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",et,Ye,bt),console.time("drilling down")),this.splitTile(He.source,et,Ye,bt,X,Y,ae),Me>1&&console.timeEnd("drilling down"),this.tiles[ke]?mn(this.tiles[ke],we):null):null}}function Hn(Ce,X,Y){return 32*((1<<Ce)*Y+X)+Ce}class br extends W{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(X,Y){return g._(this,void 0,void 0,function*(){const ae=X.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ye=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!ye)return null;const we=new $(ye.features,{version:2,extent:g.$});let Me=function(je){const ke=new g.cM;return function(He,et){for(const Ye in He.layers)et.writeMessage(3,te,He.layers[Ye])}(je,ke),ke.finish()}(we);return Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),{vectorTile:we,rawData:Me.buffer}})}loadData(X){return g._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const ae=!!(X&&X.request&&X.request.collectResourceTiming)&&new g.cN(X.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(X,this._pendingRequest);const ye=yield this._pendingData;this._geoJSONIndex=X.cluster?new vt(function({superclusterOptions:Me,clusterProperties:je}){if(!je||!Me)return Me;const ke={},He={},et={accumulated:null,zoom:0},Ye={properties:null},bt=Object.keys(je);for(const Ct of bt){const[De,Ht]=je[Ct],yn=g.cT(Ht),St=g.cT(typeof De=="string"?[De,["accumulated"],["get",Ct]]:De);ke[Ct]=yn.value,He[Ct]=St.value}return Me.map=Ct=>{Ye.properties=Ct;const De={};for(const Ht of bt)De[Ht]=ke[Ht].evaluate(et,Ye);return De},Me.reduce=(Ct,De)=>{Ye.properties=De;for(const Ht of bt)et.accumulated=Ct[Ht],Ct[Ht]=He[Ht].evaluate(et,Ye)},Me}(X)).load(ye.features):function(Me,je){return new li(Me,je)}(ye,X.geojsonVtOptions),this.loaded={};const we={data:ye};if(ae){const Me=ae.finish();Me&&(we.resourceTiming={},we.resourceTiming[X.source]=JSON.parse(JSON.stringify(Me)))}return we}catch(ye){if(delete this._pendingRequest,g.cy(ye))return{abandoned:!0};throw ye}})}getData(){return g._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(X){const Y=this.loaded;return Y&&Y[X.uid]?super.reloadTile(X):this.loadTile(X)}loadAndProcessGeoJSON(X,Y){return g._(this,void 0,void 0,function*(){let ae=yield this.loadGeoJSON(X,Y);if(delete this._pendingRequest,typeof ae!="object")throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(oe(ae,!0),X.filter){const ye=g.cT(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));ae={type:"FeatureCollection",features:ae.features.filter(Me=>ye.value.evaluate({zoom:0},Me))}}return ae})}loadGeoJSON(X,Y){return g._(this,void 0,void 0,function*(){const{promoteId:ae}=X;if(X.request){const ye=yield g.j(X.request,Y);return this._dataUpdateable=g.cV(ye.data,ae)?g.cU(ye.data,ae):void 0,ye.data}if(typeof X.data=="string")try{const ye=JSON.parse(X.data);return this._dataUpdateable=g.cV(ye,ae)?g.cU(ye,ae):void 0,ye}catch{throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`)}if(!X.dataDiff)throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${X.source}`);return g.cW(this._dataUpdateable,X.dataDiff,ae),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(X){return g._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(X){return this._geoJSONIndex.getClusterExpansionZoom(X.clusterId)}getClusterChildren(X){return this._geoJSONIndex.getChildren(X.clusterId)}getClusterLeaves(X){return this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset)}}class Kn{constructor(X){this.self=X,this.actor=new g.J(X),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(Y,ae)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=ae},this.self.addProtocol=g.cA,this.self.removeProtocol=g.cB,this.self.registerRTLTextPlugin=Y=>{g.cX.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,ae)=>this._getDEMWorkerSource(Y,ae.source).loadTile(ae)),this.actor.registerMessageHandler("RDT",(Y,ae)=>g._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,ae.source).removeTile(ae)})),this.actor.registerMessageHandler("GCEZ",(Y,ae)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ae.type,ae.source).getClusterExpansionZoom(ae)})),this.actor.registerMessageHandler("GCC",(Y,ae)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ae.type,ae.source).getClusterChildren(ae)})),this.actor.registerMessageHandler("GCL",(Y,ae)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ae.type,ae.source).getClusterLeaves(ae)})),this.actor.registerMessageHandler("LD",(Y,ae)=>this._getWorkerSource(Y,ae.type,ae.source).loadData(ae)),this.actor.registerMessageHandler("GD",(Y,ae)=>this._getWorkerSource(Y,ae.type,ae.source).getData()),this.actor.registerMessageHandler("LT",(Y,ae)=>this._getWorkerSource(Y,ae.type,ae.source).loadTile(ae)),this.actor.registerMessageHandler("RT",(Y,ae)=>this._getWorkerSource(Y,ae.type,ae.source).reloadTile(ae)),this.actor.registerMessageHandler("AT",(Y,ae)=>this._getWorkerSource(Y,ae.type,ae.source).abortTile(ae)),this.actor.registerMessageHandler("RMT",(Y,ae)=>this._getWorkerSource(Y,ae.type,ae.source).removeTile(ae)),this.actor.registerMessageHandler("RS",(Y,ae)=>g._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][ae.type]||!this.workerSources[Y][ae.type][ae.source])return;const ye=this.workerSources[Y][ae.type][ae.source];delete this.workerSources[Y][ae.type][ae.source],ye.removeSource!==void 0&&ye.removeSource(ae)})),this.actor.registerMessageHandler("RM",Y=>g._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],this.globalStates.delete(Y)})),this.actor.registerMessageHandler("SR",(Y,ae)=>g._(this,void 0,void 0,function*(){this.referrer=ae})),this.actor.registerMessageHandler("SRPS",(Y,ae)=>this._syncRTLPluginState(Y,ae)),this.actor.registerMessageHandler("IS",(Y,ae)=>g._(this,void 0,void 0,function*(){this.self.importScripts(ae)})),this.actor.registerMessageHandler("SI",(Y,ae)=>this._setImages(Y,ae)),this.actor.registerMessageHandler("UL",(Y,ae)=>g._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(ae.layers,ae.removedIds,this._getGlobalState(Y))})),this.actor.registerMessageHandler("UGS",(Y,ae)=>g._(this,void 0,void 0,function*(){const ye=this._getGlobalState(Y);for(const we in ae)ye[we]=ae[we]})),this.actor.registerMessageHandler("SL",(Y,ae)=>g._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(ae,this._getGlobalState(Y))}))}_getGlobalState(X){let Y=this.globalStates.get(X);return Y||(Y={},this.globalStates.set(X,Y)),Y}_setImages(X,Y){return g._(this,void 0,void 0,function*(){this.availableImages[X]=Y;for(const ae in this.workerSources[X]){const ye=this.workerSources[X][ae];for(const we in ye)ye[we].availableImages=Y}})}_syncRTLPluginState(X,Y){return g._(this,void 0,void 0,function*(){return yield g.cX.syncState(Y,this.self.importScripts)})}_getAvailableImages(X){let Y=this.availableImages[X];return Y||(Y=[]),Y}_getLayerIndex(X){let Y=this.layerIndexes[X];return Y||(Y=this.layerIndexes[X]=new c),Y}_getWorkerSource(X,Y,ae){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Y]||(this.workerSources[X][Y]={}),!this.workerSources[X][Y][ae]){const ye={sendAsync:(we,Me)=>(we.targetMapId=X,this.actor.sendAsync(we,Me))};switch(Y){case"vector":this.workerSources[X][Y][ae]=new W(ye,this._getLayerIndex(X),this._getAvailableImages(X));break;case"geojson":this.workerSources[X][Y][ae]=new br(ye,this._getLayerIndex(X),this._getAvailableImages(X));break;default:this.workerSources[X][Y][ae]=new this.externalWorkerSourceTypes[Y](ye,this._getLayerIndex(X),this._getAvailableImages(X))}}return this.workerSources[X][Y][ae]}_getDEMWorkerSource(X,Y){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Y]||(this.demWorkerSources[X][Y]=new K),this.demWorkerSources[X][Y]}}return g.i(self)&&(self.worker=new Kn(self)),Kn}),f("index",["exports","./shared"],function(g,c){var A="5.9.0";function N(){var _=new c.A(4);return c.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let Z,W;const K={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_,n,a){const d=requestAnimationFrame(b=>{m(),n(b)}),{unsubscribe:m}=c.s(_.signal,"abort",()=>{m(),cancelAnimationFrame(d),a(c.c())},!1)},frameAsync(_){return new Promise((n,a)=>{this.frame(_,n,a)})},getImageData(_,n=0){return this.getImageCanvasContext(_).getImageData(-n,-n,_.width+2*n,_.height+2*n)},getImageCanvasContext(_){const n=window.document.createElement("canvas"),a=n.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return n.width=_.width,n.height=_.height,a.drawImage(_,0,0,_.width,_.height),a},resolveURL:_=>(Z||(Z=document.createElement("a")),Z.href=_,Z.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(W==null&&(W=matchMedia("(prefers-reduced-motion: reduce)")),W.matches)}};class J{static testProp(n){if(!J.docStyle)return n[0];for(let a=0;a<n.length;a++)if(n[a]in J.docStyle)return n[a];return n[0]}static create(n,a,d){const m=window.document.createElement(n);return a!==void 0&&(m.className=a),d&&d.appendChild(m),m}static createNS(n,a){return window.document.createElementNS(n,a)}static disableDrag(){J.docStyle&&J.selectProp&&(J.userSelect=J.docStyle[J.selectProp],J.docStyle[J.selectProp]="none")}static enableDrag(){J.docStyle&&J.selectProp&&(J.docStyle[J.selectProp]=J.userSelect)}static setTransform(n,a){n.style[J.transformProp]=a}static addEventListener(n,a,d,m={}){n.addEventListener(a,d,"passive"in m?m:m.capture)}static removeEventListener(n,a,d,m={}){n.removeEventListener(a,d,"passive"in m?m:m.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",J.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",J.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",J.suppressClickInternal,!0)},0)}static getScale(n){const a=n.getBoundingClientRect();return{x:a.width/n.offsetWidth||1,y:a.height/n.offsetHeight||1,boundingClientRect:a}}static getPoint(n,a,d){const m=a.boundingClientRect;return new c.P((d.clientX-m.left)/a.x-n.clientLeft,(d.clientY-m.top)/a.y-n.clientTop)}static mousePos(n,a){const d=J.getScale(n);return J.getPoint(n,d,a)}static touchPos(n,a){const d=[],m=J.getScale(n);for(let b=0;b<a.length;b++)d.push(J.getPoint(n,m,a[b]));return d}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}static sanitize(n){const a=new DOMParser().parseFromString(n,"text/html").body||document.createElement("body"),d=a.querySelectorAll("script");for(const m of d)m.remove();return J.clean(a),a.innerHTML}static isPossiblyDangerous(n,a){const d=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(n)||!d.includes("javascript:")&&!d.includes("data:"))||!!n.startsWith("on")||void 0}static clean(n){const a=n.children;for(const d of a)J.removeAttributes(d),J.clean(d)}static removeAttributes(n){for(const{name:a,value:d}of n.attributes)J.isPossiblyDangerous(a,d)&&n.removeAttribute(a)}}J.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,J.selectProp=J.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),J.transformProp=J.testProp(["transform","WebkitTransform"]);const ce={supported:!1,testSupport:function(_){!re&&oe&&($?te(_):ie=_)}};let ie,oe,re=!1,$=!1;function te(_){const n=_.createTexture();_.bindTexture(_.TEXTURE_2D,n);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,oe),_.isContextLost())return;ce.supported=!0}catch{}_.deleteTexture(n),re=!0}var fe;typeof document<"u"&&(oe=document.createElement("img"),oe.onload=()=>{ie&&te(ie),ie=null,$=!0},oe.onerror=()=>{re=!0,ie=null},oe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let n,a,d,m;_.resetRequestQueue=()=>{n=[],a=0,d=0,m={}},_.addThrottleControl=k=>{const D=d++;return m[D]=k,D},_.removeThrottleControl=k=>{delete m[k],T()},_.getImage=(k,D,O=!0)=>new Promise((U,B)=>{ce.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),c.e(k,{type:"image"}),n.push({abortController:D,requestParameters:k,supportImageRefresh:O,state:"queued",onError:q=>{B(q)},onSuccess:q=>{U(q)}}),T()});const b=k=>c._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:D,supportImageRefresh:O,onError:U,onSuccess:B,abortController:q}=k,Q=O===!1&&!c.i(self)&&!c.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((de,ge)=>de&&ge==="accept",!0));a++;const ue=Q?C(D,q):c.m(D,q);try{const de=yield ue;delete k.abortController,k.state="completed",de.data instanceof HTMLImageElement||c.b(de.data)?B(de):de.data&&B({data:yield(he=de.data,typeof createImageBitmap=="function"?c.f(he):c.h(he)),cacheControl:de.cacheControl,expires:de.expires})}catch(de){delete k.abortController,U(de)}finally{a--,T()}var he}),T=()=>{const k=(()=>{for(const D of Object.keys(m))if(m[D]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=a;D<k&&n.length>0;D++){const O=n.shift();O.abortController.signal.aborted?D--:b(O)}},C=(k,D)=>new Promise((O,U)=>{const B=new Image,q=k.url,Q=k.credentials;Q&&Q==="include"?B.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!c.d(q))&&(B.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{B.src="",U(c.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,O({data:B})},B.onerror=()=>{B.onerror=B.onload=null,D.signal.aborted||U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=q})}(fe||(fe={})),fe.resetRequestQueue();class pe{constructor(n){this._transformRequestFn=n??null}transformRequest(n,a){return this._transformRequestFn&&this._transformRequestFn(n,a)||{url:n}}setTransformRequest(n){this._transformRequestFn=n}}function Ie(_){const n=[];if(typeof _=="string")n.push({id:"default",url:_});else if(_&&_.length>0){const a=[];for(const{id:d,url:m}of _){const b=`${d}${m}`;a.indexOf(b)===-1&&(a.push(b),n.push({id:d,url:m}))}}return n}function Ge(_,n,a){try{const d=new URL(_);return d.pathname+=`${n}${a}`,d.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Le(_){const{userImage:n}=_;return!!(n&&n.render&&n.render())&&(_.data.replace(new Uint8Array(n.data.buffer)),!0)}class xt extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:a,promiseResolve:d}of this.requestors)d(this._getImagesForIds(a));this.requestors=[]}}getImage(n){const a=this.images[n];if(a&&!a.data&&a.spriteData){const d=a.spriteData;a.data=new c.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),a.spriteData=null}return a}addImage(n,a){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,a)&&(this.images[n]=a)}_validate(n,a){let d=!0;const m=a.data||a.spriteData;return this._validateStretch(a.stretchX,m&&m.width)||(this.fire(new c.k(new Error(`Image "${n}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,m&&m.height)||(this.fire(new c.k(new Error(`Image "${n}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new c.k(new Error(`Image "${n}" has invalid "content" value`))),d=!1),d}_validateStretch(n,a){if(!n)return!0;let d=0;for(const m of n){if(m[0]<d||m[1]<m[0]||a<m[1])return!1;d=m[1]}return!0}_validateContent(n,a){if(!n)return!0;if(n.length!==4)return!1;const d=a.spriteData,m=d&&d.width||a.data.width,b=d&&d.height||a.data.height;return!(n[0]<0||m<n[0]||n[1]<0||b<n[1]||n[2]<0||m<n[2]||n[3]<0||b<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,a,d=!0){const m=this.getImage(n);if(d&&(m.data.width!==a.data.width||m.data.height!==a.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=m.version+1,this.images[n]=a,this.updatedImages[n]=!0}removeImage(n){const a=this.images[n];delete this.images[n],delete this.patterns[n],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n){return new Promise((a,d)=>{let m=!0;if(!this.isLoaded())for(const b of n)this.images[b]||(m=!1);this.isLoaded()||m?a(this._getImagesForIds(n)):this.requestors.push({ids:n,promiseResolve:a})})}_getImagesForIds(n){const a={};for(const d of n){let m=this.getImage(d);m||(this.fire(new c.l("styleimagemissing",{id:d})),m=this.getImage(d)),m?a[d]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:c.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:n,height:a}=this.atlasImage;return{width:n,height:a}}getPattern(n){const a=this.patterns[n],d=this.getImage(n);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},b=new c.I(m,d);this.patterns[n]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const a=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(n,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:a,h:d}=c.p(n),m=this.atlasImage;m.resize({width:a||1,height:d||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],C=T.x+1,k=T.y+1,D=this.getImage(b).data,O=D.width,U=D.height;c.R.copy(D,m,{x:0,y:0},{x:C,y:k},{width:O,height:U}),c.R.copy(D,m,{x:0,y:U-1},{x:C,y:k-1},{width:O,height:1}),c.R.copy(D,m,{x:0,y:0},{x:C,y:k+U},{width:O,height:1}),c.R.copy(D,m,{x:O-1,y:0},{x:C-1,y:k},{width:1,height:U}),c.R.copy(D,m,{x:0,y:0},{x:C+O,y:k},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const a of n){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.getImage(a);d||c.w(`Image with ID: "${a}" was not found`),Le(d)&&this.updateImage(a,d)}}}const ct=1e20;function ht(_,n,a,d,m,b,T,C,k){for(let D=n;D<n+d;D++)ze(_,a*b+D,b,m,T,C,k);for(let D=a;D<a+m;D++)ze(_,D*b+n,1,d,T,C,k)}function ze(_,n,a,d,m,b,T){b[0]=0,T[0]=-ct,T[1]=ct,m[0]=_[n];for(let C=1,k=0,D=0;C<d;C++){m[C]=_[n+C*a];const O=C*C;do{const U=b[k];D=(m[C]-m[U]+O-U*U)/(C-U)/2}while(D<=T[k]&&--k>-1);k++,b[k]=C,T[k]=D,T[k+1]=ct}for(let C=0,k=0;C<d;C++){for(;T[k+1]<C;)k++;const D=b[k],O=C-D;_[n+C*a]=m[D]+O*O}}class vt{constructor(n,a,d){this.requestManager=n,this.localIdeographFontFamily=a,this.entries={},this.lang=d}setURL(n){this.url=n}getGlyphs(n){return c._(this,void 0,void 0,function*(){const a=[];for(const b in n)for(const T of n[b])a.push(this._getAndCacheGlyphsPromise(b,T));const d=yield Promise.all(a),m={};for(const{stack:b,id:T,glyph:C}of d)m[b]||(m[b]={}),m[b][T]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return m})}_getAndCacheGlyphsPromise(n,a){return c._(this,void 0,void 0,function*(){let d=this.entries[n];d||(d=this.entries[n]={glyphs:{},requests:{},ranges:{}});let m=d.glyphs[a];if(m!==void 0)return{stack:n,id:a,glyph:m};if(m=this._tinySDF(d,n,a),m)return d.glyphs[a]=m,{stack:n,id:a,glyph:m};const b=Math.floor(a/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[b])return{stack:n,id:a,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[b]){const C=vt.loadGlyphRange(n,b,this.url,this.requestManager);d.requests[b]=C}const T=yield d.requests[b];for(const C in T)this._doesCharSupportLocalGlyph(+C)||(d.glyphs[+C]=T[+C]);return d.ranges[b]=!0,{stack:n,id:a,glyph:T[a]||null}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(n))||c.u["CJK Unified Ideographs"](n)||c.u["Hangul Syllables"](n)||c.u.Hiragana(n)||c.u.Katakana(n)||c.u["CJK Symbols and Punctuation"](n)||c.u["Halfwidth and Fullwidth Forms"](n))}_tinySDF(n,a,d){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let b=n.tinySDF;if(!b){let C="400";/bold/i.test(a)?C="900":/medium/i.test(a)?C="500":/light/i.test(a)&&(C="200"),b=n.tinySDF=new vt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:m,fontWeight:C})}const T=b.draw(String.fromCharCode(d));return{id:d,bitmap:new c.q({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}vt.loadGlyphRange=function(_,n,a,d){return c._(this,void 0,void 0,function*(){const m=256*n,b=m+255,T=d.transformRequest(a.replace("{fontstack}",_).replace("{range}",`${m}-${b}`),"Glyphs"),C=yield c.n(T,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${n}, ${m}-${b}`);const k={};for(const D of c.o(C.data))k[D.id]=D;return k})},vt.TinySDF=class{constructor({fontSize:_=24,buffer:n=3,radius:a=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:T="normal",lang:C=null}={}){this.buffer=n,this.cutoff=d,this.radius=a,this.lang=C;const k=this.size=_+4*n,D=this._createCanvas(k),O=this.ctx=D.getContext("2d",{willReadFrequently:!0});O.font=`${T} ${b} ${_}px ${m}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(_){const n=document.createElement("canvas");return n.width=n.height=_,n}draw(_){const{width:n,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(_),T=Math.ceil(a),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),k=Math.min(this.size-this.buffer,T+Math.ceil(d)),D=C+2*this.buffer,O=k+2*this.buffer,U=Math.max(D*O,0),B=new Uint8ClampedArray(U),q={data:B,width:D,height:O,glyphWidth:C,glyphHeight:k,glyphTop:T,glyphLeft:0,glyphAdvance:n};if(C===0||k===0)return q;const{ctx:Q,buffer:ue,gridInner:he,gridOuter:de}=this;this.lang&&(Q.lang=this.lang),Q.clearRect(ue,ue,C,k),Q.fillText(_,ue,ue+T);const ge=Q.getImageData(ue,ue,C,k);de.fill(ct,0,U),he.fill(0,0,U);for(let ve=0;ve<k;ve++)for(let _e=0;_e<C;_e++){const Te=ge.data[4*(ve*C+_e)+3]/255;if(Te===0)continue;const Ee=(ve+ue)*D+_e+ue;if(Te===1)de[Ee]=0,he[Ee]=ct;else{const xe=.5-Te;de[Ee]=xe>0?xe*xe:0,he[Ee]=xe<0?xe*xe:0}}ht(de,0,0,D,O,D,this.f,this.v,this.z),ht(he,ue,ue,C,k,D,this.f,this.v,this.z);for(let ve=0;ve<U;ve++){const _e=Math.sqrt(de[ve])-Math.sqrt(he[ve]);B[ve]=Math.round(255-255*(_e/this.radius+this.cutoff))}return q}};class at{constructor(){this.specification=c.v.light.position}possiblyEvaluate(n,a){return c.B(n.expression.evaluate(a))}interpolate(n,a,d){return{x:c.C.number(n.x,a.x,d),y:c.C.number(n.y,a.y,d),z:c.C.number(n.z,a.z,d)}}}let Mt;class wt extends c.E{constructor(n){super(),Mt=Mt||new c.r({anchor:new c.D(c.v.light.anchor),position:new at,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.t(Mt,void 0),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a={}){if(!this._validate(c.x,n,a))for(const d in n){const m=n[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&c.y(this,n.call(c.z,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const jt=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class Ne extends c.E{constructor(n){super(),this._transitionable=new c.t(jt,void 0),this.setSky(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0))}setSky(n,a={}){if(!this._validate(c.G,n,a)){n||(n={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const d in n){const m=n[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d={}){return(d==null?void 0:d.validate)!==!1&&c.y(this,n.call(c.z,c.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(n){return n<60?0:n<70?(n-60)/10:1}}class Oe{constructor(n,a){this.width=n,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,a){const d=n.join(",")+String(a);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(n,a)),this.dashEntry[d]}getDashRanges(n,a,d){const m=[];let b=n.length%2==1?-n[n.length-1]*d:0,T=n[0]*d,C=!0;m.push({left:b,right:T,isDash:C,zeroLength:n[0]===0});let k=n[0];for(let D=1;D<n.length;D++){C=!C;const O=n[D];b=k*d,k+=O,T=k*d,m.push({left:b,right:T,isDash:C,zeroLength:O===0})}return m}addRoundDash(n,a,d){const m=a/2;for(let b=-d;b<=d;b++){const T=this.width*(this.nextRow+d+b);let C=0,k=n[C];for(let D=0;D<this.width;D++){D/k.right>1&&(k=n[++C]);const O=Math.abs(D-k.left),U=Math.abs(D-k.right),B=Math.min(O,U);let q;const Q=b/d*(m+1);if(k.isDash){const ue=m-Math.abs(Q);q=Math.sqrt(B*B+ue*ue)}else q=m-Math.sqrt(B*B+Q*Q);this.data[T+D]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(n){for(let C=n.length-1;C>=0;--C){const k=n[C],D=n[C+1];k.zeroLength?n.splice(C,1):D&&D.isDash===k.isDash&&(D.left=k.left,n.splice(C,1))}const a=n[0],d=n[n.length-1];a.isDash===d.isDash&&(a.left=d.left-this.width,d.right=a.right+this.width);const m=this.width*this.nextRow;let b=0,T=n[b];for(let C=0;C<this.width;C++){C/T.right>1&&(T=n[++b]);const k=Math.abs(C-T.left),D=Math.abs(C-T.right),O=Math.min(k,D);this.data[m+C]=Math.max(0,Math.min(255,(T.isDash?O:-O)+128))}}addDash(n,a){const d=a?7:0,m=2*d+1;if(this.nextRow+m>this.height)return c.w("LineAtlas out of space"),null;let b=0;for(let C=0;C<n.length;C++)b+=n[C];if(b!==0){const C=this.width/b,k=this.getDashRanges(n,this.width,C);a?this.addRoundDash(k,C,d):this.addRegularDash(k)}const T={y:this.nextRow+d,height:2*d,width:b};return this.nextRow+=m,this.dirty=!0,T}bind(n){const a=n.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const We="maplibre_preloaded_worker_pool";class nt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<nt.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[We]}numActive(){return Object.keys(this.active).length}}const _t=Math.floor(K.hardwareConcurrency/2);let Bt,Ft;function Ut(){return Bt||(Bt=new nt),Bt}nt.workerCount=c.H(globalThis)?Math.max(Math.min(_t,3),1):1;class Pt{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=a;const d=this.workerPool.acquire(a);for(let m=0;m<d.length;m++){const b=new c.J(d[m],a);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,a){const d=[];for(const m of this.actors)d.push(m.sendAsync({type:n,data:a}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],n&&this.workerPool.release(this.id)}registerMessageHandler(n,a){for(const d of this.actors)d.registerMessageHandler(n,a)}}function Un(){return Ft||(Ft=new Pt(Ut(),c.K),Ft.registerMessageHandler("GR",(_,n,a)=>c.m(n,a))),Ft}function Vn(_,n){const a=c.L();return c.M(a,a,[1,1,0]),c.N(a,a,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?c.O(a,a,_.calculatePosMatrix(n.toUnwrapped())):a}function yi(_,n,a,d,m,b,T){var C;const k=function(B,q,Q){if(B)for(const ue of B){const he=q[ue];if(he&&he.source===Q&&he.type==="fill-extrusion")return!0}else for(const ue in q){const he=q[ue];if(he.source===Q&&he.type==="fill-extrusion")return!0}return!1}((C=m==null?void 0:m.layers)!==null&&C!==void 0?C:null,n,_.id),D=b.maxPitchScaleFactor(),O=_.tilesIn(d,D,k);O.sort(ws);const U=[];for(const B of O)U.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(n,a,_._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,m,b,D,Vn(_.transform,B.tileID),T?(q,Q)=>T(B.tileID,q,Q):void 0)});return function(B,q){for(const Q in B)for(const ue of B[Q])Ts(ue,q);return B}(function(B){const q={},Q={};for(const ue of B){const he=ue.queryResults,de=ue.wrappedTileID,ge=Q[de]=Q[de]||{};for(const ve in he){const _e=he[ve],Te=ge[ve]=ge[ve]||{},Ee=q[ve]=q[ve]||[];for(const xe of _e)Te[xe.featureIndex]||(Te[xe.featureIndex]=!0,Ee.push(xe))}}return q}(U),_)}function ws(_,n){const a=_.tileID,d=n.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function Ts(_,n){const a=_.feature,d=n.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=d}function xr(_,n,a){return c._(this,void 0,void 0,function*(){let d=_;if(_.url?d=(yield c.j(n.transformRequest(_.url,"Source"),a)).data:yield K.frameAsync(a),!d)return null;const m=c.Q(c.e(d,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(m.vectorLayerIds=d.vector_layers.map(b=>b.id)),m})}class In{constructor(n,a){n&&(a?this.setSouthWest(n).setNorthEast(a):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof c.S?new c.S(n.lng,n.lat):c.S.convert(n),this}setSouthWest(n){return this._sw=n instanceof c.S?new c.S(n.lng,n.lat):c.S.convert(n),this}extend(n){const a=this._sw,d=this._ne;let m,b;if(n instanceof c.S)m=n,b=n;else{if(!(n instanceof In))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(In.convert(n)):this.extend(c.S.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(c.S.convert(n)):this;if(m=n._sw,b=n._ne,!m||!b)return this}return a||d?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),d.lng=Math.max(b.lng,d.lng),d.lat=Math.max(b.lat,d.lat)):(this._sw=new c.S(m.lng,m.lat),this._ne=new c.S(b.lng,b.lat)),this}getCenter(){return new c.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.S(this.getWest(),this.getNorth())}getSouthEast(){return new c.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:a,lat:d}=c.S.convert(n);let m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(n){return n instanceof In?n:n&&new In(n)}static fromLngLat(n,a=0){const d=360*a/40075017,m=d/Math.cos(Math.PI/180*n.lat);return new In(new c.S(n.lng-m,n.lat-d),new c.S(n.lng+m,n.lat+d))}adjustAntiMeridian(){const n=new c.S(this._sw.lng,this._sw.lat),a=new c.S(this._ne.lng,this._ne.lat);return new In(n,n.lng>a.lng?new c.S(a.lng+360,a.lat):a)}}class $n{constructor(n,a,d){this.bounds=In.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),d=Math.floor(c.V(this.bounds.getWest())*a),m=Math.floor(c.U(this.bounds.getNorth())*a),b=Math.ceil(c.V(this.bounds.getEast())*a),T=Math.ceil(c.U(this.bounds.getSouth())*a);return n.x>=d&&n.x<b&&n.y>=m&&n.y<T}}class vi extends c.E{constructor(n,a,d,m){if(super(),this.id=n,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.Q(a,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield xr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n&&(c.e(this,n),n.bounds&&(this.tileBounds=new $n(n.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this._loaded=!0,this.fire(new c.k(n))}})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.abort(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(n){return c._(this,void 0,void 0,function*(){const a=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(a,"Tile"),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};d.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(n.actor&&n.state!=="expired"){if(n.state==="loading")return new Promise((b,T)=>{n.reloadPromise={resolve:b,reject:T}})}else n.actor=this.dispatcher.getActor(),m="LT";n.abortController=new AbortController;try{const b=yield n.actor.sendAsync({type:m,data:d},n.abortController);if(delete n.abortController,n.aborted)return;this._afterTileLoadWorkerResponse(n,b)}catch(b){if(delete n.abortController,n.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(n,null)}})}_afterTileLoadWorkerResponse(n,a){if(a&&a.resourceTiming&&(n.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&n.setExpiryData(a),n.loadVectorData(a,this.map.painter),n.reloadPromise){const d=n.reloadPromise;n.reloadPromise=null,this.loadTile(n).then(d.resolve).catch(d.reject)}}abortTile(n){return c._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.actor&&(yield n.actor.sendAsync({type:"AT",data:{uid:n.uid,type:this.type,source:this.id}}))})}unloadTile(n){return c._(this,void 0,void 0,function*(){n.unloadVectorData(),n.actor&&(yield n.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Dr extends c.E{constructor(n,a,d,m){super(),this.id=n,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},a),c.e(this,c.Q(a,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(n=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield xr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(c.e(this,a),a.bounds&&(this.tileBounds=new $n(a.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,this.fire(new c.k(a))}})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),n(),this.load(!0)}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}serialize(){return c.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n){return c._(this,void 0,void 0,function*(){const a=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.abortController=new AbortController;try{const d=yield fe.getImage(this.map._requestManager.transformRequest(a,"Tile"),n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&n.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const m=this.map.painter.context,b=m.gl,T=d.data;n.texture=this.map.painter.getTileTexture(T.width),n.texture?n.texture.update(T,{useMipmap:!0}):(n.texture=new c.T(m,T,b.RGBA,{useMipmap:!0}),n.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),n.state="loaded"}}catch(d){if(delete n.abortController,n.aborted)n.state="unloaded";else if(d)throw n.state="errored",d}})}abortTile(n){return c._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController)})}unloadTile(n){return c._(this,void 0,void 0,function*(){n.texture&&this.map.painter.saveTileTexture(n.texture)})}hasTransition(){return!1}}class Vt extends Dr{constructor(n,a,d,m){super(n,a,d,m),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(n){return c._(this,void 0,void 0,function*(){const a=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(a,"Tile");n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.abortController=new AbortController;try{const m=yield fe.getImage(d,n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&n.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const T=c.b(b)&&c.W()?b:yield this.readImageNow(b),C={type:this.type,uid:n.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!n.actor||n.state==="expired"){n.actor=this.dispatcher.getActor();const k=yield n.actor.sendAsync({type:"LDT",data:C});n.dem=k,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded"}}}catch(m){if(delete n.abortController,n.aborted)n.state="unloaded";else if(m)throw n.state="errored",m}})}readImageNow(n){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.X()){const a=n.width+2,d=n.height+2;try{return new c.R({width:a,height:d},yield c.Y(n,-1,-1,a,d))}catch{}}return K.getImageData(n,1)})}_getNeighboringTiles(n){const a=n.canonical,d=Math.pow(2,a.z),m=(a.x-1+d)%d,b=a.x===0?n.wrap-1:n.wrap,T=(a.x+1+d)%d,C=a.x+1===d?n.wrap+1:n.wrap,k={};return k[new c.Z(n.overscaledZ,b,a.z,m,a.y).key]={backfilled:!1},k[new c.Z(n.overscaledZ,C,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(k[new c.Z(n.overscaledZ,b,a.z,m,a.y-1).key]={backfilled:!1},k[new c.Z(n.overscaledZ,n.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},k[new c.Z(n.overscaledZ,C,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<d&&(k[new c.Z(n.overscaledZ,b,a.z,m,a.y+1).key]={backfilled:!1},k[new c.Z(n.overscaledZ,n.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},k[new c.Z(n.overscaledZ,C,a.z,T,a.y+1).key]={backfilled:!1}),k}unloadTile(n){return c._(this,void 0,void 0,function*(){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&(yield n.actor.sendAsync({type:"RDT",data:{type:this.type,uid:n.uid,source:this.id}}))})}}class _n extends c.E{constructor(n,a,d,m){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=d.getActor(),this.setEventedParent(m),this._data=a.data,this._options=c.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:c.$,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:c.$,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(n){return n*(c.$/this.tileSize)}_getClusterMaxZoom(n){const a=n?Math.round(n):this.maxzoom-1;return Number.isInteger(n)||n===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${n}" rounded to "${a}"`),a}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._pendingWorkerUpdate={data:n},this._updateWorkerData(),this}updateData(n){return this._pendingWorkerUpdate.diff=c.a0(this._pendingWorkerUpdate.diff,n),this._updateWorkerData(),this}getData(){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:n})})}getCoordinatesFromGeometry(n){return n.type==="GeometryCollection"?n.geometries.map(a=>a.coordinates).flat(1/0):n.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,function*(){const n=new In,a=yield this.getData();let d;switch(a.type){case"FeatureCollection":d=a.features.map(m=>this.getCoordinatesFromGeometry(m.geometry)).flat(1/0);break;case"Feature":d=this.getCoordinatesFromGeometry(a.geometry);break;default:d=this.getCoordinatesFromGeometry(a)}if(d.length==0)return n;for(let m=0;m<d.length-1;m+=2)n.extend([d[m],d[m+1]]);return n})}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(n.clusterRadius)),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(n.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(n){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:n,source:this.id}})}getClusterChildren(n){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:n,source:this.id}})}getClusterLeaves(n,a,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:n,limit:a,offset:d}})}_updateWorkerData(){return c._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;const{data:n,diff:a}=this._pendingWorkerUpdate;if(!n&&!a)return void c.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const d=c.e({type:this.type},this.workerOptions);n?(typeof n=="string"?(d.request=this.map._requestManager.transformRequest(K.resolveURL(n),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(n),this._pendingWorkerUpdate.data=void 0):a&&(d.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:d});if(this._isUpdatingWorker=!1,this._removed||m.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));this._data=m.data;let b=null;m.resourceTiming&&m.resourceTiming[this.id]&&(b=m.resourceTiming[this.id].slice(0));const T={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&c.e(T,{resourceTiming:b}),this.fire(new c.l("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))}catch(m){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(m))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(n){return c._(this,void 0,void 0,function*(){const a=n.actor?"RT":"LT";n.actor=this.actor;const d={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};n.abortController=new AbortController;const m=yield this.actor.sendAsync({type:a,data:d},n.abortController);delete n.abortController,n.unloadVectorData(),n.aborted||n.loadVectorData(m,this.map.painter,a==="RT")})}abortTile(n){return c._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.aborted=!0})}unloadTile(n){return c._(this,void 0,void 0,function*(){n.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class mn extends c.E{constructor(n,a,d,m){super(),this.flippedWindingOrder=!1,this.id=n,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=a}load(n){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield fe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,n&&(this.coordinates=n),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new c.k(a))}})}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=n.url,this.load(n.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(n){this.coordinates=n;const a=n.map(c.a1.fromLngLat);var d;return this.tileID=function(m){const b=c.a2.fromPoints(m),T=b.width(),C=b.height(),k=Math.max(T,C),D=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),O=Math.pow(2,D);return new c.a4(D,Math.floor((b.minX+b.maxX)/2*O),Math.floor((b.minY+b.maxY)/2*O))}(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map(m=>this.tileID.getTilePoint(m)._round()),this.flippedWindingOrder=((d=this.tileCoords)[1].x-d[0].x)*(d[2].y-d[0].y)-(d[1].y-d[0].y)*(d[2].x-d[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,a=n.gl;this.texture||(this.texture=new c.T(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,d=!0)}d&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(n){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={}):n.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(n){const{minX:a,minY:d,maxX:m,maxY:b}=c.a2.fromPoints(n),T={};for(let C=0;C<=c.a3;C++){const k=Math.pow(2,C),D=Math.floor(a*k),O=Math.floor(d*k),U=Math.floor(m*k),B=Math.floor(b*k);T[C]={minTileX:D,minTileY:O,maxTileX:U,maxTileY:B}}return T}}class dr extends mn{constructor(n,a,d,m){super(n,a,d,m),this.roundZoom=!0,this.type="video",this.options=a}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const n=this.options;this.urls=[];for(const a of n.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield c.a5(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new c.k(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const a=this.video.seekable;n<a.start(0)||n>a.end(0)?this.fire(new c.k(new c.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,a=n.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(n,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,d=!0)}d&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ai extends mn{constructor(n,a,d,m){super(n,a,d,m),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new c.k(new c.a6(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a6(`sources.${n}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new c.k(new c.a6(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a6(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a6(`sources.${n}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,d=a.gl;this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(a,this.canvas,d.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,m=!0)}m&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const Gi={},xi=_=>{switch(_){case"geojson":return _n;case"image":return mn;case"raster":return Dr;case"raster-dem":return Vt;case"vector":return vi;case"video":return dr;case"canvas":return Ai}return Gi[_]},Ss="RTLPluginLoaded";class li extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Un()}_syncState(n){return this.status=n,this.dispatcher.broadcast("SRPS",{pluginStatus:n,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(n){return c._(this,arguments,void 0,function*(a,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=K.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(Ss))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Hn=null;function br(){return Hn||(Hn=new li),Hn}var Kn,Ce;(function(_){_[_.Base=0]="Base",_[_.Parent=1]="Parent"})(Kn||(Kn={})),function(_){_[_.Departing=0]="Departing",_[_.Incoming=1]="Incoming"}(Ce||(Ce={}));class X{constructor(n,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=n,this.uid=c.a7(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(n){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(n||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:n,fadingDirection:a,fadingParentID:d,fadeEndTime:m}){this.resetFadeLogic(),this.fadingRole=n,this.fadingDirection=a,this.fadingParentID=d,this.fadeEndTime=m}setSelfFadeLogic(n){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=n}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=K.now(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,a,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(m,b){const T={};if(!b)return T;for(const C of m){const k=C.layerIds.map(D=>b.getLayer(D)).filter(Boolean);if(k.length!==0){C.layers=k,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(D=>k.filter(O=>O.id===D)[0]));for(const D of k)T[D.id]=C}}return T}(n.buckets,a==null?void 0:a.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof c.a9){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof c.a9&&b.hasRTLText){this.hasRTLText=!0,br().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(m).queryRadius(b))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),this.dashPositions=n.dashPositions}else this.collisionBoxArray=new c.a8}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(n)}const a=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(n,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(n,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,a,d,m,b,T,C,k,D,O,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:T,tileSize:this.tileSize,pixelPosMatrix:O,transform:k,params:C,queryPadding:this.queryPadding*D,getElevation:U},n,a,d):{}}querySourceFeatures(n,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),b=a&&a.sourceLayer?a.sourceLayer:"",T=m._geojsonTileLayer||m[b];if(!T)return;const C=c.aa(a==null?void 0:a.filter,a==null?void 0:a.globalState),{z:k,x:D,y:O}=this.tileID.canonical,U={z:k,x:D,y:O};for(let B=0;B<T.length;B++){const q=T.feature(B);if(C.needGeometry){const he=c.ab(q,!0);if(!C.filter(new c.F(this.tileID.overscaledZ),he,this.tileID.canonical))continue}else if(!C.filter(new c.F(this.tileID.overscaledZ),q))continue;const Q=d.getId(q,b),ue=new c.ac(q,k,D,O,Q);ue.tile=U,n.push(ue)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const d=c.ad(n.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{const b=this.expirationTime-a;b?this.expirationTime=d+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!a.style.hasLayer(m))continue;const b=this.buckets[m],T=b.layers[0].sourceLayer||"_geojsonTileLayer",C=d[T],k=n[T];if(!C||!k||Object.keys(k).length===0)continue;b.update(k,C,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const D=a&&a.style&&a.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(b)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<K.now()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(n){this.symbolFadeHoldUntil=K.now()+n}setDependencies(n,a){const d={};for(const m of a)d[m]=!0;this.dependencies[n]=d}hasDependency(n,a){for(const d of n){const m=this.dependencies[d];if(m){for(const b of a)if(m[b])return!0}}return!1}}class Y{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,d){const m=n.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:a,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},d)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const d=n.wrapped().key,m=a===void 0?0:this.data[d].indexOf(a),b=this.data[d][m];return this.data[d].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const d in this.data)for(const m of this.data[d])n(m.value)||a.push(m);for(const d of a)this.remove(d.value.tileID,d)}}class ae{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,d){const m=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][m]=this.stateChanges[n][m]||{},c.e(this.stateChanges[n][m],d),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==m&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][m]===null){this.deletedStates[n][m]={};for(const b in this.state[n][m])d[b]||(this.deletedStates[n][m][b]=null)}else for(const b in d)this.deletedStates[n]&&this.deletedStates[n][m]&&this.deletedStates[n][m][b]===null&&delete this.deletedStates[n][m][b]}removeFeatureState(n,a,d){if(this.deletedStates[n]===null)return;const m=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},d&&a!==void 0)this.deletedStates[n][m]!==null&&(this.deletedStates[n][m]=this.deletedStates[n][m]||{},this.deletedStates[n][m][d]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][m])for(d in this.deletedStates[n][m]={},this.stateChanges[n][m])this.deletedStates[n][m][d]=null;else this.deletedStates[n][m]=null;else this.deletedStates[n]=null}getState(n,a){const d=String(a),m=c.e({},(this.state[n]||{})[d],(this.stateChanges[n]||{})[d]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const b=this.deletedStates[n][a];if(b===null)return{};for(const T in b)delete m[T]}return m}initializeTileState(n,a){n.setFeatureState(this.state,a)}coalesceChanges(n,a){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const T in this.stateChanges[m])this.state[m][T]||(this.state[m][T]={}),c.e(this.state[m][T],this.stateChanges[m][T]),b[T]=this.state[m][T];d[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const T in this.state[m])b[T]={},this.state[m][T]={};else for(const T in this.deletedStates[m]){if(this.deletedStates[m][T]===null)this.state[m][T]={};else for(const C of Object.keys(this.deletedStates[m][T]))delete this.state[m][T][C];b[T]=this.state[m][T]}d[m]=d[m]||{},c.e(d[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in n)n[m].setFeatureState(d,a)}}const ye=89.25;function we(_,n){const a=c.ah(n.lat,-c.ai,c.ai);return new c.P(c.V(n.lng)*_,c.U(a)*_)}function Me(_,n){return new c.a1(n.x/_,n.y/_).toLngLat()}function je(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(c.ae(90-_.pitch)),Math.tan(c.ae(ye-_.pitch)))}function ke(_,n){const a=_.canonical,d=n/c.af(a.z),m=a.x+Math.pow(2,a.z)*_.wrap,b=c.ag(new Float64Array(16));return c.M(b,b,[m*d,a.y*d,0]),c.N(b,b,[d/c.$,d/c.$,1]),b}function He(_,n,a,d,m){const b=c.a1.fromLngLat(_,n),T=m*c.aj(1,_.lat),C=T*Math.cos(c.ae(a)),k=Math.sqrt(T*T-C*C),D=k*Math.sin(c.ae(-d)),O=k*Math.cos(c.ae(-d));return new c.a1(b.x+D,b.y+O,b.z+C)}function et(_,n,a){const d=n.intersectsFrustum(_);if(!a||d===0)return d;const m=n.intersectsPlane(a);return m===0?0:d===2&&m===2?2:1}function Ye(_,n,a){let d=0;const m=(a-n)/10;for(let b=0;b<10;b++)d+=m*Math.pow(Math.cos(n+(b+.5)/10*(a-n)),_);return d}function bt(_,n){return function(a,d,m,b,T){const C=2*((_-1)/c.ak(Math.cos(c.ae(ye-T))/Math.cos(c.ae(ye)))-1),k=Math.acos(m/b),D=2*Ye(C-1,0,c.ae(T/2)),O=Math.min(c.ae(ye),k+c.ae(T/2)),U=Ye(C-1,Math.min(O,k-c.ae(T/2)),O),B=Math.atan(d/m),q=Math.hypot(d,m);let Q=a;return Q+=c.ak(b/q/Math.max(.5,Math.cos(c.ae(T/2)))),Q+=C*c.ak(Math.cos(B))/2,Q-=c.ak(Math.max(1,U/D/n))/2,Q}}const Ct=bt(9.314,3);function De(_,n){const a=(n.roundZoom?Math.round:Math.floor)(_.zoom+c.ak(_.tileSize/n.tileSize));return Math.max(0,a)}function Ht(_,n){const a=_.getCameraFrustum(),d=_.getClippingPlane(),m=_.screenPointToMercatorCoordinate(_.getCameraPoint()),b=c.a1.fromLngLat(_.center,_.elevation);m.z=b.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;const T=_.getCoveringTilesDetailsProvider(),C=T.allowVariableZoom(_,n),k=De(_,n),D=n.minzoom||0,O=n.maxzoom!==void 0?n.maxzoom:_.maxZoom,U=Math.min(Math.max(0,k),O),B=Math.pow(2,U),q=[B*m.x,B*m.y,0],Q=[B*b.x,B*b.y,0],ue=Math.hypot(b.x-m.x,b.y-m.y),he=Math.abs(b.z-m.z),de=Math.hypot(ue,he),ge=Te=>({zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),ve=[],_e=[];if(_.renderWorldCopies&&T.allowWorldCopies())for(let Te=1;Te<=3;Te++)ve.push(ge(-Te)),ve.push(ge(Te));for(ve.push(ge(0));ve.length>0;){const Te=ve.pop(),Ee=Te.x,xe=Te.y;let Ae=Te.fullyVisible;const qe={x:Ee,y:xe,z:Te.zoom},Ue=T.getTileBoundingVolume(qe,Te.wrap,_.elevation,n);if(!Ae){const ot=et(a,Ue,d);if(ot===0)continue;Ae=ot===2}const $e=T.distanceToTile2d(m.x,m.y,qe,Ue);let Ze=k;C&&(Ze=(n.calculateTileZoom||Ct)(_.zoom+c.ak(_.tileSize/n.tileSize),$e,he,de,_.fov)),Ze=(n.roundZoom?Math.round:Math.floor)(Ze),Ze=Math.max(0,Ze);const st=Math.min(Ze,O);if(Te.wrap=T.getWrap(b,qe,Te.wrap),Te.zoom>=st){if(Te.zoom<D)continue;const ot=U-Te.zoom,tt=q[0]-.5-(Ee<<ot),Et=q[1]-.5-(xe<<ot),Wt=n.reparseOverscaled?Math.max(Te.zoom,Ze):Te.zoom;_e.push({tileID:new c.Z(Te.zoom===O?Wt:Te.zoom,Te.wrap,Te.zoom,Ee,xe),distanceSq:c.al([Q[0]-.5-Ee,Q[1]-.5-xe]),tileDistanceToCamera:Math.sqrt(tt*tt+Et*Et)})}else for(let ot=0;ot<4;ot++)ve.push({zoom:Te.zoom+1,x:(Ee<<1)+ot%2,y:(xe<<1)+(ot>>1),wrap:Te.wrap,fullyVisible:Ae})}return _e.sort((Te,Ee)=>Te.distanceSq-Ee.distanceSq).map(Te=>Te.tileID)}const yn=c.a2.fromPoints([new c.P(0,0),new c.P(c.$,c.$)]);class St extends c.E{constructor(n,a,d){super(),this.id=n,this.dispatcher=d,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,T,C)=>{const k=new(xi(b.type))(m,b,T,C);if(k.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${k.id}`);return k})(n,a,d,this),this._tiles={},this._cache=new Y(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new ae,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const a=this._tiles[n];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,a,d){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(n),this._tileLoaded(n,a,d)}catch(m){n.state="errored",m.status!==404?this._source.fire(new c.k(m,{tile:n})):this.update(this.transform,this.terrain)}})}_unloadTile(n){this._source.unloadTile&&this._source.unloadTile(n)}_abortTile(n){this._source.abortTile&&this._source.abortTile(n),this._source.fire(new c.l("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(n),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(on).map(n=>n.key)}getRenderableIds(n){const a=[];for(const d in this._tiles)this._isIdRenderable(d,n)&&a.push(this._tiles[d]);return n?a.sort((d,m)=>{const b=d.tileID,T=m.tileID,C=new c.P(b.canonical.x,b.canonical.y)._rotate(-this.transform.bearingInRadians),k=new c.P(T.canonical.x,T.canonical.y)._rotate(-this.transform.bearingInRadians);return b.overscaledZ-T.overscaledZ||k.y-C.y||k.x-C.x}).map(d=>d.tileID.key):a.map(d=>d.tileID).sort(on).map(d=>d.key)}hasRenderableParent(n){const a=n.overscaledZ-1;if(a>=this._source.minzoom){const d=this._getLoadedTile(n.scaledTo(a));if(d)return this._isIdRenderable(d.tileID.key)}return!1}_isIdRenderable(n,a=!1){var d;return(d=this._tiles[n])===null||d===void 0?void 0:d.isRenderable(a)}reload(n){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)n?this._reloadTile(a,"expired"):this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(n,a){return c._(this,void 0,void 0,function*(){const d=this._tiles[n];d&&(d.state!=="loading"&&(d.state=a),yield this._loadTile(d,n,a))})}_tileLoaded(n,a,d){n.timeAdded=K.now(),d==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const a=this.getRenderableIds();for(let m=0;m<a.length;m++){const b=a[m];if(n.neighboringTiles&&n.neighboringTiles[b]){const T=this.getTileByID(b);d(n,T),d(T,n)}}function d(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let T=b.tileID.canonical.x-m.tileID.canonical.x;const C=b.tileID.canonical.y-m.tileID.canonical.y,k=Math.pow(2,m.tileID.canonical.z),D=b.tileID.key;T===0&&C===0||Math.abs(C)>1||(Math.abs(T)>1&&(Math.abs(T+k)===1?T+=k:Math.abs(T-k)===1&&(T-=k)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,T,C),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a){const d=Object.values(n),m=this._getLoadedDescendents(d),b={};for(const T of d){const C=m[T.key];if(!(C!=null&&C.length)){b[T.key]=T;continue}const k=T.overscaledZ+St.maxUnderzooming,D=C.filter(B=>B.tileID.overscaledZ<=k);if(!D.length){b[T.key]=T;continue}const O=Math.min(...D.map(B=>B.tileID.overscaledZ)),U=D.filter(B=>B.tileID.overscaledZ===O).map(B=>B.tileID);for(const B of U)a[B.key]=B;this._areDescendentsComplete(U,O,T.overscaledZ)||(b[T.key]=T)}return b}_getLoadedDescendents(n){var a;const d={};for(const m in this._tiles){const b=this._tiles[m];if(b.hasData())for(const T of n)b.tileID.isChildOf(T)&&(d[a=T.key]||(d[a]=[])).push(b)}return d}_areDescendentsComplete(n,a,d){return n.length===1&&n[0].isOverscaled()?n[0].overscaledZ===a:Math.pow(4,a-d)===n.length}_getLoadedTile(n){const a=this._tiles[n.key];return a!=null&&a.hasData()?a:null}updateCacheSize(n){const a=Math.ceil(n.width/this._source.tileSize)+1,d=Math.ceil(n.height/this._source.tileSize)+1,m=Math.floor(a*d*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const d={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),d[b.tileID.key]=b}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(n,a){if(!this._sourceLoaded||this._paused)return;let d;this.transform=n,this.terrain=a,this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?d=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new c.Z(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(d=Ht(n,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(d=d.filter(k=>this._source.hasTile(k)))):d=[],this.usedForTerrain&&(d=this._addTerrainIdealTiles(d));const m=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,m&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=De(n,this._source),T=this._updateRetainedTiles(d,b),C=ir(this._source.type);C&&this._rasterFadeDuration>0&&!a&&this._updateFadingTiles(d,T),C?this._cleanUpRasterTiles(T):this._cleanUpVectorTiles(T)}_cleanUpRasterTiles(n){for(const a in this._tiles)n[a]||this._removeTile(a)}_cleanUpVectorTiles(n){for(const a in this._tiles){const d=this._tiles[a];n[a]?d.clearSymbolFadeHold():d.hasSymbolBuckets?d.holdingForSymbolFade()?d.symbolFadeFinished()&&this._removeTile(a):d.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(n){const a=[];for(const d of n)if(d.canonical.z>this._source.minzoom){const m=d.scaledTo(d.canonical.z-1);a.push(m);const b=d.scaledTo(Math.max(this._source.minzoom,Math.min(d.canonical.z,5)));a.push(b)}return n.concat(a)}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForSymbolFade()&&this._removeTile(n)}_updateRetainedTiles(n,a){var d;const m={},b={},T=Math.max(a-St.maxOverzooming,this._source.minzoom);let C={};for(const k of n){const D=this._addTile(k);m[k.key]=k,D.hasData()||(C[k.key]=k)}C=this._retainLoadedChildren(C,m);for(const k in C){const D=C[k];let O=this._tiles[k],U=O==null?void 0:O.wasRequested();for(let B=D.overscaledZ-1;B>=T;--B){const q=D.scaledTo(B);if(b[q.key])break;if(b[q.key]=!0,O=this.getTile(q),!O&&U&&(O=this._addTile(q)),O){const Q=O.hasData();if((Q||!(!((d=this.map)===null||d===void 0)&&d.cancelPendingTileRequestsWhileZooming)||U)&&(m[q.key]=q),U=O.wasRequested(),Q)break}}}return m}_updateFadingTiles(n,a){const d=K.now(),m=c.am(n);for(const b of n){const T=this._tiles[b.key];T.fadingDirection!==Ce.Departing&&T.fadeOpacity!==0||T.resetFadeLogic(),this._updateFadingAncestor(T,a,d)||this._updateFadingDescendents(T,a,d)||this._updateFadingEdge(T,m,d)||T.resetFadeLogic()}}_updateFadingAncestor(n,a,d){if(!n.hasData())return!1;const{tileID:m,fadingRole:b,fadingDirection:T,fadingParentID:C}=n;if(b===Kn.Base&&T===Ce.Incoming&&C)return a[C.key]=C,!0;const k=Math.max(m.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let D=m.overscaledZ-1;D>=k;D--){const O=m.scaledTo(D),U=this._getLoadedTile(O);if(U)return n.setCrossFadeLogic({fadingRole:Kn.Base,fadingDirection:Ce.Incoming,fadingParentID:U.tileID,fadeEndTime:d+this._rasterFadeDuration}),U.setCrossFadeLogic({fadingRole:Kn.Parent,fadingDirection:Ce.Departing,fadeEndTime:d+this._rasterFadeDuration}),a[O.key]=O,!0}return!1}_updateFadingDescendents(n,a,d){if(!n.hasData())return!1;const m=n.tileID.children(this._source.maxzoom);let b=this._updateFadingChildren(n,m,a,d);if(b)return!0;for(const T of m){const C=T.children(this._source.maxzoom);this._updateFadingChildren(n,C,a,d)&&(b=!0)}return b}_updateFadingChildren(n,a,d,m){if(a[0].overscaledZ>=this._source.maxzoom)return!1;let b=!1;for(const T of a){const C=this._getLoadedTile(T);if(!C)continue;const{fadingRole:k,fadingDirection:D,fadingParentID:O}=C;k===Kn.Base&&D===Ce.Departing&&O||(C.setCrossFadeLogic({fadingRole:Kn.Base,fadingDirection:Ce.Departing,fadingParentID:n.tileID,fadeEndTime:m+this._rasterFadeDuration}),n.setCrossFadeLogic({fadingRole:Kn.Parent,fadingDirection:Ce.Incoming,fadeEndTime:m+this._rasterFadeDuration})),d[T.key]=T,b=!0}return b}_updateFadingEdge(n,a,d){const m=n.tileID;return!!n.selfFading||!n.hasData()&&!!a.has(m)&&(n.setSelfFadeLogic(d+this._rasterFadeDuration),!0)}_addTile(n){let a=this._tiles[n.key];if(a)return a;a=this._cache.getAndRemove(n),a&&(a.resetFadeLogic(),this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const d=a;return a||(a=new X(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(a,n.key,a.state)),a.uses++,this._tiles[n.key]=a,d||this._source.fire(new c.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const d=a.getExpiryTimeout();d&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},d))}refreshTiles(n){for(const a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&n.some(d=>d.equals(this._tiles[a].tileID.canonical))&&this._reloadTile(a,"expired")}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(n){n.dataType==="source"&&(n.sourceDataType!=="metadata"?n.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(n.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,a,d){const m=[],b=this.transform;if(!b)return m;const T=b.getCoveringTilesDetailsProvider().allowWorldCopies(),C=d?b.getCameraQueryGeometry(n):n,k=q=>b.screenPointToMercatorCoordinate(q,this.terrain),D=this.transformBbox(n,k,!T),O=this.transformBbox(C,k,!T),U=this.getIds(),B=c.a2.fromPoints(O);for(let q=0;q<U.length;q++){const Q=this._tiles[U[q]];if(Q.holdingForSymbolFade())continue;const ue=T?[Q.tileID]:[Q.tileID.unwrapTo(-1),Q.tileID.unwrapTo(0)],he=Math.pow(2,b.zoom-Q.tileID.overscaledZ),de=a*Q.queryPadding*c.$/Q.tileSize/he;for(const ge of ue){const ve=B.map(_e=>ge.getTilePoint(new c.a1(_e.x,_e.y)));if(ve.expandBy(de),ve.intersects(yn)){const _e=D.map(Ee=>ge.getTilePoint(Ee)),Te=O.map(Ee=>ge.getTilePoint(Ee));m.push({tile:Q,tileID:T?ge:ge.unwrapTo(0),queryGeometry:_e,cameraQueryGeometry:Te,scale:he})}}}return m}transformBbox(n,a,d){let m=n.map(a);if(d){const b=c.a2.fromPoints(n);b.shrinkBy(.001*Math.min(b.width(),b.height()));const T=b.map(a);c.a2.fromPoints(m).covers(T)||(m=m.map(C=>C.x>.5?new c.a1(C.x-1,C.y,C.z):C))}return m}getVisibleCoordinates(n){const a=this.getRenderableIds(n).map(d=>this._tiles[d].tileID);return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(ir(this._source.type)&&this._rasterFadeDuration>0){const n=K.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=n)return!0}return!1}setRasterFadeDuration(n){this._rasterFadeDuration=n}setFeatureState(n,a,d){this._state.updateState(n=n||"_geojsonTileLayer",a,d)}removeFeatureState(n,a,d){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,d)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,d){const m=this._tiles[n];m&&m.setDependencies(a,d)}reloadTilesForDependencies(n,a){for(const d in this._tiles)this._tiles[d].hasDependency(n,a)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(n,a))}}function on(_,n){const a=Math.abs(2*_.wrap)-+(_.wrap<0),d=Math.abs(2*n.wrap)-+(n.wrap<0);return _.overscaledZ-n.overscaledZ||d-a||n.canonical.y-_.canonical.y||n.canonical.x-_.canonical.x}function ir(_){return _==="raster"||_==="image"||_==="video"}St.maxOverzooming=10,St.maxUnderzooming=3;class Zn{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=c.ah(n,0,1);let a=1,d=this._distances[a];const m=n*this.paddedLength+this.padding;for(;d<m&&a<this._distances.length;)d=this._distances[++a];const b=a-1,T=this._distances[b],C=d-T,k=C>0?(m-T)/C:0;return this.points[b].mult(1-k).add(this.points[a].mult(k))}}function Xn(_,n){let a=!0;return _==="always"||_!=="never"&&n!=="never"||(a=!1),a}class wr{constructor(n,a,d){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(a/d);for(let T=0;T<this.xCellCount*this.yCellCount;T++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,d,m,b){this._forEachCell(a,d,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(n,a,d,m){this._forEachCell(a-m,d-m,a+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(d),this.circles.push(m)}_insertBoxCell(n,a,d,m,b,T){this.boxCells[b].push(T)}_insertCircleCell(n,a,d,m,b,T){this.circleCells[b].push(T)}_query(n,a,d,m,b,T,C){if(d<0||n>this.width||m<0||a>this.height)return[];const k=[];if(n<=0&&a<=0&&this.width<=d&&this.height<=m){if(b)return[{key:null,x1:n,y1:a,x2:d,y2:m}];for(let D=0;D<this.boxKeys.length;D++)k.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const O=this.circles[3*D],U=this.circles[3*D+1],B=this.circles[3*D+2];k.push({key:this.circleKeys[D],x1:O-B,y1:U-B,x2:O+B,y2:U+B})}}else this._forEachCell(n,a,d,m,this._queryCell,k,{hitTest:b,overlapMode:T,seenUids:{box:{},circle:{}}},C);return k}query(n,a,d,m){return this._query(n,a,d,m,!1,null)}hitTest(n,a,d,m,b,T){return this._query(n,a,d,m,!0,b,T).length>0}hitTestCircle(n,a,d,m,b){const T=n-d,C=n+d,k=a-d,D=a+d;if(C<0||T>this.width||D<0||k>this.height)return!1;const O=[];return this._forEachCell(T,k,C,D,this._queryCellCircle,O,{hitTest:!0,overlapMode:m,circle:{x:n,y:a,radius:d},seenUids:{box:{},circle:{}}},b),O.length>0}_queryCell(n,a,d,m,b,T,C,k){const{seenUids:D,hitTest:O,overlapMode:U}=C,B=this.boxCells[b];if(B!==null){const Q=this.bboxes;for(const ue of B)if(!D.box[ue]){D.box[ue]=!0;const he=4*ue,de=this.boxKeys[ue];if(n<=Q[he+2]&&a<=Q[he+3]&&d>=Q[he+0]&&m>=Q[he+1]&&(!k||k(de))&&(!O||!Xn(U,de.overlapMode))&&(T.push({key:de,x1:Q[he],y1:Q[he+1],x2:Q[he+2],y2:Q[he+3]}),O))return!0}}const q=this.circleCells[b];if(q!==null){const Q=this.circles;for(const ue of q)if(!D.circle[ue]){D.circle[ue]=!0;const he=3*ue,de=this.circleKeys[ue];if(this._circleAndRectCollide(Q[he],Q[he+1],Q[he+2],n,a,d,m)&&(!k||k(de))&&(!O||!Xn(U,de.overlapMode))){const ge=Q[he],ve=Q[he+1],_e=Q[he+2];if(T.push({key:de,x1:ge-_e,y1:ve-_e,x2:ge+_e,y2:ve+_e}),O)return!0}}}return!1}_queryCellCircle(n,a,d,m,b,T,C,k){const{circle:D,seenUids:O,overlapMode:U}=C,B=this.boxCells[b];if(B!==null){const Q=this.bboxes;for(const ue of B)if(!O.box[ue]){O.box[ue]=!0;const he=4*ue,de=this.boxKeys[ue];if(this._circleAndRectCollide(D.x,D.y,D.radius,Q[he+0],Q[he+1],Q[he+2],Q[he+3])&&(!k||k(de))&&!Xn(U,de.overlapMode))return T.push(!0),!0}}const q=this.circleCells[b];if(q!==null){const Q=this.circles;for(const ue of q)if(!O.circle[ue]){O.circle[ue]=!0;const he=3*ue,de=this.circleKeys[ue];if(this._circlesCollide(Q[he],Q[he+1],Q[he+2],D.x,D.y,D.radius)&&(!k||k(de))&&!Xn(U,de.overlapMode))return T.push(!0),!0}}}_forEachCell(n,a,d,m,b,T,C,k){const D=this._convertToXCellCoord(n),O=this._convertToYCellCoord(a),U=this._convertToXCellCoord(d),B=this._convertToYCellCoord(m);for(let q=D;q<=U;q++)for(let Q=O;Q<=B;Q++)if(b.call(this,n,a,d,m,this.xCellCount*Q+q,T,C,k))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,d,m,b,T){const C=m-n,k=b-a,D=d+T;return D*D>C*C+k*k}_circleAndRectCollide(n,a,d,m,b,T,C){const k=(T-m)/2,D=Math.abs(n-(m+k));if(D>k+d)return!1;const O=(C-b)/2,U=Math.abs(a-(b+O));if(U>O+d)return!1;if(D<=k||U<=O)return!0;const B=D-k,q=U-O;return B*B+q*q<=d*d}}function En(_,n,a){const d=c.L();if(!_){const{vecSouth:U,vecEast:B}=nn(n),q=N();q[0]=B[0],q[1]=B[1],q[2]=U[0],q[3]=U[1],m=q,(O=(T=(b=q)[0])*(D=b[3])-(k=b[2])*(C=b[1]))&&(m[0]=D*(O=1/O),m[1]=-C*O,m[2]=-k*O,m[3]=T*O),d[0]=q[0],d[1]=q[1],d[4]=q[2],d[5]=q[3]}var m,b,T,C,k,D,O;return c.N(d,d,[1/a,1/a,1]),d}function Tr(_,n,a,d){if(_){const m=c.L();if(!n){const{vecSouth:b,vecEast:T}=nn(a);m[0]=T[0],m[1]=T[1],m[4]=b[0],m[5]=b[1]}return c.N(m,m,[d,d,1]),m}return a.pixelsToClipSpaceMatrix}function nn(_){const n=Math.cos(_.rollInRadians),a=Math.sin(_.rollInRadians),d=Math.cos(_.pitchInRadians),m=Math.cos(_.bearingInRadians),b=Math.sin(_.bearingInRadians),T=c.ar();T[0]=-m*d*a-b*n,T[1]=-b*d*a+m*n;const C=c.as(T);C<1e-9?c.at(T):c.au(T,T,1/C);const k=c.ar();k[0]=m*d*n-b*a,k[1]=b*d*n+m*a;const D=c.as(k);return D<1e-9?c.at(k):c.au(k,k,1/D),{vecEast:k,vecSouth:T}}function Fe(_,n,a,d){let m;d?(m=[_,n,d(_,n),1],c.aw(m,m,a)):(m=[_,n,0,1],Bo(m,m,a));const b=m[3];return{point:new c.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function is(_,n){return .5+_/n*.5}function bi(_,n){return _.x>=-n[0]&&_.x<=n[0]&&_.y>=-n[1]&&_.y<=n[1]}function wi(_,n,a,d,m,b,T,C,k,D,O,U,B){const q=a?_.textSizeData:_.iconSizeData,Q=c.an(q,n.transform.zoom),ue=[256/n.width*2+1,256/n.height*2+1],he=a?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;he.clear();const de=_.lineVertexArray,ge=a?_.text.placedSymbolArray:_.icon.placedSymbolArray,ve=n.transform.width/n.transform.height;let _e=!1;for(let Te=0;Te<ge.length;Te++){const Ee=ge.get(Te);if(Ee.hidden||Ee.writingMode===c.ao.vertical&&!_e){Zs(Ee.numGlyphs,he);continue}_e=!1;const xe=new c.P(Ee.anchorX,Ee.anchorY),Ae={getElevation:B,pitchedLabelPlaneMatrix:d,lineVertexArray:de,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:xe,unwrappedTileID:k,width:D,height:O,translation:U},qe=Xt(Ee.anchorX,Ee.anchorY,Ae);if(!bi(qe.point,ue)){Zs(Ee.numGlyphs,he);continue}const Ue=is(n.transform.cameraToCenterDistance,qe.signedDistanceFromCamera),$e=c.ap(q,Q,Ee),Ze=b?$e*n.transform.getPitchedTextCorrection(Ee.anchorX,Ee.anchorY,k)/Ue:$e*Ue,st=Jt({projectionContext:Ae,pitchedLabelPlaneMatrixInverse:m,symbol:Ee,fontSize:Ze,flip:!1,keepUpright:T,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:he,aspectRatio:ve,rotateToLine:C});_e=st.useVertical,(st.notEnoughRoom||_e||st.needsFlipping&&Jt({projectionContext:Ae,pitchedLabelPlaneMatrixInverse:m,symbol:Ee,fontSize:Ze,flip:!0,keepUpright:T,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:he,aspectRatio:ve,rotateToLine:C}).notEnoughRoom)&&Zs(Ee.numGlyphs,he)}a?_.text.dynamicLayoutVertexBuffer.updateData(he):_.icon.dynamicLayoutVertexBuffer.updateData(he)}function fr(_,n,a,d,m,b,T,C){const k=b.glyphStartIndex+b.numGlyphs,D=b.lineStartIndex,O=b.lineStartIndex+b.lineLength,U=n.getoffsetX(b.glyphStartIndex),B=n.getoffsetX(k-1),q=jo(_*U,a,d,m,b.segment,D,O,C,T);if(!q)return null;const Q=jo(_*B,a,d,m,b.segment,D,O,C,T);return Q?C.projectionCache.anyProjectionOccluded?null:{first:q,last:Q}:null}function ut(_,n,a,d){return _===c.ao.horizontal&&Math.abs(a.y-n.y)>Math.abs(a.x-n.x)*d?{useVertical:!0}:(_===c.ao.vertical?n.y<a.y:n.x>a.x)?{needsFlipping:!0}:null}function Jt(_){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:a,symbol:d,fontSize:m,flip:b,keepUpright:T,glyphOffsetArray:C,dynamicLayoutVertexArray:k,aspectRatio:D,rotateToLine:O}=_,U=m/24,B=d.lineOffsetX*U,q=d.lineOffsetY*U;let Q;if(d.numGlyphs>1){const ue=d.glyphStartIndex+d.numGlyphs,he=d.lineStartIndex,de=d.lineStartIndex+d.lineLength,ge=fr(U,C,B,q,b,d,O,n);if(!ge)return{notEnoughRoom:!0};const ve=Es(ge.first.point.x,ge.first.point.y,n,a),_e=Es(ge.last.point.x,ge.last.point.y,n,a);if(T&&!b){const Te=ut(d.writingMode,ve,_e,D);if(Te)return Te}Q=[ge.first];for(let Te=d.glyphStartIndex+1;Te<ue-1;Te++){const Ee=jo(U*C.getoffsetX(Te),B,q,b,d.segment,he,de,n,O);if(!Ee)return{notEnoughRoom:!0};Q.push(Ee)}Q.push(ge.last)}else{if(T&&!b){const he=Ps(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,de=d.lineStartIndex+d.segment+1,ge=new c.P(n.lineVertexArray.getx(de),n.lineVertexArray.gety(de)),ve=Ps(ge.x,ge.y,n),_e=ve.signedDistanceFromCamera>0?ve.point:qt(n.tileAnchorPoint,ge,he,1,n),Te=Es(he.x,he.y,n,a),Ee=Es(_e.x,_e.y,n,a),xe=ut(d.writingMode,Te,Ee,D);if(xe)return xe}const ue=jo(U*C.getoffsetX(d.glyphStartIndex),B,q,b,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,n,O);if(!ue||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Q=[ue]}for(const ue of Q)c.av(k,ue.point,ue.angle);return{}}function qt(_,n,a,d,m){const b=_.add(_.sub(n)._unit()),T=Ps(b.x,b.y,m).point,C=a.sub(T);return a.add(C._mult(d/C.mag()))}function Ti(_,n,a){const d=n.projectionCache;if(d.projections[_])return d.projections[_];const m=new c.P(n.lineVertexArray.getx(_),n.lineVertexArray.gety(_)),b=Ps(m.x,m.y,n);if(b.signedDistanceFromCamera>0)return d.projections[_]=b.point,d.anyProjectionOccluded=d.anyProjectionOccluded||b.isOccluded,b.point;const T=_-a.direction;return qt(a.distanceFromAnchor===0?n.tileAnchorPoint:new c.P(n.lineVertexArray.getx(T),n.lineVertexArray.gety(T)),m,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,n)}function Ps(_,n,a){const d=_+a.translation[0],m=n+a.translation[1];let b;return a.pitchWithMap?(b=Fe(d,m,a.pitchedLabelPlaneMatrix,a.getElevation),b.isOccluded=!1):(b=a.transform.projectTileCoordinates(d,m,a.unwrappedTileID,a.getElevation),b.point.x=(.5*b.point.x+.5)*a.width,b.point.y=(.5*-b.point.y+.5)*a.height),b}function Es(_,n,a,d){if(a.pitchWithMap){const m=[_,n,0,1];return c.aw(m,m,d),a.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],a.unwrappedTileID,a.getElevation).point}return{x:_/a.width*2-1,y:1-n/a.height*2}}function Xt(_,n,a){return a.transform.projectTileCoordinates(_,n,a.unwrappedTileID,a.getElevation)}function Pa(_,n,a){return _._unit()._perp()._mult(n*a)}function Ea(_,n,a,d,m,b,T,C,k){if(C.projectionCache.offsets[_])return C.projectionCache.offsets[_];const D=a.add(n);if(_+k.direction<d||_+k.direction>=m)return C.projectionCache.offsets[_]=D,D;const O=Ti(_+k.direction,C,k),U=Pa(O.sub(a),T,k.direction),B=a.add(U),q=O.add(U);return C.projectionCache.offsets[_]=c.ax(b,D,B,q)||D,C.projectionCache.offsets[_]}function jo(_,n,a,d,m,b,T,C,k){const D=d?_-n:_+n;let O=D>0?1:-1,U=0;d&&(O*=-1,U=Math.PI),O<0&&(U+=Math.PI);let B,q=O>0?b+m:b+m+1;C.projectionCache.cachedAnchorPoint?B=C.projectionCache.cachedAnchorPoint:(B=Ps(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=B);let Q,ue,he=B,de=B,ge=0,ve=0;const _e=Math.abs(D),Te=[];let Ee;for(;ge+ve<=_e;){if(q+=O,q<b||q>=T)return null;ge+=ve,de=he,ue=Q;const qe={absOffsetX:_e,direction:O,distanceFromAnchor:ge,previousVertex:de};if(he=Ti(q,C,qe),a===0)Te.push(de),Ee=he.sub(de);else{let Ue;const $e=he.sub(de);Ue=$e.mag()===0?Pa(Ti(q+O,C,qe).sub(he),a,O):Pa($e,a,O),ue||(ue=de.add(Ue)),Q=Ea(q,Ue,he,b,T,ue,a,C,qe),Te.push(ue),Ee=Q.sub(ue)}ve=Ee.mag()}const xe=Ee._mult((_e-ge)/ve)._add(ue||de),Ae=U+Math.atan2(he.y-de.y,he.x-de.x);return Te.push(xe),{point:xe,angle:k?Ae:0,path:Te}}const mo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Zs(_,n){for(let a=0;a<_;a++){const d=n.length;n.resize(d+4),n.float32.set(mo,3*d)}}function Bo(_,n,a){const d=n[0],m=n[1];return _[0]=a[0]*d+a[4]*m+a[12],_[1]=a[1]*d+a[5]*m+a[13],_[3]=a[3]*d+a[7]*m+a[15],_}const sr=100;class Ri{constructor(n,a=new wr(n.width+200,n.height+200,25),d=new wr(n.width+200,n.height+200,25)){this.transform=n,this.grid=a,this.ignoredGrid=d,this.pitchFactor=Math.cos(n.pitch*Math.PI/180)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+sr,this.screenBottomBoundary=n.height+sr,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,a,d,m,b,T,C,k,D,O,U,B){const q=this.projectAndGetPerspectiveRatio(n.anchorPointX+k[0],n.anchorPointY+k[1],b,O,B),Q=d*q.perspectiveRatio;let ue;if(T||C)ue=this._projectCollisionBox(n,Q,m,b,T,C,k,q,O,U,B);else{const Ee=q.x+(U?U.x*Q:0),xe=q.y+(U?U.y*Q:0);ue={allPointsOccluded:!1,box:[Ee+n.x1*Q,xe+n.y1*Q,Ee+n.x2*Q,xe+n.y2*Q]}}const[he,de,ge,ve]=ue.box,_e=T?ue.allPointsOccluded:q.isOccluded;let Te=_e;return Te||(Te=q.perspectiveRatio<this.perspectiveRatioCutoff),Te||(Te=!this.isInsideGrid(he,de,ge,ve)),Te||a!=="always"&&this.grid.hitTest(he,de,ge,ve,a,D)?{box:[he,de,ge,ve],placeable:!1,offscreen:!1,occluded:_e}:{box:[he,de,ge,ve],placeable:!0,offscreen:this.isOffscreen(he,de,ge,ve),occluded:_e}}placeCollisionCircles(n,a,d,m,b,T,C,k,D,O,U,B,q,Q){const ue=[],he=new c.P(a.anchorX,a.anchorY),de=this.getPerspectiveRatio(he.x,he.y,T,Q),ge=(D?b*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,T)/de:b*de)/c.aB,ve={getElevation:Q,pitchedLabelPlaneMatrix:C,lineVertexArray:d,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:he,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:q},_e=fr(ge,m,a.lineOffsetX*ge,a.lineOffsetY*ge,!1,a,!1,ve);let Te=!1,Ee=!1,xe=!0;if(_e){const Ae=.5*U*de+B,qe=new c.P(-100,-100),Ue=new c.P(this.screenRightBoundary,this.screenBottomBoundary),$e=new Zn,Ze=_e.first,st=_e.last;let ot=[];for(let Wt=Ze.path.length-1;Wt>=1;Wt--)ot.push(Ze.path[Wt]);for(let Wt=1;Wt<st.path.length;Wt++)ot.push(st.path[Wt]);const tt=2.5*Ae;if(D){const Wt=this.projectPathToScreenSpace(ot,ve);ot=Wt.some(Tn=>Tn.signedDistanceFromCamera<=0)?[]:Wt.map(Tn=>Tn.point)}let Et=[];if(ot.length>0){const Wt=ot[0].clone(),Tn=ot[0].clone();for(let Sn=1;Sn<ot.length;Sn++)Wt.x=Math.min(Wt.x,ot[Sn].x),Wt.y=Math.min(Wt.y,ot[Sn].y),Tn.x=Math.max(Tn.x,ot[Sn].x),Tn.y=Math.max(Tn.y,ot[Sn].y);Et=Wt.x>=qe.x&&Tn.x<=Ue.x&&Wt.y>=qe.y&&Tn.y<=Ue.y?[ot]:Tn.x<qe.x||Wt.x>Ue.x||Tn.y<qe.y||Wt.y>Ue.y?[]:c.ay([ot],qe.x,qe.y,Ue.x,Ue.y)}for(const Wt of Et){$e.reset(Wt,.25*Ae);let Tn=0;Tn=$e.length<=.5*Ae?1:Math.ceil($e.paddedLength/tt)+1;for(let Sn=0;Sn<Tn;Sn++){const An=Sn/Math.max(Tn-1,1),er=$e.lerp(An),jn=er.x+sr,gn=er.y+sr;ue.push(jn,gn,Ae,0);const qn=jn-Ae,di=gn-Ae,Er=jn+Ae,Cr=gn+Ae;if(xe=xe&&this.isOffscreen(qn,di,Er,Cr),Ee=Ee||this.isInsideGrid(qn,di,Er,Cr),n!=="always"&&this.grid.hitTestCircle(jn,gn,Ae,n,O)&&(Te=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Te}}}}return{circles:!k&&Te||!Ee||de<this.perspectiveRatioCutoff?[]:ue,offscreen:xe,collisionDetected:Te}}projectPathToScreenSpace(n,a){const d=function(m,b){const T=c.L();return c.aq(T,b.pitchedLabelPlaneMatrix),m.map(C=>{const k=Fe(C.x,C.y,T,b.getElevation),D=b.transform.projectTileCoordinates(k.point.x,k.point.y,b.unwrappedTileID,b.getElevation);return D.point.x=(.5*D.point.x+.5)*b.width,D.point.y=(.5*-D.point.y+.5)*b.height,D})}(n,a);return function(m){let b=0,T=0,C=0,k=0;for(let D=0;D<m.length;D++)m[D].isOccluded?(C=D+1,k=0):(k++,k>T&&(T=k,b=C));return m.slice(b,b+T)}(d)}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],d=new c.a2;for(const U of n){const B=new c.P(U.x+sr,U.y+sr);d.extend(B),a.push(B)}const{minX:m,minY:b,maxX:T,maxY:C}=d,k=this.grid.query(m,b,T,C).concat(this.ignoredGrid.query(m,b,T,C)),D={},O={};for(const U of k){const B=U.key;if(D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]={}),D[B.bucketInstanceId][B.featureIndex])continue;const q=[new c.P(U.x1,U.y1),new c.P(U.x2,U.y1),new c.P(U.x2,U.y2),new c.P(U.x1,U.y2)];c.az(a,q)&&(D[B.bucketInstanceId][B.featureIndex]=!0,O[B.bucketInstanceId]===void 0&&(O[B.bucketInstanceId]=[]),O[B.bucketInstanceId].push(B.featureIndex))}return O}insertCollisionBox(n,a,d,m,b,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:T,overlapMode:a},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,d,m,b,T){const C=d?this.ignoredGrid:this.grid,k={bucketInstanceId:m,featureIndex:b,collisionGroupID:T,overlapMode:a};for(let D=0;D<n.length;D+=4)C.insertCircle(k,n[D],n[D+1],n[D+2])}projectAndGetPerspectiveRatio(n,a,d,m,b){if(b){let T;m?(T=[n,a,m(n,a),1],c.aw(T,T,b)):(T=[n,a,0,1],Bo(T,T,b));const C=T[3];return{x:(T[0]/C+1)/2*this.transform.width+sr,y:(-T[1]/C+1)/2*this.transform.height+sr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}{const T=this.transform.projectTileCoordinates(n,a,d,m);return{x:(T.point.x+1)/2*this.transform.width+sr,y:(1-T.point.y)/2*this.transform.height+sr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5,isOccluded:T.isOccluded,signedDistanceFromCamera:T.signedDistanceFromCamera}}}getPerspectiveRatio(n,a,d,m){const b=this.transform.projectTileCoordinates(n,a,d,m);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(n,a,d,m){return d<sr||n>=this.screenRightBoundary||m<sr||a>this.screenBottomBoundary}isInsideGrid(n,a,d,m){return d>=0&&n<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=c.ag([]);return c.M(n,n,[-100,-100,0]),n}_projectCollisionBox(n,a,d,m,b,T,C,k,D,O,U){let B=1,q=0,Q=0,ue=1;const he=n.anchorPointX+C[0],de=n.anchorPointY+C[1];if(T&&!b){const ot=this.projectAndGetPerspectiveRatio(he+1,de,m,D,U),tt=ot.x-k.x,Et=Math.atan((ot.y-k.y)/tt)+(tt<0?Math.PI:0),Wt=Math.sin(Et),Tn=Math.cos(Et);B=Tn,q=Wt,Q=-Wt,ue=Tn}else if(!T&&b){const ot=nn(this.transform);B=ot.vecEast[0],q=ot.vecEast[1],Q=ot.vecSouth[0],ue=ot.vecSouth[1]}let ge=k.x,ve=k.y,_e=a;b&&(ge=he,ve=de,_e=Math.pow(2,-(this.transform.zoom-d.overscaledZ)),_e*=this.transform.getPitchedTextCorrection(he,de,m),O||(_e*=c.ah(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),O&&(ge+=B*O.x*_e+Q*O.y*_e,ve+=q*O.x*_e+ue*O.y*_e);const Te=n.x1*_e,Ee=n.x2*_e,xe=(Te+Ee)/2,Ae=n.y1*_e,qe=n.y2*_e,Ue=(Ae+qe)/2,$e=[{offsetX:Te,offsetY:Ae},{offsetX:xe,offsetY:Ae},{offsetX:Ee,offsetY:Ae},{offsetX:Ee,offsetY:Ue},{offsetX:Ee,offsetY:qe},{offsetX:xe,offsetY:qe},{offsetX:Te,offsetY:qe},{offsetX:Te,offsetY:Ue}];let Ze=[];for(const{offsetX:ot,offsetY:tt}of $e)Ze.push(new c.P(ge+B*ot+Q*tt,ve+q*ot+ue*tt));let st=!1;if(b){const ot=Ze.map(tt=>this.projectAndGetPerspectiveRatio(tt.x,tt.y,m,D,U));st=ot.some(tt=>!tt.isOccluded),Ze=ot.map(tt=>new c.P(tt.x,tt.y))}else st=!0;return{box:c.aA(Ze),allPointsOccluded:!st}}}class Nn{constructor(n,a,d,m){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Fo{constructor(n,a,d,m,b){this.text=new Nn(n?n.text:null,a,d,b),this.icon=new Nn(n?n.icon:null,a,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Cs{constructor(n,a,d){this.text=n,this.icon=a,this.skipFade=d}}class oc{constructor(n,a,d,m,b){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=b}}class go{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[n]}}function Li(_,n,a,d,m){const{horizontalAlign:b,verticalAlign:T}=c.aH(_);return new c.P(-(b-.5)*n+d[0]*m,-(T-.5)*a+d[1]*m)}class vn{constructor(n,a,d,m,b){this.transform=n.clone(),this.terrain=a,this.collisionIndex=new Ri(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new go(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(n){const a=this.terrain;return a?(d,m)=>a.getElevation(n,d,m):null}getBucketParts(n,a,d,m){const b=d.getBucket(a),T=d.latestFeatureIndex;if(!b||!T||a.id!==b.layerIds[0])return;const C=d.collisionBoxArray,k=b.layers[0].layout,D=b.layers[0].paint,O=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),U=d.tileSize/c.$,B=d.tileID.toUnwrapped(),q=k.get("text-rotation-alignment")==="map",Q=c.aC(d,1,this.transform.zoom),ue=c.aD(this.collisionIndex.transform,d,D.get("text-translate"),D.get("text-translate-anchor")),he=c.aD(this.collisionIndex.transform,d,D.get("icon-translate"),D.get("icon-translate-anchor")),de=En(q,this.transform,Q);this.retainedQueryData[b.bucketInstanceId]=new oc(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,d.tileID);const ge={bucket:b,layout:k,translationText:ue,translationIcon:he,unwrappedTileID:B,pitchedLabelPlaneMatrix:de,scale:O,textPixelRatio:U,holdingForFade:d.holdingForSymbolFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:c.an(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const ve of b.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Te,symbolInstanceEnd:Ee}=ve;n.push({sortKey:_e,symbolInstanceStart:Te,symbolInstanceEnd:Ee,parameters:ge})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(n,a,d,m,b,T,C,k,D,O,U,B,q,Q,ue,he,de,ge,ve,_e){const Te=c.aE[n.textAnchor],Ee=[n.textOffset0,n.textOffset1],xe=Li(Te,d,m,Ee,b),Ae=this.collisionIndex.placeCollisionBox(a,B,k,D,O,C,T,he,U.predicate,ve,xe,_e);if((!ge||this.collisionIndex.placeCollisionBox(ge,B,k,D,O,C,T,de,U.predicate,ve,xe,_e).placeable)&&Ae.placeable){let qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(qe=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Ee,width:d,height:m,anchor:Te,textBoxScale:b,prevAnchor:qe},this.markUsedJustification(Q,Te,q,ue),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,ue,q),this.placedOrientations[q.crossTileID]=ue),{shift:xe,placedGlyphBoxes:Ae}}}placeLayerBucketPart(n,a,d){const{bucket:m,layout:b,translationText:T,translationIcon:C,unwrappedTileID:k,pitchedLabelPlaneMatrix:D,textPixelRatio:O,holdingForFade:U,collisionBoxArray:B,partiallyEvaluatedTextSize:q,collisionGroup:Q}=n.parameters,ue=b.get("text-optional"),he=b.get("icon-optional"),de=c.aF(b,"text-overlap","text-allow-overlap"),ge=de==="always",ve=c.aF(b,"icon-overlap","icon-allow-overlap"),_e=ve==="always",Te=b.get("text-rotation-alignment")==="map",Ee=b.get("text-pitch-alignment")==="map",xe=b.get("icon-text-fit")!=="none",Ae=b.get("symbol-z-order")==="viewport-y",qe=ge&&(_e||!m.hasIconData()||he),Ue=_e&&(ge||!m.hasTextData()||ue);!m.collisionArrays&&B&&m.deserializeCollisionBoxes(B);const $e=this.retainedQueryData[m.bucketInstanceId].tileID,Ze=this._getTerrainElevationFunc($e),st=this.transform.getFastPathSimpleProjectionMatrix($e),ot=(tt,Et,Wt)=>{var Tn,Sn;if(a[tt.crossTileID])return;if(U)return void(this.placements[tt.crossTileID]=new Cs(!1,!1,!1));let An=!1,er=!1,jn=!0,gn=null,qn={box:null,placeable:!1,offscreen:null,occluded:!1},di={placeable:!1},Er=null,Cr=null,Fi=null,el=0,to=0,tl=0;Et.textFeatureIndex?el=Et.textFeatureIndex:tt.useRuntimeCollisionCircles&&(el=tt.featureIndex),Et.verticalTextFeatureIndex&&(to=Et.verticalTextFeatureIndex);const Ol=Et.textBox;if(Ol){const us=_r=>{let Gr=c.ao.horizontal;if(m.allowVerticalPlacement&&!_r&&this.prevPlacement){const ds=this.prevPlacement.placedOrientations[tt.crossTileID];ds&&(this.placedOrientations[tt.crossTileID]=ds,Gr=ds,this.markUsedOrientation(m,Gr,tt))}return Gr},Co=(_r,Gr)=>{if(m.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&Et.verticalTextBox){for(const ds of m.writingModes)if(ds===c.ao.vertical?(qn=Gr(),di=qn):qn=_r(),qn&&qn.placeable)break}else qn=_r()},Io=tt.textAnchorOffsetStartIndex,hs=tt.textAnchorOffsetEndIndex;if(hs===Io){const _r=(Gr,ds)=>{const Jr=this.collisionIndex.placeCollisionBox(Gr,de,O,$e,k,Ee,Te,T,Q.predicate,Ze,void 0,st);return Jr&&Jr.placeable&&(this.markUsedOrientation(m,ds,tt),this.placedOrientations[tt.crossTileID]=ds),Jr};Co(()=>_r(Ol,c.ao.horizontal),()=>{const Gr=Et.verticalTextBox;return m.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&Gr?_r(Gr,c.ao.vertical):{box:null,offscreen:null}}),us(qn&&qn.placeable)}else{let _r=c.aE[(Sn=(Tn=this.prevPlacement)===null||Tn===void 0?void 0:Tn.variableOffsets[tt.crossTileID])===null||Sn===void 0?void 0:Sn.anchor];const Gr=(Jr,Ef,Uu)=>{const jl=Jr.x2-Jr.x1,aa=Jr.y2-Jr.y1,no=tt.textBoxScale,nl=xe&&ve==="never"?Ef:null;let rl=null,Cf=de==="never"?1:2,If="never";_r&&Cf++;for(let il=0;il<Cf;il++){for(let kf=Io;kf<hs;kf++){const Mf=m.textAnchorOffsets.get(kf);if(_r&&Mf.textAnchor!==_r)continue;const Vu=this.attemptAnchorPlacement(Mf,Jr,jl,aa,no,Te,Ee,O,$e,k,Q,If,tt,m,Uu,T,C,nl,Ze);if(Vu&&(rl=Vu.placedGlyphBoxes,rl&&rl.placeable))return An=!0,gn=Vu.shift,rl}_r?_r=null:If=de}return d&&!rl&&(rl={box:this.collisionIndex.placeCollisionBox(Ol,"always",O,$e,k,Ee,Te,T,Q.predicate,Ze,void 0,st).box,offscreen:!1,placeable:!1,occluded:!1}),rl};Co(()=>Gr(Ol,Et.iconBox,c.ao.horizontal),()=>{const Jr=Et.verticalTextBox;return m.allowVerticalPlacement&&(!qn||!qn.placeable)&&tt.numVerticalGlyphVertices>0&&Jr?Gr(Jr,Et.verticalIconBox,c.ao.vertical):{box:null,occluded:!0,offscreen:null}}),qn&&(An=qn.placeable,jn=qn.offscreen);const ds=us(qn&&qn.placeable);if(!An&&this.prevPlacement){const Jr=this.prevPlacement.variableOffsets[tt.crossTileID];Jr&&(this.variableOffsets[tt.crossTileID]=Jr,this.markUsedJustification(m,Jr.anchor,tt,ds))}}}if(Er=qn,An=Er&&Er.placeable,jn=Er&&Er.offscreen,tt.useRuntimeCollisionCircles&&tt.centerJustifiedTextSymbolIndex>=0){const us=m.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),Co=c.ap(m.textSizeData,q,us),Io=b.get("text-padding");Cr=this.collisionIndex.placeCollisionCircles(de,us,m.lineVertexArray,m.glyphOffsetArray,Co,k,D,d,Ee,Q.predicate,tt.collisionCircleDiameter,Io,T,Ze),Cr.circles.length&&Cr.collisionDetected&&!d&&c.w("Collisions detected, but collision boxes are not shown"),An=ge||Cr.circles.length>0&&!Cr.collisionDetected,jn=jn&&Cr.offscreen}if(Et.iconFeatureIndex&&(tl=Et.iconFeatureIndex),Et.iconBox){const us=Co=>this.collisionIndex.placeCollisionBox(Co,ve,O,$e,k,Ee,Te,C,Q.predicate,Ze,xe&&gn?gn:void 0,st);di&&di.placeable&&Et.verticalIconBox?(Fi=us(Et.verticalIconBox),er=Fi.placeable):(Fi=us(Et.iconBox),er=Fi.placeable),jn=jn&&Fi.offscreen}const Kh=ue||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,Ac=he||tt.numIconVertices===0;Kh||Ac?Ac?Kh||(er=er&&An):An=er&&An:er=An=er&&An;const oa=er&&Fi.placeable;if(An&&Er.placeable&&this.collisionIndex.insertCollisionBox(Er.box,de,b.get("text-ignore-placement"),m.bucketInstanceId,di&&di.placeable&&to?to:el,Q.ID),oa&&this.collisionIndex.insertCollisionBox(Fi.box,ve,b.get("icon-ignore-placement"),m.bucketInstanceId,tl,Q.ID),Cr&&An&&this.collisionIndex.insertCollisionCircles(Cr.circles,de,b.get("text-ignore-placement"),m.bucketInstanceId,el,Q.ID),d&&this.storeCollisionData(m.bucketInstanceId,Wt,Et,Er,Fi,Cr),tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new Cs((An||qe)&&!(Er!=null&&Er.occluded),(er||Ue)&&!(Fi!=null&&Fi.occluded),jn||m.justReloaded),a[tt.crossTileID]=!0};if(Ae){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Et=tt.length-1;Et>=0;--Et){const Wt=tt[Et];ot(m.symbolInstances.get(Wt),m.collisionArrays[Wt],Wt)}}else for(let tt=n.symbolInstanceStart;tt<n.symbolInstanceEnd;tt++)ot(m.symbolInstances.get(tt),m.collisionArrays[tt],tt);m.justReloaded=!1}storeCollisionData(n,a,d,m,b,T){if(d.textBox||d.iconBox){let C,k;this.collisionBoxArrays.has(n)?C=this.collisionBoxArrays.get(n):(C=new Map,this.collisionBoxArrays.set(n,C)),C.has(a)?k=C.get(a):(k={text:null,icon:null},C.set(a,k)),d.textBox&&(k.text=m.box),d.iconBox&&(k.icon=b.box)}if(T){let C=this.collisionCircleArrays[n];C===void 0&&(C=this.collisionCircleArrays[n]=[]);for(let k=0;k<T.circles.length;k+=4)C.push(T.circles[k+0]-sr),C.push(T.circles[k+1]-sr),C.push(T.circles[k+2]),C.push(T.collisionDetected?1:0)}}markUsedJustification(n,a,d,m){let b;b=m===c.ao.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[c.aG(a)];const T=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const C of T)C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=b>=0&&C!==b?0:d.crossTileID)}markUsedOrientation(n,a,d){const m=a===c.ao.horizontal||a===c.ao.horizontalOnly?a:0,b=a===c.ao.vertical?a:0,T=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const C of T)n.text.placedSymbolArray.get(C).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const m=a?a.symbolFadeChange(n):1,b=a?a.opacities:{},T=a?a.variableOffsets:{},C=a?a.placedOrientations:{};for(const k in this.placements){const D=this.placements[k],O=b[k];O?(this.opacities[k]=new Fo(O,m,D.text,D.icon),d=d||D.text!==O.text.placed||D.icon!==O.icon.placed):(this.opacities[k]=new Fo(null,m,D.text,D.icon,D.skipFade),d=d||D.text||D.icon)}for(const k in b){const D=b[k];if(!this.opacities[k]){const O=new Fo(D,m,!1,!1);O.isHidden()||(this.opacities[k]=O,d=d||D.text.placed||D.icon.placed)}}for(const k in T)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=T[k]);for(const k in C)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=C[k]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const d={};for(const m of a){const b=m.getBucket(n);b&&m.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,d,m.collisionBoxArray)}}updateBucketOpacities(n,a,d,m){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const b=n.layers[0],T=b.layout,C=new Fo(null,0,!1,!1,!0),k=T.get("text-allow-overlap"),D=T.get("icon-allow-overlap"),O=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),U=T.get("text-rotation-alignment")==="map",B=T.get("text-pitch-alignment")==="map",q=T.get("icon-text-fit")!=="none",Q=new Fo(null,0,k&&(D||!n.hasIconData()||T.get("icon-optional")),D&&(k||!n.hasTextData()||T.get("text-optional")),!0);!n.collisionArrays&&m&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(m);const ue=(de,ge,ve)=>{for(let _e=0;_e<ge/4;_e++)de.opacityVertexArray.emplaceBack(ve);de.hasVisibleVertices=de.hasVisibleVertices||ve!==Nr},he=this.collisionBoxArrays.get(n.bucketInstanceId);for(let de=0;de<n.symbolInstances.length;de++){const ge=n.symbolInstances.get(de),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:_e,crossTileID:Te}=ge;let Ee=this.opacities[Te];d[Te]?Ee=C:Ee||(Ee=Q,this.opacities[Te]=Ee),d[Te]=!0;const xe=ge.numIconVertices>0,Ae=this.placedOrientations[ge.crossTileID],qe=Ae===c.ao.vertical,Ue=Ae===c.ao.horizontal||Ae===c.ao.horizontalOnly;if(ve>0||_e>0){const Ze=Ca(Ee.text);ue(n.text,ve,qe?Nr:Ze),ue(n.text,_e,Ue?Nr:Ze);const st=Ee.text.isHidden();[ge.rightJustifiedTextSymbolIndex,ge.centerJustifiedTextSymbolIndex,ge.leftJustifiedTextSymbolIndex].forEach(Et=>{Et>=0&&(n.text.placedSymbolArray.get(Et).hidden=st||qe?1:0)}),ge.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ge.verticalPlacedTextSymbolIndex).hidden=st||Ue?1:0);const ot=this.variableOffsets[ge.crossTileID];ot&&this.markUsedJustification(n,ot.anchor,ge,Ae);const tt=this.placedOrientations[ge.crossTileID];tt&&(this.markUsedJustification(n,"left",ge,tt),this.markUsedOrientation(n,tt,ge))}if(xe){const Ze=Ca(Ee.icon),st=!(q&&ge.verticalPlacedIconSymbolIndex&&qe);ge.placedIconSymbolIndex>=0&&(ue(n.icon,ge.numIconVertices,st?Ze:Nr),n.icon.placedSymbolArray.get(ge.placedIconSymbolIndex).hidden=Ee.icon.isHidden()),ge.verticalPlacedIconSymbolIndex>=0&&(ue(n.icon,ge.numVerticalIconVertices,st?Nr:Ze),n.icon.placedSymbolArray.get(ge.verticalPlacedIconSymbolIndex).hidden=Ee.icon.isHidden())}const $e=he&&he.has(de)?he.get(de):{text:null,icon:null};if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Ze=n.collisionArrays[de];if(Ze){let st=new c.P(0,0);if(Ze.textBox||Ze.verticalTextBox){let ot=!0;if(O){const tt=this.variableOffsets[Te];tt?(st=Li(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),U&&st._rotate(B?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ot=!1}if(Ze.textBox||Ze.verticalTextBox){let tt;Ze.textBox&&(tt=qe),Ze.verticalTextBox&&(tt=Ue),On(n.textCollisionBox.collisionVertexArray,Ee.text.placed,!ot||tt,$e.text,st.x,st.y)}}if(Ze.iconBox||Ze.verticalIconBox){const ot=!!(!Ue&&Ze.verticalIconBox);let tt;Ze.iconBox&&(tt=ot),Ze.verticalIconBox&&(tt=!ot),On(n.iconCollisionBox.collisionVertexArray,Ee.icon.placed,tt,$e.icon,q?st.x:0,q?st.y:0)}}}}if(n.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);n.bucketInstanceId in this.collisionCircleArrays&&(n.collisionCircleArray=this.collisionCircleArrays[n.bucketInstanceId],delete this.collisionCircleArrays[n.bucketInstanceId])}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function On(_,n,a,d,m,b){d&&d.length!==0||(d=[0,0,0,0]);const T=d[0]-sr,C=d[1]-sr,k=d[2]-sr,D=d[3]-sr;_.emplaceBack(n?1:0,a?1:0,m||0,b||0,T,C),_.emplaceBack(n?1:0,a?1:0,m||0,b||0,k,C),_.emplaceBack(n?1:0,a?1:0,m||0,b||0,k,D),_.emplaceBack(n?1:0,a?1:0,m||0,b||0,T,D)}const vl=Math.pow(2,25),ss=Math.pow(2,24),Uo=Math.pow(2,17),wu=Math.pow(2,16),rn=Math.pow(2,9),or=Math.pow(2,8),ac=Math.pow(2,1);function Ca(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const n=_.placed?1:0,a=Math.floor(127*_.opacity);return a*vl+n*ss+a*Uo+n*wu+a*rn+n*or+a*ac+n}const Nr=0;class Tu{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,a,d,m,b){const T=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(T,m,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,k)=>C.sortKey-k.sortKey));this._currentPartIndex<T.length;)if(a.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,b())return!0;return!1}}class xl{constructor(n,a,d,m,b,T,C,k){this.placement=new vn(n,a,T,C,k),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(n,a,d){const m=K.now(),b=()=>!this._forceFullPlacement&&K.now()-m>2;for(;this._currentPlacementIndex>=0;){const T=a[n[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Tu(T)),this._inProgressLayer.continuePlacement(d[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const zi=512/c.$/2;class Yn{constructor(n,a,d){this.tileID=n,this.bucketInstanceId=d,this._symbolsByKey={};const m=new Map;for(let b=0;b<a.length;b++){const T=a.get(b),C=T.key,k=m.get(C);k?k.push(T):m.set(C,[T])}for(const[b,T]of m){const C={positions:T.map(k=>({x:Math.floor(k.anchorX*zi),y:Math.floor(k.anchorY*zi)})),crossTileIDs:T.map(k=>k.crossTileID)};if(C.positions.length>128){const k=new c.aI(C.positions.length,16,Uint16Array);for(const{x:D,y:O}of C.positions)k.add(D,O);k.finish(),delete C.positions,C.index=k}this._symbolsByKey[b]=C}}getScaledCoordinates(n,a){const{x:d,y:m,z:b}=this.tileID.canonical,{x:T,y:C,z:k}=a.canonical,D=zi/Math.pow(2,k-b),O=(C*c.$+n.anchorY)*D,U=m*c.$*zi;return{x:Math.floor((T*c.$+n.anchorX)*D-d*c.$*zi),y:Math.floor(O-U)}}findMatches(n,a,d){const m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let b=0;b<n.length;b++){const T=n.get(b);if(T.crossTileID)continue;const C=this._symbolsByKey[T.key];if(!C)continue;const k=this.getScaledCoordinates(T,a);if(C.index){const D=C.index.range(k.x-m,k.y-m,k.x+m,k.y+m).sort();for(const O of D){const U=C.crossTileIDs[O];if(!d[U]){d[U]=!0,T.crossTileID=U;break}}}else if(C.positions)for(let D=0;D<C.positions.length;D++){const O=C.positions[D],U=C.crossTileIDs[D];if(Math.abs(O.x-k.x)<=m&&Math.abs(O.y-k.y)<=m&&!d[U]){d[U]=!0,T.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:n})=>n)}}class Vo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const d in this.indexes){const m=this.indexes[d],b={};for(const T in m){const C=m[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+a),b[C.tileID.key]=C}this.indexes[d]=b}this.lng=n}addBucket(n,a,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const m=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>n.overscaledZ)for(const C in T){const k=T[C];k.tileID.isChildOf(n)&&k.findMatches(a.symbolInstances,n,m)}else{const C=T[n.scaledTo(Number(b)).key];C&&C.findMatches(a.symbolInstances,n,m)}}for(let b=0;b<a.symbolInstances.length;b++){const T=a.symbolInstances.get(b);T.crossTileID||(T.crossTileID=d.generate(),m[T.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Yn(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const d of a.getCrossTileIDsLists())for(const m of d)delete this.usedCrossTileIDs[n][m]}removeStaleBuckets(n){let a=!1;for(const d in this.indexes){const m=this.indexes[d];for(const b in m)n[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[b]),delete m[b],a=!0)}return a}}class qs{constructor(){this.layerIndexes={},this.crossTileIDs=new Vo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,d){let m=this.layerIndexes[n.id];m===void 0&&(m=this.layerIndexes[n.id]=new Gs);let b=!1;const T={};m.handleWrapJump(d);for(const C of a){const k=C.getBucket(n);k&&n.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(C.tileID,k,this.crossTileIDs)&&(b=!0),T[k.bucketInstanceId]=!0)}return m.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(n){const a={};n.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}var bl="void main() {fragColor=vec4(1.0);}";const Sr={prelude:sn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:sn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:sn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:sn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:sn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:sn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:sn(bl,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:sn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:sn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:sn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:sn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:sn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:sn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:sn(bl,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:sn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:sn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:sn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:sn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:sn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:sn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:sn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:sn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:sn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:sn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:sn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:sn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:sn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:sn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:sn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:sn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:sn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:sn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:sn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:sn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:sn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:sn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:sn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function sn(_,n){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=n.match(/in ([\w]+) ([\w]+)/g),m=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=b?b.concat(m):m,C={};return{fragmentSource:_=_.replace(a,(k,D,O,U,B)=>(C[B]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${O} ${U} ${B};
#else
uniform ${O} ${U} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${O} ${U} ${B} = u_${B};
#endif
`)),vertexSource:n=n.replace(a,(k,D,O,U,B)=>{const q=U==="float"?"vec2":"vec4",Q=B.match(/color/)?"color":q;return C[B]?D==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${O} ${q} a_${B};
out ${O} ${U} ${B};
#else
uniform ${O} ${U} u_${B};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${O} ${U} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${Q}(a_${B}, u_${B}_t);
#else
    ${O} ${U} ${B} = u_${B};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${O} ${q} a_${B};
#else
uniform ${O} ${U} u_${B};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${O} ${U} ${B} = a_${B};
#else
    ${O} ${U} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${O} ${U} ${B} = unpack_mix_${Q}(a_${B}, u_${B}_t);
#else
    ${O} ${U} ${B} = u_${B};
#endif
`}),staticAttributes:d,staticUniforms:T}}class _o{constructor(n,a,d){this.vertexBuffer=n,this.indexBuffer=a,this.segments=d}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Or=c.aJ([{name:"a_pos",type:"Int16",components:2}]);const Ws="#define PROJECTION_MERCATOR",Qt="mercator";class yo{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Qt}get shaderDefine(){return Ws}get shaderPreludeCode(){return Sr.projectionMercator}get vertexShaderPreludeCode(){return Sr.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(n){}getMeshFromTileID(n,a,d,m,b){if(this._cachedMesh)return this._cachedMesh;const T=new c.aL;T.emplaceBack(0,0),T.emplaceBack(c.$,0),T.emplaceBack(0,c.$),T.emplaceBack(c.$,c.$);const C=n.createVertexBuffer(T,Or.members),k=c.aM.simpleSegment(0,0,4,2),D=new c.aN;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3);const O=n.createIndexBuffer(D);return this._cachedMesh=new _o(C,O,k),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(n){}}class Ia{constructor(n=0,a=0,d=0,m=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=d,this.right=m}interpolate(n,a,d){return a.top!=null&&n.top!=null&&(this.top=c.C.number(n.top,a.top,d)),a.bottom!=null&&n.bottom!=null&&(this.bottom=c.C.number(n.bottom,a.bottom,d)),a.left!=null&&n.left!=null&&(this.left=c.C.number(n.left,a.left,d)),a.right!=null&&n.right!=null&&(this.right=c.C.number(n.right,a.right,d)),this}getCenter(n,a){const d=c.ah((this.left+n-this.right)/2,0,n),m=c.ah((this.top+a-this.bottom)/2,0,a);return new c.P(d,m)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Ia(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function vo(_,n){if(!_.renderWorldCopies||_.lngRange)return;const a=n.lng-_.center.lng;n.lng+=a>180?-360:a<-180?360:0}function Si(_){return Math.max(0,Math.floor(_))}class Dt{constructor(n,a,d,m,b,T){this._callbacks=n,this._tileSize=512,this._renderWorldCopies=T===void 0||!!T,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=b??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Si(this._zoom),this._scale=c.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ia,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(n,a,d){this._latRange=n.latRange,this._lngRange=n.lngRange,this._width=n.width,this._height=n.height,this._center=n.center,this._elevation=n.elevation,this._minElevationForCurrentTile=n.minElevationForCurrentTile,this._zoom=n.zoom,this._tileZoom=Si(this._zoom),this._scale=c.af(this._zoom),this._bearingInRadians=n.bearingInRadians,this._fovInRadians=n.fovInRadians,this._pitchInRadians=n.pitchInRadians,this._rollInRadians=n.rollInRadians,this._unmodified=n.unmodified,this._edgeInsets=new Ia(n.padding.top,n.padding.bottom,n.padding.left,n.padding.right),this._minZoom=n.minZoom,this._maxZoom=n.maxZoom,this._minPitch=n.minPitch,this._maxPitch=n.maxPitch,this._renderWorldCopies=n.renderWorldCopies,this._cameraToCenterDistance=n.cameraToCenterDistance,this._nearZ=n.nearZ,this._farZ=n.farZ,this._autoCalculateNearFarZ=!d&&n.autoCalculateNearFarZ,a&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(n){this._minElevationForCurrentTile=n}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(n){this._minZoom!==n&&(this._minZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(n){this._minPitch!==n&&(this._minPitch=n,this.setPitch(Math.max(this.pitch,n)))}get maxPitch(){return this._maxPitch}setMaxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.setPitch(Math.min(this.pitch,n)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(n){const a=c.aO(n,-180,180)*Math.PI/180;var d,m,b,T,C,k,D,O,U;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=N(),d=this._rotationMatrix,b=-this._bearingInRadians,T=(m=this._rotationMatrix)[0],C=m[1],k=m[2],D=m[3],O=Math.sin(b),U=Math.cos(b),d[0]=T*U+k*O,d[1]=C*U+D*O,d[2]=T*-O+k*U,d[3]=C*-O+D*U)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(n){const a=c.ah(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(n){const a=n/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aP(this._fovInRadians)}setFov(n){n=c.ah(n,.1,150),this.fov!==n&&(this._unmodified=!1,this._fovInRadians=c.ae(n),this._calcMatrices())}get zoom(){return this._zoom}setZoom(n){const a=this.getConstrained(this._center,n).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=c.af(a),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(n,a){this._autoCalculateNearFarZ=!1,this._nearZ=n,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,d){this._unmodified=!1,this._edgeInsets.interpolate(n,a,d),this._constrain(),this._calcMatrices()}resize(n,a,d=!0){this._width=n,this._height=a,d&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new In([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(n){n?(this._lngRange=[n.getWest(),n.getEast()],this._latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-c.ai,c.ai])}getConstrained(n,a){return this._callbacks.getConstrained(n,a)}getCameraQueryGeometry(n,a){if(a.length===1)return[a[0],n];{const{minX:d,minY:m,maxX:b,maxY:T}=c.a2.fromPoints(a).extend(n);return[new c.P(d,m),new c.P(b,m),new c.P(b,T),new c.P(d,T),new c.P(d,m)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const n=this._unmodified,{center:a,zoom:d}=this.getConstrained(this.center,this.zoom);this.setCenter(a),this.setZoom(d),this._unmodified=n,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let n=c.ag(new Float64Array(16));c.N(n,n,[this._width/2,-this._height/2,1]),c.M(n,n,[1,-1,0]),this._clipSpaceToPixelsMatrix=n,n=c.ag(new Float64Array(16)),c.N(n,n,[1,-1,1]),c.M(n,n,[-1,-1,0]),c.N(n,n,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=n,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(n,a,d,m){const b=d!==void 0?d:this.bearing,T=m=m!==void 0?m:this.pitch,C=c.a1.fromLngLat(n,a),k=-Math.cos(c.ae(T)),D=Math.sin(c.ae(T)),O=D*Math.sin(c.ae(b)),U=-D*Math.cos(c.ae(b));let B=this.elevation;const q=a-B;let Q;k*q>=0||Math.abs(k)<.1?(Q=1e4,B=a+Q*k):Q=-q/k;let ue,he,de=c.aQ(1,C.y),ge=0;do{if(ge+=1,ge>10)break;he=Q/de,ue=new c.a1(C.x+O*he,C.y+U*he),de=1/ue.meterInMercatorCoordinateUnits()}while(Math.abs(Q-he*de)>1e-12);return{center:ue.toLngLat(),elevation:B,zoom:c.ak(this.height/2/Math.tan(this.fovInRadians/2)/he/this.tileSize)}}recalculateZoomAndCenter(n){if(this.elevation-n==0)return;const a=c.aj(1,this.center.lat)*this.worldSize,d=this.cameraToCenterDistance/a,m=c.a1.fromLngLat(this.center,this.elevation),b=He(this.center,this.elevation,this.pitch,this.bearing,d);this._elevation=n;const T=this.calculateCenterFromCameraLngLatAlt(b.toLngLat(),c.aQ(b.z,m.y),this.bearing,this.pitch);this._elevation=T.elevation,this._center=T.center,this.setZoom(T.zoom)}getCameraPoint(){const n=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(n*Math.sin(this.rollInRadians),n*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const n=c.aj(1,this.center.lat)*this.worldSize;return He(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/n).toLngLat()}getMercatorTileCoordinates(n){if(!n)return[0,0,1,1];const a=n.canonical.z>=0?1<<n.canonical.z:Math.pow(2,n.canonical.z);return[n.canonical.x/a,n.canonical.y/a,1/a/c.$,1/a/c.$]}}class kn{constructor(n,a){this.min=n,this.max=a,this.center=c.aR([],c.aS([],this.min,this.max),.5)}quadrant(n){const a=[n%2==0,n<2],d=c.aT(this.min),m=c.aT(this.max);for(let b=0;b<a.length;b++)d[b]=a[b]?this.min[b]:this.center[b],m[b]=a[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new kn(d,m)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersectsFrustum(n){let a=!0;for(let d=0;d<n.planes.length;d++){const m=this.intersectsPlane(n.planes[d]);if(m===0)return 0;m===1&&(a=!1)}return a?2:n.aabb.min[0]>this.max[0]||n.aabb.min[1]>this.max[1]||n.aabb.min[2]>this.max[2]||n.aabb.max[0]<this.min[0]||n.aabb.max[1]<this.min[1]||n.aabb.max[2]<this.min[2]?0:1}intersectsPlane(n){let a=n[3],d=n[3];for(let m=0;m<3;m++)n[m]>0?(a+=n[m]*this.min[m],d+=n[m]*this.max[m]):(d+=n[m]*this.min[m],a+=n[m]*this.max[m]);return a>=0?2:d<0?0:1}}class en{distanceToTile2d(n,a,d,m){const b=m.distanceX([n,a]),T=m.distanceY([n,a]);return Math.hypot(b,T)}getWrap(n,a,d){return d}getTileBoundingVolume(n,a,d,m){var b,T;let C=0,k=0;if(m!=null&&m.terrain){const O=new c.Z(n.z,a,n.z,n.x,n.y),U=m.terrain.getMinMaxElevation(O);C=(b=U.minElevation)!==null&&b!==void 0?b:Math.min(0,d),k=(T=U.maxElevation)!==null&&T!==void 0?T:Math.max(0,d)}const D=1<<n.z;return new kn([a+n.x/D,n.y/D,C],[a+(n.x+1)/D,(n.y+1)/D,k])}allowVariableZoom(n,a){const d=n.fov*(Math.abs(Math.cos(n.rollInRadians))*n.height+Math.abs(Math.sin(n.rollInRadians))*n.width)/n.height,m=c.ah(78.5-d/2,0,60);return!!a.terrain||n.pitch>m}allowWorldCopies(){return!0}prepareNextFrame(){}}class Mn{constructor(n,a,d){this.points=n,this.planes=a,this.aabb=d}static fromInvProjectionMatrix(n,a=1,d=0,m,b){const T=b?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],C=Math.pow(2,d),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>function(q,Q,ue,he){const de=c.aw([],q,Q),ge=1/de[3]/ue*he;return c.aY(de,de,[ge,ge,1/de[3],ge])}(B,n,a,C));m&&function(B,q,Q,ue){const he=ue?4:0,de=ue?0:4;let ge=0;const ve=[],_e=[];for(let xe=0;xe<4;xe++){const Ae=c.aU([],B[xe+de],B[xe+he]),qe=c.aZ(Ae);c.aR(Ae,Ae,1/qe),ve.push(qe),_e.push(Ae)}for(let xe=0;xe<4;xe++){const Ae=c.a_(B[xe+he],_e[xe],Q);ge=Ae!==null&&Ae>=0?Math.max(ge,Ae):Math.max(ge,ve[xe])}const Te=function(xe,Ae){const qe=c.aU([],xe[Ae[0]],xe[Ae[1]]),Ue=c.aU([],xe[Ae[2]],xe[Ae[1]]),$e=[0,0,0,0];return c.aV($e,c.aW([],qe,Ue)),$e[3]=-c.aX($e,xe[Ae[0]]),$e}(B,q),Ee=function(xe,Ae){const qe=c.a$(xe),Ue=c.b0([],xe,1/qe),$e=c.aU([],Ae,c.aR([],Ue,c.aX(Ae,Ue))),Ze=c.a$($e);if(Ze>0){const st=Math.sqrt(1-Ue[3]*Ue[3]),ot=c.aR([],Ue,-Ue[3]),tt=c.aS([],ot,c.aR([],$e,st/Ze));return c.b1(Ae,tt)}return null}(Q,Te);if(Ee!==null){const xe=Ee/c.aX(_e[0],Te);ge=Math.min(ge,xe)}for(let xe=0;xe<4;xe++){const Ae=Math.min(ge,ve[xe]);B[xe+de]=[B[xe+he][0]+_e[xe][0]*Ae,B[xe+he][1]+_e[xe][1]*Ae,B[xe+he][2]+_e[xe][2]*Ae,1]}}(k,T[0],m,b);const D=T.map(B=>{const q=c.aU([],k[B[0]],k[B[1]]),Q=c.aU([],k[B[2]],k[B[1]]),ue=c.aV([],c.aW([],q,Q)),he=-c.aX(ue,k[B[1]]);return ue.concat(he)}),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],U=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const B of k)for(let q=0;q<3;q++)O[q]=Math.min(O[q],B[q]),U[q]=Math.max(U[q],B[q]);return new Mn(k,D,new kn(O,U))}}class xo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,a,d){return this._helper.interpolatePadding(n,a,d)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,a,d=!0){this._helper.resize(n,a,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,a){this._helper.overrideNearFarZ(n,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n,a){}constructor(n,a,d,m,b){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Dt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(T,C)=>this.getConstrained(T,C)},n,a,d,m,b),this._coveringTilesDetailsProvider=new en}clone(){const n=new xo;return n.apply(this),n}apply(n,a,d){this._helper.apply(n,a,d)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(n){const a=[new c.b2(0,n)];if(this._helper._renderWorldCopies){const d=this.screenPointToMercatorCoordinate(new c.P(0,0)),m=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),T=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),C=Math.floor(Math.min(d.x,m.x,b.x,T.x)),k=Math.floor(Math.max(d.x,m.x,b.x,T.x)),D=1;for(let O=C-D;O<=k+D;O++)O!==0&&a.push(new c.b2(O,n))}return a}getCameraFrustum(){return Mn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){const a=this.screenPointToLocation(this.centerPoint,n),d=n?n.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(d)}setLocationAtPoint(n,a){const d=c.aj(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(a,d),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,d),T=c.a1.fromLngLat(n),C=new c.a1(T.x-(m.x-b.x),T.y-(m.y-b.y));this.setCenter(C==null?void 0:C.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(n,a){return a?this.coordinatePoint(c.a1.fromLngLat(n),a.getElevationForLngLatZoom(n,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.a1.fromLngLat(n))}screenPointToLocation(n,a){var d;return(d=this.screenPointToMercatorCoordinate(n,a))===null||d===void 0?void 0:d.toLngLat()}screenPointToMercatorCoordinate(n,a){if(a){const d=a.pointCoordinate(n);if(d!=null)return d}return this.screenPointToMercatorCoordinateAtZ(n)}screenPointToMercatorCoordinateAtZ(n,a){const d=a||0,m=[n.x,n.y,0,1],b=[n.x,n.y,1,1];c.aw(m,m,this._pixelMatrixInverse),c.aw(b,b,this._pixelMatrixInverse);const T=m[3],C=b[3],k=m[1]/T,D=b[1]/C,O=m[2]/T,U=b[2]/C,B=O===U?0:(d-O)/(U-O);return new c.a1(c.C.number(m[0]/T,b[0]/C,B)/this.worldSize,c.C.number(k,D,B)/this.worldSize,d)}coordinatePoint(n,a=0,d=this._pixelMatrix){const m=[n.x*this.worldSize,n.y*this.worldSize,a,1];return c.aw(m,m,d),new c.P(m[0]/m[3],m[1]/m[3])}getBounds(){const n=Math.max(0,this._helper._height/2-je(this));return new In().extend(this.screenPointToLocation(new c.P(0,n))).extend(this.screenPointToLocation(new c.P(this._helper._width,n))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(n,a){return a?a.pointCoordinate(n)!=null:n.y>this.height/2-je(this)}calculatePosMatrix(n,a=!1,d){var m;const b=(m=n.key)!==null&&m!==void 0?m:c.b3(n.wrap,n.canonical.z,n.canonical.z,n.canonical.x,n.canonical.y),T=a?this._alignedPosMatrixCache:this._posMatrixCache;if(T.has(b)){const D=T.get(b);return d?D.f32:D.f64}const C=ke(n,this.worldSize);c.O(C,a?this._alignedProjMatrix:this._viewProjMatrix,C);const k={f64:C,f32:new Float32Array(C)};return T.set(b,k),d?k.f32:k.f64}calculateFogMatrix(n){const a=n.key,d=this._fogMatrixCacheF32;if(d.has(a))return d.get(a);const m=ke(n,this.worldSize);return c.O(m,this._fogMatrix,m),d.set(a,new Float32Array(m)),d.get(a)}getConstrained(n,a){a=c.ah(+a,this.minZoom,this.maxZoom);const d={center:new c.S(n.lng,n.lat),zoom:a};let m=this._helper._lngRange;if(!this._helper._renderWorldCopies&&m===null){const ve=179.9999999999;m=[-ve,ve]}const b=this.tileSize*c.af(d.zoom);let T=0,C=b,k=0,D=b,O=0,U=0;const{x:B,y:q}=this.size;if(this._helper._latRange){const ve=this._helper._latRange;T=c.U(ve[1])*b,C=c.U(ve[0])*b,C-T<q&&(O=q/(C-T))}m&&(k=c.aO(c.V(m[0])*b,0,b),D=c.aO(c.V(m[1])*b,0,b),D<k&&(D+=b),D-k<B&&(U=B/(D-k)));const{x:Q,y:ue}=we(b,n);let he,de;const ge=Math.max(U||0,O||0);if(ge){const ve=new c.P(U?(D+k)/2:Q,O?(C+T)/2:ue);return d.center=Me(b,ve).wrap(),d.zoom+=c.ak(ge),d}if(this._helper._latRange){const ve=q/2;ue-ve<T&&(de=T+ve),ue+ve>C&&(de=C-ve)}if(m){const ve=(k+D)/2;let _e=Q;this._helper._renderWorldCopies&&(_e=c.aO(Q,ve-b/2,ve+b/2));const Te=B/2;_e-Te<k&&(he=k+Te),_e+Te>D&&(he=D-Te)}if(he!==void 0||de!==void 0){const ve=new c.P(he??Q,de??ue);d.center=Me(b,ve).wrap()}return d}calculateCenterFromCameraLngLatAlt(n,a,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(n,a,d,m)}_calculateNearFarZIfNeeded(n,a,d){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=n-m*this._helper._pixelPerMeter/Math.cos(a),T=m<0?b:n,C=Math.PI/2+this.pitchInRadians,k=c.ae(this.fov)*(Math.abs(Math.cos(c.ae(this.roll)))*this.height+Math.abs(Math.sin(c.ae(this.roll)))*this.width)/this.height*(.5+d.y/this.height),D=Math.sin(k)*T/Math.sin(c.ah(Math.PI-C-k,.01,Math.PI-.01)),O=je(this),U=Math.atan(O/this._helper.cameraToCenterDistance),B=c.ae(.75),q=U>B?2*U*(.5+d.y/(2*O)):B,Q=Math.sin(q)*T/Math.sin(c.ah(Math.PI-C-q,.01,Math.PI-.01)),ue=Math.min(D,Q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*ue+T),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const n=this.centerOffset,a=we(this.worldSize,this.center),d=a.x,m=a.y;this._helper._pixelPerMeter=c.aj(1,this.center.lat)*this.worldSize;const b=c.ae(Math.min(this.pitch,ye)),T=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let C;this._calculateNearFarZIfNeeded(T,b,n),C=new Float64Array(16),c.b4(C,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aq(this._invProjMatrix,C),C[8]=2*-n.x/this._helper._width,C[9]=2*n.y/this._helper._height,this._projectionMatrix=c.b5(C),c.N(C,C,[1,-1,1]),c.M(C,C,[0,0,-this._helper.cameraToCenterDistance]),c.b6(C,C,-this.rollInRadians),c.b7(C,C,this.pitchInRadians),c.b6(C,C,-this.bearingInRadians),c.M(C,C,[-d,-m,0]),this._mercatorMatrix=c.N([],C,[this.worldSize,this.worldSize,this.worldSize]),c.N(C,C,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,C),c.M(C,C,[0,0,-this.elevation]),this._viewProjMatrix=C,this._invViewProjMatrix=c.aq([],C);const k=[0,0,-1,1];c.aw(k,k,this._invViewProjMatrix),this._cameraPosition=[k[0]/k[3],k[1]/k[3],k[2]/k[3]],this._fogMatrix=new Float64Array(16),c.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,T,this._helper._farZ),this._fogMatrix[8]=2*-n.x/this.width,this._fogMatrix[9]=2*n.y/this.height,c.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.M(this._fogMatrix,this._fogMatrix,[-d,-m,0]),c.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,C);const D=this._helper._width%2/2,O=this._helper._height%2/2,U=Math.cos(this.bearingInRadians),B=Math.sin(-this.bearingInRadians),q=d-Math.round(d)+U*D+B*O,Q=m-Math.round(m)+U*O+B*D,ue=new Float64Array(C);if(c.M(ue,ue,[q>.5?q-1:q,Q>.5?Q-1:Q,0]),this._alignedProjMatrix=ue,C=c.aq(new Float64Array(16),this._pixelMatrix),!C)throw new Error("failed to invert matrix");this._pixelMatrixInverse=C,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const n=this.screenPointToMercatorCoordinate(new c.P(0,0)),a=[n.x*this.worldSize,n.y*this.worldSize,0,1];return c.aw(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const n=c.aj(1,this.center.lat)*this.worldSize;return He(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/n).toLngLat()}lngLatToCameraDepth(n,a){const d=c.a1.fromLngLat(n),m=[d.x*this.worldSize,d.y*this.worldSize,a,1];return c.aw(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(n){const{overscaledTileID:a,aligned:d,applyTerrainMatrix:m}=n,b=this._helper.getMercatorTileCoordinates(a),T=a?this.calculatePosMatrix(a,d,!0):null;let C;return C=a&&a.terrainRttPosMatrix32f&&m?a.terrainRttPosMatrix32f:T||c.b8(),{mainMatrix:C,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C}}isLocationOccluded(n){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(n,a,d){return 1}transformLightDirection(n){return c.aT(n)}getRayDirectionFromPixel(n){throw new Error("Not implemented.")}projectTileCoordinates(n,a,d,m){const b=this.calculatePosMatrix(d);let T;m?(T=[n,a,m(n,a),1],c.aw(T,T,b)):(T=[n,a,0,1],Bo(T,T,b));const C=T[3];return{point:new c.P(T[0]/C,T[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}populateCache(n){for(const a of n)this.calculatePosMatrix(a)}getMatrixForModel(n,a){const d=c.a1.fromLngLat(n,a),m=d.meterInMercatorCoordinateUnits(),b=c.b9();return c.M(b,b,[d.x,d.y,d.z]),c.b6(b,b,Math.PI),c.b7(b,b,Math.PI/2),c.N(b,b,[-m,m,m]),b}getProjectionDataForCustomLayer(n=!0){const a=new c.Z(0,0,0,0,0),d=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:n}),m=ke(a,this.worldSize);c.O(m,this._viewProjMatrix,m),d.tileMercatorCoords=[0,0,1,1];const b=[c.$,c.$,this.worldSize/this._helper.pixelsPerMeter],T=c.ba();return c.N(T,m,b),d.fallbackMatrix=T,d.mainMatrix=T,d}getFastPathSimpleProjectionMatrix(n){return this.calculatePosMatrix(n)}}function $r(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ci(_){if(_.useSlerp)if(_.k<1){const n=c.bb(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),a=c.bb(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),d=new Float64Array(4);c.bc(d,n,a,_.k);const m=c.bd(d);_.tr.setRoll(m.roll),_.tr.setPitch(m.pitch),_.tr.setBearing(m.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(c.C.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(c.C.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(c.C.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function pr(_,n,a,d,m){const b=m.padding,T=we(m.worldSize,a.getNorthWest()),C=we(m.worldSize,a.getNorthEast()),k=we(m.worldSize,a.getSouthEast()),D=we(m.worldSize,a.getSouthWest()),O=c.ae(-d),U=T.rotate(O),B=C.rotate(O),q=k.rotate(O),Q=D.rotate(O),ue=new c.P(Math.max(U.x,B.x,Q.x,q.x),Math.max(U.y,B.y,Q.y,q.y)),he=new c.P(Math.min(U.x,B.x,Q.x,q.x),Math.min(U.y,B.y,Q.y,q.y)),de=ue.sub(he),ge=(m.width-(b.left+b.right+n.left+n.right))/de.x,ve=(m.height-(b.top+b.bottom+n.top+n.bottom))/de.y;if(ve<0||ge<0)return void $r();const _e=Math.min(c.ak(m.scale*Math.min(ge,ve)),_.maxZoom),Te=c.P.convert(_.offset),Ee=new c.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(c.ae(d)),xe=Te.add(Ee).mult(m.scale/c.af(_e));return{center:Me(m.worldSize,T.add(k).div(2).sub(xe)),zoom:_e,bearing:d}}class $o{get useGlobeControls(){return!1}handlePanInertia(n,a){const d=n.mag(),m=Math.abs(je(a));return{easingOffset:n.mult(Math.min(.75*m/d,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(n,a){n.bearingDelta&&a.setBearing(a.bearing+n.bearingDelta),n.pitchDelta&&a.setPitch(a.pitch+n.pitchDelta),n.rollDelta&&a.setRoll(a.roll+n.rollDelta),n.zoomDelta&&a.setZoom(a.zoom+n.zoomDelta)}handleMapControlsPan(n,a,d){n.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(d,n.around)}cameraForBoxAndBearing(n,a,d,m,b){return pr(n,a,d,m,b)}handleJumpToCenterZoom(n,a){n.zoom!==(a.zoom!==void 0?+a.zoom:n.zoom)&&n.setZoom(+a.zoom),a.center!==void 0&&n.setCenter(c.S.convert(a.center))}handleEaseTo(n,a){const d=n.zoom,m=n.padding,b={roll:n.roll,pitch:n.pitch,bearing:n.bearing},T={roll:a.roll===void 0?n.roll:a.roll,pitch:a.pitch===void 0?n.pitch:a.pitch,bearing:a.bearing===void 0?n.bearing:a.bearing},C=a.zoom!==void 0,k=!n.isPaddingEqual(a.padding);let D=!1;const O=C?+a.zoom:n.zoom;let U=n.centerPoint.add(a.offsetAsPoint);const B=n.screenPointToLocation(U),{center:q,zoom:Q}=n.getConstrained(c.S.convert(a.center||B),O??d);vo(n,q);const ue=we(n.worldSize,B),he=we(n.worldSize,q).sub(ue),de=c.af(Q-d);return D=Q!==d,{easeFunc:ge=>{if(D&&n.setZoom(c.C.number(d,Q,ge)),c.be(b,T)||ci({startEulerAngles:b,endEulerAngles:T,tr:n,k:ge,useSlerp:b.roll!=T.roll}),k&&(n.interpolatePadding(m,a.padding,ge),U=n.centerPoint.add(a.offsetAsPoint)),a.around)n.setLocationAtPoint(a.around,a.aroundPoint);else{const ve=c.af(n.zoom-d),_e=Q>d?Math.min(2,de):Math.max(.5,de),Te=Math.pow(_e,1-ge),Ee=Me(n.worldSize,ue.add(he.mult(ge*Te)).mult(ve));n.setLocationAtPoint(n.renderWorldCopies?Ee.wrap():Ee,U)}},isZooming:D,elevationCenter:q}}handleFlyTo(n,a){const d=a.zoom!==void 0,m=n.zoom,b=n.getConstrained(c.S.convert(a.center||a.locationAtOffset),d?+a.zoom:m),T=b.center,C=b.zoom;vo(n,T);const k=we(n.worldSize,a.locationAtOffset),D=we(n.worldSize,T).sub(k),O=D.mag(),U=c.af(C-m);let B;if(a.minZoom!==void 0){const q=Math.min(+a.minZoom,m,C),Q=n.getConstrained(T,q).zoom;B=c.af(Q-m)}return{easeFunc:(q,Q,ue,he)=>{n.setZoom(q===1?C:m+c.ak(Q));const de=q===1?T:Me(n.worldSize,k.add(D.mult(ue)).mult(Q));n.setLocationAtPoint(n.renderWorldCopies?de.wrap():de,he)},scaleOfZoom:U,targetCenter:T,scaleOfMinZoom:B,pixelPathLength:O}}}class xn{constructor(n,a,d){this.blendFunction=n,this.blendColor=a,this.mask=d}}xn.Replace=[1,0],xn.disabled=new xn(xn.Replace,c.bf.transparent,[!1,!1,!1,!1]),xn.unblended=new xn(xn.Replace,c.bf.transparent,[!0,!0,!0,!0]),xn.alphaBlended=new xn([1,771],c.bf.transparent,[!0,!0,!0,!0]);const an=2305;class Kt{constructor(n,a,d){this.enable=n,this.mode=a,this.frontFace=d}}Kt.disabled=new Kt(!1,1029,an),Kt.backCCW=new Kt(!0,1029,an),Kt.frontCCW=new Kt(!0,1028,an);class $t{constructor(n,a,d){this.func=n,this.mask=a,this.range=d}}$t.ReadOnly=!1,$t.ReadWrite=!0,$t.disabled=new $t(519,$t.ReadOnly,[0,1]);const Zo=7680;class Yt{constructor(n,a,d,m,b,T){this.test=n,this.ref=a,this.mask=d,this.fail=m,this.depthFail=b,this.pass=T}}Yt.disabled=new Yt({func:519,mask:0},0,0,Zo,Zo,Zo);const wl=new WeakMap;function jr(_){var n;if(wl.has(_))return wl.get(_);{const a=(n=_.getParameter(_.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return wl.set(_,a),a}}class Su{get awaitingQuery(){return!!this._readbackQueue}constructor(n){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=n;const a=n.context,d=a.gl;this._texFormat=d.RGBA,this._texType=d.UNSIGNED_BYTE;const m=new c.aL;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const b=new c.aN;b.emplaceBack(0,1,2),this._fullscreenTriangle=new _o(a.createVertexBuffer(m,Or.members),a.createIndexBuffer(b),c.aM.simpleSegment(0,0,m.length,b.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(d.TEXTURE1);const T=d.createTexture();d.bindTexture(d.TEXTURE_2D,T),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(T),jr(d)&&(this._pbo=d.createBuffer(),d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.bufferData(d.PIXEL_PACK_BUFFER,4,d.STREAM_READ),d.bindBuffer(d.PIXEL_PACK_BUFFER,null))}destroy(){const n=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),n.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(n,a){const d=this._updateCount;return this._readbackQueue?d>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():d>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(n,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const n=this._cachedRenderContext.context,a=n.gl;n.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),n.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(n,a){const d=this._cachedRenderContext.context,m=d.gl;if(this._bindFramebuffer(),d.viewport.set([0,0,this._texWidth,this._texHeight]),d.clear({color:c.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(d,m.TRIANGLES,$t.disabled,Yt.disabled,xn.unblended,Kt.disabled,((b,T)=>({u_input:b,u_output_expected:T}))(n,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&jr(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const b=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const n=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&jr(n)){const a=n.clientWaitSync(this._readbackQueue.sync,0,0);if(a===n.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===n.TIMEOUT_EXPIRED)return;n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),n.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Su._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(n){let a=0;return a+=n[0]/256,a+=n[1]/65536,a+=n[2]/16777216,n[3]<127&&(a=-a),a/128}}const ka=c.$/128;function cn(_,n){const a=_.granularity!==void 0?Math.max(_.granularity,1):1,d=a+(_.generateBorders?2:0),m=a+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),b=d+1,T=m+1,C=_.generateBorders?-1:0,k=_.generateBorders||_.extendToNorthPole?-1:0,D=a+(_.generateBorders?1:0),O=a+(_.generateBorders||_.extendToSouthPole?1:0),U=b*T,B=d*m*6,q=b*T>65536;if(q&&n==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Q=q||n==="32bit",ue=new Int16Array(2*U);let he=0;for(let ve=k;ve<=O;ve++)for(let _e=C;_e<=D;_e++){let Te=_e/a*c.$;_e===-1&&(Te=-ka),_e===a+1&&(Te=c.$+ka);let Ee=ve/a*c.$;ve===-1&&(Ee=_.extendToNorthPole?c.bh:-ka),ve===a+1&&(Ee=_.extendToSouthPole?c.bi:c.$+ka),ue[he++]=Te,ue[he++]=Ee}const de=Q?new Uint32Array(B):new Uint16Array(B);let ge=0;for(let ve=0;ve<m;ve++)for(let _e=0;_e<d;_e++){const Te=_e+1+ve*b,Ee=_e+(ve+1)*b,xe=_e+1+(ve+1)*b;de[ge++]=_e+ve*b,de[ge++]=Ee,de[ge++]=Te,de[ge++]=Te,de[ge++]=Ee,de[ge++]=xe}return{vertices:ue.buffer.slice(0),indices:de.buffer.slice(0),uses32bitIndices:Q}}const Ma=new c.aK({fill:new c.bj(128,2),line:new c.bj(512,0),tile:new c.bj(128,32),stencil:new c.bj(128,1),circle:3});class ui{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Sr.projectionGlobe}get vertexShaderPreludeCode(){return Sr.projectionMercator.vertexSource}get subdivisionGranularity(){return Ma}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(n){this._errorMeasurement||(this._errorMeasurement=new Su(n));const a=c.U(this._errorQueryLatitudeDegrees),d=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(a,d),b=K.now();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=b);const T=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bl(T))}_getMeshKey(n){return`${n.granularity.toString(36)}_${n.generateBorders?"b":""}${n.extendToNorthPole?"n":""}${n.extendToSouthPole?"s":""}`}getMeshFromTileID(n,a,d,m,b){const T=(b==="stencil"?Ma.stencil:Ma.tile).getGranularityForZoomLevel(a.z);return this._getMesh(n,{granularity:T,generateBorders:d,extendToNorthPole:a.y===0&&m,extendToSouthPole:a.y===(1<<a.z)-1&&m})}_getMesh(n,a){const d=this._getMeshKey(a);if(d in this._tileMeshCache)return this._tileMeshCache[d];const m=function(b,T){const C=cn(T,"16bit"),k=c.aL.deserialize({arrayBuffer:C.vertices,length:C.vertices.byteLength/2/2}),D=c.aN.deserialize({arrayBuffer:C.indices,length:C.indices.byteLength/2/3});return new _o(b.createVertexBuffer(k,Or.members),b.createIndexBuffer(D),c.aM.simpleSegment(0,0,k.length,D.length))}(n,a);return this._tileMeshCache[d]=m,m}recalculate(n){}hasTransition(){const n=K.now();let a=!1;return a=a||(n-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(n){this._errorQueryLatitudeDegrees=n}}const Go=new c.r({type:new c.D(c.v.projection.type)});class Tl extends c.E{constructor(n){super(),this._transitionable=new c.t(Go,void 0),this.setProjection(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0)),this._mercatorProjection=new yo,this._verticalPerspectiveProjection=new ui}get transitionState(){const n=this.properties.get("type");if(typeof n=="string"&&n==="mercator")return 0;if(typeof n=="string"&&n==="vertical-perspective")return 1;if(n instanceof c.bm){if(n.from==="vertical-perspective"&&n.to==="mercator")return 1-n.transition;if(n.from==="mercator"&&n.to==="vertical-perspective")return n.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(n){this._mercatorProjection.updateGPUdependent(n),this._verticalPerspectiveProjection.updateGPUdependent(n)}getMeshFromTileID(n,a,d,m,b){return this.currentProjection.getMeshFromTileID(n,a,d,m,b)}setProjection(n){this._transitionable.setValue("type",(n==null?void 0:n.type)||"mercator")}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}setErrorQueryLatitudeDegrees(n){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(n),this._mercatorProjection.setErrorQueryLatitudeDegrees(n)}}function Sl(_){const n=bo(_.worldSize,_.center.lat);return 2*Math.PI*n}function qi(_,n,a,d,m){const b=1/(1<<m),T=n/c.$*b+d*b,C=c.bo((_/c.$*b+a*b)*Math.PI*2+Math.PI,2*Math.PI),k=2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI,D=Math.cos(k),O=new Float64Array(3);return O[0]=Math.sin(C)*D,O[1]=Math.sin(k),O[2]=Math.cos(C)*D,O}function Br(_){return function(n,a){const d=Math.cos(a),m=new Float64Array(3);return m[0]=Math.sin(n)*d,m[1]=Math.sin(a),m[2]=Math.cos(n)*d,m}(_.lng*Math.PI/180,_.lat*Math.PI/180)}function bo(_,n){return _/(2*Math.PI)/Math.cos(n*Math.PI/180)}function Pl(_){const n=Math.asin(_[1])/Math.PI*180,a=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(a>1e-6){const d=_[0]/a,m=Math.acos(_[2]/a),b=(d>0?m:-m)/Math.PI*180;return new c.S(c.aO(b,-180,180),n)}return new c.S(0,n)}function wo(_){return Math.cos(_*Math.PI/180)}function mr(_,n){const a=wo(_),d=wo(n);return c.ak(d/a)}function lc(_,n){const a=_.rotate(n.bearingInRadians),d=n.zoom+mr(n.center.lat,0),m=c.bk(1/wo(n.center.lat),1/wo(Math.min(Math.abs(n.center.lat),60)),c.bn(d,7,3,0,1)),b=360/Sl({worldSize:n.worldSize,center:{lat:n.center.lat}});return new c.S(n.center.lng-a.x*b*m,c.ah(n.center.lat+a.y*b,-c.ai,c.ai))}function Di(_){const n=.5*_,a=Math.sin(n),d=Math.cos(n);return Math.log(a+d)-Math.log(d-a)}function bh(_,n,a,d){const m=_.lat+a*d;if(Math.abs(a)>1){const b=(Math.sign(_.lat+a)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,T=Math.abs(_.lat+a)*Math.PI/180,C=Di(b+d*(T-b)),k=Di(b),D=Di(T);return new c.S(_.lng+n*((C-k)/(D-k)),m)}return new c.S(_.lng+n*d,m)}class wh{constructor(n){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=n}swapBuffers(){if(!this._hadAnyChanges)return;const n=this._cachePrevious;this._cachePrevious=this._cache,this._cache=n,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(n,a,d,m){const b=`${n.z}_${n.x}_${n.y}_${m!=null&&m.terrain?"t":""}`,T=this._cache.get(b);if(T)return T;const C=this._cachePrevious.get(b);if(C)return this._cache.set(b,C),C;const k=this._boundingVolumeFactory(n,a,d,m);return this._cache.set(b,k),this._hadAnyChanges=!0,k}}class zn{constructor(n,a,d,m){this.min=d,this.max=m,this.points=n,this.planes=a}static fromAabb(n,a){const d=[];for(let m=0;m<8;m++)d.push([1&~m?n[0]:a[0],(m>>1&1)==1?a[1]:n[1],(m>>2&1)==1?a[2]:n[2]]);return new zn(d,[[-1,0,0,a[0]],[1,0,0,-n[0]],[0,-1,0,a[1]],[0,1,0,-n[1]],[0,0,-1,a[2]],[0,0,1,-n[2]]],n,a)}static fromCenterSizeAngles(n,a,d){const m=c.br([],d[0],d[1],d[2]),b=c.bs([],[a[0],0,0],m),T=c.bs([],[0,a[1],0],m),C=c.bs([],[0,0,a[2]],m),k=[...n],D=[...n];for(let U=0;U<8;U++)for(let B=0;B<3;B++){const q=n[B]+b[B]*(1&~U?-1:1)+T[B]*((U>>1&1)==1?1:-1)+C[B]*((U>>2&1)==1?1:-1);k[B]=Math.min(k[B],q),D[B]=Math.max(D[B],q)}const O=[];for(let U=0;U<8;U++){const B=[...n];c.aS(B,B,c.aR([],b,1&~U?-1:1)),c.aS(B,B,c.aR([],T,(U>>1&1)==1?1:-1)),c.aS(B,B,c.aR([],C,(U>>2&1)==1?1:-1)),O.push(B)}return new zn(O,[[...b,-c.aX(b,O[0])],[...T,-c.aX(T,O[0])],[...C,-c.aX(C,O[0])],[-b[0],-b[1],-b[2],-c.aX(b,O[7])],[-T[0],-T[1],-T[2],-c.aX(T,O[7])],[-C[0],-C[1],-C[2],-c.aX(C,O[7])]],k,D)}intersectsFrustum(n){let a=!0;const d=this.points.length,m=this.planes.length,b=n.planes.length,T=n.points.length;for(let C=0;C<b;C++){const k=n.planes[C];let D=0;for(let O=0;O<d;O++){const U=this.points[O];k[0]*U[0]+k[1]*U[1]+k[2]*U[2]+k[3]>=0&&D++}if(D===0)return 0;D<d&&(a=!1)}if(a)return 2;for(let C=0;C<m;C++){const k=this.planes[C];let D=0;for(let O=0;O<T;O++){const U=n.points[O];k[0]*U[0]+k[1]*U[1]+k[2]*U[2]+k[3]>=0&&D++}if(D===0)return 0}return 1}intersectsPlane(n){const a=this.points.length;let d=0;for(let m=0;m<a;m++){const b=this.points[m];n[0]*b[0]+n[1]*b[1]+n[2]*b[2]+n[3]>=0&&d++}return d===a?2:d===0?0:1}}function qo(_,n,a){const d=_-n;return d<0?-d:Math.max(0,d-a)}function Ni(_,n,a,d,m){const b=_-a;let T;return T=b<0?Math.min(-b,1+b-m):b>1?Math.min(Math.max(b-m,0),1-b):0,Math.max(T,qo(n,d,m))}class Aa{constructor(){this._boundingVolumeCache=new wh(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(n,a,d,m){const b=1<<d.z,T=1/b,C=d.x/b,k=d.y/b;let D=2;return D=Math.min(D,Ni(n,a,C,k,T)),D=Math.min(D,Ni(n,a,C+.5,-k-T,T)),D=Math.min(D,Ni(n,a,C+.5,2-k-T,T)),D}getWrap(n,a,d){const m=1<<a.z,b=1/m,T=a.x/m,C=qo(n.x,T,b),k=qo(n.x,T-1,b),D=qo(n.x,T+1,b),O=Math.min(C,k,D);return O===D?1:O===k?-1:0}allowVariableZoom(n,a){return De(n,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(n,a,d,m){return this._boundingVolumeCache.getTileBoundingVolume(n,a,d,m)}_computeTileBoundingVolume(n,a,d,m){var b,T;let C=0,k=0;if(m!=null&&m.terrain){const D=new c.Z(n.z,a,n.z,n.x,n.y),O=m.terrain.getMinMaxElevation(D);C=(b=O.minElevation)!==null&&b!==void 0?b:Math.min(0,d),k=(T=O.maxElevation)!==null&&T!==void 0?T:Math.max(0,d)}if(C/=c.bu,k/=c.bu,C+=1,k+=1,n.z<=0)return zn.fromAabb([-k,-k,-k],[k,k,k]);if(n.z===1)return zn.fromAabb([n.x===0?-k:0,n.y===0?0:-k,-k],[n.x===0?0:k,n.y===0?k:0,k]);{const D=[qi(0,0,n.x,n.y,n.z),qi(c.$,0,n.x,n.y,n.z),qi(c.$,c.$,n.x,n.y,n.z),qi(0,c.$,n.x,n.y,n.z)],O=[];for(const $e of D)O.push(c.aR([],$e,k));if(k!==C)for(const $e of D)O.push(c.aR([],$e,C));n.y===0&&O.push([0,1,0]),n.y===(1<<n.z)-1&&O.push([0,-1,0]);const U=[1,1,1],B=[-1,-1,-1];for(const $e of O)for(let Ze=0;Ze<3;Ze++)U[Ze]=Math.min(U[Ze],$e[Ze]),B[Ze]=Math.max(B[Ze],$e[Ze]);const q=qi(c.$/2,c.$/2,n.x,n.y,n.z),Q=c.aW([],[0,1,0],q);c.aV(Q,Q);const ue=c.aW([],q,Q);c.aV(ue,ue);const he=c.aW([],D[2],D[1]);c.aV(he,he);const de=c.aW([],D[0],D[3]);c.aV(de,de),O.push(c.aR([],q,k)),n.y>=(1<<n.z)/2&&O.push(c.aR([],qi(c.$/2,0,n.x,n.y,n.z),k)),n.y<(1<<n.z)/2&&O.push(c.aR([],qi(c.$/2,c.$,n.x,n.y,n.z),k));const ge=Pu(q,O),ve=Pu(ue,O),_e=[-q[0],-q[1],-q[2],ge.max],Te=[q[0],q[1],q[2],-ge.min],Ee=[-ue[0],-ue[1],-ue[2],ve.max],xe=[ue[0],ue[1],ue[2],-ve.min],Ae=[...he,0],qe=[...de,0],Ue=[];return n.y===0?Ue.push(c.bt(qe,Ae,_e),c.bt(qe,Ae,Te)):Ue.push(c.bt(Ee,Ae,_e),c.bt(Ee,Ae,Te),c.bt(Ee,qe,_e),c.bt(Ee,qe,Te)),n.y===(1<<n.z)-1?Ue.push(c.bt(qe,Ae,_e),c.bt(qe,Ae,Te)):Ue.push(c.bt(xe,Ae,_e),c.bt(xe,Ae,Te),c.bt(xe,qe,_e),c.bt(xe,qe,Te)),new zn(Ue,[_e,Te,Ee,xe,Ae,qe],U,B)}}}function Pu(_,n){let a=1/0,d=-1/0;for(const m of n){const b=c.aX(_,m);a=Math.min(a,b),d=Math.max(d,b)}return{min:a,max:d}}class Ra{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,a,d){return this._helper.interpolatePadding(n,a,d)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,a){this._helper.resize(n,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,a){this._helper.overrideNearFarZ(n,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n){}constructor(){this._cachedClippingPlane=c.bv(),this._projectionMatrix=c.b9(),this._globeViewProjMatrix32f=c.b8(),this._globeViewProjMatrixNoCorrection=c.b9(),this._globeViewProjMatrixNoCorrectionInverted=c.b9(),this._globeProjMatrixInverted=c.b9(),this._cameraPosition=c.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Dt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,a)=>this.getConstrained(n,a)}),this._coveringTilesDetailsProvider=new Aa}clone(){const n=new Ra;return n.apply(this),n}apply(n,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(n)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const n=c.bp();return n[0]=this._cameraPosition[0],n[1]=this._cameraPosition[1],n[2]=this._cameraPosition[2],n}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(n){const{overscaledTileID:a,applyGlobeMatrix:d}=n,m=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:d?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(n){const a=this.pitchInRadians,d=this.cameraToCenterDistance/n,m=Math.sin(a)*d,b=Math.cos(a)*d+1,T=1/Math.sqrt(m*m+b*b)*1;let C=-m,k=b;const D=Math.sqrt(C*C+k*k);C/=D,k/=D;const O=[0,C,k];c.bw(O,O,[0,0,0],-this.bearingInRadians),c.bx(O,O,[0,0,0],-1*this.center.lat*Math.PI/180),c.by(O,O,[0,0,0],this.center.lng*Math.PI/180);const U=1/c.aZ(O);return c.aR(O,O,U),[...O,-T*U]}isLocationOccluded(n){return!this.isSurfacePointVisible(Br(n))}transformLightDirection(n){const a=this._helper._center.lng*Math.PI/180,d=this._helper._center.lat*Math.PI/180,m=Math.cos(d),b=[Math.sin(a)*m,Math.sin(d),Math.cos(a)*m],T=[b[2],0,-b[0]],C=[0,0,0];c.aW(C,T,b),c.aV(T,T),c.aV(C,C);const k=[0,0,0];return c.aV(k,[T[0]*n[0]+C[0]*n[1]+b[0]*n[2],T[1]*n[0]+C[1]*n[1]+b[1]*n[2],T[2]*n[0]+C[2]*n[1]+b[2]*n[2]]),k}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(n,a,d){const m=function(C,k,D){const O=1/(1<<D.z);return new c.a1(C/c.$*O+D.x*O,k/c.$*O+D.y*O)}(n,a,d.canonical),b=(T=m.y,[c.bo(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI]);var T;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(n,a,d,m){const b=d.canonical,T=qi(n,a,b.x,b.y,b.z),C=1+(m?m(n,a):0)/c.bu,k=[T[0]*C,T[1]*C,T[2]*C,1];c.aw(k,k,this._globeViewProjMatrixNoCorrection);const D=this._cachedClippingPlane,O=D[0]*T[0]+D[1]*T[1]+D[2]*T[2]+D[3]<0;return{point:new c.P(k[0]/k[3],k[1]/k[3]),signedDistanceFromCamera:k[3],isOccluded:O}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const n=bo(this.worldSize,this.center.lat),a=c.ba(),d=c.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*n),c.b4(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;a[8]=2*-m.x/this._helper._width,a[9]=2*m.y/this._helper._height,this._projectionMatrix=c.b5(a),this._globeProjMatrixInverted=c.ba(),c.aq(this._globeProjMatrixInverted,a),c.M(a,a,[0,0,-this.cameraToCenterDistance]),c.b6(a,a,this.rollInRadians),c.b7(a,a,-this.pitchInRadians),c.b6(a,a,this.bearingInRadians),c.M(a,a,[0,0,-n]);const b=c.bp();b[0]=n,b[1]=n,b[2]=n,c.b7(d,a,this.center.lat*Math.PI/180),c.bz(d,d,-this.center.lng*Math.PI/180),c.N(d,d,b),this._globeViewProjMatrixNoCorrection=d,c.b7(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bz(a,a,-this.center.lng*Math.PI/180),c.N(a,a,b),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=c.ba(),c.aq(this._globeViewProjMatrixNoCorrectionInverted,d);const T=c.bp();this._cameraPosition=c.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/n,c.bw(this._cameraPosition,this._cameraPosition,T,-this.rollInRadians),c.bx(this._cameraPosition,this._cameraPosition,T,this.pitchInRadians),c.bw(this._cameraPosition,this._cameraPosition,T,-this.bearingInRadians),c.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bx(this._cameraPosition,this._cameraPosition,T,-this.center.lat*Math.PI/180),c.by(this._cameraPosition,this._cameraPosition,T,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(n);const C=c.b5(this._globeViewProjMatrixNoCorrectionInverted);c.N(C,C,[1,1,-1]),this._cachedFrustum=Mn.fromInvProjectionMatrix(C,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(n){c.w("calculateFogMatrix is not supported on globe projection.");const a=c.ba();return c.ag(a),a}getVisibleUnwrappedCoordinates(n){return[new c.b2(0,n)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){n&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const d=Br(n);c.aR(d,d,1+a/c.bu);const m=c.bv();return c.aw(m,[d[0],d[1],d[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(n){}getBounds(){const n=.5*this.width,a=.5*this.height,d=[new c.P(0,0),new c.P(n,0),new c.P(this.width,0),new c.P(this.width,a),new c.P(this.width,this.height),new c.P(n,this.height),new c.P(0,this.height),new c.P(0,a)],m=[];for(const U of d)m.push(this.unprojectScreenPoint(U));let b=0,T=0,C=0,k=0;const D=this.center;for(const U of m){const B=c.bA(D.lng,U.lng),q=c.bA(D.lat,U.lat);B<T&&(T=B),B>b&&(b=B),q<k&&(k=q),q>C&&(C=q)}const O=[D.lng+T,D.lat+k,D.lng+b,D.lat+C];return this.isSurfacePointOnScreen([0,1,0])&&(O[3]=90,O[0]=-180,O[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(O[1]=-90,O[0]=-180,O[2]=180),new In(O)}getConstrained(n,a){const d=c.ah(n.lat,-c.ai,c.ai),m=c.ah(+a,this.minZoom+mr(0,d),this.maxZoom);return{center:new c.S(n.lng,d),zoom:m}}calculateCenterFromCameraLngLatAlt(n,a,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(n,a,d,m)}setLocationAtPoint(n,a){const d=Br(this.unprojectScreenPoint(a)),m=Br(n),b=c.bp();c.bB(b);const T=c.bp();c.by(T,d,b,-this.center.lng*Math.PI/180),c.bx(T,T,b,this.center.lat*Math.PI/180);const C=m[0]*m[0]+m[2]*m[2],k=T[0]*T[0];if(C<k)return;const D=Math.sqrt(C-k),O=-D,U=c.bC(m[0],m[2],T[0],D),B=c.bC(m[0],m[2],T[0],O),q=c.bp();c.by(q,m,b,-U);const Q=c.bC(q[1],q[2],T[1],T[2]),ue=c.bp();c.by(ue,m,b,-B);const he=c.bC(ue[1],ue[2],T[1],T[2]),de=.5*Math.PI,ge=Q>=-de&&Q<=de,ve=he>=-de&&he<=de;let _e,Te;if(ge&&ve){const qe=this.center.lng*Math.PI/180,Ue=this.center.lat*Math.PI/180;c.bD(U,qe)+c.bD(Q,Ue)<c.bD(B,qe)+c.bD(he,Ue)?(_e=U,Te=Q):(_e=B,Te=he)}else if(ge)_e=U,Te=Q;else{if(!ve)return;_e=B,Te=he}const Ee=_e/Math.PI*180,xe=Te/Math.PI*180,Ae=this.center.lat;this.setCenter(new c.S(Ee,c.ah(xe,-90,90))),this.setZoom(this.zoom+mr(Ae,this.center.lat))}locationToScreenPoint(n,a){const d=Br(n);if(a){const m=a.getElevationForLngLatZoom(n,this._helper._tileZoom);c.aR(d,d,1+m/c.bu)}return this._projectSurfacePointToScreen(d)}_projectSurfacePointToScreen(n){const a=c.bv();return c.aw(a,[...n,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new c.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(n,a){if(a){const d=a.pointCoordinate(n);if(d)return d}return c.a1.fromLngLat(this.unprojectScreenPoint(n))}screenPointToLocation(n,a){var d;return(d=this.screenPointToMercatorCoordinate(n,a))===null||d===void 0?void 0:d.toLngLat()}isPointOnMapSurface(n,a){const d=this._cameraPosition,m=this.getRayDirectionFromPixel(n);return!!this.rayPlanetIntersection(d,m)}getRayDirectionFromPixel(n){const a=c.bv();a[0]=n.x/this.width*2-1,a[1]=-1*(n.y/this.height*2-1),a[2]=1,a[3]=1,c.aw(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const d=c.bp();d[0]=a[0]-this._cameraPosition[0],d[1]=a[1]-this._cameraPosition[1],d[2]=a[2]-this._cameraPosition[2];const m=c.bp();return c.aV(m,d),m}isSurfacePointVisible(n){const a=this._cachedClippingPlane;return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]+a[3]>=0}isSurfacePointOnScreen(n){if(!this.isSurfacePointVisible(n))return!1;const a=c.bv();return c.aw(a,[...n,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(n,a){const d=c.aX(n,a),m=c.bp(),b=c.bp();c.aR(b,a,d),c.aU(m,n,b);const T=1-c.aX(m,m);if(T<0)return null;const C=c.aX(n,n)-1,k=-d+(d<0?1:-1)*Math.sqrt(T),D=C/k,O=k;return{tMin:Math.min(D,O),tMax:Math.max(D,O)}}unprojectScreenPoint(n){const a=this._cameraPosition,d=this.getRayDirectionFromPixel(n),m=this.rayPlanetIntersection(a,d);if(m){const O=c.bp();c.aS(O,a,[d[0]*m.tMin,d[1]*m.tMin,d[2]*m.tMin]);const U=c.bp();return c.aV(U,O),Pl(U)}const b=this._cachedClippingPlane,T=b[0]*d[0]+b[1]*d[1]+b[2]*d[2],C=-c.b1(b,a)/T,k=c.bp();if(C>0)c.aS(k,a,[d[0]*C,d[1]*C,d[2]*C]);else{const O=c.bp();c.aS(O,a,[2*d[0],2*d[1],2*d[2]]);const U=c.b1(this._cachedClippingPlane,O);c.aU(k,O,[this._cachedClippingPlane[0]*U,this._cachedClippingPlane[1]*U,this._cachedClippingPlane[2]*U])}const D=function(O){const U=c.bp();return U[0]=O[0]*-O[3],U[1]=O[1]*-O[3],U[2]=O[2]*-O[3],{center:U,radius:Math.sqrt(1-O[3]*O[3])}}(b);return Pl(function(O,U,B){const q=c.bp();c.aU(q,B,O);const Q=c.bp();return c.bq(Q,O,q,U/c.a$(q)),Q}(D.center,D.radius,k))}getMatrixForModel(n,a){const d=c.S.convert(n),m=1/c.bu,b=c.b9();return c.bz(b,b,d.lng/180*Math.PI),c.b7(b,b,-d.lat/180*Math.PI),c.M(b,b,[0,0,1+a/c.bu]),c.b7(b,b,.5*Math.PI),c.N(b,b,[m,m,m]),b}getProjectionDataForCustomLayer(n=!0){const a=this.getProjectionData({overscaledTileID:new c.Z(0,0,0,0,0),applyGlobeMatrix:n});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(n){}}class Is{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,a,d){return this._helper.interpolatePadding(n,a,d)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,a,d=!0){this._helper.resize(n,a,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,a){this._helper.overrideNearFarZ(n,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(n,a){this._globeness=n,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Dt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,a)=>this.getConstrained(n,a)}),this._globeness=1,this._mercatorTransform=new xo,this._verticalPerspectiveTransform=new Ra}clone(){const n=new Is;return n._globeness=this._globeness,n._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,n.apply(this),n}apply(n){this._helper.apply(n),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(n){const a=this._mercatorTransform.getProjectionData(n),d=this._verticalPerspectiveTransform.getProjectionData(n);return{mainMatrix:this.isGlobeRendering?d.mainMatrix:a.mainMatrix,clippingPlane:d.clippingPlane,tileMercatorCoords:d.tileMercatorCoords,projectionTransition:n.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(n){return this.currentTransform.isLocationOccluded(n)}transformLightDirection(n){return this.currentTransform.transformLightDirection(n)}getPixelScale(){return c.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(n,a,d){const m=this._mercatorTransform.getPitchedTextCorrection(n,a,d),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(n,a,d);return c.bk(m,b,this._globeness)}projectTileCoordinates(n,a,d,m){return this.currentTransform.projectTileCoordinates(n,a,d,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(n){return this.currentTransform.calculateFogMatrix(n)}getVisibleUnwrappedCoordinates(n){return this.currentTransform.getVisibleUnwrappedCoordinates(n)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(n){this._mercatorTransform.recalculateZoomAndCenter(n),this._verticalPerspectiveTransform.recalculateZoomAndCenter(n)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,a){return this.currentTransform.lngLatToCameraDepth(n,a)}populateCache(n){this._mercatorTransform.populateCache(n),this._verticalPerspectiveTransform.populateCache(n)}getBounds(){return this.currentTransform.getBounds()}getConstrained(n,a){return this.currentTransform.getConstrained(n,a)}calculateCenterFromCameraLngLatAlt(n,a,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(n,a,d,m)}setLocationAtPoint(n,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(n,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(n,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(n,a){return this.currentTransform.locationToScreenPoint(n,a)}screenPointToMercatorCoordinate(n,a){return this.currentTransform.screenPointToMercatorCoordinate(n,a)}screenPointToLocation(n,a){return this.currentTransform.screenPointToLocation(n,a)}isPointOnMapSurface(n,a){return this.currentTransform.isPointOnMapSurface(n,a)}getRayDirectionFromPixel(n){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(n)}getMatrixForModel(n,a){return this.currentTransform.getMatrixForModel(n,a)}getProjectionDataForCustomLayer(n=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(n);if(!this.isGlobeRendering)return a;const d=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(n);return d.fallbackMatrix=a.mainMatrix,d}getFastPathSimpleProjectionMatrix(n){return this.currentTransform.getFastPathSimpleProjectionMatrix(n)}}class os{get useGlobeControls(){return!0}handlePanInertia(n,a){const d=lc(n,a);return Math.abs(d.lng-a.center.lng)>180&&(d.lng=a.center.lng+179.5*Math.sign(d.lng-a.center.lng)),{easingCenter:d,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(n,a){const d=n.around,m=a.screenPointToLocation(d);n.bearingDelta&&a.setBearing(a.bearing+n.bearingDelta),n.pitchDelta&&a.setPitch(a.pitch+n.pitchDelta),n.rollDelta&&a.setRoll(a.roll+n.rollDelta);const b=a.zoom;n.zoomDelta&&a.setZoom(a.zoom+n.zoomDelta);const T=a.zoom-b;if(T===0)return;const C=c.bA(a.center.lng,m.lng),k=C/(Math.abs(C/180)+1),D=c.bA(a.center.lat,m.lat),O=a.getRayDirectionFromPixel(d),U=a.cameraPosition,B=-1*c.aX(U,O),q=c.bp();c.aS(q,U,[O[0]*B,O[1]*B,O[2]*B]);const Q=c.aZ(q)-1,ue=Math.exp(.5*-Math.max(Q-.3,0)),he=bo(a.worldSize,a.center.lat)/Math.min(a.width,a.height),de=c.bn(he,.9,.5,1,.25),ge=(1-c.af(-T))*Math.min(ue,de),ve=a.center.lat,_e=a.zoom,Te=new c.S(a.center.lng+k*ge,c.ah(a.center.lat+D*ge,-c.ai,c.ai));a.setLocationAtPoint(m,d);const Ee=a.center,xe=c.bn(Math.abs(C),45,85,0,1),Ae=c.bn(he,.75,.35,0,1),qe=Math.pow(Math.max(xe,Ae),.25),Ue=c.bA(Ee.lng,Te.lng),$e=c.bA(Ee.lat,Te.lat);a.setCenter(new c.S(Ee.lng+Ue*qe,Ee.lat+$e*qe).wrap()),a.setZoom(_e+mr(ve,a.center.lat))}handleMapControlsPan(n,a,d){if(!n.panDelta)return;const m=a.center.lat,b=a.zoom;a.setCenter(lc(n.panDelta,a).wrap()),a.setZoom(b+mr(m,a.center.lat))}cameraForBoxAndBearing(n,a,d,m,b){const T=pr(n,a,d,m,b),C=a.left/b.width*2-1,k=(b.width-a.right)/b.width*2-1,D=a.top/b.height*-2+1,O=(b.height-a.bottom)/b.height*-2+1,U=c.bA(d.getWest(),d.getEast())<0,B=U?d.getEast():d.getWest(),q=U?d.getWest():d.getEast(),Q=Math.max(d.getNorth(),d.getSouth()),ue=Math.min(d.getNorth(),d.getSouth()),he=B+.5*c.bA(B,q),de=Q+.5*c.bA(Q,ue),ge=b.clone();ge.setCenter(T.center),ge.setBearing(T.bearing),ge.setPitch(0),ge.setRoll(0),ge.setZoom(T.zoom);const ve=ge.modelViewProjectionMatrix,_e=[Br(d.getNorthWest()),Br(d.getNorthEast()),Br(d.getSouthWest()),Br(d.getSouthEast()),Br(new c.S(q,de)),Br(new c.S(B,de)),Br(new c.S(he,Q)),Br(new c.S(he,ue))],Te=Br(T.center);let Ee=Number.POSITIVE_INFINITY;for(const xe of _e)C<0&&(Ee=os.getLesserNonNegativeNonNull(Ee,os.solveVectorScale(xe,Te,ve,"x",C))),k>0&&(Ee=os.getLesserNonNegativeNonNull(Ee,os.solveVectorScale(xe,Te,ve,"x",k))),D>0&&(Ee=os.getLesserNonNegativeNonNull(Ee,os.solveVectorScale(xe,Te,ve,"y",D))),O<0&&(Ee=os.getLesserNonNegativeNonNull(Ee,os.solveVectorScale(xe,Te,ve,"y",O)));if(Number.isFinite(Ee)&&Ee!==0)return T.zoom=ge.zoom+c.ak(Ee),T;$r()}handleJumpToCenterZoom(n,a){const d=n.center.lat,m=n.getConstrained(a.center?c.S.convert(a.center):n.center,n.zoom).center;n.setCenter(m.wrap());const b=a.zoom!==void 0?+a.zoom:n.zoom+mr(d,m.lat);n.zoom!==b&&n.setZoom(b)}handleEaseTo(n,a){const d=n.zoom,m=n.center,b=n.padding,T={roll:n.roll,pitch:n.pitch,bearing:n.bearing},C={roll:a.roll===void 0?n.roll:a.roll,pitch:a.pitch===void 0?n.pitch:a.pitch,bearing:a.bearing===void 0?n.bearing:a.bearing},k=a.zoom!==void 0,D=!n.isPaddingEqual(a.padding);let O=!1;const U=a.center?c.S.convert(a.center):m,B=n.getConstrained(U,d).center;vo(n,B);const q=n.clone();q.setCenter(B),q.setZoom(k?+a.zoom:d+mr(m.lat,U.lat)),q.setBearing(a.bearing);const Q=new c.P(c.ah(n.centerPoint.x+a.offsetAsPoint.x,0,n.width),c.ah(n.centerPoint.y+a.offsetAsPoint.y,0,n.height));q.setLocationAtPoint(B,Q);const ue=(a.offset&&a.offsetAsPoint.mag())>0?q.center:B,he=k?+a.zoom:d+mr(m.lat,ue.lat),de=d+mr(m.lat,0),ge=he+mr(ue.lat,0),ve=c.bA(m.lng,ue.lng),_e=c.bA(m.lat,ue.lat),Te=c.af(ge-de);return O=he!==d,{easeFunc:Ee=>{if(c.be(T,C)||ci({startEulerAngles:T,endEulerAngles:C,tr:n,k:Ee,useSlerp:T.roll!=C.roll}),D&&n.interpolatePadding(b,a.padding,Ee),a.around)c.w("Easing around a point is not supported under globe projection."),n.setLocationAtPoint(a.around,a.aroundPoint);else{const xe=ge>de?Math.min(2,Te):Math.max(.5,Te),Ae=Math.pow(xe,1-Ee),qe=bh(m,ve,_e,Ee*Ae);n.setCenter(qe.wrap())}if(O){const xe=c.C.number(de,ge,Ee)+mr(0,n.center.lat);n.setZoom(xe)}},isZooming:O,elevationCenter:ue}}handleFlyTo(n,a){const d=a.zoom!==void 0,m=n.center,b=n.zoom,T=n.padding,C=!n.isPaddingEqual(a.padding),k=n.getConstrained(c.S.convert(a.center||a.locationAtOffset),b).center,D=d?+a.zoom:n.zoom+mr(n.center.lat,k.lat),O=n.clone();O.setCenter(k),O.setZoom(D),O.setBearing(a.bearing);const U=new c.P(c.ah(n.centerPoint.x+a.offsetAsPoint.x,0,n.width),c.ah(n.centerPoint.y+a.offsetAsPoint.y,0,n.height));O.setLocationAtPoint(k,U);const B=O.center;vo(n,B);const q=function(_e,Te,Ee){const xe=Br(Te),Ae=Br(Ee),qe=c.aX(xe,Ae),Ue=Math.acos(qe),$e=Sl(_e);return Ue/(2*Math.PI)*$e}(n,m,B),Q=b+mr(m.lat,0),ue=D+mr(B.lat,0),he=c.af(ue-Q);let de;if(typeof a.minZoom=="number"){const _e=+a.minZoom+mr(B.lat,0),Te=Math.min(_e,Q,ue)+mr(0,B.lat),Ee=n.getConstrained(B,Te).zoom+mr(B.lat,0);de=c.af(Ee-Q)}const ge=c.bA(m.lng,B.lng),ve=c.bA(m.lat,B.lat);return{easeFunc:(_e,Te,Ee,xe)=>{const Ae=bh(m,ge,ve,Ee);C&&n.interpolatePadding(T,a.padding,_e);const qe=_e===1?B:Ae;n.setCenter(qe.wrap());const Ue=Q+c.ak(Te);n.setZoom(_e===1?D:Ue+mr(0,qe.lat))},scaleOfZoom:he,targetCenter:B,scaleOfMinZoom:de,pixelPathLength:q}}static solveVectorScale(n,a,d,m,b){const T=m==="x"?[d[0],d[4],d[8],d[12]]:[d[1],d[5],d[9],d[13]],C=[d[3],d[7],d[11],d[15]],k=n[0]*T[0]+n[1]*T[1]+n[2]*T[2],D=n[0]*C[0]+n[1]*C[1]+n[2]*C[2],O=a[0]*T[0]+a[1]*T[1]+a[2]*T[2],U=a[0]*C[0]+a[1]*C[1]+a[2]*C[2];return O+b*D===k+b*U||C[3]*(k-O)+T[3]*(U-D)+k*U==O*D?null:(O+T[3]-b*U-b*C[3])/(O-k-b*U+b*D)}static getLesserNonNegativeNonNull(n,a){return a!==null&&a>=0&&a<n?a:n}}class Th{constructor(n){this._globe=n,this._mercatorCameraHelper=new $o,this._verticalPerspectiveCameraHelper=new os}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(n,a){return this.currentHelper.handlePanInertia(n,a)}handleMapControlsRollPitchBearingZoom(n,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(n,a)}handleMapControlsPan(n,a,d){this.currentHelper.handleMapControlsPan(n,a,d)}cameraForBoxAndBearing(n,a,d,m,b){return this.currentHelper.cameraForBoxAndBearing(n,a,d,m,b)}handleJumpToCenterZoom(n,a){this.currentHelper.handleJumpToCenterZoom(n,a)}handleEaseTo(n,a){return this.currentHelper.handleEaseTo(n,a)}handleFlyTo(n,a){return this.currentHelper.handleFlyTo(n,a)}}const La=(_,n)=>c.y(_,n&&n.filter(a=>a.identifier!=="source.canvas")),lf=c.bE();class cc extends c.E{constructor(n,a={}){var d,m;super(),this._rtlPluginLoaded=()=>{for(const T in this.sourceCaches){const C=this.sourceCaches[T].getSource().type;C!=="vector"&&C!=="geojson"||this.sourceCaches[T].reload()}},this.map=n,this.dispatcher=new Pt(Ut(),n._getMapId()),this.dispatcher.registerMessageHandler("GG",(T,C)=>this.getGlyphs(T,C)),this.dispatcher.registerMessageHandler("GI",(T,C)=>this.getImages(T,C)),this.dispatcher.registerMessageHandler("GDA",(T,C)=>this.getDashes(T,C)),this.imageManager=new xt,this.imageManager.setEventedParent(this);const b=((d=n._container)===null||d===void 0?void 0:d.lang)||typeof document<"u"&&((m=document.documentElement)===null||m===void 0?void 0:m.lang)||void 0;this.glyphManager=new vt(n._requestManager,a.localIdeographFontFamily,b),this.lineAtlas=new Oe(256,512),this.crossTileSymbolIndex=new qs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",c.bG()),br().on(Ss,this._rtlPluginLoaded),this.on("data",T=>{if(T.dataType!=="source"||T.sourceDataType!=="metadata")return;const C=this.sourceCaches[T.sourceId];if(!C)return;const k=C.getSource();if(k&&k.vectorLayerIds)for(const D in this._layers){const O=this._layers[D];O.source===k.id&&this._validateLayer(O)}})}setGlobalStateProperty(n,a){var d,m,b;this._checkLoaded();const T=a===null?(b=(m=(d=this.stylesheet.state)===null||d===void 0?void 0:d[n])===null||m===void 0?void 0:m.default)!==null&&b!==void 0?b:null:a;if(c.bH(T,this._globalState[n]))return this;this._globalState[n]=T,this._applyGlobalStateChanges([n])}getGlobalState(){return this._globalState}setGlobalState(n){this._checkLoaded();const a=[];for(const d in n)!c.bH(this._globalState[d],n[d].default)&&(a.push(d),this._globalState[d]=n[d].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(n){if(n.length===0)return;const a=new Set,d={};for(const m of n){d[m]=this._globalState[m];for(const b in this._layers){const T=this._layers[b],C=T.getLayoutAffectingGlobalStateRefs(),k=T.getPaintAffectingGlobalStateRefs();if(C.has(m)&&a.add(T.source),k.has(m))for(const{name:D,value:O}of k.get(m))this._updatePaintProperty(T,D,O)}}this.dispatcher.broadcast("UGS",d);for(const m in this.sourceCaches)a.has(m)&&(this._reloadSource(m),this._changed=!0)}loadURL(n,a={},d){this.fire(new c.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const m=this.map._requestManager.transformRequest(n,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;c.j(m,this._loadStyleRequest).then(T=>{this._loadStyleRequest=null,this._load(T.data,a,d)}).catch(T=>{this._loadStyleRequest=null,T&&!b.signal.aborted&&this.fire(new c.k(T))})}loadJSON(n,a={},d){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,K.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(n,a,d)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(lf,{validate:!1})}_load(n,a,d){var m,b;let T=a.transformStyle?a.transformStyle(d,n):n;if(!a.validate||!La(this,c.z(T))){T=Object.assign({},T),this._loaded=!0,this.stylesheet=T;for(const C in T.sources)this.addSource(C,T.sources[C],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new wt(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new Ne(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var n,a,d;const m=c.bI(this.stylesheet.layers);this.setGlobalState((n=this.stylesheet.state)!==null&&n!==void 0?n:null),this.dispatcher.broadcast("SL",m),this._order=m.map(b=>b.id),this._layers={},this._serializedLayers=null;for(const b of m){const T=c.bJ(b,this._globalState);if(T.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=T,c.bK(T)&&this.sourceCaches[T.source]){const C=(d=(a=b.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&d!==void 0?d:T.paint.get("raster-fade-duration");this.sourceCaches[T.source].setRasterFadeDuration(C)}}}_loadSprite(n,a=!1,d=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,T,C,k){return c._(this,void 0,void 0,function*(){const D=Ie(b),O=C>1?"@2x":"",U={},B={};for(const{id:q,url:Q}of D){const ue=T.transformRequest(Ge(Q,O,".json"),"SpriteJSON");U[q]=c.j(ue,k);const he=T.transformRequest(Ge(Q,O,".png"),"SpriteImage");B[q]=fe.getImage(he,k)}return yield Promise.all([...Object.values(U),...Object.values(B)]),function(q,Q){return c._(this,void 0,void 0,function*(){const ue={};for(const he in q){ue[he]={};const de=K.getImageCanvasContext((yield Q[he]).data),ge=(yield q[he]).data;for(const ve in ge){const{width:_e,height:Te,x:Ee,y:xe,sdf:Ae,pixelRatio:qe,stretchX:Ue,stretchY:$e,content:Ze,textFitWidth:st,textFitHeight:ot}=ge[ve];ue[he][ve]={data:null,pixelRatio:qe,sdf:Ae,stretchX:Ue,stretchY:$e,content:Ze,textFitWidth:st,textFitHeight:ot,spriteData:{width:_e,height:Te,x:Ee,y:xe,context:de}}}}return ue})}(U,B)})}(n,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const T in b){this._spritesImagesIds[T]=[];const C=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(k=>!(k in b)):[];for(const k of C)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in b[T]){const D=T==="default"?k:`${T}:${k}`;this._spritesImagesIds[T].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,b[T][k],!1):this.imageManager.addImage(D,b[T][k]),a&&(this._changedImages[D]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new c.k(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),d&&d(m)})}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(n){const a=this.sourceCaches[n.source];if(!a)return;const d=n.sourceLayer;if(!d)return;const m=a.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(d)===-1)&&this.fire(new c.k(new Error(`Source layer "${d}" does not exist on source "${m.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n,a=!1){const d=this._serializedAllLayers();if(!n||n.length===0)return Object.values(a?c.bL(d):d);const m=[];for(const b of n)if(d[b]){const T=a?c.bL(d[b]):d[b];m.push(T)}return m}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const a=Object.keys(this._layers);for(const d of a){const m=this._layers[d];m.type!=="custom"&&(n[d]=m.serialize())}return n}hasTransitions(){var n,a,d;if(!((n=this.light)===null||n===void 0)&&n.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((d=this.projection)===null||d===void 0)&&d.hasTransition())return!0;for(const m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const a=this._changed;if(a){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const T in this._updatedSources){const C=this._updatedSources[T];if(C==="reload")this._reloadSource(T);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(n);this.light.updateTransitions(n),this.sky.updateTransitions(n),this._resetUpdates()}const d={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];d[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in d){const b=this.sourceCaches[m];!!d[m]!=!!b.used&&b.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(n),this.sky.recalculate(n),this.projection.recalculate(n),this.z=n.zoom,a&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(n,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,a={}){var d;this._checkLoaded();const m=this.serialize();if(n=a.transformStyle?a.transformStyle(m,n):n,((d=a.validate)===null||d===void 0||d)&&La(this,c.z(n)))return!1;(n=c.bL(n)).layers=c.bI(n.layers);const b=c.bM(m,n),T=this._getOperationsToPerform(b);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const C of T.operations)C();return this.stylesheet=n,this._serializedLayers=null,!0}_getOperationsToPerform(n){const a=[],d=[];for(const m of n)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":a.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":a.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setSky":a.push(()=>this.setSky.apply(this,m.args));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setGlobalState":a.push(()=>this.setGlobalState.apply(this,m.args));break;case"setTransition":a.push(()=>{});break;default:d.push(m.command)}return{operations:a,unimplemented:d}}addImage(n,a){if(this.getImage(n))return this.fire(new c.k(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,a),this._afterImageUpdated(n)}updateImage(n,a){this.imageManager.updateImage(n,a)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new c.k(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,a,d={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(c.z.source,`sources.${n}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const m=this.sourceCaches[n]=new St(n,a,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:n})),m.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===n)return this.fire(new c.k(new Error(`Source "${n}" cannot be removed while layer "${d}" is using it.`)));const a=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],a.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,a){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const d=this.sourceCaches[n].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(a),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,a,d={}){this._checkLoaded();const m=n.id;if(this.getLayer(m))return void this.fire(new c.k(new Error(`Layer "${m}" already exists on this map.`)));let b;if(n.type==="custom"){if(La(this,c.bN(n)))return;b=c.bJ(n,this._globalState)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(m,n.source),n=c.bL(n),n=c.e(n,{source:m})),this._validate(c.z.layer,`layers.${m}`,n,{arrayIndex:-1},d))return;b=c.bJ(n,this._globalState),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const T=a?this._order.indexOf(a):this._order.length;if(a&&T===-1)this.fire(new c.k(new Error(`Cannot add layer "${m}" before non-existing layer "${a}".`)));else{if(this._order.splice(T,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(n,a){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new c.k(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===a)return;const d=this._order.indexOf(n);this._order.splice(d,1);const m=a?this._order.indexOf(a):this._order.length;a&&m===-1?this.fire(new c.k(new Error(`Cannot move layer "${n}" before non-existing layer "${a}".`))):(this._order.splice(m,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const a=this._layers[n];if(!a)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${n}".`)));a.setEventedParent(null);const d=this._order.indexOf(n);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=a,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],a.onRemove&&a.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,a,d){this._checkLoaded();const m=this.getLayer(n);m?m.minzoom===a&&m.maxzoom===d||(a!=null&&(m.minzoom=a),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,a,d={}){this._checkLoaded();const m=this.getLayer(n);if(m){if(!c.bH(m.filter,a))return a==null?(m.setFilter(void 0),void this._updateLayer(m)):void(this._validate(c.z.filter,`layers.${m.id}.filter`,a,null,d)||(m.setFilter(c.bL(a)),this._updateLayer(m)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return c.bL(this.getLayer(n).filter)}setLayoutProperty(n,a,d,m={}){this._checkLoaded();const b=this.getLayer(n);b?c.bH(b.getLayoutProperty(a),d)||(b.setLayoutProperty(a,d,m),this._updateLayer(b)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,a){const d=this.getLayer(n);if(d)return d.getLayoutProperty(a);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,a,d,m={}){this._checkLoaded();const b=this.getLayer(n);b?c.bH(b.getPaintProperty(a),d)||this._updatePaintProperty(b,a,d,m):this.fire(new c.k(new Error(`Cannot style non-existing layer "${n}".`)))}_updatePaintProperty(n,a,d,m={}){n.setPaintProperty(a,d,m)&&this._updateLayer(n),c.bK(n)&&a==="raster-fade-duration"&&this.sourceCaches[n.source].setRasterFadeDuration(d),this._changed=!0,this._updatedPaintProps[n.id]=!0,this._serializedLayers=null}getPaintProperty(n,a){return this.getLayer(n).getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const d=n.source,m=n.sourceLayer,b=this.sourceCaches[d];if(b===void 0)return void this.fire(new c.k(new Error(`The source '${d}' does not exist in the map's style.`)));const T=b.getSource().type;T==="geojson"&&m?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||m?(n.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,n.id,a)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,a){this._checkLoaded();const d=n.source,m=this.sourceCaches[d];if(m===void 0)return void this.fire(new c.k(new Error(`The source '${d}' does not exist in the map's style.`)));const b=m.getSource().type,T=b==="vector"?n.sourceLayer:void 0;b!=="vector"||T?a&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(T,n.id,a):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const a=n.source,d=n.sourceLayer,m=this.sourceCaches[a];if(m!==void 0)return m.getSource().type!=="vector"||d?(n.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(d,n.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=c.bO(this.sourceCaches,b=>b.serialize()),a=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,m=this.stylesheet;return c.bP({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:n,layers:a,terrain:d},b=>b!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const a=T=>this._layers[T].type==="fill-extrusion",d={},m=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(a(C)){d[C]=T;for(const k of n){const D=k[C];if(D)for(const O of D)m.push(O)}}}m.sort((T,C)=>C.intersectionZ-T.intersectionZ);const b=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(a(C))for(let k=m.length-1;k>=0;k--){const D=m[k].feature;if(d[D.layer.id]<T)break;b.push(D),m.pop()}else for(const k of n){const D=k[C];if(D)for(const O of D)b.push(O.feature)}}return b}queryRenderedFeatures(n,a,d){a&&a.filter&&this._validate(c.z.filter,"queryRenderedFeatures.filter",a.filter,null,a);const m={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const D of a.layers){const O=this._layers[D];if(!O)return this.fire(new c.k(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];m[O.source]=!0}}const b=[];a.availableImages=this._availableImages;const T=this._serializedAllLayers(),C=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,k=Object.assign(Object.assign({},a),{layers:C,globalState:this._globalState});for(const D in this.sourceCaches)a.layers&&!m[D]||b.push(yi(this.sourceCaches[D],this._layers,T,n,k,d,this.map.terrain?(O,U,B)=>this.map.terrain.getElevation(O,U,B):void 0));return this.placement&&b.push(function(D,O,U,B,q,Q,ue){const he={},de=Q.queryRenderedSymbols(B),ge=[];for(const ve of Object.keys(de).map(Number))ge.push(ue[ve]);ge.sort(ws);for(const ve of ge){const _e=ve.featureIndex.lookupSymbolFeatures(de[ve.bucketInstanceId],O,ve.bucketIndex,ve.sourceLayerIndex,{filterSpec:q.filter,globalState:q.globalState},q.layers,q.availableImages,D);for(const Te in _e){const Ee=he[Te]=he[Te]||[],xe=_e[Te];xe.sort((Ae,qe)=>{const Ue=ve.featureSortOrder;if(Ue){const $e=Ue.indexOf(Ae.featureIndex);return Ue.indexOf(qe.featureIndex)-$e}return qe.featureIndex-Ae.featureIndex});for(const Ae of xe)Ee.push(Ae)}}return function(ve,_e,Te){for(const Ee in ve)for(const xe of ve[Ee])Ts(xe,Te[_e[Ee].source]);return ve}(he,D,U)}(this._layers,T,this.sourceCaches,n,k,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,a){a!=null&&a.filter&&this._validate(c.z.filter,"querySourceFeatures.filter",a.filter,null,a);const d=this.sourceCaches[n];return d?function(m,b){const T=m.getRenderableIds().map(D=>m.getTileByID(D)),C=[],k={};for(let D=0;D<T.length;D++){const O=T[D],U=O.tileID.canonical.key;k[U]||(k[U]=!0,O.querySourceFeatures(C,b))}return C}(d,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(n,a={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const T in n)if(!c.bH(n[T],d[T])){m=!0;break}if(!m)return;const b={now:K.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,a),this.light.updateTransitions(b)}getProjection(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.projection}setProjection(n){if(this._checkLoaded(),this.projection){if(this.projection.name===n.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=n,this._setProjectionInternal(n.type)}getSky(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.sky}setSky(n,a={}){this._checkLoaded();const d=this.getSky();let m=!1;if(!n&&!d)return;if(n&&!d)m=!0;else if(!n&&d)m=!0;else for(const T in n)if(!c.bH(n[T],d[T])){m=!0;break}if(!m)return;const b={now:K.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=n,this.sky.setSky(n,a),this.sky.updateTransitions(b)}_setProjectionInternal(n){const a=function(d){if(Array.isArray(d)){const m=new Tl({type:d});return{projection:m,transform:new Is,cameraHelper:new Th(m)}}switch(d){case"mercator":return{projection:new yo,transform:new xo,cameraHelper:new $o};case"globe":{const m=new Tl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new Is,cameraHelper:new Th(m)}}case"vertical-perspective":return{projection:new ui,transform:new Ra,cameraHelper:new os};default:return c.w(`Unknown projection name: ${d}. Falling back to mercator projection.`),{projection:new yo,transform:new xo,cameraHelper:new $o}}}(n);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const d in this.sourceCaches)this.sourceCaches[d].reload()}_validate(n,a,d,m,b={}){return(!b||b.validate!==!1)&&La(this,n.call(c.z,c.e({key:a,style:this.serialize(),value:d,styleSpec:c.v},m)))}_remove(n=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),br().off(Ss,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const d=this.sourceCaches[a];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),n&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const a in this.sourceCaches)this.sourceCaches[a].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,a,d,m,b=!1){let T=!1,C=!1;const k={};for(const D of this._order){const O=this._layers[D];if(O.type!=="symbol")continue;if(!k[O.source]){const B=this.sourceCaches[O.source];k[O.source]=B.getRenderableIds(!0).map(q=>B.getTileByID(q)).sort((q,Q)=>Q.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(Q.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(O,k[O.source],n.center.lng);T=T||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(K.now(),n.zoom))&&(this.pauseablePlacement=new xl(n,this.map.terrain,this._order,b,a,d,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(K.now()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const D of this._order){const O=this._layers[D];O.type==="symbol"&&this.placement.updateLayerOpacities(O,k[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(K.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,a){return c._(this,void 0,void 0,function*(){const d=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[a.source];return m&&m.setDependencies(a.tileID.key,a.type,a.icons),d})}getGlyphs(n,a){return c._(this,void 0,void 0,function*(){const d=yield this.glyphManager.getGlyphs(a.stacks),m=this.sourceCaches[a.source];return m&&m.setDependencies(a.tileID.key,a.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,a={}){this._checkLoaded(),n&&this._validate(c.z.glyphs,"glyphs",n,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}getDashes(n,a){return c._(this,void 0,void 0,function*(){const d={};for(const[m,b]of Object.entries(a.dashes))d[m]=this.lineAtlas.getDash(b.dasharray,b.round);return d})}addSprite(n,a,d={},m){this._checkLoaded();const b=[{id:n,url:a}],T=[...Ie(this.stylesheet.sprite),...b];this._validate(c.z.sprite,"sprite",T,null,d)||(this.stylesheet.sprite=T,this._loadSprite(b,!0,m))}removeSprite(n){this._checkLoaded();const a=Ie(this.stylesheet.sprite);if(a.find(d=>d.id===n)){if(this._spritesImagesIds[n])for(const d of this._spritesImagesIds[n])this.imageManager.removeImage(d),this._changedImages[d]=!0;a.splice(a.findIndex(d=>d.id===n),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return Ie(this.stylesheet.sprite)}setSprite(n,a={},d){this._checkLoaded(),n&&this._validate(c.z.sprite,"sprite",n,null,a)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,d):(this._unloadSprite(),d&&d(null)))}}var Sh=c.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Wo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,a,d,m,b,T,C,k,D){this.context=n;let O=this.boundPaintVertexBuffers.length!==m.length;for(let U=0;!O&&U<m.length;U++)this.boundPaintVertexBuffers[U]!==m[U]&&(O=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||O||this.boundIndexBuffer!==b||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==D?this.freshBind(a,d,m,b,T,C,k,D):(n.bindVertexArray.set(this.vao),C&&C.bind(),b&&b.dynamicDraw&&b.bind(),k&&k.bind(),D&&D.bind())}freshBind(n,a,d,m,b,T,C,k){const D=n.numAttributes,O=this.context,U=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=k,a.enableAttributes(U,n);for(const B of d)B.enableAttributes(U,n);T&&T.enableAttributes(U,n),C&&C.enableAttributes(U,n),k&&k.enableAttributes(U,n),a.bind(),a.setVertexAttribPointers(U,n,b);for(const B of d)B.bind(),B.setVertexAttribPointers(U,n,b);T&&(T.bind(),T.setVertexAttribPointers(U,n,b)),m&&m.bind(),C&&(C.bind(),C.setVertexAttribPointers(U,n,b)),k&&(k.bind(),k.setVertexAttribPointers(U,n,b)),O.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Hs=(_,n,a,d,m)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:n,u_fog_color:a?a.properties.get("fog-color"):c.bf.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:a?a.calculateFogBlendOpacity(d):0,u_horizon_color:a?a.properties.get("horizon-color"):c.bf.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),uc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ks(_){const n=[];for(let a=0;a<_.length;a++){if(_[a]===null)continue;const d=_[a].split(" ");n.push(d.pop())}return n}class Pi{constructor(n,a,d,m,b,T,C,k,D=[]){const O=n.gl;this.program=O.createProgram();const U=ks(a.staticAttributes),B=d?d.getBinderAttributes():[],q=U.concat(B),Q=Sr.prelude.staticUniforms?ks(Sr.prelude.staticUniforms):[],ue=C.staticUniforms?ks(C.staticUniforms):[],he=a.staticUniforms?ks(a.staticUniforms):[],de=d?d.getBinderUniforms():[],ge=Q.concat(ue).concat(he).concat(de),ve=[];for(const Ue of ge)ve.indexOf(Ue)<0&&ve.push(Ue);const _e=d?d.defines():[];jr(O)&&_e.unshift("#version 300 es"),b&&_e.push("#define OVERDRAW_INSPECTOR;"),T&&_e.push("#define TERRAIN3D;"),k&&_e.push(k),D&&_e.push(...D);let Te=_e.concat(Sr.prelude.fragmentSource,C.fragmentSource,a.fragmentSource).join(`
`),Ee=_e.concat(Sr.prelude.vertexSource,C.vertexSource,a.vertexSource).join(`
`);jr(O)||(Te=function(Ue){return Ue.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Te),Ee=function(Ue){return Ue.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Ee));const xe=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(xe,Te),O.compileShader(xe),!O.getShaderParameter(xe,O.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${O.getShaderInfoLog(xe)}`);O.attachShader(this.program,xe);const Ae=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(Ae,Ee),O.compileShader(Ae),!O.getShaderParameter(Ae,O.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${O.getShaderInfoLog(Ae)}`);O.attachShader(this.program,Ae),this.attributes={};const qe={};this.numAttributes=q.length;for(let Ue=0;Ue<this.numAttributes;Ue++)q[Ue]&&(O.bindAttribLocation(this.program,Ue,q[Ue]),this.attributes[q[Ue]]=Ue);if(O.linkProgram(this.program),!O.getProgramParameter(this.program,O.LINK_STATUS))throw new Error(`Program failed to link: ${O.getProgramInfoLog(this.program)}`);O.deleteShader(Ae),O.deleteShader(xe);for(let Ue=0;Ue<ve.length;Ue++){const $e=ve[Ue];if($e&&!qe[$e]){const Ze=O.getUniformLocation(this.program,$e);Ze&&(qe[$e]=Ze)}}this.fixedUniforms=m(n,qe),this.terrainUniforms=((Ue,$e)=>({u_depth:new c.bQ(Ue,$e.u_depth),u_terrain:new c.bQ(Ue,$e.u_terrain),u_terrain_dim:new c.bg(Ue,$e.u_terrain_dim),u_terrain_matrix:new c.bS(Ue,$e.u_terrain_matrix),u_terrain_unpack:new c.bT(Ue,$e.u_terrain_unpack),u_terrain_exaggeration:new c.bg(Ue,$e.u_terrain_exaggeration)}))(n,qe),this.projectionUniforms=((Ue,$e)=>({u_projection_matrix:new c.bS(Ue,$e.u_projection_matrix),u_projection_tile_mercator_coords:new c.bT(Ue,$e.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bT(Ue,$e.u_projection_clipping_plane),u_projection_transition:new c.bg(Ue,$e.u_projection_transition),u_projection_fallback_matrix:new c.bS(Ue,$e.u_projection_fallback_matrix)}))(n,qe),this.binderUniforms=d?d.getUniforms(n,qe):[]}draw(n,a,d,m,b,T,C,k,D,O,U,B,q,Q,ue,he,de,ge,ve){const _e=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(d),n.setStencilMode(m),n.setColorMode(b),n.setCullFace(T),k){n.activeTexture.set(_e.TEXTURE2),_e.bindTexture(_e.TEXTURE_2D,k.depthTexture),n.activeTexture.set(_e.TEXTURE3),_e.bindTexture(_e.TEXTURE_2D,k.texture);for(const Ee in this.terrainUniforms)this.terrainUniforms[Ee].set(k[Ee])}if(D)for(const Ee in D)this.projectionUniforms[uc[Ee]].set(D[Ee]);if(C)for(const Ee in this.fixedUniforms)this.fixedUniforms[Ee].set(C[Ee]);he&&he.setUniforms(n,this.binderUniforms,Q,{zoom:ue});let Te=0;switch(a){case _e.LINES:Te=2;break;case _e.TRIANGLES:Te=3;break;case _e.LINE_STRIP:Te=1}for(const Ee of q.get()){const xe=Ee.vaos||(Ee.vaos={});(xe[O]||(xe[O]=new Wo)).bind(n,this,U,he?he.getPaintVertexBuffers():[],B,Ee.vertexOffset,de,ge,ve),_e.drawElements(a,Ee.primitiveLength*Te,_e.UNSIGNED_SHORT,Ee.primitiveOffset*Te*2)}}}function Wi(_,n,a){const d=1/c.aC(a,1,n.transform.tileZoom),m=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,n.transform.tileZoom)/m,T=b*(a.tileID.canonical.x+a.tileID.wrap*m),C=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}const Eu=(_,n,a,d)=>{const m=_.style.light,b=m.properties.get("position"),T=[b.x,b.y,b.z],C=c.bW();m.properties.get("anchor")==="viewport"&&c.bX(C,_.transform.bearingInRadians),c.bY(T,T,C);const k=_.transform.transformLightDirection(T),D=m.properties.get("color");return{u_lightpos:T,u_lightpos_globe:k,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+n,u_opacity:a,u_fill_translate:d}},Cu=(_,n,a,d,m,b,T)=>c.e(Eu(_,n,a,d),Wi(b,_,T),{u_height_factor:-Math.pow(2,m.overscaledZ)/T.tileSize/8}),To=(_,n,a,d)=>c.e(Wi(n,_,a),{u_fill_translate:d}),Ho=(_,n)=>({u_world:_,u_fill_translate:n}),cf=(_,n,a,d,m)=>c.e(To(_,n,a,m),{u_world:d}),hc=(_,n,a,d,m)=>{const b=_.transform;let T,C,k=0;if(a.paint.get("circle-pitch-alignment")==="map"){const D=c.aC(n,1,b.zoom);T=!0,C=[D,D],k=D/(c.$*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*m}else T=!1,C=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+T,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:C,u_globe_extrude_scale:k,u_translate:d}},Ph=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),za=_=>({u_viewport_size:[_.width,_.height]}),Hi=(_,n=1)=>({u_color:_,u_overlay:0,u_overlay_scale:n}),So=(_,n,a,d)=>{const m=c.aC(_,1,n)/(c.$*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*d;return{u_extrude_scale:c.aC(_,1,n),u_intensity:a,u_globe_extrude_scale:m}},Eh=(_,n,a,d)=>{const m=c.L();c.bZ(m,0,_.width,_.height,0,0,1);const b=_.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:a,u_color_ramp:d,u_opacity:n.paint.get("heatmap-opacity")}},Ms=(_,n,a)=>{const d=a.paint.get("hillshade-accent-color");let m;switch(a.paint.get("hillshade-method")){case"basic":m=4;break;case"combined":m=1;break;case"igor":m=2;break;case"multidirectional":m=3;break;default:m=0}const b=a.getIlluminationProperties();for(let T=0;T<b.directionRadians.length;T++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(b.directionRadians[T]+=_.transform.bearingInRadians);return{u_image:0,u_latrange:Ko(0,n.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:b.altitudeRadians,u_azimuths:b.directionRadians,u_accent:d,u_method:m,u_highlights:b.highlightColor,u_shadows:b.shadowColor}},Iu=(_,n)=>{const a=n.stride,d=c.L();return c.bZ(d,0,c.$,-c.$,0,0,1),c.M(d,d,[0,-c.$,0]),{u_matrix:d,u_image:1,u_dimension:[a,a],u_zoom:_.overscaledZ,u_unpack:n.getUnpackVector()}};function Ko(_,n){const a=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new c.a1(0,d/a).toLngLat().lat,new c.a1(0,(d+1)/a).toLngLat().lat]}const Ch=(_,n,a=0)=>({u_image:0,u_unpack:n.getUnpackVector(),u_dimension:[n.stride,n.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:_.paint.get("color-relief-opacity")}),Ks=(_,n,a,d)=>{const m=_.transform;return{u_translation:kh(_,n,a),u_ratio:d/c.aC(n,1,m.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},ku=(_,n,a,d,m)=>c.e(Ks(_,n,a,d),{u_image:0,u_image_height:m}),As=(_,n,a,d,m)=>{const b=_.transform,T=Rs(n,b);return{u_translation:kh(_,n,a),u_texsize:n.imageAtlasTexture.size,u_ratio:d/c.aC(n,1,b.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[T,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Ih=(_,n,a,d,m)=>{const b=Rs(n,_.transform);return c.e(Ks(_,n,a,d),{u_tileratio:b,u_crossfade_from:m.fromScale,u_crossfade_to:m.toScale,u_image:0,u_mix:m.t,u_lineatlas_width:_.lineAtlas.width,u_lineatlas_height:_.lineAtlas.height})},Xs=(_,n,a,d,m,b)=>{const T=Rs(n,_.transform);return c.e(Ks(_,n,a,d),{u_image:0,u_image_height:b,u_tileratio:T,u_crossfade_from:m.fromScale,u_crossfade_to:m.toScale,u_image_dash:1,u_mix:m.t,u_lineatlas_width:_.lineAtlas.width,u_lineatlas_height:_.lineAtlas.height})};function Rs(_,n){return 1/c.aC(_,1,n.tileZoom)}function kh(_,n,a){return c.aD(_.transform,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Da=(_,n,a,d,m)=>{return{u_tl_parent:_,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(T=d.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=d.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:uf(d.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var b,T};function uf(_){_*=Math.PI/180;const n=Math.sin(_),a=Math.cos(_);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Ls=(_,n,a,d,m,b,T,C,k,D,O,U,B)=>{const q=T.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:q.width/q.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_label_plane_matrix:C,u_coord_matrix:k,u_is_text:+O,u_pitch_with_map:+d,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:U,u_texture:0,u_translation:D,u_pitched_scale:B}},Mu=(_,n,a,d,m,b,T,C,k,D,O,U,B,q)=>{const Q=T.transform;return c.e(Ls(_,n,a,d,m,b,T,C,k,D,O,U,q),{u_gamma_scale:d?Math.cos(Q.pitch*Math.PI/180)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:1})},Xo=(_,n,a,d,m,b,T,C,k,D,O,U,B)=>c.e(Mu(_,n,a,d,m,b,T,C,k,D,!0,O,0,B),{u_texsize_icon:U,u_texture_icon:1}),Mh=(_,n)=>({u_opacity:_,u_color:n}),as=(_,n,a,d,m)=>c.e(function(b,T,C,k){const D=C.imageManager.getPattern(b.from.toString()),O=C.imageManager.getPattern(b.to.toString()),{width:U,height:B}=C.imageManager.getPixelSize(),q=Math.pow(2,k.tileID.overscaledZ),Q=k.tileSize*Math.pow(2,C.transform.tileZoom)/q,ue=Q*(k.tileID.canonical.x+k.tileID.wrap*q),he=Q*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[U,B],u_mix:T.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/c.aC(k,1,C.transform.tileZoom),u_pixel_coord_upper:[ue>>16,he>>16],u_pixel_coord_lower:[65535&ue,65535&he]}}(a,m,n,d),{u_opacity:_}),Na=(_,n)=>{},El={fillExtrusion:(_,n)=>({u_lightpos:new c.bU(_,n.u_lightpos),u_lightpos_globe:new c.bU(_,n.u_lightpos_globe),u_lightintensity:new c.bg(_,n.u_lightintensity),u_lightcolor:new c.bU(_,n.u_lightcolor),u_vertical_gradient:new c.bg(_,n.u_vertical_gradient),u_opacity:new c.bg(_,n.u_opacity),u_fill_translate:new c.bV(_,n.u_fill_translate)}),fillExtrusionPattern:(_,n)=>({u_lightpos:new c.bU(_,n.u_lightpos),u_lightpos_globe:new c.bU(_,n.u_lightpos_globe),u_lightintensity:new c.bg(_,n.u_lightintensity),u_lightcolor:new c.bU(_,n.u_lightcolor),u_vertical_gradient:new c.bg(_,n.u_vertical_gradient),u_height_factor:new c.bg(_,n.u_height_factor),u_opacity:new c.bg(_,n.u_opacity),u_fill_translate:new c.bV(_,n.u_fill_translate),u_image:new c.bQ(_,n.u_image),u_texsize:new c.bV(_,n.u_texsize),u_pixel_coord_upper:new c.bV(_,n.u_pixel_coord_upper),u_pixel_coord_lower:new c.bV(_,n.u_pixel_coord_lower),u_scale:new c.bU(_,n.u_scale),u_fade:new c.bg(_,n.u_fade)}),fill:(_,n)=>({u_fill_translate:new c.bV(_,n.u_fill_translate)}),fillPattern:(_,n)=>({u_image:new c.bQ(_,n.u_image),u_texsize:new c.bV(_,n.u_texsize),u_pixel_coord_upper:new c.bV(_,n.u_pixel_coord_upper),u_pixel_coord_lower:new c.bV(_,n.u_pixel_coord_lower),u_scale:new c.bU(_,n.u_scale),u_fade:new c.bg(_,n.u_fade),u_fill_translate:new c.bV(_,n.u_fill_translate)}),fillOutline:(_,n)=>({u_world:new c.bV(_,n.u_world),u_fill_translate:new c.bV(_,n.u_fill_translate)}),fillOutlinePattern:(_,n)=>({u_world:new c.bV(_,n.u_world),u_image:new c.bQ(_,n.u_image),u_texsize:new c.bV(_,n.u_texsize),u_pixel_coord_upper:new c.bV(_,n.u_pixel_coord_upper),u_pixel_coord_lower:new c.bV(_,n.u_pixel_coord_lower),u_scale:new c.bU(_,n.u_scale),u_fade:new c.bg(_,n.u_fade),u_fill_translate:new c.bV(_,n.u_fill_translate)}),circle:(_,n)=>({u_camera_to_center_distance:new c.bg(_,n.u_camera_to_center_distance),u_scale_with_map:new c.bQ(_,n.u_scale_with_map),u_pitch_with_map:new c.bQ(_,n.u_pitch_with_map),u_extrude_scale:new c.bV(_,n.u_extrude_scale),u_device_pixel_ratio:new c.bg(_,n.u_device_pixel_ratio),u_globe_extrude_scale:new c.bg(_,n.u_globe_extrude_scale),u_translate:new c.bV(_,n.u_translate)}),collisionBox:(_,n)=>({u_pixel_extrude_scale:new c.bV(_,n.u_pixel_extrude_scale)}),collisionCircle:(_,n)=>({u_viewport_size:new c.bV(_,n.u_viewport_size)}),debug:(_,n)=>({u_color:new c.bR(_,n.u_color),u_overlay:new c.bQ(_,n.u_overlay),u_overlay_scale:new c.bg(_,n.u_overlay_scale)}),depth:Na,clippingMask:Na,heatmap:(_,n)=>({u_extrude_scale:new c.bg(_,n.u_extrude_scale),u_intensity:new c.bg(_,n.u_intensity),u_globe_extrude_scale:new c.bg(_,n.u_globe_extrude_scale)}),heatmapTexture:(_,n)=>({u_matrix:new c.bS(_,n.u_matrix),u_world:new c.bV(_,n.u_world),u_image:new c.bQ(_,n.u_image),u_color_ramp:new c.bQ(_,n.u_color_ramp),u_opacity:new c.bg(_,n.u_opacity)}),hillshade:(_,n)=>({u_image:new c.bQ(_,n.u_image),u_latrange:new c.bV(_,n.u_latrange),u_exaggeration:new c.bg(_,n.u_exaggeration),u_altitudes:new c.b$(_,n.u_altitudes),u_azimuths:new c.b$(_,n.u_azimuths),u_accent:new c.bR(_,n.u_accent),u_method:new c.bQ(_,n.u_method),u_shadows:new c.b_(_,n.u_shadows),u_highlights:new c.b_(_,n.u_highlights)}),hillshadePrepare:(_,n)=>({u_matrix:new c.bS(_,n.u_matrix),u_image:new c.bQ(_,n.u_image),u_dimension:new c.bV(_,n.u_dimension),u_zoom:new c.bg(_,n.u_zoom),u_unpack:new c.bT(_,n.u_unpack)}),colorRelief:(_,n)=>({u_image:new c.bQ(_,n.u_image),u_unpack:new c.bT(_,n.u_unpack),u_dimension:new c.bV(_,n.u_dimension),u_elevation_stops:new c.bQ(_,n.u_elevation_stops),u_color_stops:new c.bQ(_,n.u_color_stops),u_color_ramp_size:new c.bQ(_,n.u_color_ramp_size),u_opacity:new c.bg(_,n.u_opacity)}),line:(_,n)=>({u_translation:new c.bV(_,n.u_translation),u_ratio:new c.bg(_,n.u_ratio),u_device_pixel_ratio:new c.bg(_,n.u_device_pixel_ratio),u_units_to_pixels:new c.bV(_,n.u_units_to_pixels)}),lineGradient:(_,n)=>({u_translation:new c.bV(_,n.u_translation),u_ratio:new c.bg(_,n.u_ratio),u_device_pixel_ratio:new c.bg(_,n.u_device_pixel_ratio),u_units_to_pixels:new c.bV(_,n.u_units_to_pixels),u_image:new c.bQ(_,n.u_image),u_image_height:new c.bg(_,n.u_image_height)}),linePattern:(_,n)=>({u_translation:new c.bV(_,n.u_translation),u_texsize:new c.bV(_,n.u_texsize),u_ratio:new c.bg(_,n.u_ratio),u_device_pixel_ratio:new c.bg(_,n.u_device_pixel_ratio),u_image:new c.bQ(_,n.u_image),u_units_to_pixels:new c.bV(_,n.u_units_to_pixels),u_scale:new c.bU(_,n.u_scale),u_fade:new c.bg(_,n.u_fade)}),lineSDF:(_,n)=>({u_translation:new c.bV(_,n.u_translation),u_ratio:new c.bg(_,n.u_ratio),u_device_pixel_ratio:new c.bg(_,n.u_device_pixel_ratio),u_units_to_pixels:new c.bV(_,n.u_units_to_pixels),u_image:new c.bQ(_,n.u_image),u_mix:new c.bg(_,n.u_mix),u_tileratio:new c.bg(_,n.u_tileratio),u_crossfade_from:new c.bg(_,n.u_crossfade_from),u_crossfade_to:new c.bg(_,n.u_crossfade_to),u_lineatlas_width:new c.bg(_,n.u_lineatlas_width),u_lineatlas_height:new c.bg(_,n.u_lineatlas_height)}),lineGradientSDF:(_,n)=>({u_translation:new c.bV(_,n.u_translation),u_ratio:new c.bg(_,n.u_ratio),u_device_pixel_ratio:new c.bg(_,n.u_device_pixel_ratio),u_units_to_pixels:new c.bV(_,n.u_units_to_pixels),u_image:new c.bQ(_,n.u_image),u_image_height:new c.bg(_,n.u_image_height),u_tileratio:new c.bg(_,n.u_tileratio),u_crossfade_from:new c.bg(_,n.u_crossfade_from),u_crossfade_to:new c.bg(_,n.u_crossfade_to),u_image_dash:new c.bQ(_,n.u_image_dash),u_mix:new c.bg(_,n.u_mix),u_lineatlas_width:new c.bg(_,n.u_lineatlas_width),u_lineatlas_height:new c.bg(_,n.u_lineatlas_height)}),raster:(_,n)=>({u_tl_parent:new c.bV(_,n.u_tl_parent),u_scale_parent:new c.bg(_,n.u_scale_parent),u_buffer_scale:new c.bg(_,n.u_buffer_scale),u_fade_t:new c.bg(_,n.u_fade_t),u_opacity:new c.bg(_,n.u_opacity),u_image0:new c.bQ(_,n.u_image0),u_image1:new c.bQ(_,n.u_image1),u_brightness_low:new c.bg(_,n.u_brightness_low),u_brightness_high:new c.bg(_,n.u_brightness_high),u_saturation_factor:new c.bg(_,n.u_saturation_factor),u_contrast_factor:new c.bg(_,n.u_contrast_factor),u_spin_weights:new c.bU(_,n.u_spin_weights),u_coords_top:new c.bT(_,n.u_coords_top),u_coords_bottom:new c.bT(_,n.u_coords_bottom)}),symbolIcon:(_,n)=>({u_is_size_zoom_constant:new c.bQ(_,n.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bQ(_,n.u_is_size_feature_constant),u_size_t:new c.bg(_,n.u_size_t),u_size:new c.bg(_,n.u_size),u_camera_to_center_distance:new c.bg(_,n.u_camera_to_center_distance),u_pitch:new c.bg(_,n.u_pitch),u_rotate_symbol:new c.bQ(_,n.u_rotate_symbol),u_aspect_ratio:new c.bg(_,n.u_aspect_ratio),u_fade_change:new c.bg(_,n.u_fade_change),u_label_plane_matrix:new c.bS(_,n.u_label_plane_matrix),u_coord_matrix:new c.bS(_,n.u_coord_matrix),u_is_text:new c.bQ(_,n.u_is_text),u_pitch_with_map:new c.bQ(_,n.u_pitch_with_map),u_is_along_line:new c.bQ(_,n.u_is_along_line),u_is_variable_anchor:new c.bQ(_,n.u_is_variable_anchor),u_texsize:new c.bV(_,n.u_texsize),u_texture:new c.bQ(_,n.u_texture),u_translation:new c.bV(_,n.u_translation),u_pitched_scale:new c.bg(_,n.u_pitched_scale)}),symbolSDF:(_,n)=>({u_is_size_zoom_constant:new c.bQ(_,n.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bQ(_,n.u_is_size_feature_constant),u_size_t:new c.bg(_,n.u_size_t),u_size:new c.bg(_,n.u_size),u_camera_to_center_distance:new c.bg(_,n.u_camera_to_center_distance),u_pitch:new c.bg(_,n.u_pitch),u_rotate_symbol:new c.bQ(_,n.u_rotate_symbol),u_aspect_ratio:new c.bg(_,n.u_aspect_ratio),u_fade_change:new c.bg(_,n.u_fade_change),u_label_plane_matrix:new c.bS(_,n.u_label_plane_matrix),u_coord_matrix:new c.bS(_,n.u_coord_matrix),u_is_text:new c.bQ(_,n.u_is_text),u_pitch_with_map:new c.bQ(_,n.u_pitch_with_map),u_is_along_line:new c.bQ(_,n.u_is_along_line),u_is_variable_anchor:new c.bQ(_,n.u_is_variable_anchor),u_texsize:new c.bV(_,n.u_texsize),u_texture:new c.bQ(_,n.u_texture),u_gamma_scale:new c.bg(_,n.u_gamma_scale),u_device_pixel_ratio:new c.bg(_,n.u_device_pixel_ratio),u_is_halo:new c.bQ(_,n.u_is_halo),u_translation:new c.bV(_,n.u_translation),u_pitched_scale:new c.bg(_,n.u_pitched_scale)}),symbolTextAndIcon:(_,n)=>({u_is_size_zoom_constant:new c.bQ(_,n.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bQ(_,n.u_is_size_feature_constant),u_size_t:new c.bg(_,n.u_size_t),u_size:new c.bg(_,n.u_size),u_camera_to_center_distance:new c.bg(_,n.u_camera_to_center_distance),u_pitch:new c.bg(_,n.u_pitch),u_rotate_symbol:new c.bQ(_,n.u_rotate_symbol),u_aspect_ratio:new c.bg(_,n.u_aspect_ratio),u_fade_change:new c.bg(_,n.u_fade_change),u_label_plane_matrix:new c.bS(_,n.u_label_plane_matrix),u_coord_matrix:new c.bS(_,n.u_coord_matrix),u_is_text:new c.bQ(_,n.u_is_text),u_pitch_with_map:new c.bQ(_,n.u_pitch_with_map),u_is_along_line:new c.bQ(_,n.u_is_along_line),u_is_variable_anchor:new c.bQ(_,n.u_is_variable_anchor),u_texsize:new c.bV(_,n.u_texsize),u_texsize_icon:new c.bV(_,n.u_texsize_icon),u_texture:new c.bQ(_,n.u_texture),u_texture_icon:new c.bQ(_,n.u_texture_icon),u_gamma_scale:new c.bg(_,n.u_gamma_scale),u_device_pixel_ratio:new c.bg(_,n.u_device_pixel_ratio),u_is_halo:new c.bQ(_,n.u_is_halo),u_translation:new c.bV(_,n.u_translation),u_pitched_scale:new c.bg(_,n.u_pitched_scale)}),background:(_,n)=>({u_opacity:new c.bg(_,n.u_opacity),u_color:new c.bR(_,n.u_color)}),backgroundPattern:(_,n)=>({u_opacity:new c.bg(_,n.u_opacity),u_image:new c.bQ(_,n.u_image),u_pattern_tl_a:new c.bV(_,n.u_pattern_tl_a),u_pattern_br_a:new c.bV(_,n.u_pattern_br_a),u_pattern_tl_b:new c.bV(_,n.u_pattern_tl_b),u_pattern_br_b:new c.bV(_,n.u_pattern_br_b),u_texsize:new c.bV(_,n.u_texsize),u_mix:new c.bg(_,n.u_mix),u_pattern_size_a:new c.bV(_,n.u_pattern_size_a),u_pattern_size_b:new c.bV(_,n.u_pattern_size_b),u_scale_a:new c.bg(_,n.u_scale_a),u_scale_b:new c.bg(_,n.u_scale_b),u_pixel_coord_upper:new c.bV(_,n.u_pixel_coord_upper),u_pixel_coord_lower:new c.bV(_,n.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bg(_,n.u_tile_units_to_pixels)}),terrain:(_,n)=>({u_texture:new c.bQ(_,n.u_texture),u_ele_delta:new c.bg(_,n.u_ele_delta),u_fog_matrix:new c.bS(_,n.u_fog_matrix),u_fog_color:new c.bR(_,n.u_fog_color),u_fog_ground_blend:new c.bg(_,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bg(_,n.u_fog_ground_blend_opacity),u_horizon_color:new c.bR(_,n.u_horizon_color),u_horizon_fog_blend:new c.bg(_,n.u_horizon_fog_blend),u_is_globe_mode:new c.bg(_,n.u_is_globe_mode)}),terrainDepth:(_,n)=>({u_ele_delta:new c.bg(_,n.u_ele_delta)}),terrainCoords:(_,n)=>({u_texture:new c.bQ(_,n.u_texture),u_terrain_coords_id:new c.bg(_,n.u_terrain_coords_id),u_ele_delta:new c.bg(_,n.u_ele_delta)}),projectionErrorMeasurement:(_,n)=>({u_input:new c.bg(_,n.u_input),u_output_expected:new c.bg(_,n.u_output_expected)}),atmosphere:(_,n)=>({u_sun_pos:new c.bU(_,n.u_sun_pos),u_atmosphere_blend:new c.bg(_,n.u_atmosphere_blend),u_globe_position:new c.bU(_,n.u_globe_position),u_globe_radius:new c.bg(_,n.u_globe_radius),u_inv_proj_matrix:new c.bS(_,n.u_inv_proj_matrix)}),sky:(_,n)=>({u_sky_color:new c.bR(_,n.u_sky_color),u_horizon_color:new c.bR(_,n.u_horizon_color),u_horizon:new c.bV(_,n.u_horizon),u_horizon_normal:new c.bV(_,n.u_horizon_normal),u_sky_horizon_blend:new c.bg(_,n.u_sky_horizon_blend),u_sky_blend:new c.bg(_,n.u_sky_blend)})};class ls{constructor(n,a,d){this.context=n;const m=n.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Oa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Cl{constructor(n,a,d,m){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let d=0;d<this.attributes.length;d++){const m=a.attributes[this.attributes[d].name];m!==void 0&&n.enableVertexAttribArray(m)}}setVertexAttribPointers(n,a,d){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],T=a.attributes[b.name];T!==void 0&&n.vertexAttribPointer(T,b.components,n[Oa[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class dn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yo extends dn{getDefault(){return c.bf.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ja extends dn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Ys extends dn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class dc extends dn{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class hf extends dn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class fc extends dn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class df extends dn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Ah extends dn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Rh extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Lh extends dn{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class zh extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class Oi extends dn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Jo extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class pc extends dn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ba extends dn{getDefault(){return c.bf.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Qo extends dn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Fa extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class Ua extends dn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Yr extends dn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Dh extends dn{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class ea extends dn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class mc extends dn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Po extends dn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class gc extends dn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ki extends dn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Va extends dn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Il extends dn{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class $a extends dn{getDefault(){return null}set(n){var a;if(n===this.current&&!this.dirty)return;const d=this.gl;jr(d)?d.bindVertexArray(n):(a=d.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class Za extends dn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Js extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Ga extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class qa extends dn{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class tn extends qa{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class _c extends qa{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Nh extends qa{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}const yc="Framebuffer is not complete";class Wa{constructor(n,a,d,m,b){this.context=n,this.width=a,this.height=d;const T=n.gl,C=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new tn(n,C),m)this.depthAttachment=b?new Nh(n,C):new _c(n,C);else if(b)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error(yc)}destroy(){const n=this.context.gl,a=this.colorAttachment.get();if(a&&n.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&n.deleteRenderbuffer(d)}n.deleteFramebuffer(this.framebuffer)}}class Oh{constructor(n){var a,d;if(this.gl=n,this.clearColor=new Yo(this),this.clearDepth=new ja(this),this.clearStencil=new Ys(this),this.colorMask=new dc(this),this.depthMask=new hf(this),this.stencilMask=new fc(this),this.stencilFunc=new df(this),this.stencilOp=new Ah(this),this.stencilTest=new Rh(this),this.depthRange=new Lh(this),this.depthTest=new zh(this),this.depthFunc=new Oi(this),this.blend=new Jo(this),this.blendFunc=new pc(this),this.blendColor=new Ba(this),this.blendEquation=new Qo(this),this.cullFace=new Fa(this),this.cullFaceSide=new Ua(this),this.frontFace=new Yr(this),this.program=new Dh(this),this.activeTexture=new ea(this),this.viewport=new mc(this),this.bindFramebuffer=new Po(this),this.bindRenderbuffer=new gc(this),this.bindTexture=new Ki(this),this.bindVertexBuffer=new Va(this),this.bindElementBuffer=new Il(this),this.bindVertexArray=new $a(this),this.pixelStoreUnpack=new Za(this),this.pixelStoreUnpackPremultiplyAlpha=new Js(this),this.pixelStoreUnpackFlipY=new Ga(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),jr(n)){this.HALF_FLOAT=n.HALF_FLOAT;const m=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=n.RGBA16F)!==null&&a!==void 0?a:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(d=n.RGB16F)!==null&&d!==void 0?d:m==null?void 0:m.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const m=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a){return new ls(this,n,a)}createVertexBuffer(n,a,d){return new Cl(this,n,a,d)}createRenderbuffer(n,a,d){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,n,a,d),this.bindRenderbuffer.set(null),b}createFramebuffer(n,a,d,m){return new Wa(this,n,a,d,m)}clear({color:n,depth:a,stencil:d}){const m=this.gl;let b=0;n&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){c.bH(n.blendFunction,xn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return jr(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var a;return jr(this.gl)?this.gl.deleteVertexArray(n):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}let kl;function Au(_,n,a,d,m){const b=_.context,T=_.transform,C=b.gl,k=_.useProgram("collisionBox"),D=[];let O=0,U=0;for(let de=0;de<d.length;de++){const ge=d[de],ve=n.getTile(ge).getBucket(a);if(!ve)continue;const _e=m?ve.textCollisionBox:ve.iconCollisionBox,Te=ve.collisionCircleArray;Te.length>0&&(D.push({circleArray:Te,circleOffset:U,coord:ge}),O+=Te.length/4,U=O),_e&&k.draw(b,C.LINES,$t.disabled,Yt.disabled,_.colorModeForRenderPass(),Kt.disabled,Ph(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(ge),T.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,_.transform.zoom,null,null,_e.collisionVertexBuffer)}if(!m||!D.length)return;const B=_.useProgram("collisionCircle"),q=new c.c0;q.resize(4*O),q._trim();let Q=0;for(const de of D)for(let ge=0;ge<de.circleArray.length/4;ge++){const ve=4*ge,_e=de.circleArray[ve+0],Te=de.circleArray[ve+1],Ee=de.circleArray[ve+2],xe=de.circleArray[ve+3];q.emplace(Q++,_e,Te,Ee,xe,0),q.emplace(Q++,_e,Te,Ee,xe,1),q.emplace(Q++,_e,Te,Ee,xe,2),q.emplace(Q++,_e,Te,Ee,xe,3)}(!kl||kl.length<2*O)&&(kl=function(de){const ge=2*de,ve=new c.c2;ve.resize(ge),ve._trim();for(let _e=0;_e<ge;_e++){const Te=6*_e;ve.uint16[Te+0]=4*_e+0,ve.uint16[Te+1]=4*_e+1,ve.uint16[Te+2]=4*_e+2,ve.uint16[Te+3]=4*_e+2,ve.uint16[Te+4]=4*_e+3,ve.uint16[Te+5]=4*_e+0}return ve}(O));const ue=b.createIndexBuffer(kl,!0),he=b.createVertexBuffer(q,c.c1.members,!0);for(const de of D){const ge=za(_.transform);B.draw(b,C.TRIANGLES,$t.disabled,Yt.disabled,_.colorModeForRenderPass(),Kt.disabled,ge,_.style.map.terrain&&_.style.map.terrain.getTerrainData(de.coord),null,a.id,he,ue,c.aM.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,_.transform.zoom,null,null,null)}he.destroy(),ue.destroy()}const jh=c.ag(new Float32Array(16));function vc(_,n,a,d,m,b){const{horizontalAlign:T,verticalAlign:C}=c.aH(_);return new c.P((-(T-.5)*n/m+d[0])*b,(-(C-.5)*a/m+d[1])*b)}function xc(_,n,a,d,m,b){const T=n.tileAnchorPoint.add(new c.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let C=d.mult(b);a||(C=C.rotate(-m));const k=T.add(C);return Fe(k.x,k.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(a){const C=Ps(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(_),k=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return _.add(d.rotate(k))}return _.add(d)}function u(_,n,a,d,m,b,T,C,k,D,O,U){const B=_.text.placedSymbolArray,q=_.text.dynamicLayoutVertexArray,Q=_.icon.dynamicLayoutVertexArray,ue={};q.clear();for(let he=0;he<B.length;he++){const de=B.get(he),ge=de.hidden||!de.crossTileID||_.allowVerticalPlacement&&!de.placedOrientation?null:d[de.crossTileID];if(ge){const ve=new c.P(de.anchorX,de.anchorY),_e={getElevation:U,width:m.width,height:m.height,pitchedLabelPlaneMatrix:b,pitchWithMap:a,transform:m,tileAnchorPoint:ve,translation:D,unwrappedTileID:O},Te=a?Xt(ve.x,ve.y,_e):Ps(ve.x,ve.y,_e),Ee=is(m.cameraToCenterDistance,Te.signedDistanceFromCamera);let xe=c.ap(_.textSizeData,C,de)*Ee/c.aB;a&&(xe*=_.tilePixelRatio/T);const{width:Ae,height:qe,anchor:Ue,textOffset:$e,textBoxScale:Ze}=ge,st=vc(Ue,Ae,qe,$e,Ze,xe),ot=m.getPitchedTextCorrection(ve.x+D[0],ve.y+D[1],O),tt=xc(Te.point,_e,n,st,-m.bearingInRadians,ot),Et=_.allowVerticalPlacement&&de.placedOrientation===c.ao.vertical?Math.PI/2:0;for(let Wt=0;Wt<de.numGlyphs;Wt++)c.av(q,tt,Et);k&&de.associatedIconIndex>=0&&(ue[de.associatedIconIndex]={shiftedAnchor:tt,angle:Et})}else Zs(de.numGlyphs,q)}if(k){Q.clear();const he=_.icon.placedSymbolArray;for(let de=0;de<he.length;de++){const ge=he.get(de);if(ge.hidden)Zs(ge.numGlyphs,Q);else{const ve=ue[de];if(ve)for(let _e=0;_e<ge.numGlyphs;_e++)c.av(Q,ve.shiftedAnchor,ve.angle);else Zs(ge.numGlyphs,Q)}}_.icon.dynamicLayoutVertexBuffer.updateData(Q)}_.text.dynamicLayoutVertexBuffer.updateData(q)}function y(_,n,a){return a.iconsInText&&n?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function P(_,n,a,d,m,b,T,C,k,D,O,U,B){const q=_.context,Q=q.gl,ue=_.transform,he=C==="map",de=k==="map",ge=C!=="viewport"&&a.layout.get("symbol-placement")!=="point",ve=he&&!de&&!ge,_e=!a.layout.get("symbol-sort-key").isConstant();let Te=!1;const Ee=_.getDepthModeForSublayer(0,$t.ReadOnly),xe=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ae=[],qe=ue.getCircleRadiusCorrection();for(const Ue of d){const $e=n.getTile(Ue),Ze=$e.getBucket(a);if(!Ze)continue;const st=m?Ze.text:Ze.icon;if(!st||!st.segments.get().length||!st.hasVisibleVertices)continue;const ot=st.programConfigurations.get(a.id),tt=m||Ze.sdfIcons,Et=m?Ze.textSizeData:Ze.iconSizeData,Wt=de||ue.pitch!==0,Tn=_.useProgram(y(tt,m,Ze),ot),Sn=c.an(Et,ue.zoom),An=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ue);let er,jn,gn,qn,di=[0,0],Er=null;if(m)jn=$e.glyphAtlasTexture,gn=Q.LINEAR,er=$e.glyphAtlasTexture.size,Ze.iconsInText&&(di=$e.imageAtlasTexture.size,Er=$e.imageAtlasTexture,qn=Wt||_.options.rotating||_.options.zooming||Et.kind==="composite"||Et.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const _r=a.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear;jn=$e.imageAtlasTexture,gn=tt||_.options.rotating||_.options.zooming||_r||Wt?Q.LINEAR:Q.NEAREST,er=$e.imageAtlasTexture.size}const Cr=c.aC($e,1,_.transform.zoom),Fi=En(he,_.transform,Cr),el=c.L();c.aq(el,Fi);const to=Tr(de,he,_.transform,Cr),tl=c.aD(ue,$e,b,T),Ol=ue.getProjectionData({overscaledTileID:Ue,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Kh=xe&&Ze.hasTextData(),Ac=a.layout.get("icon-text-fit")!=="none"&&Kh&&Ze.hasIconData();if(ge){const _r=_.style.map.terrain?(ds,Jr)=>_.style.map.terrain.getElevation(Ue,ds,Jr):null,Gr=a.layout.get("text-rotation-alignment")==="map";wi(Ze,_,m,Fi,el,de,D,Gr,Ue.toUnwrapped(),ue.width,ue.height,tl,_r)}const oa=m&&xe||Ac,us=ge||oa?jh:de?Fi:_.transform.clipSpaceToPixelsMatrix,Co=tt&&a.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Io;Io=tt?Ze.iconsInText?Xo(Et.kind,Sn,ve,de,ge,oa,_,us,to,tl,er,di,qe):Mu(Et.kind,Sn,ve,de,ge,oa,_,us,to,tl,m,er,0,qe):Ls(Et.kind,Sn,ve,de,ge,oa,_,us,to,tl,m,er,qe);const hs={program:Tn,buffers:st,uniformValues:Io,projectionData:Ol,atlasTexture:jn,atlasTextureIcon:Er,atlasInterpolation:gn,atlasInterpolationIcon:qn,isSDF:tt,hasHalo:Co};if(_e&&Ze.canOverlap){Te=!0;const _r=st.segments.get();for(const Gr of _r)Ae.push({segments:new c.aM([Gr]),sortKey:Gr.sortKey,state:hs,terrainData:An})}else Ae.push({segments:st.segments,sortKey:0,state:hs,terrainData:An})}Te&&Ae.sort((Ue,$e)=>Ue.sortKey-$e.sortKey);for(const Ue of Ae){const $e=Ue.state;if(q.activeTexture.set(Q.TEXTURE0),$e.atlasTexture.bind($e.atlasInterpolation,Q.CLAMP_TO_EDGE),$e.atlasTextureIcon&&(q.activeTexture.set(Q.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),$e.isSDF){const Ze=$e.uniformValues;$e.hasHalo&&(Ze.u_is_halo=1,z($e.buffers,Ue.segments,a,_,$e.program,Ee,O,U,Ze,$e.projectionData,Ue.terrainData)),Ze.u_is_halo=0}z($e.buffers,Ue.segments,a,_,$e.program,Ee,O,U,$e.uniformValues,$e.projectionData,Ue.terrainData)}}function z(_,n,a,d,m,b,T,C,k,D,O){const U=d.context;m.draw(U,U.gl.TRIANGLES,b,T,C,Kt.backCCW,k,O,D,a.id,_.layoutVertexBuffer,_.indexBuffer,n,a.paint,d.transform.zoom,_.programConfigurations.get(a.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function F(_,n,a,d,m){const b=_.context,T=b.gl,C=Yt.disabled,k=new xn([T.ONE,T.ONE],c.bf.transparent,[!0,!0,!0,!0]),D=n.getBucket(a);if(!D)return;const O=d.key;let U=a.heatmapFbos.get(O);U||(U=Se(b,n.tileSize,n.tileSize),a.heatmapFbos.set(O,U)),b.bindFramebuffer.set(U.framebuffer),b.viewport.set([0,0,n.tileSize,n.tileSize]),b.clear({color:c.bf.transparent});const B=D.programConfigurations.get(a.id),q=_.useProgram("heatmap",B,!m),Q=_.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ue=_.style.map.terrain.getTerrainData(d);q.draw(b,T.TRIANGLES,$t.disabled,C,k,Kt.disabled,So(n,_.transform.zoom,a.paint.get("heatmap-intensity"),1),ue,Q,a.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,a.paint,_.transform.zoom,B)}function ne(_,n,a,d,m){const b=_.context,T=b.gl,C=_.transform;b.setColorMode(_.colorModeForRenderPass());const k=Be(b,n),D=a.key,O=n.heatmapFbos.get(D);if(!O)return;b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,O.colorAttachment.get()),b.activeTexture.set(T.TEXTURE1),k.bind(T.LINEAR,T.CLAMP_TO_EDGE);const U=C.getProjectionData({overscaledTileID:a,applyTerrainMatrix:m,applyGlobeMatrix:!d});_.useProgram("heatmapTexture").draw(b,T.TRIANGLES,$t.disabled,Yt.disabled,_.colorModeForRenderPass(),Kt.disabled,Eh(_,n,0,1),null,U,n.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,n.paint,C.zoom),O.destroy(),n.heatmapFbos.delete(D)}function Se(_,n,a){var d,m;const b=_.gl,T=b.createTexture();b.bindTexture(b.TEXTURE_2D,T),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const C=(d=_.HALF_FLOAT)!==null&&d!==void 0?d:b.UNSIGNED_BYTE,k=(m=_.RGBA16F)!==null&&m!==void 0?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,k,n,a,0,b.RGBA,C,null);const D=_.createFramebuffer(n,a,!1,!1);return D.colorAttachment.set(T),D}function Be(_,n){return n.colorRampTexture||(n.colorRampTexture=new c.T(_,n.colorRamp,_.gl.RGBA)),n.colorRampTexture}function Ke(_,n,a,d,m,b,T,C){let k=256;if(m.stepInterpolant){const D=n.getSource().maxzoom,O=T.canonical.z===D?Math.ceil(1<<_.transform.maxZoom-T.canonical.z):1;k=c.ah(c.c4(b.maxLineLength/c.$*1024*O),256,a.maxTextureSize)}return C.gradient=c.c5({expression:m.gradientExpression(),evaluationKey:"lineProgress",resolution:k,image:C.gradient||void 0,clips:b.lineClipsArray}),C.texture?C.texture.update(C.gradient):C.texture=new c.T(a,C.gradient,d.RGBA),C.version=m.gradientVersion,C.texture}function it(_,n,a,d,m){_.activeTexture.set(n.TEXTURE0),a.imageAtlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE),d.updatePaintBuffers(m)}function Tt(_,n,a,d,m,b){(m||_.lineAtlas.dirty)&&(n.activeTexture.set(a.TEXTURE0),_.lineAtlas.bind(n)),d.updatePaintBuffers(b)}function Zt(_,n,a,d,m,b,T){const C=b.gradients[m.id];let k=C.texture;m.gradientVersion!==C.version&&(k=Ke(_,n,a,d,m,b,T,C)),a.activeTexture.set(d.TEXTURE0),k.bind(m.stepInterpolant?d.NEAREST:d.LINEAR,d.CLAMP_TO_EDGE)}function ln(_,n,a,d,m,b,T,C,k){const D=b.gradients[m.id];let O=D.texture;m.gradientVersion!==D.version&&(O=Ke(_,n,a,d,m,b,T,D)),a.activeTexture.set(d.TEXTURE0),O.bind(m.stepInterpolant?d.NEAREST:d.LINEAR,d.CLAMP_TO_EDGE),a.activeTexture.set(d.TEXTURE1),_.lineAtlas.bind(a),C.updatePaintBuffers(k)}function Pr(_,n,a,d,m){if(!a||!d||!d.imageAtlas)return;const b=d.imageAtlas.patternPositions;let T=b[a.to.toString()],C=b[a.from.toString()];if(!T&&C&&(T=C),!C&&T&&(C=T),!T||!C){const k=m.getPaintProperty(n);T=b[k],C=b[k]}T&&C&&_.setConstantPatternPositions(T,C)}function ar(_,n,a,d,m,b,T,C){const k=_.context.gl,D="fill-pattern",O=a.paint.get(D),U=O&&O.constantOr(1),B=a.getCrossfadeParameters();let q,Q,ue,he,de;const ge=_.transform,ve=a.paint.get("fill-translate"),_e=a.paint.get("fill-translate-anchor");T?(Q=U&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=k.LINES):(Q=U?"fillPattern":"fill",q=k.TRIANGLES);const Te=O.constantOr(null);for(const Ee of d){const xe=n.getTile(Ee);if(U&&!xe.patternsLoaded())continue;const Ae=xe.getBucket(a);if(!Ae)continue;const qe=Ae.programConfigurations.get(a.id),Ue=_.useProgram(Q,qe),$e=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ee);U&&(_.context.activeTexture.set(k.TEXTURE0),xe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),qe.updatePaintBuffers(B)),Pr(qe,D,Te,xe,a);const Ze=ge.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),st=c.aD(ge,xe,ve,_e);if(T){he=Ae.indexBuffer2,de=Ae.segments2;const tt=[k.drawingBufferWidth,k.drawingBufferHeight];ue=Q==="fillOutlinePattern"&&U?cf(_,B,xe,tt,st):Ho(tt,st)}else he=Ae.indexBuffer,de=Ae.segments,ue=U?To(_,B,xe,st):{u_fill_translate:st};const ot=_.stencilModeForClipping(Ee);Ue.draw(_.context,q,m,ot,b,Kt.backCCW,ue,$e,Ze,a.id,Ae.layoutVertexBuffer,he,de,a.paint,_.transform.zoom,qe)}}function hi(_,n,a,d,m,b,T,C){const k=_.context,D=k.gl,O="fill-extrusion-pattern",U=a.paint.get(O),B=U.constantOr(1),q=a.getCrossfadeParameters(),Q=a.paint.get("fill-extrusion-opacity"),ue=U.constantOr(null),he=_.transform;for(const de of d){const ge=n.getTile(de),ve=ge.getBucket(a);if(!ve)continue;const _e=_.style.map.terrain&&_.style.map.terrain.getTerrainData(de),Te=ve.programConfigurations.get(a.id),Ee=_.useProgram(B?"fillExtrusionPattern":"fillExtrusion",Te);B&&(_.context.activeTexture.set(D.TEXTURE0),ge.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Te.updatePaintBuffers(q));const xe=he.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!C,applyTerrainMatrix:!0});Pr(Te,O,ue,ge,a);const Ae=c.aD(he,ge,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),qe=a.paint.get("fill-extrusion-vertical-gradient"),Ue=B?Cu(_,qe,Q,Ae,de,q,ge):Eu(_,qe,Q,Ae);Ee.draw(k,k.gl.TRIANGLES,m,b,T,Kt.backCCW,Ue,_e,xe,a.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,a.paint,_.transform.zoom,Te,_.style.map.terrain&&ve.centroidVertexBuffer)}}function Zr(_,n,a,d,m,b,T,C,k){var D;const O=_.style.projection,U=_.context,B=_.transform,q=U.gl,Q=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],ue=_.useProgram("hillshade",null,!1,Q),he=!_.options.moving;for(const de of d){const ge=n.getTile(de),ve=ge.fbo;if(!ve)continue;const _e=O.getMeshFromTileID(U,de.canonical,C,!0,"raster"),Te=(D=_.style.map.terrain)===null||D===void 0?void 0:D.getTerrainData(de);U.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ve.colorAttachment.get());const Ee=B.getProjectionData({overscaledTileID:de,aligned:he,applyGlobeMatrix:!k,applyTerrainMatrix:!0});ue.draw(U,q.TRIANGLES,b,m[de.overscaledZ],T,Kt.backCCW,Ms(_,ge,a),Te,Ee,a.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}function cs(_,n,a,d,m,b,T,C,k){var D;const O=_.style.projection,U=_.context,B=_.transform,q=U.gl,Q=_.useProgram("colorRelief"),ue=!_.options.moving;let he=!0,de=0;for(const ge of d){const ve=n.getTile(ge),_e=ve.dem;if(he){const Ue=q.getParameter(q.MAX_TEXTURE_SIZE),{elevationTexture:$e,colorTexture:Ze}=a.getColorRampTextures(U,Ue,_e.getUnpackVector());U.activeTexture.set(q.TEXTURE1),$e.bind(q.NEAREST,q.CLAMP_TO_EDGE),U.activeTexture.set(q.TEXTURE4),Ze.bind(q.LINEAR,q.CLAMP_TO_EDGE),he=!1,de=$e.size[0]}if(!_e||!_e.data)continue;const Te=_e.stride,Ee=_e.getPixels();if(U.activeTexture.set(q.TEXTURE0),U.pixelStoreUnpackPremultiplyAlpha.set(!1),ve.demTexture=ve.demTexture||_.getTileTexture(Te),ve.demTexture){const Ue=ve.demTexture;Ue.update(Ee,{premultiply:!1}),Ue.bind(q.LINEAR,q.CLAMP_TO_EDGE)}else ve.demTexture=new c.T(U,Ee,q.RGBA,{premultiply:!1}),ve.demTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const xe=O.getMeshFromTileID(U,ge.canonical,C,!0,"raster"),Ae=(D=_.style.map.terrain)===null||D===void 0?void 0:D.getTerrainData(ge),qe=B.getProjectionData({overscaledTileID:ge,aligned:ue,applyGlobeMatrix:!k,applyTerrainMatrix:!0});Q.draw(U,q.TRIANGLES,b,m[ge.overscaledZ],T,Kt.backCCW,Ch(a,ve.dem,de),Ae,qe,a.id,xe.vertexBuffer,xe.indexBuffer,xe.segments)}}const Ml=[new c.P(0,0),new c.P(c.$,0),new c.P(c.$,c.$),new c.P(0,c.$)];function bc(_,n,a,d,m,b,T,C,k=!1,D=!1){const O=d[d.length-1].overscaledZ,U=_.context,B=U.gl,q=_.useProgram("raster"),Q=_.transform,ue=_.style.projection,he=_.colorModeForRenderPass(),de=!_.options.moving,ge=a.paint.get("raster-opacity"),ve=a.paint.get("raster-resampling"),_e=a.paint.get("raster-fade-duration"),Te=!!_.style.map.terrain;for(const Ee of d){const xe=_.getDepthModeForSublayer(Ee.overscaledZ-O,ge===1?$t.ReadWrite:$t.ReadOnly,B.LESS),Ae=n.getTile(Ee),qe=ve==="nearest"?B.NEAREST:B.LINEAR;U.activeTexture.set(B.TEXTURE0),Ae.texture.bind(qe,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),U.activeTexture.set(B.TEXTURE1);const{parentTile:Ue,parentScaleBy:$e,parentTopLeft:Ze,fadeValues:st}=Bh(Ae,n,_e,Te);Ae.fadeOpacity=st.tileOpacity,Ue?(Ue.fadeOpacity=st.parentTileOpacity,Ue.texture.bind(qe,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST)):Ae.texture.bind(qe,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),Ae.texture.useMipmap&&U.extTextureFilterAnisotropic&&_.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const ot=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ee),tt=Q.getProjectionData({overscaledTileID:Ee,aligned:de,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),Et=Da(Ze,$e,st.fadeMix,a,C),Wt=ue.getMeshFromTileID(U,Ee.canonical,b,T,"raster");q.draw(U,B.TRIANGLES,xe,m?m[Ee.overscaledZ]:Yt.disabled,he,k?Kt.frontCCW:Kt.backCCW,Et,ot,tt,a.id,Wt.vertexBuffer,Wt.indexBuffer,Wt.segments)}}function Bh(_,n,a,d){const m={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||d)return m;if(_.fadingParentID){const b=n._getLoadedTile(_.fadingParentID);if(!b)return m;const T=Math.pow(2,b.tileID.overscaledZ-_.tileID.overscaledZ),C=[_.tileID.canonical.x*T%1,_.tileID.canonical.y*T%1],k=function(D,O,U){const B=K.now(),q=(B-O.timeAdded)/U,Q=D.fadingDirection===Ce.Incoming,ue=c.ah((B-D.timeAdded)/U,0,1),he=c.ah(1-q,0,1),de=Q?ue:he;return{tileOpacity:de,parentTileOpacity:Q?he:ue,fadeMix:{opacity:1,mix:1-de}}}(_,b,a);return{parentTile:b,parentScaleBy:T,parentTopLeft:C,fadeValues:k}}if(_.selfFading){const b=function(T,C){const k=K.now(),D=c.ah((k-T.timeAdded)/C,0,1);return{tileOpacity:D,fadeMix:{opacity:D,mix:0}}}(_,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:b}}return m}const Gn=new c.bf(1,0,0,1),ta=new c.bf(0,1,0,1),ji=new c.bf(0,0,1,1),Jn=new c.bf(1,0,1,1),na=new c.bf(0,1,1,1);function Ru(_,n,a,d){Ha(_,0,n+a/2,_.transform.width,a,d)}function ra(_,n,a,d){Ha(_,n-a/2,0,a,_.transform.height,d)}function Ha(_,n,a,d,m,b){const T=_.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(n*_.pixelRatio,a*_.pixelRatio,d*_.pixelRatio,m*_.pixelRatio),T.clear({color:b}),C.disable(C.SCISSOR_TEST)}function ia(_,n,a){const d=_.context,m=d.gl,b=_.useProgram("debug"),T=$t.disabled,C=Yt.disabled,k=_.colorModeForRenderPass(),D="$debug",O=_.style.map.terrain&&_.style.map.terrain.getTerrainData(a);d.activeTexture.set(m.TEXTURE0);const U=n.getTileByID(a.key).latestRawTileData,B=Math.floor((U&&U.byteLength||0)/1024),q=n.getTile(a).tileSize,Q=512/Math.min(q,512)*(a.overscaledZ/_.transform.zoom)*.5;let ue=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ue+=` => ${a.overscaledZ}`),function(de,ge){de.initDebugOverlayCanvas();const ve=de.debugOverlayCanvas,_e=de.context.gl,Te=de.debugOverlayCanvas.getContext("2d");Te.clearRect(0,0,ve.width,ve.height),Te.shadowColor="white",Te.shadowBlur=2,Te.lineWidth=1.5,Te.strokeStyle="white",Te.textBaseline="top",Te.font="bold 36px Open Sans, sans-serif",Te.fillText(ge,5,5),Te.strokeText(ge,5,5),de.debugOverlayTexture.update(ve),de.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(_,`${ue} ${B}kB`);const he=_.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(d,m.TRIANGLES,T,C,xn.alphaBlended,Kt.disabled,Hi(c.bf.transparent,Q),null,he,D,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),b.draw(d,m.LINE_STRIP,T,C,k,Kt.disabled,Hi(c.bf.red),O,he,D,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function Al(_,n,a,d){const{isRenderingGlobe:m}=d,b=_.context,T=b.gl,C=_.transform,k=_.colorModeForRenderPass(),D=_.getDepthModeFor3D(),O=_.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,_.width,_.height]);for(const U of a){const B=n.getTerrainMesh(U.tileID),q=_.renderToTexture.getTexture(U),Q=n.getTerrainData(U.tileID);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,q.texture);const ue=n.getMeshFrameDelta(C.zoom),he=C.calculateFogMatrix(U.tileID.toUnwrapped()),de=Hs(ue,he,_.style.sky,C.pitch,m),ge=C.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(b,T.TRIANGLES,D,Yt.disabled,k,Kt.backCCW,de,Q,ge,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}function Lu(_,n){if(!n.mesh){const a=new c.aL;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const d=new c.aN;d.emplaceBack(0,1,2),d.emplaceBack(0,2,3),n.mesh=new _o(_.createVertexBuffer(a,Or.members),_.createIndexBuffer(d),c.aM.simpleSegment(0,0,a.length,d.length))}return n.mesh}class vm{constructor(n,a){this.context=new Oh(n),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=St.maxUnderzooming+St.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qs}resize(n,a,d){if(this.width=Math.floor(n*d),this.height=Math.floor(a*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const n=this.context,a=new c.aL;a.emplaceBack(0,0),a.emplaceBack(c.$,0),a.emplaceBack(0,c.$),a.emplaceBack(c.$,c.$),this.tileExtentBuffer=n.createVertexBuffer(a,Or.members),this.tileExtentSegments=c.aM.simpleSegment(0,0,4,2);const d=new c.aL;d.emplaceBack(0,0),d.emplaceBack(c.$,0),d.emplaceBack(0,c.$),d.emplaceBack(c.$,c.$),this.debugBuffer=n.createVertexBuffer(d,Or.members),this.debugSegments=c.aM.simpleSegment(0,0,4,5);const m=new c.c7;m.emplaceBack(0,0,0,0),m.emplaceBack(c.$,0,c.$,0),m.emplaceBack(0,c.$,0,c.$),m.emplaceBack(c.$,c.$,c.$,c.$),this.rasterBoundsBuffer=n.createVertexBuffer(m,Sh.members),this.rasterBoundsSegments=c.aM.simpleSegment(0,0,4,2);const b=new c.aL;b.emplaceBack(0,0),b.emplaceBack(c.$,0),b.emplaceBack(0,c.$),b.emplaceBack(c.$,c.$),this.rasterBoundsBufferPosOnly=n.createVertexBuffer(b,Or.members),this.rasterBoundsSegmentsPosOnly=c.aM.simpleSegment(0,0,4,5);const T=new c.aL;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(T,Or.members),this.viewportSegments=c.aM.simpleSegment(0,0,4,2);const C=new c.c8;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(C);const k=new c.aN;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(k);const D=this.context.gl;this.stencilClearMode=new Yt({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.tileExtentMesh=new _o(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const n=this.context,a=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=c.L();c.bZ(d,0,this.width,this.height,0,0,1),c.N(d,d,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const m={mainMatrix:d,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:d};this.useProgram("clippingMask",null,!0).draw(n,a.TRIANGLES,$t.disabled,this.stencilClearMode,xn.disabled,Kt.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,a,d){if(this.currentStencilSource===n.source||!n.isTileClipped()||!a||!a.length)return;this.currentStencilSource=n.source,this.nextStencilID+a.length>256&&this.clearStencil();const m=this.context;m.setColorMode(xn.disabled),m.setDepthMode($t.disabled);const b={};for(const T of a)b[T.key]=this.nextStencilID++;this._renderTileMasks(b,a,d,!0),this._renderTileMasks(b,a,d,!1),this._tileClippingMaskIDs=b}_renderTileMasks(n,a,d,m){const b=this.context,T=b.gl,C=this.style.projection,k=this.transform,D=this.useProgram("clippingMask");for(const O of a){const U=n[O.key],B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),q=C.getMeshFromTileID(this.context,O.canonical,m,!0,"stencil"),Q=k.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!d,applyTerrainMatrix:!0});D.draw(b,T.TRIANGLES,$t.disabled,new Yt({func:T.ALWAYS,mask:0},U,255,T.KEEP,T.KEEP,T.REPLACE),xn.disabled,d?Kt.disabled:Kt.backCCW,null,B,Q,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}_renderTilesDepthBuffer(){const n=this.context,a=n.gl,d=this.style.projection,m=this.transform,b=this.useProgram("depth"),T=this.getDepthModeFor3D(),C=Ht(m,{tileSize:m.tileSize});for(const k of C){const D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),O=d.getMeshFromTileID(this.context,k.canonical,!0,!0,"raster"),U=m.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(n,a.TRIANGLES,T,Yt.disabled,xn.disabled,Kt.backCCW,null,D,U,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new Yt({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){const a=this.context.gl;return new Yt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(n){const a=this.context.gl,d=n.sort((T,C)=>C.overscaledZ-T.overscaledZ),m=d[d.length-1].overscaledZ,b=d[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let C=0;C<b;C++)T[C+m]=new Yt({func:a.GEQUAL,mask:255},C+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,d]}return[{[m]:Yt.disabled},d]}stencilConfigForOverlapTwoPass(n){const a=this.context.gl,d=n.sort((T,C)=>C.overscaledZ-T.overscaledZ),m=d[d.length-1].overscaledZ,b=d[0].overscaledZ-m+1;if(this.clearStencil(),b>1){const T={},C={};for(let k=0;k<b;k++)T[k+m]=new Yt({func:a.GREATER,mask:255},b+1+k,255,a.KEEP,a.KEEP,a.REPLACE),C[k+m]=new Yt({func:a.GREATER,mask:255},1+k,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*b+1,[T,C,d]}return this.nextStencilID=3,[{[m]:new Yt({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[m]:new Yt({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},d]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new xn([n.CONSTANT_COLOR,n.ONE],new c.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xn.unblended:xn.alphaBlended}getDepthModeForSublayer(n,a,d){if(!this.opaquePassEnabledForLayer())return $t.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new $t(d||this.context.gl.LEQUAL,a,[m,m])}getDepthModeFor3D(){return new $t(this.context.gl.LEQUAL,$t.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){var d,m;this.style=n,this.options=a,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(K.now()),this.imageManager.beginFrame();const b=this.style._order,T=this.style.sourceCaches,C={},k={},D={},O={isRenderingToTexture:!1,isRenderingGlobe:((d=n.projection)===null||d===void 0?void 0:d.transitionState)>0};for(const B in T){const q=T[B];q.used&&q.prepare(this.context),C[B]=q.getVisibleCoordinates(!1),k[B]=C[B].slice().reverse(),D[B]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<b.length;B++)if(this.style._layers[b[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of b){const q=this.style._layers[B];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const Q=k[q.source];(q.type==="custom"||Q.length)&&this.renderLayer(this,T[q.source],q,Q,O)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:B=>this.useProgram(B)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?c.bf.black:c.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(B,q){const Q=B.context,ue=Q.gl,he=((Ee,xe,Ae)=>{const qe=Math.cos(xe.rollInRadians),Ue=Math.sin(xe.rollInRadians),$e=je(xe),Ze=xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ee.properties.get("sky-color"),u_horizon_color:Ee.properties.get("horizon-color"),u_horizon:[(xe.width/2-$e*Ue)*Ae,(xe.height/2+$e*qe)*Ae],u_horizon_normal:[-Ue,qe],u_sky_horizon_blend:Ee.properties.get("sky-horizon-blend")*xe.height/2*Ae,u_sky_blend:Ze}})(q,B.style.map.transform,B.pixelRatio),de=new $t(ue.LEQUAL,$t.ReadWrite,[0,1]),ge=Yt.disabled,ve=B.colorModeForRenderPass(),_e=B.useProgram("sky"),Te=Lu(Q,q);_e.draw(Q,ue.TRIANGLES,de,ge,ve,Kt.disabled,he,null,void 0,"sky",Te.vertexBuffer,Te.indexBuffer,Te.segments)}(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[b[this.currentLayer]],q=T[B.source],Q=C[B.source];this._renderTileClippingMasks(B,Q,!1),this.renderLayer(this,q,B,Q,O)}this.renderPass="translucent";let U=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const B=this.style._layers[b[this.currentLayer]],q=T[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B,O))continue;this.opaquePassEnabledForLayer()||U||(U=!0,O.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Q=(B.type==="symbol"?D:k)[B.source];this._renderTileClippingMasks(B,C[B.source],!!this.renderToTexture),this.renderLayer(this,q,B,Q,O)}if(O.isRenderingGlobe&&function(B,q,Q){const ue=B.context,he=ue.gl,de=B.useProgram("atmosphere"),ge=new $t(he.LEQUAL,$t.ReadOnly,[0,1]),ve=B.transform,_e=function(Ze,st){const ot=Ze.properties.get("position"),tt=[-ot.x,-ot.y,-ot.z],Et=c.ag(new Float64Array(16));return Ze.properties.get("anchor")==="map"&&(c.b6(Et,Et,st.rollInRadians),c.b7(Et,Et,-st.pitchInRadians),c.b6(Et,Et,st.bearingInRadians),c.b7(Et,Et,st.center.lat*Math.PI/180),c.bz(Et,Et,-st.center.lng*Math.PI/180)),c.c6(tt,tt,Et),tt}(Q,B.transform),Te=ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ee=q.properties.get("atmosphere-blend")*Te.projectionTransition;if(Ee===0)return;const xe=bo(ve.worldSize,ve.center.lat),Ae=ve.inverseProjectionMatrix,qe=new Float64Array(4);qe[3]=1,c.aw(qe,qe,ve.modelViewProjectionMatrix),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1,c.aw(qe,qe,Ae),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1;const Ue=((Ze,st,ot,tt,Et)=>({u_sun_pos:Ze,u_atmosphere_blend:st,u_globe_position:ot,u_globe_radius:tt,u_inv_proj_matrix:Et}))(_e,Ee,[qe[0],qe[1],qe[2]],xe,Ae),$e=Lu(ue,q);de.draw(ue,he.TRIANGLES,ge,Yt.disabled,xn.alphaBlended,Kt.disabled,Ue,null,null,"atmosphere",$e.vertexBuffer,$e.indexBuffer,$e.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const B=function(q,Q){let ue=null;const he=Object.values(q._layers).flatMap(_e=>_e.source&&!_e.isHidden(Q)?[q.sourceCaches[_e.source]]:[]),de=he.filter(_e=>_e.getSource().type==="vector"),ge=he.filter(_e=>_e.getSource().type!=="vector"),ve=_e=>{(!ue||ue.getSource().maxzoom<_e.getSource().maxzoom)&&(ue=_e)};return de.forEach(_e=>ve(_e)),ue||ge.forEach(_e=>ve(_e)),ue}(this.style,this.transform.zoom);B&&function(q,Q,ue){for(let he=0;he<ue.length;he++)ia(q,Q,ue[he])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const q=B.transform.padding;Ru(B,B.transform.height-(q.top||0),3,Gn),Ru(B,q.bottom||0,3,ta),ra(B,q.left||0,3,ji),ra(B,B.transform.width-(q.right||0),3,Jn);const Q=B.transform.centerPoint;(function(ue,he,de,ge){Ha(ue,he-1,de-10,2,20,ge),Ha(ue,he-10,de-1,20,2,ge)})(B,Q.x,B.transform.height-Q.y,na)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(n){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=n?!c.c9(a,d):!c.ca(a,d)),m||(m=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(c.cb(a,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,T){const C=b.context,k=C.gl,D=b.transform,O=xn.unblended,U=new $t(k.LEQUAL,$t.ReadWrite,[0,1]),B=T.sourceCache.getRenderableTiles(),q=b.useProgram("terrainDepth");C.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),C.clear({color:c.bf.transparent,depth:1});for(const Q of B){const ue=T.getTerrainMesh(Q.tileID),he=T.getTerrainData(Q.tileID),de=D.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ge={u_ele_delta:T.getMeshFrameDelta(D.zoom)};q.draw(C,k.TRIANGLES,U,Yt.disabled,O,Kt.backCCW,ge,he,de,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,T){const C=b.context,k=C.gl,D=b.transform,O=xn.unblended,U=new $t(k.LEQUAL,$t.ReadWrite,[0,1]),B=T.getCoordsTexture(),q=T.sourceCache.getRenderableTiles(),Q=b.useProgram("terrainCoords");C.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),C.clear({color:c.bf.transparent,depth:1}),T.coordsIndex=[];for(const ue of q){const he=T.getTerrainMesh(ue.tileID),de=T.getTerrainData(ue.tileID);C.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,B.texture);const ge={u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(D.zoom)},ve=D.getProjectionData({overscaledTileID:ue.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Q.draw(C,k.TRIANGLES,U,Yt.disabled,O,Kt.backCCW,ge,de,ve,"terrain",he.vertexBuffer,he.indexBuffer,he.segments),T.coordsIndex.push(ue.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(n,a,d,m,b){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||(m||[]).length)&&(this.id=d.id,c.cc(d)?function(T,C,k,D,O,U){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:B}=U,q=Yt.disabled,Q=T.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ue,he,de,ge,ve,_e,Te,Ee,xe){const Ae=he.transform,qe=he.style.map.terrain,Ue=ve==="map",$e=_e==="map";for(const Ze of ue){const st=ge.getTile(Ze),ot=st.getBucket(de);if(!ot||!ot.text||!ot.text.segments.get().length)continue;const tt=c.an(ot.textSizeData,Ae.zoom),Et=c.aC(st,1,he.transform.zoom),Wt=En(Ue,he.transform,Et),Tn=de.layout.get("icon-text-fit")!=="none"&&ot.hasIconData();if(tt){const Sn=Math.pow(2,Ae.zoom-st.tileID.overscaledZ),An=qe?(er,jn)=>qe.getElevation(Ze,er,jn):null;u(ot,Ue,$e,xe,Ae,Wt,Sn,tt,Tn,c.aD(Ae,st,Te,Ee),Ze.toUnwrapped(),An)}}}(D,T,k,C,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),O),k.paint.get("icon-opacity").constantOr(1)!==0&&P(T,C,k,D,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),q,Q,B),k.paint.get("text-opacity").constantOr(1)!==0&&P(T,C,k,D,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),q,Q,B),C.map.showCollisionBoxes&&(Au(T,C,k,D,!0),Au(T,C,k,D,!1))}(n,a,d,m,this.style.placement.variableOffsets,b):c.cd(d)?function(T,C,k,D,O){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,B=k.paint.get("circle-opacity"),q=k.paint.get("circle-stroke-width"),Q=k.paint.get("circle-stroke-opacity"),ue=!k.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(q.constantOr(1)===0||Q.constantOr(1)===0))return;const he=T.context,de=he.gl,ge=T.transform,ve=T.getDepthModeForSublayer(0,$t.ReadOnly),_e=Yt.disabled,Te=T.colorModeForRenderPass(),Ee=[],xe=ge.getCircleRadiusCorrection();for(let Ae=0;Ae<D.length;Ae++){const qe=D[Ae],Ue=C.getTile(qe),$e=Ue.getBucket(k);if(!$e)continue;const Ze=k.paint.get("circle-translate"),st=k.paint.get("circle-translate-anchor"),ot=c.aD(ge,Ue,Ze,st),tt=$e.programConfigurations.get(k.id),Et=T.useProgram("circle",tt),Wt=$e.layoutVertexBuffer,Tn=$e.indexBuffer,Sn=T.style.map.terrain&&T.style.map.terrain.getTerrainData(qe),An={programConfiguration:tt,program:Et,layoutVertexBuffer:Wt,indexBuffer:Tn,uniformValues:hc(T,Ue,k,ot,xe),terrainData:Sn,projectionData:ge.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!U,applyTerrainMatrix:!0})};if(ue){const er=$e.segments.get();for(const jn of er)Ee.push({segments:new c.aM([jn]),sortKey:jn.sortKey,state:An})}else Ee.push({segments:$e.segments,sortKey:0,state:An})}ue&&Ee.sort((Ae,qe)=>Ae.sortKey-qe.sortKey);for(const Ae of Ee){const{programConfiguration:qe,program:Ue,layoutVertexBuffer:$e,indexBuffer:Ze,uniformValues:st,terrainData:ot,projectionData:tt}=Ae.state;Ue.draw(he,de.TRIANGLES,ve,_e,Te,Kt.backCCW,st,ot,tt,k.id,$e,Ze,Ae.segments,k.paint,T.transform.zoom,qe)}}(n,a,d,m,b):c.ce(d)?function(T,C,k,D,O){if(k.paint.get("heatmap-opacity")===0)return;const U=T.context,{isRenderingToTexture:B,isRenderingGlobe:q}=O;if(T.style.map.terrain){for(const Q of D){const ue=C.getTile(Q);C.hasRenderableParent(Q)||(T.renderPass==="offscreen"?F(T,ue,k,Q,q):T.renderPass==="translucent"&&ne(T,k,Q,B,q))}U.viewport.set([0,0,T.width,T.height])}else T.renderPass==="offscreen"?function(Q,ue,he,de){const ge=Q.context,ve=ge.gl,_e=Q.transform,Te=Yt.disabled,Ee=new xn([ve.ONE,ve.ONE],c.bf.transparent,[!0,!0,!0,!0]);(function(xe,Ae,qe){const Ue=xe.gl;xe.activeTexture.set(Ue.TEXTURE1),xe.viewport.set([0,0,Ae.width/4,Ae.height/4]);let $e=qe.heatmapFbos.get(c.c3);$e?(Ue.bindTexture(Ue.TEXTURE_2D,$e.colorAttachment.get()),xe.bindFramebuffer.set($e.framebuffer)):($e=Se(xe,Ae.width/4,Ae.height/4),qe.heatmapFbos.set(c.c3,$e))})(ge,Q,he),ge.clear({color:c.bf.transparent});for(let xe=0;xe<de.length;xe++){const Ae=de[xe];if(ue.hasRenderableParent(Ae))continue;const qe=ue.getTile(Ae),Ue=qe.getBucket(he);if(!Ue)continue;const $e=Ue.programConfigurations.get(he.id),Ze=Q.useProgram("heatmap",$e),st=_e.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ot=_e.getCircleRadiusCorrection();Ze.draw(ge,ve.TRIANGLES,$t.disabled,Te,Ee,Kt.backCCW,So(qe,_e.zoom,he.paint.get("heatmap-intensity"),ot),null,st,he.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,he.paint,_e.zoom,$e)}ge.viewport.set([0,0,Q.width,Q.height])}(T,C,k,D):T.renderPass==="translucent"&&function(Q,ue){const he=Q.context,de=he.gl;he.setColorMode(Q.colorModeForRenderPass());const ge=ue.heatmapFbos.get(c.c3);ge&&(he.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_2D,ge.colorAttachment.get()),he.activeTexture.set(de.TEXTURE1),Be(he,ue).bind(de.LINEAR,de.CLAMP_TO_EDGE),Q.useProgram("heatmapTexture").draw(he,de.TRIANGLES,$t.disabled,Yt.disabled,Q.colorModeForRenderPass(),Kt.disabled,Eh(Q,ue,0,1),null,null,ue.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments,ue.paint,Q.transform.zoom))}(T,k)}(n,a,d,m,b):c.cf(d)?function(T,C,k,D,O){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,B=k.paint.get("line-opacity"),q=k.paint.get("line-width");if(B.constantOr(1)===0||q.constantOr(1)===0)return;const Q=T.getDepthModeForSublayer(0,$t.ReadOnly),ue=T.colorModeForRenderPass(),he=k.paint.get("line-dasharray"),de=he.constantOr(1),ge=k.paint.get("line-pattern"),ve=ge.constantOr(1),_e=k.paint.get("line-gradient"),Te=k.getCrossfadeParameters();let Ee;Ee=ve?"linePattern":de&&_e?"lineGradientSDF":de?"lineSDF":_e?"lineGradient":"line";const xe=T.context,Ae=xe.gl,qe=T.transform;let Ue=!0;for(const $e of D){const Ze=C.getTile($e);if(ve&&!Ze.patternsLoaded())continue;const st=Ze.getBucket(k);if(!st)continue;const ot=st.programConfigurations.get(k.id),tt=T.context.program.get(),Et=T.useProgram(Ee,ot),Wt=Ue||Et.program!==tt,Tn=T.style.map.terrain&&T.style.map.terrain.getTerrainData($e),Sn=ge.constantOr(null),An=he&&he.constantOr(null);if(Sn&&Ze.imageAtlas){const di=Ze.imageAtlas,Er=di.patternPositions[Sn.to.toString()],Cr=di.patternPositions[Sn.from.toString()];Er&&Cr&&ot.setConstantPatternPositions(Er,Cr)}else if(An){const di=k.layout.get("line-cap")==="round",Er=T.lineAtlas.getDash(An.to,di),Cr=T.lineAtlas.getDash(An.from,di);ot.setConstantDashPositions(Er,Cr)}const er=qe.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),jn=qe.getPixelScale();let gn;ve?(gn=As(T,Ze,k,jn,Te),it(xe,Ae,Ze,ot,Te)):de&&_e?(gn=Xs(T,Ze,k,jn,Te,st.lineClipsArray.length),ln(T,C,xe,Ae,k,st,$e,ot,Te)):de?(gn=Ih(T,Ze,k,jn,Te),Tt(T,xe,Ae,ot,Wt,Te)):_e?(gn=ku(T,Ze,k,jn,st.lineClipsArray.length),Zt(T,C,xe,Ae,k,st,$e)):gn=Ks(T,Ze,k,jn);const qn=T.stencilModeForClipping($e);Et.draw(xe,Ae.TRIANGLES,Q,qn,ue,Kt.disabled,gn,Tn,er,k.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,k.paint,T.transform.zoom,ot,st.layoutVertexBuffer2),Ue=!1}}(n,a,d,m,b):c.cg(d)?function(T,C,k,D,O){const U=k.paint.get("fill-color"),B=k.paint.get("fill-opacity");if(B.constantOr(1)===0)return;const{isRenderingToTexture:q}=O,Q=T.colorModeForRenderPass(),ue=k.paint.get("fill-pattern"),he=T.opaquePassEnabledForLayer()&&!ue.constantOr(1)&&U.constantOr(c.bf.transparent).a===1&&B.constantOr(0)===1?"opaque":"translucent";if(T.renderPass===he){const de=T.getDepthModeForSublayer(1,T.renderPass==="opaque"?$t.ReadWrite:$t.ReadOnly);ar(T,C,k,D,de,Q,!1,q)}if(T.renderPass==="translucent"&&k.paint.get("fill-antialias")){const de=T.getDepthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,$t.ReadOnly);ar(T,C,k,D,de,Q,!0,q)}}(n,a,d,m,b):c.ch(d)?function(T,C,k,D,O){const U=k.paint.get("fill-extrusion-opacity");if(U===0)return;const{isRenderingToTexture:B}=O;if(T.renderPass==="translucent"){const q=new $t(T.context.gl.LEQUAL,$t.ReadWrite,T.depthRangeFor3D);if(U!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))hi(T,C,k,D,q,Yt.disabled,xn.disabled,B),hi(T,C,k,D,q,T.stencilModeFor3D(),T.colorModeForRenderPass(),B);else{const Q=T.colorModeForRenderPass();hi(T,C,k,D,q,Yt.disabled,Q,B)}}}(n,a,d,m,b):c.ci(d)?function(T,C,k,D,O){if(T.renderPass!=="offscreen"&&T.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,B=T.context,q=T.style.projection.useSubdivision,Q=T.getDepthModeForSublayer(0,$t.ReadOnly),ue=T.colorModeForRenderPass();if(T.renderPass==="offscreen")(function(he,de,ge,ve,_e,Te,Ee){const xe=he.context,Ae=xe.gl;for(const qe of ge){const Ue=de.getTile(qe),$e=Ue.dem;if(!$e||!$e.data||!Ue.needsHillshadePrepare)continue;const Ze=$e.dim,st=$e.stride,ot=$e.getPixels();if(xe.activeTexture.set(Ae.TEXTURE1),xe.pixelStoreUnpackPremultiplyAlpha.set(!1),Ue.demTexture=Ue.demTexture||he.getTileTexture(st),Ue.demTexture){const Et=Ue.demTexture;Et.update(ot,{premultiply:!1}),Et.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE)}else Ue.demTexture=new c.T(xe,ot,Ae.RGBA,{premultiply:!1}),Ue.demTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);xe.activeTexture.set(Ae.TEXTURE0);let tt=Ue.fbo;if(!tt){const Et=new c.T(xe,{width:Ze,height:Ze,data:null},Ae.RGBA);Et.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),tt=Ue.fbo=xe.createFramebuffer(Ze,Ze,!0,!1),tt.colorAttachment.set(Et.texture)}xe.bindFramebuffer.set(tt.framebuffer),xe.viewport.set([0,0,Ze,Ze]),he.useProgram("hillshadePrepare").draw(xe,Ae.TRIANGLES,_e,Te,Ee,Kt.disabled,Iu(Ue.tileID,$e),null,null,ve.id,he.rasterBoundsBuffer,he.quadTriangleIndexBuffer,he.rasterBoundsSegments),Ue.needsHillshadePrepare=!1}})(T,C,D,k,Q,Yt.disabled,ue),B.viewport.set([0,0,T.width,T.height]);else if(T.renderPass==="translucent")if(q){const[he,de,ge]=T.stencilConfigForOverlapTwoPass(D);Zr(T,C,k,ge,he,Q,ue,!1,U),Zr(T,C,k,ge,de,Q,ue,!0,U)}else{const[he,de]=T.getStencilConfigForOverlapAndUpdateStencilID(D);Zr(T,C,k,de,he,Q,ue,!1,U)}}(n,a,d,m,b):c.cj(d)?function(T,C,k,D,O){if(T.renderPass!=="translucent"||!D.length)return;const{isRenderingToTexture:U}=O,B=T.style.projection.useSubdivision,q=T.getDepthModeForSublayer(0,$t.ReadOnly),Q=T.colorModeForRenderPass();if(B){const[ue,he,de]=T.stencilConfigForOverlapTwoPass(D);cs(T,C,k,de,ue,q,Q,!1,U),cs(T,C,k,de,he,q,Q,!0,U)}else{const[ue,he]=T.getStencilConfigForOverlapAndUpdateStencilID(D);cs(T,C,k,he,ue,q,Q,!1,U)}}(n,a,d,m,b):c.bK(d)?function(T,C,k,D,O){if(T.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!D.length)return;const{isRenderingToTexture:U}=O,B=C.getSource(),q=T.style.projection.useSubdivision;if(B instanceof mn)bc(T,C,k,D,null,!1,!1,B.tileCoords,B.flippedWindingOrder,U);else if(q){const[Q,ue,he]=T.stencilConfigForOverlapTwoPass(D);bc(T,C,k,he,Q,!1,!0,Ml,!1,U),bc(T,C,k,he,ue,!0,!0,Ml,!1,U)}else{const[Q,ue]=T.getStencilConfigForOverlapAndUpdateStencilID(D);bc(T,C,k,ue,Q,!1,!0,Ml,!1,U)}}(n,a,d,m,b):c.ck(d)?function(T,C,k,D,O){const U=k.paint.get("background-color"),B=k.paint.get("background-opacity");if(B===0)return;const{isRenderingToTexture:q}=O,Q=T.context,ue=Q.gl,he=T.style.projection,de=T.transform,ge=de.tileSize,ve=k.paint.get("background-pattern");if(T.isPatternMissing(ve))return;const _e=!ve&&U.a===1&&B===1&&T.opaquePassEnabledForLayer()?"opaque":"translucent";if(T.renderPass!==_e)return;const Te=Yt.disabled,Ee=T.getDepthModeForSublayer(0,_e==="opaque"?$t.ReadWrite:$t.ReadOnly),xe=T.colorModeForRenderPass(),Ae=T.useProgram(ve?"backgroundPattern":"background"),qe=D||Ht(de,{tileSize:ge,terrain:T.style.map.terrain});ve&&(Q.activeTexture.set(ue.TEXTURE0),T.imageManager.bind(T.context));const Ue=k.getCrossfadeParameters();for(const $e of qe){const Ze=de.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),st=ve?as(B,T,ve,{tileID:$e,tileSize:ge},Ue):Mh(B,U),ot=T.style.map.terrain&&T.style.map.terrain.getTerrainData($e),tt=he.getMeshFromTileID(Q,$e.canonical,!1,!0,"raster");Ae.draw(Q,ue.TRIANGLES,Ee,Te,xe,Kt.backCCW,st,ot,Ze,k.id,tt.vertexBuffer,tt.indexBuffer,tt.segments)}}(n,0,d,m,b):c.cl(d)&&function(T,C,k,D){const{isRenderingGlobe:O}=D,U=T.context,B=k.implementation,q=T.style.projection,Q=T.transform,ue=Q.getProjectionDataForCustomLayer(O),he={farZ:Q.farZ,nearZ:Q.nearZ,fov:Q.fov*Math.PI/180,modelViewProjectionMatrix:Q.modelViewProjectionMatrix,projectionMatrix:Q.projectionMatrix,shaderData:{variantName:q.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${q.shaderPreludeCode.vertexSource}`,define:q.shaderDefine},defaultProjectionData:ue},de=B.renderingMode?B.renderingMode:"2d";if(T.renderPass==="offscreen"){const ge=B.prerender;ge&&(T.setCustomLayerDefaults(),U.setColorMode(T.colorModeForRenderPass()),ge.call(B,U.gl,he),U.setDirty(),T.setBaseState())}else if(T.renderPass==="translucent"){T.setCustomLayerDefaults(),U.setColorMode(T.colorModeForRenderPass()),U.setStencilMode(Yt.disabled);const ge=de==="3d"?T.getDepthModeFor3D():T.getDepthModeForSublayer(0,$t.ReadOnly);U.setDepthMode(ge),B.render(U.gl,he),U.setDirty(),T.setBaseState(),U.bindFramebuffer.set(null)}}(n,0,d,b))}saveTileTexture(n){const a=this._tileTextures[n.size[0]];a?a.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const a=this.imageManager.getPattern(n.from.toString()),d=this.imageManager.getPattern(n.to.toString());return!a||!d}useProgram(n,a,d=!1,m=[]){this.cache=this.cache||{};const b=!!this.style.map.terrain,T=this.style.projection,C=d?Sr.projectionMercator:T.shaderPreludeCode,k=d?Ws:T.shaderDefine,D=n+(a?a.cacheKey:"")+`/${d?Qt:T.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(b?"/terrain":"")+(m?`/${m.join("/")}`:"");return this.cache[D]||(this.cache[D]=new Pi(this.context,Sr[n],a,El[n],this._showOverdrawInspector,b,C,k,m)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:a}=this.context.gl;return this.width!==n||this.height!==a}}function ff(_,n){let a,d=!1,m=null,b=null;const T=()=>{m=null,d&&(_.apply(b,a),m=setTimeout(T,n),d=!1)};return(...C)=>(d=!0,b=this,a=C,m||T(),m)}class pf{constructor(n){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let d;return a.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(d=m)}),(d&&d[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const d=a.join("/");let m=d;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${d}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let T=window.location.href.replace(/(#.+)?$/,b);T=T.replace("&&","&"),window.history.replaceState(window.history.state,null,T)},this._updateHash=ff(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(n){const a=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),T=Math.round(a.lng*b)/b,C=Math.round(a.lat*b)/b,k=this._map.getBearing(),D=this._map.getPitch();let O="";if(O+=n?`/${T}/${C}/${d}`:`${d}/${C}/${T}`,(k||D)&&(O+="/"+Math.round(10*k)/10),D&&(O+=`/${Math.round(D)}`),this._hashName){const U=this._hashName;let B=!1;const q=window.location.hash.slice(1).split("&").map(Q=>{const ue=Q.split("=")[0];return ue===U?(B=!0,`${ue}=${O}`):Q}).filter(Q=>Q);return B||q.push(`${U}=${O}`),`#${q.join("&")}`}return`#${O}`}_isValidHash(n){if(n.length<3||n.some(isNaN))return!1;try{new c.S(+n[2],+n[1])}catch{return!1}const a=+n[0],d=+(n[3]||0),m=+(n[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&d>=-180&&d<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const wc={linearity:.3,easing:c.cm(0,0,.3,1)},Rl=c.e({deceleration:2500,maxSpeed:1400},wc),xm=c.e({deceleration:20,maxSpeed:1400},wc),bm=c.e({deceleration:1e3,maxSpeed:360},wc),wm=c.e({deceleration:1e3,maxSpeed:90},wc),Tm=c.e({deceleration:1e3,maxSpeed:360},wc);class Sm{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:K.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=K.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,a.roll+=b.rollDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){const b=Sc(a.pan.mag(),d,c.e({},Rl,n||{})),T=a.pan.mult(b.amount/a.pan.mag()),C=this._map.cameraHelper.handlePanInertia(T,this._map.transform);m.center=C.easingCenter,m.offset=C.easingOffset,Tc(m,b)}if(a.zoom){const b=Sc(a.zoom,d,xm);m.zoom=this._map.transform.zoom+b.amount,Tc(m,b)}if(a.bearing){const b=Sc(a.bearing,d,bm);m.bearing=this._map.transform.bearing+c.ah(b.amount,-179,179),Tc(m,b)}if(a.pitch){const b=Sc(a.pitch,d,wm);m.pitch=this._map.transform.pitch+b.amount,Tc(m,b)}if(a.roll){const b=Sc(a.roll,d,Tm);m.roll=this._map.transform.roll+c.ah(b.amount,-179,179),Tc(m,b)}if(m.zoom||m.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),c.e(m,{noMoveStart:!0})}}function Tc(_,n){(!_.duration||_.duration<n.duration)&&(_.duration=n.duration,_.easing=n.easing)}function Sc(_,n,a){const{maxSpeed:d,linearity:m,deceleration:b}=a,T=c.ah(_*m/(n/1e3),-d,d),C=Math.abs(T)/(b*m);return{easing:a.easing,duration:1e3*C,amount:T*(C/2)}}class Xi extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d,m={}){d=d instanceof MouseEvent?d:new MouseEvent(n,d);const b=J.mousePos(a.getCanvas(),d),T=a.unproject(b);super(n,c.e({point:b,lngLat:T,originalEvent:d},m)),this._defaultPrevented=!1,this.target=a}}class Ka extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){const m=n==="touchend"?d.changedTouches:d.touches,b=J.touchPos(a.getCanvasContainer(),m),T=b.map(k=>a.unproject(k)),C=b.reduce((k,D,O,U)=>k.add(D.div(U.length)),new c.P(0,0));super(n,{points:b,point:C,lngLats:T,lngLat:a.unproject(C),originalEvent:d}),this._defaultPrevented=!1}}class mf extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){super(n,{originalEvent:d}),this._defaultPrevented=!1}}class zs{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new mf(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new Xi(n.type,this._map,n))}mouseup(n){this._map.fire(new Xi(n.type,this._map,n))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Xi(n.type,this._map,n))}dblclick(n){return this._firePreventable(new Xi(n.type,this._map,n))}mouseover(n){this._map.fire(new Xi(n.type,this._map,n))}mouseout(n){this._map.fire(new Xi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ka(n.type,this._map,n))}touchmove(n){this._map.fire(new Ka(n.type,this._map,n))}touchend(n){this._map.fire(new Ka(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ka(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qs{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new Xi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new Xi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pc{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.screenPointToLocation(c.P.convert(n),this._map.terrain)}}class Ds{constructor(n,a){this._map=n,this._tr=new Pc(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(J.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=J.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(m.x,d.x),T=Math.max(m.x,d.x),C=Math.min(m.y,d.y),k=Math.max(m.y,d.y);J.setTransform(this._box,`translate(${b}px,${C}px)`),this._box.style.width=T-b+"px",this._box.style.height=k-C+"px"}mouseupWindow(n,a){if(!this._active||n.button!==0)return;const d=this._startPos,m=a;if(this.reset(),J.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(d,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(J.remove(this._box),this._box=null),J.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new c.l(n,{originalEvent:a}))}}function Xa(_,n){if(_.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${n.length}`);const a={};for(let d=0;d<_.length;d++)a[_[d].identifier]=n[d];return a}class py{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const b=new c.P(0,0);for(const T of m)b._add(T);return b.div(m.length)}(a),this.touches=Xa(d,a)))}touchmove(n,a,d){if(this.aborted||!this.centroid)return;const m=Xa(d,a);for(const b in this.touches){const T=m[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,a,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class gf{constructor(n){this.singleTap=new py(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,a,d){this.singleTap.touchstart(n,a,d)}touchmove(n,a,d){this.singleTap.touchmove(n,a,d)}touchend(n,a,d){const m=this.singleTap.touchend(n,a,d);if(m){const b=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(m)<30;if(b&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class my{constructor(n){this._tr=new Pc(n),this._zoomIn=new gf({numTouches:1,numTaps:2}),this._zoomOut=new gf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,d){this._zoomIn.touchstart(n,a,d),this._zoomOut.touchstart(n,a,d)}touchmove(n,a,d){this._zoomIn.touchmove(n,a,d),this._zoomOut.touchmove(n,a,d)}touchend(n,a,d){const m=this._zoomIn.touchend(n,a,d),b=this._zoomOut.touchend(n,a,d),T=this._tr;return m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(m)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zu{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const a=this._moveFunction(...n);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(n,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,a){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const m=Array.isArray(a)?a[0]:a;return!this._moved&&m.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(d,m))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&J.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Pm=0,Du=2,sa={[Pm]:1,[Du]:2};class yt{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const a=J.mouseButton(n);this._eventButton=a}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!function(a,d){const m=sa[d];return a.buttons===void 0||(a.buttons&m)!==m}(n,this._eventButton)}isValidEndEvent(n){return J.mouseButton(n)===this._eventButton}}class Em{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}class _f{constructor(n=new yt({checkCorrectEvent:()=>!0}),a=new Em){this.mouseMoveStateManager=n,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(n,a,d){return n instanceof MouseEvent?a(n):typeof TouchEvent<"u"&&n instanceof TouchEvent?d(n):void 0}startMove(n){this._executeRelevantHandler(n,a=>this.mouseMoveStateManager.startMove(a),a=>this.oneFingerTouchMoveStateManager.startMove(a))}endMove(n){this._executeRelevantHandler(n,a=>this.mouseMoveStateManager.endMove(a),a=>this.oneFingerTouchMoveStateManager.endMove(a))}isValidStartEvent(n){return this._executeRelevantHandler(n,a=>this.mouseMoveStateManager.isValidStartEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a))}isValidMoveEvent(n){return this._executeRelevantHandler(n,a=>this.mouseMoveStateManager.isValidMoveEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a))}isValidEndEvent(n){return this._executeRelevantHandler(n,a=>this.mouseMoveStateManager.isValidEndEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a))}}const Nu=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=n=>{n.preventDefault()}};class Ou{constructor(n,a){this._clickTolerance=n.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(n){return n<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(n,a,d){return this._calculateTransform(n,a,d)}touchmove(n,a,d){if(this._active){if(!this._shouldBePrevented(d.length))return n.preventDefault(),this._calculateTransform(n,a,d);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",n)}}touchend(n,a,d){this._calculateTransform(n,a,d),this._active&&this._shouldBePrevented(d.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,d){d.length>0&&(this._active=!0);const m=Xa(d,a),b=new c.P(0,0),T=new c.P(0,0);let C=0;for(const D in m){const O=m[D],U=this._touches[D];U&&(b._add(O),T._add(O.sub(U)),C++,m[D]=O)}if(this._touches=m,this._shouldBePrevented(C)||!T.mag())return;const k=T.div(C);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(C),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ll{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,d){if(!this._firstTwoTouches)return;n.preventDefault();const[m,b]=this._firstTwoTouches,T=Ec(d,a,m),C=Ec(d,a,b);if(!T||!C)return;const k=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],k,n)}touchend(n,a,d){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,T=Ec(d,a,m),C=Ec(d,a,b);T&&C||(this._active&&J.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ec(_,n,a){for(let d=0;d<_.length;d++)if(_[d].identifier===a)return n[d]}function un(_,n){return Math.log(_/n)/Math.LN2}class Fh extends Ll{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(un(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:un(this._distance,d),pinchAround:a}}}function Cm(_,n){return 180*_.angleWith(n)/Math.PI}class Uh extends Ll{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a,d){const m=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Cm(this._vector,m),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,d=Cm(n,this._startVector);return Math.abs(d)<a}}function yf(_){return Math.abs(_.y)>Math.abs(_.x)}class Im extends Ll{constructor(n){super(),this._currentTouchCount=0,this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,a,d){super.touchstart(n,a,d),this._currentTouchCount=d.length}_start(n){this._lastPoints=n,yf(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=n[0].sub(this._lastPoints[0]),b=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,d.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(n,a,d){if(this._valid!==void 0)return this._valid;const m=n.mag()>=2,b=a.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const T=n.y>0==a.y>0;return yf(n)&&yf(a)&&T}}const km={panStep:100,bearingStep:15,pitchStep:10};class Vh{constructor(n){this._tr=new Pc(n);const a=km;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,d=0,m=0,b=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?m=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?m=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:C=>{const k=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Mm,zoom:a?Math.round(k.zoom)+a*(n.shiftKey?2:1):k.zoom,bearing:k.bearing+d*this._bearingStep,pitch:k.pitch+m*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:k.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mm(_){return _*(2-_)}const Am=4.000244140625,Rm=1/450;class Lm{constructor(n,a){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=n,this._tr=new Pc(n),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Rm}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(n){return!!this._map.cooperativeGestures.isEnabled()&&!(n.ctrlKey||this._map.cooperativeGestures.isBypassed(n))}wheel(n){if(!this.isEnabled())return;if(this._shouldBePrevented(n))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",n);let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const d=K.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Am==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=J.mousePos(this._map.getCanvas(),n),d=this._tr;this._aroundPoint=this._aroundCenter?d.transform.locationToScreenPoint(c.S.convert(d.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const C=n.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=C),typeof this._targetZoom=="number"&&(this._targetZoom+=C)}if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Am?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&k!==0&&(k=1/k);const D=typeof this._targetZoom!="number"?n.scale:c.af(this._targetZoom);this._targetZoom=n.getConstrained(n.getCameraLngLat(),c.ak(D*k)).zoom,this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?n.zoom:this._targetZoom,d=this._startZoom,m=this._easing;let b,T=!1;if(this._type==="wheel"&&d&&m){const C=K.now()-this._lastWheelEventTime,k=Math.min((C+5)/200,1),D=m(k);b=c.C.number(d,a,D),k<1?this._frameId||(this._frameId=!0):T=!0}else b=a,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!T,zoomDelta:b-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=c.co;if(this._prevEase){const d=this._prevEase,m=(K.now()-d.start)/d.duration,b=d.easing(m+.01)-d.easing(m),T=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-T*T);a=c.cm(T,C,.25,1)}return this._prevEase={start:K.now(),duration:n,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zm{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ya{constructor(n){this._tr=new Pc(n),this.reset()}reset(){this._active=!1}dblclick(n,a){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dn{constructor(){this._tap=new gf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,a,d){if(!this._swipePoint)if(this._tapTime){const m=a[0],b=n.timeStamp-this._tapTime<500,T=this._tapPoint.dist(m)<30;b&&T?d.length>0&&(this._swipePoint=m,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(n,a,d)}touchmove(n,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=a[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,a,d)}touchend(n,a,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const m=this._tap.touchend(n,a,d);m&&(this._tapTime=n.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dm{constructor(n,a,d){this._el=n,this._mousePan=a,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ju{constructor(n,a,d,m){this._pitchWithRotate=n.pitchWithRotate,this._rollEnabled=n.rollEnabled,this._mouseRotate=a,this._mousePitch=d,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class $h{constructor(n,a,d,m){this._el=n,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class vf{constructor(n,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=n,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const n=this._map.getCanvasContainer();n.classList.add("maplibregl-cooperative-gestures"),this._container=J.create("div","maplibregl-cooperative-gesture-screen",n);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=a,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=d,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(J.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(n){return n[this._bypassKey]}notifyGestureBlocked(n,a){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:n,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Bu=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class Nm extends c.l{}function xf(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class Eo{constructor(n,a){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=m.type==="renderFrame"?void 0:m,C={needsRenderFrame:!1},k={},D={};for(const{handlerName:B,handler:q,allowed:Q}of this._handlers){if(!q.isEnabled())continue;let ue;if(this._blockedByActive(D,Q,B))q.reset();else if(q[b||m.type]){if(c.cp(m,b||m.type)){const he=J.mousePos(this._map.getCanvas(),m);ue=q[b||m.type](m,he)}else if(c.cq(m,b||m.type)){const he=this._getMapTouches(m.touches),de=J.touchPos(this._map.getCanvas(),he);ue=q[b||m.type](m,de,he)}else c.cr(b||m.type)||(ue=q[b||m.type](m));this.mergeHandlerResult(C,k,ue,B,T),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()}(ue||q.isActive())&&(D[B]=q)}const O={};for(const B in this._previousActiveHandlers)D[B]||(O[B]=T);this._previousActiveHandlers=D,(Object.keys(O).length||xf(C))&&(this._changes.push([C,k,O]),this._triggerRenderFrame()),(Object.keys(D).length||xf(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=C;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sm(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,T]of this._listeners)J.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[n,a,d]of this._listeners)J.removeEventListener(n,a,n===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(n){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new zs(a,n));const m=a.boxZoom=new Ds(a,n);this._add("boxZoom",m),n.interactive&&n.boxZoom&&m.enable();const b=a.cooperativeGestures=new vf(a,n.cooperativeGestures);this._add("cooperativeGestures",b),n.cooperativeGestures&&b.enable();const T=new my(a),C=new Ya(a);a.doubleClickZoom=new zm(C,T),this._add("tapZoom",T),this._add("clickZoom",C),n.interactive&&n.doubleClickZoom&&a.doubleClickZoom.enable();const k=new Dn;this._add("tapDragZoom",k);const D=a.touchPitch=new Im(a);this._add("touchPitch",D),n.interactive&&n.touchPitch&&a.touchPitch.enable(n.touchPitch);const O=()=>a.project(a.getCenter()),U=function({enable:_e,clickTolerance:Te,aroundCenter:Ee=!0,minPixelCenterThreshold:xe=100,rotateDegreesPerPixelMoved:Ae=.8},qe){const Ue=new yt({checkCorrectEvent:$e=>J.mouseButton($e)===0&&$e.ctrlKey||J.mouseButton($e)===2&&!$e.ctrlKey});return new zu({clickTolerance:Te,move:($e,Ze)=>{const st=qe();if(Ee&&Math.abs(st.y-$e.y)>xe)return{bearingDelta:c.cn(new c.P($e.x,Ze.y),Ze,st)};let ot=(Ze.x-$e.x)*Ae;return Ee&&Ze.y<st.y&&(ot=-ot),{bearingDelta:ot}},moveStateManager:Ue,enable:_e,assignEvents:Nu})}(n,O),B=function({enable:_e,clickTolerance:Te,pitchDegreesPerPixelMoved:Ee=-.5}){const xe=new yt({checkCorrectEvent:Ae=>J.mouseButton(Ae)===0&&Ae.ctrlKey||J.mouseButton(Ae)===2});return new zu({clickTolerance:Te,move:(Ae,qe)=>({pitchDelta:(qe.y-Ae.y)*Ee}),moveStateManager:xe,enable:_e,assignEvents:Nu})}(n),q=function({enable:_e,clickTolerance:Te,rollDegreesPerPixelMoved:Ee=.3},xe){const Ae=new yt({checkCorrectEvent:qe=>J.mouseButton(qe)===2&&qe.ctrlKey});return new zu({clickTolerance:Te,move:(qe,Ue)=>{const $e=xe();let Ze=(Ue.x-qe.x)*Ee;return Ue.y<$e.y&&(Ze=-Ze),{rollDelta:Ze}},moveStateManager:Ae,enable:_e,assignEvents:Nu})}(n,O);a.dragRotate=new ju(n,U,B,q),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",B,["mouseRotate","mouseRoll"]),this._add("mouseRoll",q,["mousePitch"]),n.interactive&&n.dragRotate&&a.dragRotate.enable();const Q=function({enable:_e,clickTolerance:Te}){const Ee=new yt({checkCorrectEvent:xe=>J.mouseButton(xe)===0&&!xe.ctrlKey});return new zu({clickTolerance:Te,move:(xe,Ae)=>({around:Ae,panDelta:Ae.sub(xe)}),activateOnStart:!0,moveStateManager:Ee,enable:_e,assignEvents:Nu})}(n),ue=new Ou(n,a);a.dragPan=new Dm(d,Q,ue),this._add("mousePan",Q),this._add("touchPan",ue,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&a.dragPan.enable(n.dragPan);const he=new Uh,de=new Fh;a.touchZoomRotate=new $h(d,de,he,k),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",de,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&a.touchZoomRotate.enable(n.touchZoomRotate);const ge=a.scrollZoom=new Lm(a,()=>this._triggerRenderFrame());this._add("scrollZoom",ge,["mousePan"]),n.interactive&&n.scrollZoom&&a.scrollZoom.enable(n.scrollZoom);const ve=a.keyboard=new Vh(a);this._add("keyboard",ve),n.interactive&&n.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new Qs(a))}_add(n,a,d){this._handlers.push({handlerName:n,handler:a,allowed:d}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bu(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,a,d){for(const m in n)if(m!==d&&(!a||a.indexOf(m)<0))return!0;return!1}_getMapTouches(n){const a=[];for(const d of n)this._el.contains(d.target)&&a.push(d);return a}mergeHandlerResult(n,a,d,m,b){if(!d)return;c.e(n,d);const T={handlerName:m,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(a.zoom=T),d.panDelta!==void 0&&(a.drag=T),d.rollDelta!==void 0&&(a.roll=T),d.pitchDelta!==void 0&&(a.pitch=T),d.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const n={},a={},d={};for(const[m,b,T]of this._changes)m.panDelta&&(n.panDelta=(n.panDelta||new c.P(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(n.rollDelta=(n.rollDelta||0)+m.rollDelta),m.around!==void 0&&(n.around=m.around),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),c.e(a,b),c.e(d,T);this._updateMapTransform(n,a,d),this._changes=[]}_updateMapTransform(n,a,d){const m=this._map,b=m._getTransformForUpdate(),T=m.terrain;if(!(xf(n)||T&&this._terrainMovement))return this._fireEvents(a,d,!0);m._stop(!0);let{panDelta:C,zoomDelta:k,bearingDelta:D,pitchDelta:O,rollDelta:U,around:B,pinchAround:q}=n;q!==void 0&&(B=q),B=B||m.transform.centerPoint,T&&!b.isPointOnMapSurface(B)&&(B=b.centerPoint);const Q={panDelta:C,zoomDelta:k,rollDelta:U,pitchDelta:O,bearingDelta:D,around:B};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(B)&&(B=b.centerPoint);const ue=B.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(C?B.sub(C):B);this._handleMapControls({terrain:T,tr:b,deltasForHelper:Q,preZoomAroundLoc:ue,combinedEventsInProgress:a,panDelta:C}),m._applyUpdatedTransform(b),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,d,!0)}_handleMapControls({terrain:n,tr:a,deltasForHelper:d,preZoomAroundLoc:m,combinedEventsInProgress:b,panDelta:T}){const C=this._map.cameraHelper;if(C.handleMapControlsRollPitchBearingZoom(d,a),n)return C.useGlobeControls?(this._terrainMovement||!b.drag&&!b.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void C.handleMapControlsPan(d,a,m)):this._terrainMovement||!b.drag&&!b.zoom?void(b.drag&&this._terrainMovement&&T?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(T))):C.handleMapControlsPan(d,a,m)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void C.handleMapControlsPan(d,a,m));C.handleMapControlsPan(d,a,m)}_fireEvents(n,a,d){const m=Bu(this._eventsInProgress),b=Bu(n),T={};for(const U in n){const{originalEvent:B}=n[U];this._eventsInProgress[U]||(T[`${U}start`]=B),this._eventsInProgress[U]=n[U]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const U in T)this._fireEvent(U,T[U]);b&&this._fireEvent("move",b.originalEvent);for(const U in n){const{originalEvent:B}=n[U];this._fireEvent(U,B)}const C={};let k;for(const U in this._eventsInProgress){const{handlerName:B,originalEvent:q}=this._eventsInProgress[U];this._handlersById[B].isActive()||(delete this._eventsInProgress[U],k=a[B]||q,C[`${U}end`]=k)}for(const U in C)this._fireEvent(U,C[U]);const D=Bu(this._eventsInProgress),O=(m||b)&&!D;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const U=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&U.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(U)}if(d&&O){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!U||!U.essential&&K.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:k})),B(this._map.getBearing())&&this._map.resetNorth()):(B(U.bearing||this._map.getBearing())&&(U.bearing=0),U.freezeElevation=!0,this._map.easeTo(U,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new c.l(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Nm("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Zh extends c.E{constructor(n,a,d){super(),this._renderFrameCallback=()=>{const m=Math.min((K.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=d.bearingSnap,this.cameraHelper=a,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(n,a){n.apply(this.transform),this.transform=n,this.cameraHelper=a}getCenter(){return new c.S(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(n,a){return this.jumpTo({elevation:n},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(n){this._centerClampedToGround=n}panBy(n,a,d){return n=c.P.convert(n).mult(-1),this.panTo(this.transform.center,c.e({offset:n},a),d)}panTo(n,a,d){return this.easeTo(c.e({center:n},a),d)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,d){return this.easeTo(c.e({zoom:n},a),d)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(n,a){return n!=this.transform.fov&&(this.transform.setFov(n),this.fire(new c.l("movestart",a)).fire(new c.l("move",a)).fire(new c.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,d){return this.easeTo(c.e({bearing:n},a),d)}resetNorth(n,a){return this.rotateTo(0,c.e({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}getRoll(){return this.transform.roll}setRoll(n,a){return this.jumpTo({roll:n},a),this}cameraForBounds(n,a){n=In.convert(n).adjustAntiMeridian();const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),d,a)}_cameraForBoxAndBearing(n,a,d,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=c.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const D=m.padding;m.padding={top:D,bottom:D,right:D,left:D}}const T=c.e(b,m.padding);m.padding=T;const C=this.transform,k=new In(n,a);return this.cameraHelper.cameraForBoxAndBearing(m,T,k,d,C)}fitBounds(n,a,d){return this._fitInternal(this.cameraForBounds(n,a),a,d)}fitScreenCoordinates(n,a,d,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(n)),this.transform.screenPointToLocation(c.P.convert(a)),d,m),m,b)}_fitInternal(n,a,d){return n?(delete(a=c.e(n,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(n,a){this.stop();const d=this._getTransformForUpdate();let m=!1,b=!1,T=!1;const C=d.zoom;this.cameraHelper.handleJumpToCenterZoom(d,n);const k=d.zoom!==C;return"elevation"in n&&d.elevation!==+n.elevation&&d.setElevation(+n.elevation),"bearing"in n&&d.bearing!==+n.bearing&&(m=!0,d.setBearing(+n.bearing)),"pitch"in n&&d.pitch!==+n.pitch&&(b=!0,d.setPitch(+n.pitch)),"roll"in n&&d.roll!==+n.roll&&(T=!0,d.setRoll(+n.roll)),n.padding==null||d.isPaddingEqual(n.padding)||d.setPadding(n.padding),this._applyUpdatedTransform(d),this.fire(new c.l("movestart",a)).fire(new c.l("move",a)),k&&this.fire(new c.l("zoomstart",a)).fire(new c.l("zoom",a)).fire(new c.l("zoomend",a)),m&&this.fire(new c.l("rotatestart",a)).fire(new c.l("rotate",a)).fire(new c.l("rotateend",a)),b&&this.fire(new c.l("pitchstart",a)).fire(new c.l("pitch",a)).fire(new c.l("pitchend",a)),T&&this.fire(new c.l("rollstart",a)).fire(new c.l("roll",a)).fire(new c.l("rollend",a)),this.fire(new c.l("moveend",a))}calculateCameraOptionsFromTo(n,a,d,m=0){const b=c.a1.fromLngLat(n,a),T=c.a1.fromLngLat(d,m),C=T.x-b.x,k=T.y-b.y,D=T.z-b.z,O=Math.hypot(C,k,D);if(O===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(C,k),B=c.ak(this.transform.cameraToCenterDistance/O/this.transform.tileSize),q=180*Math.atan2(C,-k)/Math.PI;let Q=180*Math.acos(U/O)/Math.PI;return Q=D<0?90-Q:90+Q,{center:T.toLngLat(),elevation:m,zoom:B,pitch:Q,bearing:q}}calculateCameraOptionsFromCameraLngLatAltRotation(n,a,d,m,b){const T=this.transform.calculateCenterFromCameraLngLatAlt(n,a,d,m);return{center:T.center,elevation:T.elevation,zoom:T.zoom,bearing:d,pitch:m,roll:b}}easeTo(n,a){this._stop(!1,n.easeId),((n=c.e({offset:[0,0],duration:500,easing:c.co},n)).animate===!1||!n.essential&&K.prefersReducedMotion)&&(n.duration=0);const d=this._getTransformForUpdate(),m=this.getBearing(),b=d.pitch,T=d.roll,C="bearing"in n?this._normalizeBearing(n.bearing,m):m,k="pitch"in n?+n.pitch:b,D="roll"in n?this._normalizeBearing(n.roll,T):T,O="padding"in n?n.padding:d.padding,U=c.P.convert(n.offset);let B,q;n.around&&(B=c.S.convert(n.around),q=d.locationToScreenPoint(B));const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ue=this.cameraHelper.handleEaseTo(d,{bearing:C,pitch:k,roll:D,padding:O,around:B,aroundPoint:q,offsetAsPoint:U,offset:n.offset,zoom:n.zoom,center:n.center});return this._rotating=this._rotating||m!==C,this._pitching=this._pitching||k!==b,this._rolling=this._rolling||D!==T,this._padding=!d.isPaddingEqual(O),this._zooming=this._zooming||ue.isZooming,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,Q),this.terrain&&this._prepareElevation(ue.elevationCenter),this._ease(he=>{ue.easeFunc(he),this.terrain&&!n.freezeElevation&&this._updateElevation(he),this._applyUpdatedTransform(d),this._fireMoveEvents(a)},he=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(a,he)},n),this}_prepareEase(n,a,d={}){this._moving=!0,a||d.moving||this.fire(new c.l("movestart",n)),this._zooming&&!d.zooming&&this.fire(new c.l("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new c.l("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new c.l("pitchstart",n)),this._rolling&&!d.rolling&&this.fire(new c.l("rollstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&a!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(d-(a-(d*n+this._elevationStart))/(1-n)),this._elevationTarget=a}this.transform.setElevation(c.C.number(this._elevationStart,this._elevationTarget,n))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(n){if(!this.terrain&&n.elevation>=0&&n.pitch<=90)return{};const a=n.getCameraLngLat(),d=n.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(a,n.zoom):0;if(d<m){const b=this.calculateCameraOptionsFromTo(a,m,n.center,n.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(n){const a=[];if(a.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&a.push(m=>this.transformCameraUpdate(m)),!a.length)return;const d=n.clone();for(const m of a){const b=d.clone(),{center:T,zoom:C,roll:k,pitch:D,bearing:O,elevation:U}=m(b);T&&b.setCenter(T),U!==void 0&&b.setElevation(U),C!==void 0&&b.setZoom(C),k!==void 0&&b.setRoll(k),D!==void 0&&b.setPitch(D),O!==void 0&&b.setBearing(O),d.apply(b)}this.transform.apply(d)}_fireMoveEvents(n){this.fire(new c.l("move",n)),this._zooming&&this.fire(new c.l("zoom",n)),this._rotating&&this.fire(new c.l("rotate",n)),this._pitching&&this.fire(new c.l("pitch",n)),this._rolling&&this.fire(new c.l("roll",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const d=this._zooming,m=this._rotating,b=this._pitching,T=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,d&&this.fire(new c.l("zoomend",n)),m&&this.fire(new c.l("rotateend",n)),b&&this.fire(new c.l("pitchend",n)),T&&this.fire(new c.l("rollend",n)),this.fire(new c.l("moveend",n))}flyTo(n,a){if(!n.essential&&K.prefersReducedMotion){const Ze=c.Q(n,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ze,a)}this.stop(),n=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.co},n);const d=this._getTransformForUpdate(),m=d.bearing,b=d.pitch,T=d.roll,C=d.padding,k="bearing"in n?this._normalizeBearing(n.bearing,m):m,D="pitch"in n?+n.pitch:b,O="roll"in n?this._normalizeBearing(n.roll,T):T,U="padding"in n?n.padding:d.padding,B=c.P.convert(n.offset);let q=d.centerPoint.add(B);const Q=d.screenPointToLocation(q),ue=this.cameraHelper.handleFlyTo(d,{bearing:k,pitch:D,roll:O,padding:U,locationAtOffset:Q,offsetAsPoint:B,center:n.center,minZoom:n.minZoom,zoom:n.zoom});let he=n.curve;const de=Math.max(d.width,d.height),ge=de/ue.scaleOfZoom,ve=ue.pixelPathLength;typeof ue.scaleOfMinZoom=="number"&&(he=Math.sqrt(de/ue.scaleOfMinZoom/ve*2));const _e=he*he;function Te(Ze){const st=(ge*ge-de*de+(Ze?-1:1)*_e*_e*ve*ve)/(2*(Ze?ge:de)*_e*ve);return Math.log(Math.sqrt(st*st+1)-st)}function Ee(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function xe(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Ae=Te(!1);let qe=function(Ze){return xe(Ae)/xe(Ae+he*Ze)},Ue=function(Ze){return de*((xe(Ae)*(Ee(st=Ae+he*Ze)/xe(st))-Ee(Ae))/_e)/ve;var st},$e=(Te(!0)-Ae)/he;if(Math.abs(ve)<2e-6||!isFinite($e)){if(Math.abs(de-ge)<1e-6)return this.easeTo(n,a);const Ze=ge<de?-1:1;$e=Math.abs(Math.log(ge/de))/he,Ue=()=>0,qe=st=>Math.exp(Ze*he*st)}return n.duration="duration"in n?+n.duration:1e3*$e/("screenSpeed"in n?+n.screenSpeed/he:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=m!==k,this._pitching=D!==b,this._rolling=O!==T,this._padding=!d.isPaddingEqual(U),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(ue.targetCenter),this._ease(Ze=>{const st=Ze*$e,ot=1/qe(st),tt=Ue(st);this._rotating&&d.setBearing(c.C.number(m,k,Ze)),this._pitching&&d.setPitch(c.C.number(b,D,Ze)),this._rolling&&d.setRoll(c.C.number(T,O,Ze)),this._padding&&(d.interpolatePadding(C,U,Ze),q=d.centerPoint.add(B)),ue.easeFunc(Ze,ot,tt,q),this.terrain&&!n.freezeElevation&&this._updateElevation(Ze),this._applyUpdatedTransform(d),this._fireMoveEvents(a)},()=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){var d;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,a)}return n||(d=this.handlers)===null||d===void 0||d.stop(!1),this}_ease(n,a,d){d.animate===!1||d.duration===0?(n(1),a()):(this._easeStart=K.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,a){n=c.aO(n,-180,180);const d=Math.abs(n-a);return Math.abs(n-360-a)<d&&(n-=360),Math.abs(n+360-a)<d&&(n+=360),n}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(c.S.convert(n),this.transform.tileZoom):null}}const It={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Nt{constructor(n=It){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options.compact,this._container=J.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=J.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=J.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){J.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const d=this._map._getUIString(`AttributionControl.${a}`);n.title=d,n.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const a=this._map.style.sourceCaches;for(const m in a){const b=a[m];if(b.used||b.usedForTerrain){const T=b.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n=n.filter(m=>String(m).trim()),n.sort((m,b)=>m.length-b.length),n=n.filter((m,b)=>{for(let T=b+1;T<n.length;T++)if(n[T].indexOf(m)>=0)return!1;return!0});const d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=J.sanitize(d),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Cc{constructor(n={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const d=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=J.create("div","maplibregl-ctrl");const a=J.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){J.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Om{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const m of d)if(m.id===n)return void(m.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Gh=c.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Bi extends c.E{constructor(n){super(),this._lastTilesetChange=K.now(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=n._source.tileSize*2**this.deltaZoom,n.usedForTerrain=!0,n.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,a){this.sourceCache.update(n,a),this._renderableTilesKeys=[];const d={};for(const m of Ht(n,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))d[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),c.bZ(m.terrainRttPosMatrix32f,0,c.$,c.$,0,0,1),this._tiles[m.key]=new X(m,this.tileSize),this._lastTilesetChange=K.now());for(const m in this._tiles)d[m]||delete this._tiles[m]}freeRtt(n){for(const a in this._tiles){const d=this._tiles[a];(!n||d.tileID.equals(n)||d.tileID.isChildOf(n)||n.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(n=>this.getTileByID(n))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n,a){return a?this._getTerrainCoordsForTileRanges(n,a):this._getTerrainCoordsForRegularTile(n)}_getTerrainCoordsForRegularTile(n){const a={};for(const d of this._renderableTilesKeys){const m=this._tiles[d].tileID,b=n.clone(),T=c.ba();if(m.canonical.equals(n.canonical))c.bZ(T,0,c.$,c.$,0,0,1);else if(m.canonical.isChildOf(n.canonical)){const C=m.canonical.z-n.canonical.z,k=m.canonical.x-(m.canonical.x>>C<<C),D=m.canonical.y-(m.canonical.y>>C<<C),O=c.$>>C;c.bZ(T,0,O,O,0,0,1),c.M(T,T,[-k*O,-D*O,0])}else{if(!n.canonical.isChildOf(m.canonical))continue;{const C=n.canonical.z-m.canonical.z,k=n.canonical.x-(n.canonical.x>>C<<C),D=n.canonical.y-(n.canonical.y>>C<<C),O=c.$>>C;c.bZ(T,0,c.$,c.$,0,0,1),c.M(T,T,[k*O,D*O,0]),c.N(T,T,[1/2**C,1/2**C,0])}}b.terrainRttPosMatrix32f=new Float32Array(T),a[d]=b}return a}_getTerrainCoordsForTileRanges(n,a){const d={};for(const m of this._renderableTilesKeys){const b=this._tiles[m].tileID;if(!this._isWithinTileRanges(b,a))continue;const T=n.clone(),C=c.ba();if(b.canonical.z===n.canonical.z){const k=n.canonical.x-b.canonical.x,D=n.canonical.y-b.canonical.y;c.bZ(C,0,c.$,c.$,0,0,1),c.M(C,C,[k*c.$,D*c.$,0])}else if(b.canonical.z>n.canonical.z){const k=b.canonical.z-n.canonical.z,D=b.canonical.x-(b.canonical.x>>k<<k),O=b.canonical.y-(b.canonical.y>>k<<k),U=n.canonical.x-(b.canonical.x>>k),B=n.canonical.y-(b.canonical.y>>k),q=c.$>>k;c.bZ(C,0,q,q,0,0,1),c.M(C,C,[-D*q+U*c.$,-O*q+B*c.$,0])}else{const k=n.canonical.z-b.canonical.z,D=n.canonical.x-(n.canonical.x>>k<<k),O=n.canonical.y-(n.canonical.y>>k<<k),U=(n.canonical.x>>k)-b.canonical.x,B=(n.canonical.y>>k)-b.canonical.y,q=c.$<<k;c.bZ(C,0,q,q,0,0,1),c.M(C,C,[D*c.$+U*q,O*c.$+B*q,0])}T.terrainRttPosMatrix32f=new Float32Array(C),d[m]=T}return d}getSourceTile(n,a){const d=this.sourceCache._source;let m=n.overscaledZ-this.deltaZoom;if(m>d.maxzoom&&(m=d.maxzoom),m<d.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!b||!b.dem)&&a)for(;m>=d.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(n.scaledTo(m--).key);return b}anyTilesAfterTime(n=Date.now()){return this._lastTilesetChange>=n}_isWithinTileRanges(n,a){return a[n.canonical.z]&&n.canonical.x>=a[n.canonical.z].minTileX&&n.canonical.x<=a[n.canonical.z].maxTileX&&n.canonical.y>=a[n.canonical.z].minTileY&&n.canonical.y<=a[n.canonical.z].maxTileY}}class jm{constructor(n,a,d){this._meshCache={},this.painter=n,this.sourceCache=new Bi(a),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,a,d,m=c.$){var b;if(!(a>=0&&a<m&&d>=0&&d<m))return 0;const T=this.getTerrainData(n),C=(b=T.tile)===null||b===void 0?void 0:b.dem;if(!C)return 0;const k=c.cs([],[a/m*c.$,d/m*c.$],T.u_terrain_matrix),D=[k[0]*C.dim,k[1]*C.dim],O=Math.floor(D[0]),U=Math.floor(D[1]),B=D[0]-O,q=D[1]-U;return C.get(O,U)*(1-B)*(1-q)+C.get(O+1,U)*B*(1-q)+C.get(O,U+1)*(1-B)*q+C.get(O+1,U+1)*B*q}getElevationForLngLatZoom(n,a){if(!c.ct(a,n.wrap()))return 0;const{tileID:d,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(n,a);return this.getElevation(d,m%c.$,b%c.$,c.$)}getElevation(n,a,d,m=c.$){return this.getDEMElevation(n,a,d,m)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const m=this.painter.context,b=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(m,new c.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ag([])}const a=this.sourceCache.getSourceTile(n,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const m=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new c.T(m,a.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),a.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const d=a&&a+a.tileID.key+n.key;if(d&&!this._demMatrixCache[d]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=n.canonical.z-a.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=m?b=n.canonical.z-m:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=n.canonical.x-(n.canonical.x>>b<<b),C=n.canonical.y-(n.canonical.y>>b<<b),k=c.cu(new Float64Array(16),[1/(c.$<<b),1/(c.$<<b),0]);c.M(k,k,[T*c.$,C*c.$,0]),this._demMatrixCache[n.key]={matrix:k,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(n){const a=this.painter,d=a.width/devicePixelRatio,m=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(a.context,{width:d,height:m,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(a.context,{width:d,height:m,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(d,m,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,d,m))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,T=0;b<this._coordsTextureSize;b++)for(let C=0;C<this._coordsTextureSize;C++,T+=4)a[T+0]=255&C,a[T+1]=255&b,a[T+2]=C>>8<<4|b>>8,a[T+3]=0;const d=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),m=new c.T(n,d,n.gl.RGBA,{premultiply:!1});return m.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(n){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),d=this.painter.context,m=d.gl,b=Math.round(n.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(n.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,C-T-1,1,1,m.RGBA,m.UNSIGNED_BYTE,a),d.bindFramebuffer.set(null);const k=a[0]+(a[2]>>4<<8),D=a[1]+((15&a[2])<<8),O=this.coordsIndex[255-a[3]],U=O&&this.sourceCache.getTileByID(O);if(!U)return null;const B=this._coordsTextureSize,q=(1<<U.tileID.canonical.z)*B;return new c.a1((U.tileID.canonical.x*B+k)/q+U.tileID.wrap,(U.tileID.canonical.y*B+D)/q,this.getElevation(U.tileID,k,D,B))}depthAtPoint(n){const a=new Uint8Array(4),d=this.painter.context,m=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,a),d.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(n){var a;const d=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,m=d&&n.canonical.y===0,b=d&&n.canonical.y===(1<<n.canonical.z)-1,T=`m_${m?"n":""}_${b?"s":""}`;if(this._meshCache[T])return this._meshCache[T];const C=this.painter.context,k=new c.cv,D=new c.aN,O=this.meshSize,U=c.$/O,B=O*O;for(let xe=0;xe<=O;xe++)for(let Ae=0;Ae<=O;Ae++)k.emplaceBack(Ae*U,xe*U,0);for(let xe=0;xe<B;xe+=O+1)for(let Ae=0;Ae<O;Ae++)D.emplaceBack(Ae+xe,O+Ae+xe+1,O+Ae+xe+2),D.emplaceBack(Ae+xe,O+Ae+xe+2,Ae+xe+1);const q=k.length,Q=q+(O+1),ue=(O+1)*O,he=m?c.bh:0,de=m?0:1,ge=b?c.bi:c.$,ve=b?0:1;for(let xe=0;xe<=O;xe++)k.emplaceBack(xe*U,he,de);for(let xe=0;xe<=O;xe++)k.emplaceBack(xe*U,ge,ve);for(let xe=0;xe<O;xe++)D.emplaceBack(ue+xe,Q+xe,Q+xe+1),D.emplaceBack(ue+xe,Q+xe+1,ue+xe+1),D.emplaceBack(0+xe,q+xe+1,q+xe),D.emplaceBack(0+xe,0+xe+1,q+xe+1);const _e=k.length,Te=_e+2*(O+1);for(const xe of[0,1])for(let Ae=0;Ae<=O;Ae++)for(const qe of[0,1])k.emplaceBack(xe*c.$,Ae*U,qe);for(let xe=0;xe<2*O;xe+=2)D.emplaceBack(_e+xe,_e+xe+1,_e+xe+3),D.emplaceBack(_e+xe,_e+xe+3,_e+xe+2),D.emplaceBack(Te+xe,Te+xe+3,Te+xe+1),D.emplaceBack(Te+xe,Te+xe+2,Te+xe+3);const Ee=new _o(C.createVertexBuffer(k,Gh.members),C.createIndexBuffer(D),c.aM.simpleSegment(0,0,k.length,D.length));return this._meshCache[T]=Ee,Ee}getMeshFrameDelta(n){return 2*Math.PI*c.bu/Math.pow(2,Math.max(n,0))/5}getMinTileElevationForLngLatZoom(n,a){var d;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(n,a);return(d=this.getMinMaxElevation(m).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(n){const a=this.getTerrainData(n).tile,d={minElevation:null,maxElevation:null};return a&&a.dem&&(d.minElevation=a.dem.min*this.exaggeration,d.maxElevation=a.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(n,a){const d=c.a1.fromLngLat(n.wrap()),m=(1<<a)*c.$,b=d.x*m,T=d.y*m,C=Math.floor(b/c.$),k=Math.floor(T/c.$);return{tileID:new c.Z(a,0,a,C,k),mercatorX:b,mercatorY:T}}}class eo{constructor(n,a,d){this._context=n,this._size=a,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(d.texture),{id:n,fbo:a,texture:d,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>n.id!==a),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(n=>!n.inUse)===!1}}const zl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class gy{constructor(n,a){this.painter=n,this.terrain=a,this.pool=new eo(n.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter(d=>!n._layers[d].isHidden(a)),this._coordsAscending={};for(const d in n.sourceCaches){this._coordsAscending[d]={};const m=n.sourceCaches[d].getVisibleCoordinates(),b=n.sourceCaches[d].getSource(),T=b instanceof mn?b.terrainTileRanges:null;for(const C of m){const k=this.terrain.sourceCache.getTerrainCoords(C,T);for(const D in k)this._coordsAscending[d][D]||(this._coordsAscending[d][D]=[]),this._coordsAscending[d][D].push(k[D])}}this._coordsAscendingStr={};for(const d of n._order){const m=n._layers[d],b=m.source;if(zl[m.type]&&!this._coordsAscendingStr[b]){this._coordsAscendingStr[b]={};for(const T in this._coordsAscending[b])this._coordsAscendingStr[b][T]=this._coordsAscending[b][T].map(C=>C.key).sort().join()}}for(const d of this._renderableTiles)for(const m in this._coordsAscendingStr){const b=this._coordsAscendingStr[m][d.tileID.key];b&&b!==d.rttCoords[m]&&(d.rtt=[])}}renderLayer(n,a){if(n.isHidden(this.painter.transform.zoom))return!1;const d=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),m=n.type,b=this.painter,T=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(zl[m]&&(this._prevType&&zl[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(n.id),!T))return!0;if(zl[this._prevType]||zl[m]&&T){this._prevType=m;const C=this._stacks.length-1,k=this._stacks[C]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(Al(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[C]){const U=this.pool.getObjectForId(D.rtt[C].id);if(U.stamp===D.rtt[C].stamp){this.pool.useObject(U);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),D.rtt[C]={id:O.id,stamp:O.stamp},b.context.bindFramebuffer.set(O.fbo.framebuffer),b.context.clear({color:c.bf.transparent,stencil:0}),b.currentStencilSource=void 0;for(let U=0;U<k.length;U++){const B=b.style._layers[k[U]],q=B.source?this._coordsAscending[B.source][D.tileID.key]:[D.tileID];b.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),b._renderTileClippingMasks(B,q,!0),b.renderLayer(b,b.style.sourceCaches[B.source],B,q,d),B.source&&(D.rttCoords[B.source]=this._coordsAscendingStr[B.source][D.tileID.key])}}return Al(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects(),zl[m]}return!1}}const _y={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},yy=A,Ic={hash:!1,interactive:!0,bearingSnap:7,attributionControl:It,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Qn={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class gr{constructor(n,a,d=!1){this.mousedown=b=>{this.startMove(b,J.mousePos(this.element,b)),J.addEventListener(window,"mousemove",this.mousemove),J.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,J.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHandler.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=J.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),J.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=J.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const m=new _f;this._rotatePitchHandler=new zu({clickTolerance:3,move:(b,T)=>{const C=a.getBoundingClientRect(),k=new c.P((C.bottom-C.top)/2,(C.right-C.left)/2);return{bearingDelta:c.cn(new c.P(b.x,T.y),T,k),pitchDelta:d?-.5*(T.y-b.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=n,J.addEventListener(a,"mousedown",this.mousedown),J.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),J.addEventListener(a,"touchcancel",this.reset)}startMove(n,a){this._rotatePitchHandler.dragStart(n,a),J.disableDrag()}move(n,a){const d=this.map,{bearingDelta:m,pitchDelta:b}=this._rotatePitchHandler.dragMove(n,a)||{};m&&d.setBearing(d.getBearing()+m),b&&d.setPitch(d.getPitch()+b)}off(){const n=this.element;J.removeEventListener(n,"mousedown",this.mousedown),J.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),J.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.removeEventListener(window,"touchend",this.touchend),J.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){J.enableDrag(),J.removeEventListener(window,"mousemove",this.mousemove),J.removeEventListener(window,"mouseup",this.mouseup),J.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.removeEventListener(window,"touchend",this.touchend)}}let Ja;function kc(_,n,a,d=!1){if(d||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return _==null?void 0:_.wrap();const m=new c.S(_.lng,_.lat);if(_=new c.S(_.lng,_.lat),n){const b=new c.S(_.lng-360,_.lat),T=new c.S(_.lng+360,_.lat),C=a.locationToScreenPoint(_).distSqr(n);a.locationToScreenPoint(b).distSqr(n)<C?_=b:a.locationToScreenPoint(T).distSqr(n)<C&&(_=T)}for(;Math.abs(_.lng-a.center.lng)>180;){const b=a.locationToScreenPoint(_);if(b.x>=0&&b.y>=0&&b.x<=a.width&&b.y<=a.height)break;_.lng>a.center.lng?_.lng-=360:_.lng+=360}return _.lng!==m.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(_))?_:m}const Mc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qh(_,n,a){const d=_.classList;for(const m in Mc)d.remove(`maplibregl-${a}-anchor-${m}`);d.add(`maplibregl-${a}-anchor-${n}`)}class Fu extends c.E{constructor(n){if(super(),this._onKeyPress=a=>{const d=a.code,m=a.charCode||a.keyCode;d!=="Space"&&d!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=a=>{const d=a.originalEvent.target,m=this._element;this._popup&&(d===m||m.contains(d))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=kc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),J.setTransform(this._element,`${Mc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${m}`),K.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._subpixelPositioning=n&&n.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this.setOpacity(n==null?void 0:n.opacity,n==null?void 0:n.opacityWhenCovered),n&&n.element)this._element=n.element,this._offset=c.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=J.create("div");const a=J.createNS("http://www.w3.org/2000/svg","svg"),d=41,m=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${d}px`),a.setAttributeNS(null,"width",`${m}px`),a.setAttributeNS(null,"viewBox",`0 0 ${m} ${d}`);const b=J.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const T=J.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const C=J.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const de of k){const ge=J.createNS("http://www.w3.org/2000/svg","ellipse");ge.setAttributeNS(null,"opacity","0.04"),ge.setAttributeNS(null,"cx","10.5"),ge.setAttributeNS(null,"cy","5.80029008"),ge.setAttributeNS(null,"rx",de.rx),ge.setAttributeNS(null,"ry",de.ry),C.appendChild(ge)}const D=J.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const O=J.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(O);const U=J.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const B=J.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(B);const q=J.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const Q=J.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ue=J.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#000000"),ue.setAttributeNS(null,"opacity","0.25"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962");const he=J.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#FFFFFF"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962"),Q.appendChild(ue),Q.appendChild(he),T.appendChild(C),T.appendChild(D),T.appendChild(U),T.appendChild(q),T.appendChild(Q),a.appendChild(T),a.setAttributeNS(null,"height",d*this._scale+"px"),a.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(a),this._offset=c.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),qh(this._element,this._anchor,"marker"),n&&n.className)for(const a of n.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(n){return this.remove(),this._map=n,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",n._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),n.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),J.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=c.S.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const m=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(n){return this._subpixelPositioning=n,this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:n?(n.isOpen()?n.remove():(n.setLngLat(this._lngLat),n.addTo(this._map)),this):this}_updateOpacity(n=!1){var a,d;const m=(a=this._map)===null||a===void 0?void 0:a.terrain,b=this._map.transform.isLocationOccluded(this._lngLat);if(!m||b){const q=b?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==q&&(this._element.style.opacity=q))}if(n)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const T=this._map,C=T.terrain.depthAtPoint(this._pos),k=T.terrain.getElevationForLngLatZoom(this._lngLat,T.transform.tileZoom);if(T.transform.lngLatToCameraDepth(this._lngLat,k)-C<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/T.transform.pixelsPerMeter,O=Math.sin(T.getPitch()*Math.PI/180)*D,U=T.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),B=T.transform.lngLatToCameraDepth(this._lngLat,k+O)-U>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&B&&this._popup.remove(),this._element.style.opacity=B?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(n){return this._offset=c.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(n,a){return(this._opacity===void 0||n===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),n!==void 0&&(this._opacity=n),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const bf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Qa=0,Dl=!1;const wf={maxWidth:100,unit:"metric"};function Wh(_,n,a){const d=a&&a.maxWidth||100,m=_._container.clientHeight/2,b=_._container.clientWidth/2,T=_.unproject([b-d/2,m]),C=_.unproject([b+d/2,m]),k=Math.round(_.project(C).x-_.project(T).x),D=Math.min(d,k,_._container.clientWidth),O=T.distanceTo(C);if(a&&a.unit==="imperial"){const U=3.2808*O;U>5280?Nl(n,D,U/5280,_._getUIString("ScaleControl.Miles")):Nl(n,D,U,_._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Nl(n,D,O/1852,_._getUIString("ScaleControl.NauticalMiles")):O>=1e3?Nl(n,D,O/1e3,_._getUIString("ScaleControl.Kilometers")):Nl(n,D,O,_._getUIString("ScaleControl.Meters"))}function Nl(_,n,a,d){const m=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let C=b/T;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(k){const D=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*D)/D}(C),T*C}(a);_.style.width=n*(m/a)+"px",_.innerHTML=`${m}&nbsp;${d}`}const Tf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Sf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hh(_){if(_){if(typeof _=="number"){const n=Math.round(Math.abs(_)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,_),"top-left":new c.P(n,n),"top-right":new c.P(-n,n),bottom:new c.P(0,-_),"bottom-left":new c.P(n,-n),"bottom-right":new c.P(-n,-n),left:new c.P(_,0),right:new c.P(-_,0)}}if(_ instanceof c.P||Array.isArray(_)){const n=c.P.convert(_);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:c.P.convert(_.center||[0,0]),top:c.P.convert(_.top||[0,0]),"top-left":c.P.convert(_["top-left"]||[0,0]),"top-right":c.P.convert(_["top-right"]||[0,0]),bottom:c.P.convert(_.bottom||[0,0]),"bottom-left":c.P.convert(_["bottom-left"]||[0,0]),"bottom-right":c.P.convert(_["bottom-right"]||[0,0]),left:c.P.convert(_.left||[0,0]),right:c.P.convert(_.right||[0,0])}}return Hh(new c.P(0,0))}const Pf=A;g.AJAXError=c.cz,g.Event=c.l,g.Evented=c.E,g.LngLat=c.S,g.MercatorCoordinate=c.a1,g.Point=c.P,g.addProtocol=c.cA,g.config=c.a,g.removeProtocol=c.cB,g.AttributionControl=Nt,g.BoxZoomHandler=Ds,g.CanvasSource=Ai,g.CooperativeGesturesHandler=vf,g.DoubleClickZoomHandler=zm,g.DragPanHandler=Dm,g.DragRotateHandler=ju,g.EdgeInsets=Ia,g.FullscreenControl=class extends c.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var n;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((n=a==null?void 0:a.shadowRoot)===null||n===void 0)&&n.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){J.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=J.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);J.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},g.GeoJSONSource=_n,g.GeolocateControl=class extends c.E{constructor(_){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",n)),this._finish()}},this._updateCamera=n=>{const a=new c.S(n.coords.longitude,n.coords.latitude),d=n.coords.accuracy,m=this._map.getBearing(),b=c.e({bearing:m},this.options.fitBoundsOptions),T=In.fromLngLat(a,d);this._map.fitBounds(T,b,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const a=new c.S(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=n.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=n=>{if(this._map){if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&Dl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=J.create("button","maplibregl-ctrl-geolocate",this._container),J.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=n=>{if(this._map){if(n===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=J.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Fu({element:this._dotElement}),this._circleElement=J.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{const d=(a==null?void 0:a[0])instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},bf,_)}onAdd(_){return this._map=_,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(n=!1){if(Ja!==void 0&&!n)return Ja;if(window.navigator.permissions===void 0)return Ja=!!window.navigator.geolocation,Ja;try{Ja=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ja=!!window.navigator.geolocation}return Ja})}().then(n=>this._finishSetupUI(n)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),J.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Qa=0,Dl=!1}_isOutOfMapMaxBounds(_){const n=this._map.getMaxBounds(),a=_.coords;return n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const _=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&_))return;const n=this._map.project(_),a=this._map.unproject([n.x+100,n.y]),d=_.distanceTo(a)/100,m=2*this._accuracy/d;this._circleElement.style.width=`${m.toFixed(2)}px`,this._circleElement.style.height=`${m.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Qa--,Dl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Qa++,Qa>1?(_={maximumAge:6e5,timeout:0},Dl=!0):(_=this.options.positionOptions,Dl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},g.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;const n=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(n!=="mercator"&&n?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=J.create("button","maplibregl-ctrl-globe",this._container),J.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){J.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},g.Hash=pf,g.ImageSource=mn,g.KeyboardHandler=Vh,g.LngLatBounds=In,g.LogoControl=Cc,g.Map=class extends Zh{constructor(_){var n,a;c.cw.mark(c.cx.create);const d=Object.assign(Object.assign(Object.assign({},Ic),_),{canvasContextAttributes:Object.assign(Object.assign({},Ic.canvasContextAttributes),_.canvasContextAttributes)});if(d.minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new xo,b=new $o;if(d.minZoom!==void 0&&m.setMinZoom(d.minZoom),d.maxZoom!==void 0&&m.setMaxZoom(d.maxZoom),d.minPitch!==void 0&&m.setMinPitch(d.minPitch),d.maxPitch!==void 0&&m.setMaxPitch(d.maxPitch),d.renderWorldCopies!==void 0&&m.setRenderWorldCopies(d.renderWorldCopies),super(m,b,{bearingSnap:d.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Om,this._controls=[],this._mapId=c.a7(),this._contextLost=C=>{C.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:C}))},this._contextRestored=C=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:C}))},this._onMapScroll=C=>{if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},d.canvasContextAttributes),this._trackResize=d.trackResize===!0,this._bearingSnap=d.bearingSnap,this._centerClampedToGround=d.centerClampedToGround,this._refreshExpiredTiles=d.refreshExpiredTiles===!0,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions===!0,this._collectResourceTiming=d.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},_y),d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=d.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=fe.addThrottleControl(()=>this.isMoving()),this._requestManager=new pe(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let C=!1;const k=ff(D=>{this._trackResize&&!this._removed&&(this.resize(D),this.redraw())},50);this._resizeObserver=new ResizeObserver(D=>{C?k(D):C=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Eo(this,d),this._hash=d.hash&&new pf(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,elevation:d.elevation,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,roll:d.roll}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,c.e({},d.fitBoundsOptions,{duration:0}))));const T=typeof d.style=="string"||((a=(n=d.style)===null||n===void 0?void 0:n.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,T),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Nt(typeof d.attributionControl=="boolean"?void 0:d.attributionControl)),d.maplibreLogo&&this.addControl(new Cc,d.logoPosition),this.on("style.load",()=>{if(T||this._resizeTransform(),this.transform.unmodified){const C=c.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(C)}}),this.on("data",C=>{this._update(C.dataType==="style"),this.fire(new c.l(`${C.dataType}data`,C))}),this.on("dataloading",C=>{this.fire(new c.l(`${C.dataType}dataloading`,C))}),this.on("dataabort",C=>{this.fire(new c.l("sourcedataabort",C))})}_getMapId(){return this._mapId}setGlobalStateProperty(_,n){return this.style.setGlobalStateProperty(_,n),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(_,n){if(n===void 0&&(n=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=_.onAdd(this);this._controls.push(_);const d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(_);return n>-1&&this._controls.splice(n,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}coveringTiles(_){return Ht(this.transform,_)}calculateCameraOptionsFromTo(_,n,a,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,n,a,d)}resize(_,n=!0){const[a,d]=this._containerDimensions(),m=this._getClampedPixelRatio(a,d);if(this._resizeCanvas(a,d,m),this.painter.resize(a,d,m),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const C=this._getClampedPixelRatio(a,d);this._resizeCanvas(a,d,C),this.painter.resize(a,d,C)}this._resizeTransform(n);const b=!this._moving;return b&&(this.stop(),this.fire(new c.l("movestart",_)).fire(new c.l("move",_))),this.fire(new c.l("resize",_)),b&&this.fire(new c.l("moveend",_)),this}_resizeTransform(_=!0){var n;const[a,d]=this._containerDimensions();this.transform.resize(a,d,_),(n=this._requestedCameraState)===null||n===void 0||n.resize(a,d,_)}_getClampedPixelRatio(_,n){const{0:a,1:d}=this._maxCanvasSize,m=this.getPixelRatio(),b=_*m,T=n*m;return Math.min(b>a?a/b:1,T>d?d/T:1)*m}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(In.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.setMinZoom(_),this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.setMaxZoom(_),this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}project(_){return this.transform.locationToScreenPoint(c.S.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(c.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,n,a){if(_==="mouseenter"||_==="mouseover"){let d=!1;return{layers:n,listener:a,delegates:{mousemove:b=>{const T=n.filter(k=>this.getLayer(k)),C=T.length!==0?this.queryRenderedFeatures(b.point,{layers:T}):[];C.length?d||(d=!0,a.call(this,new Xi(_,this,b.originalEvent,{features:C}))):d=!1},mouseout:()=>{d=!1}}}}if(_==="mouseleave"||_==="mouseout"){let d=!1;return{layers:n,listener:a,delegates:{mousemove:T=>{const C=n.filter(k=>this.getLayer(k));(C.length!==0?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?d=!0:d&&(d=!1,a.call(this,new Xi(_,this,T.originalEvent)))},mouseout:T=>{d&&(d=!1,a.call(this,new Xi(_,this,T.originalEvent)))}}}}{const d=m=>{const b=n.filter(C=>this.getLayer(C)),T=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];T.length&&(m.features=T,a.call(this,m),delete m.features)};return{layers:n,listener:a,delegates:{[_]:d}}}}_saveDelegatedListener(_,n){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(n)}_removeDelegatedListener(_,n,a){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const d=this._delegatedListeners[_];for(let m=0;m<d.length;m++){const b=d[m];if(b.listener===a&&b.layers.length===n.length&&b.layers.every(T=>n.includes(T))){for(const T in b.delegates)this.off(T,b.delegates[T]);return void d.splice(m,1)}}}on(_,n,a){if(a===void 0)return super.on(_,n);const d=typeof n=="string"?[n]:n,m=this._createDelegatedListener(_,d,a);this._saveDelegatedListener(_,m);for(const b in m.delegates)this.on(b,m.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(_,d,a)}}}once(_,n,a){if(a===void 0)return super.once(_,n);const d=typeof n=="string"?[n]:n,m=this._createDelegatedListener(_,d,a);for(const b in m.delegates){const T=m.delegates[b];m.delegates[b]=(...C)=>{this._removeDelegatedListener(_,d,a),T(...C)}}this._saveDelegatedListener(_,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(_,n,a){return a===void 0?super.off(_,n):(this._removeDelegatedListener(_,typeof n=="string"?[n]:n,a),this)}queryRenderedFeatures(_,n){if(!this.style)return[];let a;const d=_ instanceof c.P||Array.isArray(_),m=d?_:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(d?{}:_)||{},m instanceof c.P||typeof m[0]=="number")a=[c.P.convert(m)];else{const b=c.P.convert(m[0]),T=c.P.convert(m[1]);a=[b,new c.P(T.x,b.y),T,new c.P(b.x,T.y),b]}return this.style.queryRenderedFeatures(a,n,this.transform)}querySourceFeatures(_,n){return this.style.querySourceFeatures(_,n)}setStyle(_,n){return(n=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(_,n))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const n=this._locale[_];if(n==null)throw new Error(`Missing UI string '${_}'`);return n}_updateStyle(_,n){var a,d;if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,n));const m=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new cc(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,n,m):this.style.loadJSON(_,n,m),this):((d=(a=this.style)===null||a===void 0?void 0:a.projection)===null||d===void 0||d.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new cc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,n){if(typeof _=="string"){const a=this._requestManager.transformRequest(_,"Style");c.j(a,new AbortController).then(d=>{this._updateDiff(d.data,n)}).catch(d=>{d&&this.fire(new c.k(d))})}else typeof _=="object"&&this._updateDiff(_,n)}_updateDiff(_,n){try{this.style.setState(_,n)&&this._update(!0)}catch(a){c.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(_,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(_,n){return this._lazyInitEmptyStyle(),this.style.addSource(_,n),this._update(!0)}isSourceLoaded(_){const n=this.style&&this.style.sourceCaches[_];if(n!==void 0)return n.loaded();this.fire(new c.k(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const n=this.style.sourceCaches[_.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&n.reload();for(const a in this.style._layers){const d=this.style._layers[a];d.type==="hillshade"&&d.source===_.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),d.type==="color-relief"&&d.source===_.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new jm(this.painter,n,_),this.painter.renderToTexture=new gy(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var d;a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((d=a.source)===null||d===void 0?void 0:d.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:_})),this}getTerrain(){var _,n;return(n=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const n in _){const a=_[n]._tiles;for(const d in a){const m=a[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}setSourceTileLodParams(_,n,a){if(a){const d=this.getSource(a);if(!d)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);d.calculateTileZoom=bt(Math.max(1,_),Math.max(1,n))}else for(const d in this.style.sourceCaches)this.style.sourceCaches[d].getSource().calculateTileZoom=bt(Math.max(1,_),Math.max(1,n));return this._update(!0),this}refreshTiles(_,n){const a=this.style.sourceCaches[_];if(!a)throw new Error(`There is no source cache with ID "${_}", cannot refresh tile`);n===void 0?a.reload(!0):a.refreshTiles(n.map(d=>new c.a4(d.z,d.x,d.y)))}addImage(_,n,a={}){const{pixelRatio:d=1,sdf:m=!1,stretchX:b,stretchY:T,content:C,textFitWidth:k,textFitHeight:D}=a;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||c.b(n))){if(n.width===void 0||n.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:U,data:B}=n,q=n;return this.style.addImage(_,{data:new c.R({width:O,height:U},new Uint8Array(B)),pixelRatio:d,stretchX:b,stretchY:T,content:C,textFitWidth:k,textFitHeight:D,sdf:m,version:0,userImage:q}),q.onAdd&&q.onAdd(this,_),this}}{const{width:O,height:U,data:B}=K.getImageData(n);this.style.addImage(_,{data:new c.R({width:O,height:U},B),pixelRatio:d,stretchX:b,stretchY:T,content:C,textFitWidth:k,textFitHeight:D,sdf:m,version:0})}}updateImage(_,n){const a=this.style.getImage(_);if(!a)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=n instanceof HTMLImageElement||c.b(n)?K.getImageData(n):n,{width:m,height:b,data:T}=d;if(m===void 0||b===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==a.data.width||b!==a.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(n instanceof HTMLImageElement||c.b(n));return a.data.replace(T,C),this.style.updateImage(_,a),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return fe.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,n){return this._lazyInitEmptyStyle(),this.style.addLayer(_,n),this._update(!0)}moveLayer(_,n){return this.style.moveLayer(_,n),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,n,a){return this.style.setLayerZoomRange(_,n,a),this._update(!0)}setFilter(_,n,a={}){return this.style.setFilter(_,n,a),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,n,a,d={}){return this.style.setPaintProperty(_,n,a,d),this._update(!0)}getPaintProperty(_,n){return this.style.getPaintProperty(_,n)}setLayoutProperty(_,n,a,d={}){return this.style.setLayoutProperty(_,n,a,d),this._update(!0)}getLayoutProperty(_,n){return this.style.getLayoutProperty(_,n)}setGlyphs(_,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,n,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,n,a,d=>{d||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,n,a=>{a||this._update(!0)}),this}setLight(_,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,n),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,n={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,n),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,n){return this.style.setFeatureState(_,n),this._update()}removeFeatureState(_,n){return this.style.removeFeatureState(_,n),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,n=0;return this._container&&(_=this._container.clientWidth||400,n=this._container.clientHeight||300),[_,n]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const n=this._canvasContainer=J.create("div","maplibregl-canvas-container",_);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=J.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),d=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],d);const m=this._controlContainer=J.create("div","maplibregl-control-container",_),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{b[T]=J.create("div",`maplibregl-ctrl-${T} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,n,a){this._canvas.width=Math.floor(a*_),this._canvas.height=Math.floor(a*n),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let n=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{n={requestedAttributes:_},d&&(n.statusMessage=d.statusMessage,n.type=d.type)},{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!a){const d="Failed to initialize WebGL";throw n?(n.message=d,new Error(JSON.stringify(n))):new Error(d)}this.painter=new vm(a,this.transform),ce.testSupport(a)}migrateProjection(_,n){super.migrateProjection(_,n),this.painter.transform=_,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var n,a,d,m,b;const T=this._idleTriggered?this._fadeDuration:0,C=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,B=K.now();this.style.zoomHistory.update(U,B);const q=new c.F(U,{now:B,fadeDuration:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=q.crossFadingFactor();Q===1&&Q===this._crossFadingFactor||(k=!0,this._crossFadingFactor=Q),this.style.update(q)}const D=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==C;(d=this.style.projection)===null||d===void 0||d.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(b=this.style.projection)===null||b===void 0?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||D)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,D),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cw.mark(c.cx.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const O=this._sourcesDirty||this._styleDirty||this._placementDirty;return O||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,c.cw.mark(c.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),fe.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n!=null&&n.loseContext&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),J.remove(this._canvasContainer),J.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cw.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,K.frame(this._frameRequest,_=>{c.cw.frame(_),this._frameRequest=null;try{this._render(_)}catch(n){if(!c.cy(n)&&!function(a){return a.message===yc}(n))throw n}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return yy}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},g.MapMouseEvent=Xi,g.MapTouchEvent=Ka,g.MapWheelEvent=mf,g.Marker=Fu,g.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const n=this._map.getZoom(),a=n===this._map.getMaxZoom(),d=n===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(n,a)=>{const d=this._map._getUIString(`NavigationControl.${a}`);n.title=d,n.setAttribute("aria-label",d)},this.options=c.e({},Qn,_),this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),J.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),J.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=J.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){J.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,n){const a=J.create("button",_,this._container);return a.type="button",a.addEventListener("click",n),a}},g.Popup=class extends c.E{constructor(_){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&J.remove(this._content),this._container&&(J.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=J.create("div","maplibregl-popup",this._map.getContainer()),this._tip=J.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=kc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!n)return;const a=this._flatPos=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&n?n:this._map.transform.locationToScreenPoint(this._lngLat));let d=this.options.anchor;const m=Hh(this.options.offset);if(!d){const T=this._container.offsetWidth,C=this._container.offsetHeight;let k;k=a.y+m.bottom.y<C?["top"]:a.y>this._map.transform.height-C?["bottom"]:[],a.x<T/2?k.push("left"):a.x>this._map.transform.width-T/2&&k.push("right"),d=k.length===0?"bottom":k.join("-")}let b=a.add(m[d]);this.options.subpixelPositioning||(b=b.round()),J.setTransform(this._container,`${Mc[d]} translate(${b.x}px,${b.y}px)`),qh(this._container,d,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Tf),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=c.S.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const n=document.createDocumentFragment(),a=document.createElement("body");let d;for(a.innerHTML=_;d=a.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=J.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=J.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Sf);_&&_.focus()}},g.RasterDEMTileSource=Vt,g.RasterTileSource=Dr,g.ScaleControl=class{constructor(_){this._onMove=()=>{Wh(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,Wh(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wf),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){J.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},g.ScrollZoomHandler=Lm,g.Style=cc,g.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=J.create("button","maplibregl-ctrl-terrain",this._container),J.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){J.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},g.TwoFingersTouchPitchHandler=Im,g.TwoFingersTouchRotateHandler=Uh,g.TwoFingersTouchZoomHandler=Fh,g.TwoFingersTouchZoomRotateHandler=$h,g.VectorTileSource=vi,g.VideoSource=dr,g.addSourceType=(_,n)=>c._(void 0,void 0,void 0,function*(){if(xi(_))throw new Error(`A source type called "${_}" already exists.`);((a,d)=>{Gi[a]=d})(_,n)}),g.clearPrewarmedResources=function(){const _=Bt;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(We),Bt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},g.createTileMesh=cn,g.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},g.getRTLTextPluginStatus=function(){return br().getRTLTextPluginStatus()},g.getVersion=function(){return Pf},g.getWorkerCount=function(){return nt.workerCount},g.getWorkerUrl=function(){return c.a.WORKER_URL},g.importScriptInWorkers=function(_){return Un().broadcast("IS",_)},g.prewarm=function(){Ut().acquire(We)},g.setMaxParallelImageRequests=function(_){c.a.MAX_PARALLEL_IMAGE_REQUESTS=_},g.setRTLTextPlugin=function(_,n){return br().setRTLTextPlugin(_,n)},g.setWorkerCount=function(_){nt.workerCount=_},g.setWorkerUrl=function(_){c.a.WORKER_URL=_}});var v=i;return v})})(Wk);var E6=Wk.exports;const ix=z_(E6);function wP(t,e){if(!t||!e)return 0;const i=Z=>Z*Math.PI/180,l=6371e3,f=i(e.lat-t.lat),v=i(e.lng-t.lng),g=i(t.lat),c=i(e.lat),A=Math.sin(f/2)**2+Math.cos(g)*Math.cos(c)*Math.sin(v/2)**2,N=2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A));return l*N}async function C6(t,e={},i=3,l=400){let f;for(let v=0;v<i;v++)try{const g=await fetch(t,e);if(!g.ok)throw new Error(`HTTP ${g.status}`);return await g.json()}catch(g){f=g,await new Promise(c=>setTimeout(c,l*(v+1)))}throw f}function I6({center:t,pickupCoord:e,dropoffCoord:i}){const l=se.useRef(null),f=se.useRef(null),v=se.useRef(null),g=se.useRef(null);return se.useEffect(()=>{if(!l.current||f.current)return;const c=new ix.Map({container:l.current,style:"https://demotiles.maplibre.org/style.json",center:[t.lng,t.lat],zoom:13});return f.current=c,()=>{try{c.remove()}catch{}f.current=null}},[t]),se.useEffect(()=>{const c=f.current;c&&(e&&(v.current||(v.current=new ix.Marker({color:"#22c55e"})),v.current.setLngLat([e.lng,e.lat]).addTo(c),c.setCenter([e.lng,e.lat])),i&&(g.current||(g.current=new ix.Marker({color:"#ef4444"})),g.current.setLngLat([i.lng,i.lat]).addTo(c)))},[e,i]),I.jsx("div",{ref:l,style:{width:"100%",height:"100%"}})}function k6({center:t}){const e=x6();return se.useEffect(()=>{t&&e.setView([t.lat,t.lng],13)},[t,e]),null}function Kk({center:t={lat:25.033964,lng:121.564468},pickupCoord:e,dropoffCoord:i,onRouteUpdate:l,onTileError:f}){const[v,g]=se.useState(!1),[c,A]=se.useState(null),[N,Z]=se.useState("");se.useEffect(()=>{(async()=>{var J,ce,ie;if(!e||!i){A(null),l==null||l({distanceMeters:0,durationSeconds:0,polylinePath:[]});return}try{const oe=`https://router.project-osrm.org/route/v1/driving/${e.lng},${e.lat};${i.lng},${i.lat}?overview=full&geometries=geojson`,$=(J=(await C6(oe,{},2,500)).routes)==null?void 0:J[0];if($){const te=((ie=(ce=$.geometry)==null?void 0:ce.coordinates)==null?void 0:ie.map(([fe,pe])=>({lat:pe,lng:fe})))||[];A(te),l==null||l({distanceMeters:$.distance||wP(e,i),durationSeconds:$.duration||0,polylinePath:te});return}throw new Error("OSRM ")}catch(oe){console.warn("OSRM ",oe);const re=wP(e,i),$=re/1e3/30*60;A([e,i]),l==null||l({distanceMeters:re,durationSeconds:$,polylinePath:[e,i]})}})()},[e,i,l]);const W=()=>{g(!0),Z(""),f==null||f()};return v?I.jsxs("div",{className:"w-full h-full",children:[I.jsx(I6,{center:t,pickupCoord:e,dropoffCoord:i}),N&&I.jsx("div",{className:"text-xs text-yellow-400 mt-2",children:N})]}):I.jsxs("div",{className:"w-full h-full",children:[I.jsxs(w6,{center:[t.lat,t.lng],zoom:13,style:{width:"100%",height:"100%"},children:[I.jsx(S6,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:" OpenStreetMap contributors",eventHandlers:{tileerror:W}}),I.jsx(k6,{center:t}),e&&I.jsx(bP,{center:[e.lat,e.lng],radius:10,pathOptions:{color:"#22c55e"}}),i&&I.jsx(bP,{center:[i.lat,i.lng],radius:10,pathOptions:{color:"#ef4444"}}),c&&c.length>=2&&I.jsx(T6,{positions:c.map(K=>[K.lat,K.lng]),pathOptions:{color:"#0ea5e9",weight:4}})]}),N&&I.jsx("div",{className:"text-xs text-yellow-400 mt-2",children:N})]})}function M6(){const{user:t,orders:e,loading:i,updateDriverStatus:l,completeRide:f,loadOrders:v,logout:g}=_l(),{toast:c}=sc(),A=vh(),[N,Z]=se.useState(!1),[W,K]=se.useState({lat:null,lng:null}),[J,ce]=se.useState(null),[ie,oe]=se.useState(null),[re,$]=se.useState(null),te=se.useRef(null),{online:fe,setOnline:pe,lastLocation:Ie,startMeter:Ge}=$O();se.useEffect(()=>{t!=null&&t.phone&&(v(t.phone),(async()=>{try{const Oe=await _s.getUserProfile(t.phone);oe((Oe==null?void 0:Oe.rating_avg)??null),$((Oe==null?void 0:Oe.review_count)??null)}catch(Oe){console.warn('x!""',Oe)}})())},[t]),se.useEffect(()=>{const Oe=()=>{if(!("geolocation"in navigator)){c({title:"a",description:"a`x",variant:"destructive"});return}navigator.geolocation.getCurrentPosition(async We=>{var Ut;const{latitude:nt,longitude:_t,heading:Bt,speed:Ft}=We.coords;K({lat:nt,lng:_t});try{const Pt=await Os("driver-heartbeat",{phone:t==null?void 0:t.phone,status:(t==null?void 0:t.status)||null,lat:nt,lng:_t,heading:Bt,speed:Ft});Pt!=null&&Pt.success?(ce(((Ut=Pt.data)==null?void 0:Ut.lastOnlineAt)||null),console.debug("Heartbeat OK",Pt.data)):console.warn("Heartbeat failed",Pt)}catch(Pt){console.error("Heartbeat error",Pt)}},We=>{console.error("Geolocation error",We),c({title:'a"',description:We.message,variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3})};return Oe(),te.current=setInterval(Oe,2e4),()=>{te.current&&clearInterval(te.current)}},[t]);const Le=async Oe=>{Z(!0);try{await l(t.phone,Oe),c({title:"9&9:",description:`a9&9: ${Zl(Oe)}`,variant:"success"})}catch(We){c({title:'9&9:"',description:We.message,variant:"destructive"})}finally{Z(!1)}},xt=async Oe=>{Z(!0);try{await f(Oe,t.phone),c({title:"R",description:'`xR"9',variant:"success"}),v(t.phone);const We=window.prompt('9SS9"" 1-50a',"5"),nt=Number(We);if(Number.isFinite(nt)&&nt>=1&&nt<=5)try{await _s.submitOrderReview({orderId:Oe,rating:nt,comment:"",byPhone:t.phone}),c({title:'"!',description:`S" a${nt} x`,variant:"success"});try{const _t=await _s.getUserProfile(t.phone);oe((_t==null?void 0:_t.rating_avg)??null),$((_t==null?void 0:_t.review_count)??null)}catch{}}catch(_t){console.error('""',_t),c({title:'""',description:String((_t==null?void 0:_t.message)||_t),variant:"destructive"})}}catch(We){c({title:'R"',description:We.message,variant:"destructive"})}finally{Z(!1)}},ct=async()=>{try{await g()}catch{}c({title:'"!R:~"...',description:'aS9"',variant:"success"}),setTimeout(()=>{try{A("/")}catch{window.location.href="/"}},1500)},ht=()=>{v(t.phone),c({title:":",description:'!":',variant:"success"})},ze=e.filter(Oe=>["requested","pending","accepted","enroute","arrived"].includes(Oe.status)),vt=e.filter(Oe=>Oe.status==="completed"),at=vt.reduce((Oe,We)=>Oe+(We.estimatedPrice||0),0),Mt=ze[0]||null,wt=Mt!=null&&Mt.pickupLat&&(Mt!=null&&Mt.pickupLng)?{lat:Mt.pickupLat,lng:Mt.pickupLng}:null,jt=Mt!=null&&Mt.dropoffLat&&(Mt!=null&&Mt.dropoffLng)?{lat:Mt.dropoffLat,lng:Mt.dropoffLng}:null,Ne=W.lat&&W.lng?{lat:W.lat,lng:W.lng}:wt||{lat:25.033964,lng:121.564468};return I.jsx("div",{className:"min-h-screen p-4",children:I.jsxs("div",{className:"max-w-6xl mx-auto",children:[I.jsxs("div",{className:"flex items-center justify-between mb-6",children:[I.jsxs("div",{children:[I.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"x"}),I.jsxs("p",{className:"text-gray-300",children:["}R",t==null?void 0:t.name," ",t==null?void 0:t.phone,"0"]})]}),I.jsxs("div",{className:"flex gap-2",children:[I.jsx(Cn,{variant:fe?"secondary":"default",onClick:()=>pe(!fe),children:fe?"":""}),I.jsxs(Cn,{variant:"outline",onClick:ht,disabled:i,children:[I.jsx(Kp,{className:`w-4 h-4 mr-2 ${i?"animate-spin":""}`}),":"]}),I.jsxs(Cn,{variant:"destructive",onClick:ct,children:[I.jsx(Ub,{className:"w-4 h-4 mr-2"}),'"!']})]})]}),I.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[I.jsx(Rn,{className:"glass",children:I.jsx(Ln,{className:"p-4",children:I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(wp,{className:"w-8 h-8 text-blue-500"}),I.jsxs("div",{children:[I.jsx("p",{className:"text-sm text-muted-foreground",children:":09&9"}),I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx(va,{className:Yc((t==null?void 0:t.status)||"offline"),children:Zl((t==null?void 0:t.status)||"offline")}),J&&I.jsxs("span",{className:"text-xs text-muted-foreground",children:["Sa",new Date(J).toLocaleTimeString()]}),ie!==null&&I.jsxs("span",{className:"flex items-center gap-1 ml-2 text-xs text-yellow-400",children:[I.jsx(DS,{className:"w-4 h-4"}),ie," ",re?`(${re})`:""]})]})]})]})})}),I.jsx(Rn,{className:"glass",children:I.jsx(Ln,{className:"p-4",children:I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(Xl,{className:"w-8 h-8 text-orange-500"}),I.jsxs("div",{children:[I.jsx("p",{className:"text-sm text-muted-foreground",children:"R"}),I.jsx("p",{className:"text-xl font-bold",children:ze.length})]})]})})}),I.jsx(Rn,{className:"glass",children:I.jsx(Ln,{className:"p-4",children:I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(cu,{className:"w-8 h-8 text-green-500"}),I.jsxs("div",{children:[I.jsx("p",{className:"text-sm text-muted-foreground",children:"R"}),I.jsx("p",{className:"text-xl font-bold",children:vt.length})]})]})})}),I.jsx(Rn,{className:"glass",children:I.jsx(Ln,{className:"p-4",children:I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(gl,{className:"w-8 h-8 text-purple-500"}),I.jsxs("div",{children:[I.jsx("p",{className:"text-sm text-muted-foreground",children:"&"}),I.jsx("p",{className:"text-xl font-bold text-green-400",children:dl(at)}),I.jsxs("div",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-2",children:[I.jsx(Do,{className:"w-4 h-4"}),I.jsx("span",{children:':0"a'}),I.jsxs("span",{children:[W.lat?W.lat.toFixed(6):"-",", ",W.lng?W.lng.toFixed(6):"-"]})]})]})]})})})]}),I.jsxs(Rn,{className:"glass card-hover mb-6",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(Do,{className:"w-5 h-5"}),'"SS']}),I.jsx(Rr,{children:'a:0!"0a`/9`~!a'})]}),I.jsxs(Ln,{children:[I.jsx("div",{style:{height:"360px"},children:I.jsx(Kk,{center:Ne,pickupCoord:wt,dropoffCoord:jt})}),Mt&&I.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["aa",Mt.pickup,"   ",Mt.dropoff]})]})]}),I.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[I.jsxs(Rn,{className:"glass card-hover",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(wp,{className:"w-5 h-5"}),"9&9}"]}),I.jsx(Rr,{children:" aS9&9RS0R9&90S}"})]}),I.jsx(Ln,{children:I.jsxs("div",{className:"space-y-3",children:[I.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border/50",children:[I.jsx("span",{children:":09&9"}),I.jsx(va,{className:Yc((t==null?void 0:t.status)||"offline"),children:Zl((t==null?void 0:t.status)||"offline")})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs(Cn,{variant:(t==null?void 0:t.status)==="idle"?"default":"outline",className:"w-full justify-start",onClick:()=>Le("idle"),disabled:N||ze.length>0,children:[I.jsx(cu,{className:"w-4 h-4 mr-2"}),"}0"]}),I.jsxs(Cn,{variant:(t==null?void 0:t.status)==="offline"?"default":"outline",className:"w-full justify-start",onClick:()=>Le("offline"),disabled:N||ze.length>0,children:[I.jsx(up,{className:"w-4 h-4 mr-2"}),":a}0"]})]}),ze.length>0&&I.jsx("div",{className:"text-sm text-muted-foreground bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:'S0SRaR":9&9'})]})})]}),I.jsxs(Rn,{className:"glass card-hover lg:col-span-2",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(Xl,{className:"w-5 h-5"}),'"0']}),I.jsx(Rr,{children:ze.length>0?'a"09"':":0S0Ra"})]}),I.jsx(Ln,{children:ze.length>0?I.jsx("div",{className:"space-y-4",children:ze.map(Oe=>I.jsxs("div",{className:"bg-background/30 rounded-lg p-4 border border-border",children:[I.jsxs("div",{className:"flex items-start justify-between mb-3",children:[I.jsxs("div",{children:[I.jsx(va,{className:Yc(Oe.status),children:Zl(Oe.status)}),I.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:['"xa',Oe.id]})]}),I.jsxs("div",{className:"text-right",children:[I.jsx("p",{className:"font-semibold text-green-400",children:dl(Oe.estimatedPrice)}),I.jsx("p",{className:"text-xs text-muted-foreground",children:"&"})]})]}),I.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm min-w-0",children:[I.jsx(Do,{className:"w-4 h-4 text-green-500"}),I.jsx("span",{className:"text-muted-foreground",children:"``a"}),I.jsx("span",{className:"truncate",children:Oe.pickup})]}),I.jsxs("div",{className:"flex items-center gap-2 text-sm min-w-0",children:[I.jsx(lh,{className:"w-4 h-4 text-red-500"}),I.jsx("span",{className:"text-muted-foreground",children:"9`a"}),I.jsx("span",{className:"truncate",children:Oe.dropoff})]}),I.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[I.jsx(Xl,{className:"w-4 h-4 text-blue-500"}),I.jsx("span",{className:"text-muted-foreground",children:'"a'}),I.jsx("span",{children:Xp(Oe.createdAt)})]})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm min-w-0",children:[I.jsx(ly,{className:"w-4 h-4 text-purple-500"}),I.jsx("span",{className:"text-muted-foreground",children:"a"}),I.jsx("span",{className:"truncate",children:Oe.passengerPhone})]}),I.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[I.jsx(Vb,{className:"w-4 h-4 text-orange-500"}),I.jsx("span",{className:"text-muted-foreground",children:":"})]})]})]}),I.jsxs("div",{className:"flex gap-2",children:[I.jsx(Cn,{variant:fe?"secondary":"default",onClick:()=>pe(!fe),children:fe?"":""}),I.jsxs(Cn,{variant:"success",className:"flex-1",onClick:()=>xt(Oe.id),disabled:N,children:[I.jsx(cu,{className:"w-4 h-4 mr-2"}),"R"]})]})]},Oe.id))}):I.jsxs("div",{className:"text-center py-8",children:[I.jsx(gl,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),I.jsx("p",{className:"text-muted-foreground",children:":0S0Ra"}),I.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:(t==null?void 0:t.status)==="idle"?"a9&9R}":"9!9&9}"})]})})]})]}),I.jsxs(Rn,{className:"glass card-hover mt-6",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(E_,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:"a0S0RR&"})]}),I.jsx(Ln,{children:e.length>0?I.jsxs("div",{className:"space-y-3",children:[e.slice(0,10).map(Oe=>{var We;return I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg border border-border/50",children:[I.jsxs("div",{className:"flex-1",children:[I.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[I.jsx(va,{className:Yc(Oe.status),size:"sm",children:Zl(Oe.status)}),I.jsx("span",{className:"text-sm text-muted-foreground",children:Xp(Oe.createdAt)})]}),I.jsxs("div",{className:"text-sm",children:[I.jsx("span",{className:"text-muted-foreground",children:"aa"}),Oe.pickup,"   ",Oe.dropoff]}),I.jsxs("div",{className:"text-sm",children:[I.jsx("span",{className:"text-muted-foreground",children:"a"}),Oe.passengerPhone]}),(We=Oe.review)!=null&&We.rating?I.jsxs("div",{className:"text-sm flex items-center gap-1 text-yellow-400 mt-1",children:[I.jsx(DS,{className:"w-4 h-4"}),I.jsxs("span",{children:['" a',Oe.review.rating," x"]})]}):null]}),I.jsxs("div",{className:"text-right",children:[I.jsx("div",{className:`font-semibold ${Oe.status==="completed"?"text-green-400":"text-muted-foreground"}`,children:dl(Oe.estimatedPrice)}),I.jsx("div",{className:"text-xs text-muted-foreground",children:Oe.id.slice(-8)})]})]},Oe.id)}),e.length>10&&I.jsx("div",{className:"text-center pt-4",children:I.jsxs("p",{className:"text-sm text-muted-foreground",children:["S 10  RR& ",e.length," "]})})]}):I.jsxs("div",{className:"text-center py-8",children:[I.jsx(E_,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),I.jsx("p",{className:"text-muted-foreground",children:'S0"R'}),I.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"9&9RRS99}"})]})})]})]})})}function A6(){const[t,e]=se.useState(""),[i,l]=se.useState(""),[f,v]=se.useState(!1),[g,c]=se.useState({lat:25.033964,lng:121.564468}),[A,N]=se.useState(null),[Z,W]=se.useState(null),[K,J]=se.useState({distanceMeters:0,durationSeconds:0,polylinePath:[]}),[ce,ie]=se.useState("osm"),[oe,re]=se.useState(!1),[$,te]=se.useState(!1),{user:fe,orders:pe,currentOrder:Ie,loading:Ge,requestRide:Le,loadOrders:xt,logout:ct}=_l(),{toast:ht}=sc(),ze=vh();se.useEffect(()=>{fe!=null&&fe.phone&&xt(fe.phone)},[fe]),se.useEffect(()=>{async function Ne(){try{const Oe=await fetch("https://ipapi.co/json/");if(Oe.ok){const We=await Oe.json(),nt=Number(We==null?void 0:We.latitude),_t=Number(We==null?void 0:We.longitude);if(nt&&_t){const Bt={lat:nt,lng:_t};c(Bt),N(Bt),t||e(""),te(!0);return}}}catch{}try{const Oe=await fetch("http://ip-api.com/json");if(Oe.ok){const We=await Oe.json(),nt=Number(We==null?void 0:We.lat),_t=Number(We==null?void 0:We.lon);if(nt&&_t){const Bt={lat:nt,lng:_t};c(Bt),N(Bt),t||e(""),te(!0)}}}catch{}}if(!(navigator!=null&&navigator.geolocation)){Ne();return}navigator.geolocation.getCurrentPosition(Oe=>{const{latitude:We,longitude:nt}=Oe.coords||{};if(We&&nt){const _t={lat:We,lng:nt};c(_t),N(_t),t||e("")}},Oe=>{console.warn("",Oe),re(!0),Ne()},{enableHighAccuracy:!0,timeout:8e3,maximumAge:3e4})},[]);async function vt(Ne){if(!Ne||!Ne.trim())return null;try{const Oe=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(Ne.trim())}`,nt=await(await fetch(Oe)).json(),_t=nt==null?void 0:nt[0];if(_t)return{lat:Number(_t.lat),lng:Number(_t.lon)}}catch(Oe){console.warn("",Oe)}return null}const at=async Ne=>{if(Ne.preventDefault(),!A||!t.trim()||!i.trim()){ht({title:"",description:"",variant:"destructive"});return}v(!0);try{const Oe=Math.round(((K==null?void 0:K.distanceMeters)||0)/1e3*20+85),We=await Le({passengerPhone:fe.phone,pickup:t.trim(),dropoff:i.trim(),pickup_lat:A==null?void 0:A.lat,pickup_lng:A==null?void 0:A.lng,dropoff_lat:Z==null?void 0:Z.lat,dropoff_lng:Z==null?void 0:Z.lng,estimated_distance_meters:K==null?void 0:K.distanceMeters,estimated_duration_seconds:K==null?void 0:K.durationSeconds,estimated_price:Oe,map_provider:ce});ht({title:"",description:`: ${We.driver.name}`,variant:"success"}),e(""),l(""),N(null),W(null),J({distanceMeters:0,durationSeconds:0,polylinePath:[]}),xt(fe.phone)}catch(Oe){console.error("",Oe),ht({title:"",description:Oe.message,variant:"destructive"})}finally{v(!1)}},Mt=async()=>{try{await ct()}catch{}ht({title:"...",description:" Black Feather ",variant:"success"}),setTimeout(()=>{try{ze("/")}catch{window.location.href="/"}},1500)},wt=()=>{xt(fe.phone),ht({title:"",description:"",variant:"success"})},jt=pe.filter(Ne=>Ne.status==="requested");return pe.filter(Ne=>Ne.status==="completed"),I.jsx("div",{className:"min-h-screen p-4",children:I.jsxs("div",{className:"max-w-6xl mx-auto",children:[I.jsxs("div",{className:"flex items-center justify-between mb-6",children:[I.jsxs("div",{children:[I.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:""}),I.jsxs("p",{className:"text-gray-300",children:["",fe==null?void 0:fe.name," ",fe==null?void 0:fe.phone,""]})]}),I.jsxs("div",{className:"flex gap-2",children:[I.jsxs(Cn,{variant:"outline",onClick:wt,disabled:Ge,children:[I.jsx(Kp,{className:`w-4 h-4 mr-2 ${Ge?"animate-spin":""}`}),""]}),I.jsxs(Cn,{variant:"destructive",onClick:Mt,children:[I.jsx(Ub,{className:"w-4 h-4 mr-2"}),""]})]})]}),I.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[I.jsxs(Rn,{className:"glass card-hover lg:col-span-1",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(lh,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:I.jsxs("form",{onSubmit:at,className:"space-y-4",children:[I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[I.jsx(Do,{className:"w-4 h-4"}),""]}),I.jsx(nr,{placeholder:"",value:t,list:"popular-spots",onChange:async Ne=>{const Oe=Ne.target.value;e(Oe);const We=await vt(Oe);We&&(N(We),c(We))},className:"bg-background/50",disabled:f})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[I.jsx(lh,{className:"w-4 h-4"}),""]}),I.jsx(nr,{placeholder:"",value:i,list:"popular-spots",onChange:async Ne=>{const Oe=Ne.target.value;l(Oe);const We=await vt(Oe);We&&W(We)},className:"bg-background/50",disabled:f})]}),I.jsx(Cn,{type:"submit",className:"w-full btn-primary",disabled:f||jt.length>0||!A,children:f?I.jsxs(I.Fragment,{children:[I.jsx(Kp,{className:"w-4 h-4 mr-2 animate-spin"}),"..."]}):jt.length>0?"":""}),I.jsxs("datalist",{id:"popular-spots",children:[I.jsx("option",{value:""}),I.jsx("option",{value:""}),I.jsx("option",{value:" 101"}),I.jsx("option",{value:""}),I.jsx("option",{value:""})]})]})})]}),I.jsxs(Rn,{className:"glass card-hover lg:col-span-2",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(Do,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsxs(Ln,{children:[I.jsx("div",{className:"w-full h-[420px] border rounded overflow-hidden",children:I.jsx(Kk,{center:g,pickupCoord:A,dropoffCoord:Z,onRouteUpdate:Ne=>J(Ne),onTileError:()=>ie("maplibre")})}),I.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 text-sm",children:[I.jsxs("div",{className:"p-3 rounded border bg-background/30",children:[I.jsx("div",{className:"text-muted-foreground",children:""}),I.jsx("div",{className:"font-semibold",children:((K==null?void 0:K.distanceMeters)||0)>0?`${(K.distanceMeters/1e3).toFixed(2)} `:""})]}),I.jsxs("div",{className:"p-3 rounded border bg-background/30",children:[I.jsx("div",{className:"text-muted-foreground",children:""}),I.jsx("div",{className:"font-semibold",children:((K==null?void 0:K.durationSeconds)||0)>0?`${Math.round(K.durationSeconds/60)} `:""})]}),I.jsxs("div",{className:"p-3 rounded border bg-background/30",children:[I.jsx("div",{className:"text-muted-foreground",children:""}),I.jsx("div",{className:"font-semibold",children:dl(Math.round(((K==null?void 0:K.distanceMeters)||0)/1e3*20+85))})]})]}),oe&&I.jsx("div",{className:"text-xs text-yellow-400 mt-2",children:""}),$&&I.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:" IP "}),ce==="maplibre"&&I.jsx("div",{className:"text-xs text-yellow-400 mt-2",children:""})]})]}),I.jsxs(Rn,{className:"glass card-hover lg:col-span-2",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(Xl,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:jt.length>0?"":""})]}),I.jsx(Ln,{children:jt.length>0?I.jsx("div",{className:"space-y-4",children:jt.map(Ne=>I.jsxs("div",{className:"bg-background/30 rounded-lg p-4 border border-border",children:[I.jsxs("div",{className:"flex items-start justify-between mb-3",children:[I.jsxs("div",{children:[I.jsx(va,{className:Yc(Ne.status),children:Zl(Ne.status)}),I.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["",Ne.id]})]}),I.jsxs("div",{className:"text-right",children:[I.jsx("p",{className:"font-semibold text-primary",children:dl(Ne.estimatedPrice)}),I.jsx("p",{className:"text-xs text-muted-foreground",children:""})]})]}),I.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm min-w-0",children:[I.jsx(Do,{className:"w-4 h-4 text-green-500"}),I.jsx("span",{className:"text-muted-foreground",children:""}),I.jsx("span",{className:"truncate",children:Ne.pickup})]}),I.jsxs("div",{className:"flex items-center gap-2 text-sm min-w-0",children:[I.jsx(lh,{className:"w-4 h-4 text-red-500"}),I.jsx("span",{className:"text-muted-foreground",children:""}),I.jsx("span",{className:"truncate",children:Ne.dropoff})]}),I.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[I.jsx(Xl,{className:"w-4 h-4 text-blue-500"}),I.jsx("span",{className:"text-muted-foreground",children:""}),I.jsx("span",{children:Xp(Ne.createdAt)})]})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm min-w-0",children:[I.jsx(ly,{className:"w-4 h-4 text-purple-500"}),I.jsx("span",{className:"text-muted-foreground",children:""}),I.jsx("span",{className:"truncate",children:Ne.driverName})]}),I.jsxs("div",{className:"flex items-center gap-2 text-sm min-w-0",children:[I.jsx(Vb,{className:"w-4 h-4 text-orange-500"}),I.jsx("span",{className:"text-muted-foreground",children:""}),I.jsx("span",{className:"truncate",children:Ne.driverPhone})]})]})]})]},Ne.id))}):I.jsxs("div",{className:"text-center py-8",children:[I.jsx(gl,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),I.jsx("p",{className:"text-muted-foreground",children:""}),I.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:""})]})})]})]}),I.jsxs(Rn,{className:"glass card-hover mt-6",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(E_,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:pe.length>0?I.jsxs("div",{className:"space-y-3",children:[pe.slice(0,10).map(Ne=>I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg border border-border/50",children:[I.jsxs("div",{className:"flex-1",children:[I.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[I.jsx(va,{className:Yc(Ne.status),size:"sm",children:Zl(Ne.status)}),I.jsx("span",{className:"text-sm text-muted-foreground",children:Xp(Ne.createdAt)})]}),I.jsxs("div",{className:"text-sm",children:[I.jsx("span",{className:"text-muted-foreground",children:""}),Ne.pickup,"  ",Ne.dropoff]}),I.jsxs("div",{className:"text-sm",children:[I.jsx("span",{className:"text-muted-foreground",children:""}),Ne.driverName]})]}),I.jsxs("div",{className:"text-right",children:[I.jsx("div",{className:"font-semibold",children:dl(Ne.estimatedPrice)}),I.jsx("div",{className:"text-xs text-muted-foreground",children:Ne.id.slice(-8)})]})]},Ne.id)),pe.length>10&&I.jsx("div",{className:"text-center pt-4",children:I.jsxs("p",{className:"text-sm text-muted-foreground",children:[" 10  ",pe.length," "]})})]}):I.jsxs("div",{className:"text-center py-8",children:[I.jsx(E_,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),I.jsx("p",{className:"text-muted-foreground",children:""}),I.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:""})]})})]})]})})}let Cg=null;function aw({apiKey:t,libraries:e=[]}={}){return typeof window<"u"&&window.google&&window.google.maps?Promise.resolve(window.google.maps):Cg||(Cg=new Promise((i,l)=>{const f=document.createElement("script"),v=e.length>0?`&libraries=${e.join(",")}`:"";f.src=`https://maps.googleapis.com/maps/api/js?key=${t}${v}`,f.async=!0,f.defer=!0,f.onload=()=>{window.google&&window.google.maps?i(window.google.maps):l(new Error("Google Maps "))},f.onerror=()=>l(new Error("Google Maps Script ")),document.head.appendChild(f)}),Cg)}let sx=null;async function R6(){if(sx)return sx;const t=await g0(()=>Promise.resolve().then(()=>p6),void 0,import.meta.url);try{await g0(()=>Promise.resolve().then(()=>P6),void 0,import.meta.url)}catch{}return sx=t,t}async function L6(){return typeof window<"u"&&window.mapboxgl?window.mapboxgl:new Promise((t,e)=>{const i=document.createElement("link");i.rel="stylesheet",i.href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css",document.head.appendChild(i);const l=document.createElement("script");l.src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js",l.async=!0,l.onload=()=>t(window.mapboxgl),l.onerror=()=>e(new Error("Mapbox ")),document.head.appendChild(l)})}function z6({center:t,markers:e=[],polylines:i=[],onClick:l,zoom:f=14}){const v=se.useRef(null),g=se.useRef(null),c=se.useRef({markers:new Map,polylines:new Map}),A=se.useRef("google"),N=se.useRef(null),Z=se.useRef(null),W=se.useRef(null);se.useEffect(()=>{let $=!1;async function te(){if("google".toLowerCase()==="mapbox")try{const pe=await L6();if($)return;pe.accessToken="";const Ie=new pe.Map({container:v.current,style:"mapbox://styles/mapbox/streets-v12",center:[(t==null?void 0:t.lng)??121.564468,(t==null?void 0:t.lat)??25.033964],zoom:f});N.current=Ie,A.current="mapbox",l&&Ie.on("click",Ge=>{const Le=Ge.lngLat;l({lat:Le.lat,lng:Le.lng})}),J(pe),ie(pe);return}catch(pe){console.warn("Mapbox  Google Maps",pe)}try{const pe="";if(!pe)throw _0({title:"",description:"Google Maps API key  Leaflet",variant:"destructive"}),new Error("Missing Google Maps API key");const Ie=await aw({apiKey:pe,libraries:["places"]});if($)return;const Ge=new Ie.Map(v.current,{center:t||{lat:25.033964,lng:121.564468},zoom:f,disableDefaultUI:!1});g.current=Ge,A.current="google",l&&Ge.addListener("click",Le=>{l({lat:Le.latLng.lat(),lng:Le.latLng.lng()})}),K(window.google.maps),ce(window.google.maps)}catch(pe){console.warn("Google Maps  Leaflet",pe),_0({title:"",description:"Google Maps  Leaflet ",variant:"destructive"});const Ie=await R6();if(W.current=Ie,$)return;const Ge=Ie.map(v.current).setView([(t==null?void 0:t.lat)??25.033964,(t==null?void 0:t.lng)??121.564468],f);Ie.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(Ge),N.current=null,g.current=null,Z.current=Ge,A.current="leaflet",l&&Ge.on("click",Le=>{l({lat:Le.latlng.lat,lng:Le.latlng.lng})}),oe(),re()}}return te(),()=>{$=!0}},[]),se.useEffect(()=>{var $;if(A.current==="mapbox"){if(!N.current||!window.mapboxgl)return;J(window.mapboxgl)}else if(A.current==="google"){if(!g.current||!(($=window.google)!=null&&$.maps))return;K(window.google.maps)}else oe()},[e]),se.useEffect(()=>{var $;if(A.current==="mapbox"){if(!N.current||!window.mapboxgl)return;ie()}else if(A.current==="google"){if(!g.current||!(($=window.google)!=null&&$.maps))return;ce(window.google.maps)}else re()},[i]);function K($){const te=g.current,fe=c.current.markers;for(const[pe,Ie]of fe.entries())e.find(Ge=>Ge.id===pe)||(Ie.setMap(null),fe.delete(pe));e.forEach(pe=>{let Ie=fe.get(pe.id);Ie?(Ie.setPosition(pe.position),pe.label&&Ie.setLabel(pe.label)):(Ie=new $.Marker({position:pe.position,map:te,label:pe.label}),fe.set(pe.id,Ie))})}function J($){const te=N.current;if(!te)return;const fe=c.current.markers;for(const[pe,Ie]of fe.entries())e.find(Ge=>Ge.id===pe)||(Ie.remove(),fe.delete(pe));e.forEach(pe=>{let Ie=fe.get(pe.id);Ie?Ie.setLngLat([pe.position.lng,pe.position.lat]):(Ie=new $.Marker().setLngLat([pe.position.lng,pe.position.lat]).addTo(te),fe.set(pe.id,Ie))})}function ce($){const te=g.current,fe=c.current.polylines;for(const[pe,Ie]of fe.entries())i.find(Ge=>Ge.id===pe)||(Ie.setMap(null),fe.delete(pe));i.forEach(pe=>{let Ie=fe.get(pe.id);Ie?(Ie.setPath(pe.path),pe.color&&Ie.setOptions({strokeColor:pe.color})):(Ie=new $.Polyline({path:pe.path,strokeColor:pe.color||"#00aaff",strokeWeight:4}),Ie.setMap(te),fe.set(pe.id,Ie))})}function ie($){const te=N.current;if(!te)return;const fe=c.current.polylines;for(const[pe,Ie]of fe.entries())i.find(Ge=>Ge.id===pe)||(te.getLayer(Ie)&&te.removeLayer(Ie),te.getSource(Ie)&&te.removeSource(Ie),fe.delete(pe));i.forEach(pe=>{let Ie=fe.get(pe.id);const Ge={type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:pe.path.map(Le=>[Le.lng,Le.lat])}}};if(!Ie)Ie=`poly_${pe.id}`,fe.set(pe.id,Ie),te.getSource(Ie)&&te.removeSource(Ie),te.addSource(Ie,Ge),te.addLayer({id:Ie,type:"line",source:Ie,paint:{"line-color":pe.color||"#00aaff","line-width":4}});else{const Le=te.getSource(Ie);Le&&Le.setData(Ge.data)}})}function oe(){const $=Z.current,te=W.current;if(!$||!te)return;const fe=c.current.markers;for(const[pe,Ie]of fe.entries())e.find(Ge=>Ge.id===pe)||(Ie.remove(),fe.delete(pe));e.forEach(pe=>{let Ie=fe.get(pe.id);Ie?Ie.setLatLng([pe.position.lat,pe.position.lng]):(Ie=te.marker([pe.position.lat,pe.position.lng]).addTo($),fe.set(pe.id,Ie))})}function re(){const $=Z.current,te=W.current;if(!$||!te)return;const fe=c.current.polylines;for(const[pe,Ie]of fe.entries())i.find(Ge=>Ge.id===pe)||(Ie.remove(),fe.delete(pe));i.forEach(pe=>{let Ie=fe.get(pe.id);const Ge=pe.path.map(Le=>[Le.lat,Le.lng]);Ie?(Ie.setLatLngs(Ge),(pe.color||pe.strokeWeight)&&Ie.setStyle({color:pe.color||"#00aaff",weight:pe.strokeWeight||4})):(Ie=te.polyline(Ge,{color:pe.color||"#00aaff",weight:pe.strokeWeight||4}).addTo($),fe.set(pe.id,Ie))})}return I.jsx("div",{ref:v,className:"w-full h-full min-h-[320px] rounded-xl overflow-hidden border border-border/50"})}function lw({center:t,markers:e=[],polylines:i=[],onClick:l,zoom:f=14}){return I.jsx(z6,{center:t,markers:e,polylines:i,onClick:l,zoom:f})}function D6(){const{user:t,requestRide:e}=_l(),{toast:i}=sc(),[l,f]=se.useState(""),[v,g]=se.useState(""),[c,A]=se.useState(""),[N,Z]=se.useState("standard"),W=100,[K,J]=se.useState(!1),[ce,ie]=se.useState(!1),[oe,re]=se.useState(!1),[$,te]=se.useState({lat:25.034,lng:121.564}),[fe,pe]=se.useState(null),[Ie,Ge]=se.useState(null),[Le,xt]=se.useState(null),[ct,ht]=se.useState(null),[ze,vt]=se.useState(""),[at,Mt]=se.useState(null),[wt,jt]=se.useState(null),[Ne,Oe]=se.useState([]),[We,nt]=se.useState(null),[_t,Bt]=se.useState([]),[Ft,Ut]=se.useState([]),Pt=se.useRef(null),Un=se.useRef(null),Vn=se.useRef(null),yi=se.useRef(null),ws=se.useRef(null),Ts=se.useRef(null);se.useRef(0),se.useRef(0),se.useEffect(()=>{let Vt=!0;return aw({apiKey:"",libraries:["places"]}).then(()=>{Vt&&(Pt.current=new google.maps.DirectionsService,Un.current=new google.maps.Geocoder,Vn.current=new google.maps.DistanceMatrixService,navigator.geolocation&&navigator.geolocation.getCurrentPosition(_n=>{const mn={lat:_n.coords.latitude,lng:_n.coords.longitude};te(mn),pe(mn),Bt([{id:"pickup",position:mn,title:"",label:""}])},()=>{i({title:"",variant:"destructive"})}))}).catch(_n=>{console.warn("Google Maps ",_n)}),()=>{Vt=!1}},[]);const xr=Vt=>{Ge(Vt),Bt(_n=>[..._n.filter(dr=>dr.id!=="dropoff"),{id:"dropoff",position:Vt,title:"",label:""}])},In=async Vt=>{var Ai;if(!Un.current)return null;const _n=await Un.current.geocode({address:Vt}),mn=(Ai=_n==null?void 0:_n.results)==null?void 0:Ai[0];if(!mn)return null;const dr=mn.geometry.location;return{lat:dr.lat(),lng:dr.lng()}},$n=async()=>{var Vt,_n,mn,dr,Ai,Gi,xi,Ss;if(Pt.current){if(!l&&!fe){i({title:"",variant:"destructive"});return}if(!v&&!Ie){i({title:"",variant:"destructive"});return}re(!0);try{const li=fe||await In(l),Hn=Ie||await In(v);if(!li||!Hn)throw new Error("");pe(li),Ge(Hn),Bt([{id:"pickup",position:li,title:"",label:""},{id:"dropoff",position:Hn,title:"",label:""}]);let br=null,Kn=null;if(Vn.current)try{const et=await new Promise((bt,Ct)=>{Vn.current.getDistanceMatrix({origins:[li],destinations:[Hn],travelMode:google.maps.TravelMode.DRIVING},(De,Ht)=>{Ht==="OK"?bt(De):Ct(new Error(`DistanceMatrix : ${Ht}`))})}),Ye=(mn=(_n=(Vt=et==null?void 0:et.rows)==null?void 0:Vt[0])==null?void 0:_n.elements)==null?void 0:mn[0];Ye&&Ye.status==="OK"&&Ye.distance&&Ye.duration&&(br=Ye.distance.value,Kn=Ye.duration.value)}catch{}let Ce=null;try{Ce=await new Promise((et,Ye)=>{Pt.current.route({origin:li,destination:Hn,travelMode:google.maps.TravelMode.DRIVING},(bt,Ct)=>{Ct==="OK"?et(bt):Ye(new Error(`Directions : ${Ct}`))})})}catch{br||(br=Math.round(((Ct,De)=>{const Ht=wr=>wr*Math.PI/180,St=Ht(De.lat-Ct.lat),on=Ht(De.lng-Ct.lng),ir=Ht(Ct.lat),Zn=Ht(De.lat),Xn=Math.sin(St/2)**2+Math.cos(ir)*Math.cos(Zn)*Math.sin(on/2)**2;return 12742e3*Math.asin(Math.sqrt(Xn))})(li,Hn))),Kn||(Kn=Math.round(br/1e3/30*3600));const bt=[li,Hn];Ut([{id:"route",path:bt,color:"#22c55e",strokeWeight:4}]),xt({distanceMeters:br,durationSeconds:Kn,estimatedPrice:null,path:bt}),Ce=null}const X=(Gi=(Ai=(dr=Ce==null?void 0:Ce.routes)==null?void 0:dr[0])==null?void 0:Ai.legs)==null?void 0:Gi[0];X&&(!br||!Kn)&&(br=X.distance.value,Kn=X.duration.value);const Y=br/1e3,ae=Kn/60,ye=70,we=15,Me=3,je=Y>20?(Y-20)*10:0;let ke=Math.round(ye+Y*we+ae*Me+je);const He=N==="premium"&&K?W:0;if((Ss=(xi=Ce==null?void 0:Ce.routes)==null?void 0:xi[0])!=null&&Ss.overview_path){const et=Ce.routes[0].overview_path.map(Ye=>({lat:Ye.lat(),lng:Ye.lng()}));Ut([{id:"route",path:et,color:"#22c55e",strokeWeight:4}]),xt({distanceMeters:br,durationSeconds:Kn,estimatedPrice:ke,deposit:He,path:et,serviceType:N})}else xt(et=>({...et,estimatedPrice:ke,deposit:He,serviceType:N}));i({title:"",description:` ${Y.toFixed(1)}  ${Math.ceil(ae)}  $${ke}${He?` $${He}`:""}`,variant:"success"})}catch(li){i({title:"",description:li.message,variant:"destructive"})}finally{re(!1)}}},vi=async()=>{if(!t){i({title:"???",description:"??????",variant:"destructive"});return}if(!fe||!Ie||!Le){i({title:"??????",description:"????????????",variant:"destructive"});return}ie(!0);try{const Vt=await e({passengerPhone:t.phone,pickup:l||"????",dropoff:v||"???",pickup_lat:fe==null?void 0:fe.lat,pickup_lng:fe==null?void 0:fe.lng,dropoff_lat:Ie==null?void 0:Ie.lat,dropoff_lng:Ie==null?void 0:Ie.lng,estimated_distance_meters:Le==null?void 0:Le.distanceMeters,estimated_duration_seconds:Le==null?void 0:Le.durationSeconds,estimated_price:Le==null?void 0:Le.estimatedPrice,service_type:N,deposit:(Le==null?void 0:Le.deposit)||0,notes:c,map_provider:"google"}),_n=(Vt==null?void 0:Vt.order)||null,mn=(Vt==null?void 0:Vt.driver)||null;if(!_n)throw new Error("??????");ht(_n),vt("????"),mn&&Mt({id:mn.id,name:mn.name,phone:mn.phone});const dr=mn?"?????: "+((mn==null?void 0:mn.name)||""):"????????";i({title:"????",description:dr,variant:"success"})}catch(Vt){i({title:"????",description:Vt.message,variant:"destructive"})}finally{ie(!1)}};se.useEffect(()=>()=>{var Vt,_n,mn;try{(Vt=yi.current)==null||Vt.unsubscribe()}catch{}try{(_n=ws.current)==null||_n.unsubscribe()}catch{}try{(mn=Ts.current)==null||mn.unsubscribe()}catch{}},[]);const Dr=se.useMemo(()=>{if(!Le)return null;const Vt=(Le.distanceMeters/1e3).toFixed(1),_n=Math.ceil(Le.durationSeconds/60);return{km:Vt,min:_n,price:Le.estimatedPrice,deposit:Le.deposit||0}},[Le]);return I.jsx("div",{className:"p-4 max-w-6xl mx-auto",children:I.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[I.jsxs(Rn,{className:"glass card-hover lg:col-span-1",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(lh,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[I.jsx(Do,{className:"w-4 h-4"}),""]}),I.jsx(nr,{value:l,onChange:Vt=>f(Vt.target.value),placeholder:""})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[I.jsx(dI,{className:"w-4 h-4"}),""]}),I.jsx(nr,{value:v,onChange:Vt=>g(Vt.target.value),placeholder:""})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[I.jsx(gl,{className:"w-4 h-4"}),""]}),I.jsxs("select",{value:N,onChange:Vt=>Z(Vt.target.value),className:"w-full border bg-background/50 rounded px-3 py-2 text-sm",children:[I.jsx("option",{value:"standard",children:""}),I.jsx("option",{value:"premium",children:""})]}),N==="premium"&&I.jsxs("label",{className:"flex items-center gap-2 text-sm mt-2",children:[I.jsx("input",{type:"checkbox",checked:K,onChange:Vt=>J(Vt.target.checked)})," $",W]})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[I.jsx(Xl,{className:"w-4 h-4"}),""]}),I.jsx(nr,{value:c,onChange:Vt=>A(Vt.target.value),placeholder:""})]}),I.jsxs("div",{className:"flex gap-2",children:[I.jsx(Cn,{onClick:$n,disabled:oe,className:"btn-primary flex-1",children:oe?I.jsxs(I.Fragment,{children:[I.jsx(Kp,{className:"w-4 h-4 mr-2 animate-spin"})," ..."]}):""}),I.jsx(Cn,{onClick:vi,disabled:ce||!Le,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:ce?I.jsxs(I.Fragment,{children:[I.jsx(gl,{className:"w-4 h-4 mr-2 animate-spin"})," ..."]}):""})]}),Dr&&I.jsxs("div",{className:"text-sm text-muted-foreground",children:[" ",Dr.km,"  ",Dr.min,"  $",Dr.price,Dr.deposit?` $${Dr.deposit}`:""]}),ct&&I.jsxs("div",{className:"mt-3 p-3 bg-background/20 rounded-lg text-sm",children:[I.jsxs("div",{children:["",ze]}),at&&I.jsxs("div",{className:"mt-1",children:["",at.name,"",at.phone,""]}),wt&&I.jsxs("div",{className:"mt-1 text-muted-foreground",children:[" ",wt.distanceKm,"  ",wt.etaMin," "]}),typeof We=="number"&&We>0&&I.jsxs("div",{className:"mt-1 text-yellow-400",children:["",We," "]}),Ne.length>0&&I.jsxs("div",{className:"mt-2",children:[I.jsx("div",{className:"text-xs text-muted-foreground",children:""}),I.jsx("ul",{className:"mt-1 space-y-1",children:Ne.slice(0,5).map(Vt=>{var _n;return I.jsxs("li",{className:"text-xs",children:[I.jsxs("span",{className:"font-mono",children:["[",new Date(Vt.created_at).toLocaleTimeString(),"]"]})," ",Vt.event_type,(_n=Vt.payload)!=null&&_n.driver_name?`${Vt.payload.driver_name}`:""]},Vt.id)})})]})]})]})})]}),I.jsxs(Rn,{className:"glass card-hover lg:col-span-2",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(Do,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsxs(Ln,{children:[I.jsx("div",{style:{height:500},children:I.jsx(lw,{center:$,markers:_t,polylines:Ft,onClick:xr})}),I.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:""})]})]})]})})}function N6(){const{user:t}=_l(),{toast:e}=sc(),[i,l]=se.useState([]),[f,v]=se.useState(!1),[g,c]=se.useState({lat:25.034,lng:121.564}),[A,N]=se.useState([]),[Z,W]=se.useState([]),[K,J]=se.useState([]),[ce,ie]=se.useState({visible:!1,ride:null,countdown:30}),oe=se.useRef(null),re=se.useRef(null),[$,te]=se.useState(!0);se.useEffect(()=>{let ze=!0;if(aw().catch(()=>{}),navigator.geolocation){navigator.geolocation.getCurrentPosition(at=>{const Mt={lat:at.coords.latitude,lng:at.coords.longitude};ze&&c(Mt)});const vt=navigator.geolocation.watchPosition(at=>{c({lat:at.coords.latitude,lng:at.coords.longitude})});return()=>{ze=!1,navigator.geolocation.clearWatch(vt)}}return()=>{ze=!1}},[]);const fe=async()=>{if(t!=null&&t.phone){v(!0);try{if(error)throw error;l(data||[])}catch(ze){e({title:'0&"',description:ze.message,variant:"destructive"})}finally{v(!1)}}};se.useEffect(()=>(fe(),()=>{oe.current&&clearInterval(oe.current)}),[t==null?void 0:t.phone]),se.useEffect(()=>{const ze=()=>te(!0),vt=()=>te(!1);return window.addEventListener("online",ze),window.addEventListener("offline",vt),()=>{window.removeEventListener("online",ze),window.removeEventListener("offline",vt)}},[]),se.useEffect(()=>(re.current&&clearInterval(re.current),re.current=setInterval(async()=>{if(!(t!=null&&t.phone))return;const ze=i.some(vt=>["accepted","enroute","arrived"].includes(vt.status));try{await _s.updateDriverStatus({phone:t.phone,status:ze?"busy":"idle"})}catch{}},1e4),()=>{re.current&&clearInterval(re.current)}),[i,g.lat,g.lng,t==null?void 0:t.phone]);const pe=async ze=>{var vt;try{const at=(vt=window.google)==null?void 0:vt.maps;if(!at)return;const Mt=new at.DirectionsService,wt=nt=>{var Ft,Ut;const Bt=(((Ut=(Ft=nt.routes)==null?void 0:Ft[0])==null?void 0:Ut.overview_path)||[]).map(Pt=>({lat:Pt.lat(),lng:Pt.lng()}));W([{id:"route",path:Bt,color:"#00BFA5"}])},jt=ze.pickup_lat&&ze.pickup_lng?{lat:ze.pickup_lat,lng:ze.pickup_lng}:void 0,Ne=ze.dropoff_lat&&ze.dropoff_lng?{lat:ze.dropoff_lat,lng:ze.dropoff_lng}:void 0,Oe=g;if(ze.status==="assigned"||ze.status==="accepted"){if(!jt)return;Mt.route({origin:Oe,destination:jt,travelMode:at.TravelMode.DRIVING},(nt,_t)=>{_t==="OK"&&nt?wt(nt):W([{id:"route",path:[Oe,jt],color:"#00BFA5"}])})}else if(ze.status==="enroute"||ze.status==="arrived"){if(!jt||!Ne)return;Mt.route({origin:jt,destination:Ne,travelMode:at.TravelMode.DRIVING},(nt,_t)=>{_t==="OK"&&nt?wt(nt):W([{id:"route",path:[jt,Ne],color:"#00BFA5"}])})}const We=[];We.push({id:"driver",position:Oe,label:"x"}),jt&&We.push({id:"pickup",position:jt,label:"``"}),Ne&&(ze.status==="enroute"||ze.status==="arrived"||ze.status==="completed")&&We.push({id:"dropoff",position:Ne,label:":aS"}),N(We)}catch{}};se.useEffect(()=>{const ze=i.find(vt=>["assigned","accepted","enroute","arrived"].includes(vt.status));ze&&pe(ze)},[i,g.lat,g.lng]);const Ie=async ze=>{try{await _s.updateRideStatus({rideId:ze.id,nextStatus:"accepted",driverPhone:t.phone});try{await _s.updateDriverStatus({phone:t.phone,status:"busy"})}catch{}ie({visible:!1,ride:null,countdown:0}),e({title:"}",description:'9"!"0',variant:"success"}),fe()}catch(vt){e({title:'}"',description:vt.message,variant:"destructive"})}},Ge=async ze=>{try{const vt=await _s.updateRideStatus({rideId:ze.id,nextStatus:"requested"});ie({visible:!1,ride:null,countdown:0}),e({title:"9",description:"!0&!`",variant:"success"}),fe()}catch(vt){e({title:'9"',description:vt.message||"9R ",variant:"destructive"})}},Le=async ze=>{try{await _s.updateRideStatus({rideId:ze.id,nextStatus:"arrived"}),e({title:"",description:"```S~",variant:"success"}),fe()}catch(vt){e({title:':"',description:vt.message,variant:"destructive"})}},xt=async ze=>{try{await completeRide(ze.id,t.phone);try{await updateDriverStatus(t.phone,"idle")}catch{}e({title:"R9R",description:"Rx0",variant:"success"}),fe()}catch(vt){e({title:'R"',description:vt.message,variant:"destructive"})}},ct=ze=>{const vt=g!=null&&g.lat&&(g!=null&&g.lng)?`${g.lat},${g.lng}`:"",at=ze.status==="assigned"||ze.status==="accepted",Mt=at?ze.pickup_lat&&ze.pickup_lng?`${ze.pickup_lat},${ze.pickup_lng}`:null:ze.dropoff_lat&&ze.dropoff_lng?`${ze.dropoff_lat},${ze.dropoff_lng}`:null,wt=at?ze.pickup_location||null:ze.dropoff_location||null,jt=Mt||(wt?encodeURIComponent(wt):null);if(!jt)return null;const Ne="https://www.google.com/maps/dir/?api=1",Oe=[`destination=${jt}`,"travelmode=driving"];return vt&&Oe.unshift(`origin=${vt}`),`${Ne}&${Oe.join("&")}`},ht=ze=>{const vt=ct(ze);vt?window.open(vt,"_blank"):e({title:'"}',description:":aS``S~!`",variant:"destructive"})};return I.jsxs("div",{className:"p-4 max-w-6xl mx-auto",children:[I.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[I.jsxs(Rn,{className:"glass card-hover lg:col-span-2",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(gl,{className:"w-5 h-5"})," x}"]}),I.jsx(Rr,{children:" &a!RaR9"})]}),I.jsx(Ln,{children:i.length===0?I.jsx("div",{className:"text-center py-10 text-muted-foreground",children:':0S0&"" a'}):I.jsx("div",{className:"space-y-3",children:i.map(ze=>I.jsxs("div",{className:"p-3 bg-background/20 rounded-lg border border-border/50",children:[I.jsxs("div",{className:"flex items-center justify-between",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx(va,{size:"sm",children:ze.status}),I.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(ze.created_at).toLocaleString()})]}),I.jsxs("div",{className:"flex gap-2",children:[ze.status==="assigned"&&I.jsxs(I.Fragment,{children:[I.jsxs(Cn,{size:"sm",onClick:()=>Ie(ze),className:"btn-primary",children:[I.jsx(cu,{className:"w-4 h-4 mr-1"}),"}"]}),I.jsxs(Cn,{size:"sm",variant:"destructive",onClick:()=>Ge(ze),children:[I.jsx(zS,{className:"w-4 h-4 mr-1"}),"9"]})]}),ze.status==="accepted"&&I.jsxs(Cn,{size:"sm",onClick:()=>invokeWithAuth("update-ride-status",{rideId:ze.id,nextStatus:"enroute"}).then(()=>{e({title:'!"',description:"0",variant:"success"}),fe()}).catch(vt=>e({title:'!""',description:vt.message,variant:"destructive"})),children:[I.jsx(gl,{className:"w-4 h-4 mr-1"}),'!"']}),ze.status==="enroute"&&I.jsxs(Cn,{size:"sm",onClick:()=>Le(ze),children:[I.jsx(Xl,{className:"w-4 h-4 mr-1"}),"``~"]}),ze.status==="arrived"&&I.jsxs(Cn,{size:"sm",onClick:()=>xt(ze),className:"btn-primary",children:[I.jsx(cu,{className:"w-4 h-4 mr-1"}),"R"]}),I.jsxs(Cn,{size:"sm",variant:"outline",onClick:()=>ht(ze),children:[I.jsx(lh,{className:"w-4 h-4 mr-1"}),ze.status==="assigned"||ze.status==="accepted"?"}``~":"}:aS"]})]})]}),I.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[I.jsxs("div",{className:"flex items-center gap-1",children:[I.jsx(Do,{className:"w-4 h-4 text-green-500"}),ze.pickup_location]}),I.jsxs("div",{className:"flex items-center gap-1",children:[I.jsx(dI,{className:"w-4 h-4 text-red-500"}),ze.dropoff_location]}),I.jsxs("div",{children:[":a",((ze.estimated_distance_meters||0)/1e3).toFixed(1)," &!R"]}),I.jsxs("div",{children:["a$",ze.estimated_price||0]}),I.jsxs("div",{children:['S9"~~9a',ze.service_type||ze.serviceType||"standard"]}),(ze.deposit||0)>0&&I.jsxs("div",{children:["!a$",ze.deposit]})]})]},ze.id))})})]}),I.jsxs(Rn,{className:"glass card-hover lg:col-span-1",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(Do,{className:"w-5 h-5"}),"SS"]}),I.jsx(Rr,{children:"x!a"})]}),I.jsxs(Ln,{children:[I.jsx("div",{style:{height:500},children:I.jsx(lw,{center:g,markers:A,polylines:Z})}),I.jsxs("div",{className:"mt-4 p-3 bg-background/20 rounded-lg",children:[I.jsx("div",{className:"text-sm font-medium mb-2",children:'"`9'}),K.length===0?I.jsx("div",{className:"text-xs text-muted-foreground",children:":0S0`9"}):I.jsx("ul",{className:"space-y-1 text-xs",children:K.slice(0,8).map(ze=>I.jsxs("li",{children:[I.jsxs("span",{className:"font-mono",children:["[",new Date(ze.created_at).toLocaleTimeString(),"]"]})," ",ze.event_type]},ze.id))})]}),!$&&I.jsx("div",{className:"mt-2 p-2 rounded bg-red-50 text-red-600 text-xs",children:"aRS!"}),I.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:'}R0":}9"x Google Maps'})]})]})]}),ce.visible&&ce.ride&&I.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:I.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-4",children:[I.jsxs("div",{className:"flex items-center justify-between mb-2",children:[I.jsx("h3",{className:"text-lg font-semibold text-[#00BFA5]",children:""}),I.jsxs(va,{style:{backgroundColor:ce.countdown<=10?"#ef4444":"#00BFA5",color:"white"},children:['" ',ce.countdown,"s"]})]}),I.jsxs("div",{className:"space-y-2 text-sm",children:[I.jsxs("div",{children:["a",ce.ride.passenger_name||"S:"]}),I.jsxs("div",{children:["``a",ce.ride.pickup_location]}),I.jsxs("div",{children:[":aSa",ce.ride.dropoff_location]}),I.jsxs("div",{children:[":a",((ce.ride.estimated_distance_meters||0)/1e3).toFixed(1)," &!R"]}),I.jsxs("div",{children:["`!a$",ce.ride.estimated_price||0]}),I.jsxs("div",{children:['S9"~~9a',ce.ride.service_type||ce.ride.serviceType||"standard"]}),(ce.ride.deposit||0)>0&&I.jsxs("div",{children:["!a$",ce.ride.deposit]})]}),I.jsxs("div",{className:"flex gap-2 mt-4",children:[I.jsxs(Cn,{style:{backgroundColor:"#00BFA5",color:"white"},onClick:()=>{Ie(ce.ride)},children:[I.jsx(cu,{className:"w-4 h-4 mr-1"}),"}"]}),I.jsxs(Cn,{variant:"destructive",onClick:()=>{Ge(ce.ride)},children:[I.jsx(zS,{className:"w-4 h-4 mr-1"}),'9"']})]})]})})]})}function O6(){const{user:t,drivers:e,orders:i,stats:l,loading:f,loadDrivers:v,loadOrders:g,logout:c}=_l(),{toast:A}=sc(),[N,Z]=se.useState(!1),W=vh();se.useEffect(()=>{v(),g()},[]);const K=async()=>{Z(!0);try{await Promise.all([v(),g()]),A({title:"",description:"",variant:"success"})}catch($){A({title:"",description:$.message,variant:"destructive"})}finally{Z(!1)}},J=async()=>{try{await c()}catch{}A({title:"...",description:"",variant:"success"}),setTimeout(()=>{try{W("/")}catch{window.location.href="/"}},1500)},ce=i.filter($=>$.status==="completed").reduce(($,te)=>$+(te.estimatedPrice||0),0),ie=i.filter($=>{const te=new Date().toDateString(),fe=new Date($.createdAt).toDateString();return te===fe}),oe=i.slice(0,10),re=e.filter($=>$.status!=="offline");return I.jsx("div",{className:"min-h-screen p-4",children:I.jsxs("div",{className:"max-w-7xl mx-auto",children:[I.jsxs("div",{className:"flex items-center justify-between mb-6",children:[I.jsxs("div",{children:[I.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:""}),I.jsxs("p",{className:"text-gray-300",children:["Black Feather  - ",t==null?void 0:t.name]})]}),I.jsxs("div",{className:"flex gap-2",children:[I.jsxs(Cn,{variant:"outline",onClick:K,disabled:f||N,children:[I.jsx(Kp,{className:`w-4 h-4 mr-2 ${f||N?"animate-spin":""}`}),""]}),I.jsxs(Cn,{variant:"destructive",onClick:J,children:[I.jsx(Ub,{className:"w-4 h-4 mr-2"}),""]})]})]}),I.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[I.jsx(Rn,{className:"glass",children:I.jsx(Ln,{className:"p-4",children:I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(U3,{className:"w-8 h-8 text-blue-500"}),I.jsxs("div",{children:[I.jsx("p",{className:"text-sm text-muted-foreground",children:""}),I.jsx("p",{className:"text-2xl font-bold",children:e.length}),I.jsxs("p",{className:"text-xs text-muted-foreground",children:[": ",re.length]})]})]})})}),I.jsx(Rn,{className:"glass",children:I.jsx(Ln,{className:"p-4",children:I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(wp,{className:"w-8 h-8 text-green-500"}),I.jsxs("div",{children:[I.jsx("p",{className:"text-sm text-muted-foreground",children:""}),I.jsx("p",{className:"text-2xl font-bold",children:i.length}),I.jsxs("p",{className:"text-xs text-muted-foreground",children:[": ",ie.length]})]})]})})}),I.jsx(Rn,{className:"glass",children:I.jsx(Ln,{className:"p-4",children:I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(cu,{className:"w-8 h-8 text-purple-500"}),I.jsxs("div",{children:[I.jsx("p",{className:"text-sm text-muted-foreground",children:""}),I.jsx("p",{className:"text-2xl font-bold",children:i.filter($=>$.status==="completed").length}),I.jsxs("p",{className:"text-xs text-muted-foreground",children:[": ",i.filter($=>["requested","assigned","accepted","enroute","arrived"].includes($.status)).length]})]})]})})}),I.jsx(Rn,{className:"glass",children:I.jsx(Ln,{className:"p-4",children:I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(B3,{className:"w-8 h-8 text-orange-500"}),I.jsxs("div",{children:[I.jsx("p",{className:"text-sm text-muted-foreground",children:""}),I.jsx("p",{className:"text-2xl font-bold text-green-400",children:dl(ce)}),I.jsxs("p",{className:"text-xs text-muted-foreground",children:[": ",dl(ce/(i.filter($=>$.status==="completed").length||1))]})]})]})})})]}),I.jsxs(Bk,{defaultValue:"overview",className:"space-y-4",children:[I.jsxs(rw,{className:"grid w-full grid-cols-4",children:[I.jsxs(Jc,{value:"overview",children:[I.jsx(O3,{className:"w-4 h-4 mr-2"}),""]}),I.jsxs(Jc,{value:"drivers",children:[I.jsx(gl,{className:"w-4 h-4 mr-2"}),""]}),I.jsxs(Jc,{value:"orders",children:[I.jsx(Xl,{className:"w-4 h-4 mr-2"}),""]}),I.jsxs(Jc,{value:"realtime",children:[I.jsx(wp,{className:"w-4 h-4 mr-2"}),""]})]}),I.jsx(Qc,{value:"overview",className:"space-y-4",children:I.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[I.jsxs(Rn,{className:"glass card-hover",children:[I.jsxs(Mr,{children:[I.jsx(Ar,{children:""}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:I.jsxs("div",{className:"space-y-3",children:[I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),I.jsx("span",{children:""})]}),I.jsx("span",{className:"font-semibold",children:e.filter($=>$.status==="idle").length})]}),I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),I.jsx("span",{children:""})]}),I.jsx("span",{className:"font-semibold",children:e.filter($=>$.status==="busy").length})]}),I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),I.jsx("span",{children:""})]}),I.jsx("span",{className:"font-semibold",children:e.filter($=>$.status==="offline").length})]})]})})]}),I.jsxs(Rn,{className:"glass card-hover",children:[I.jsxs(Mr,{children:[I.jsx(Ar,{children:""}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:I.jsxs("div",{className:"space-y-3",children:[I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),I.jsx("span",{children:""})]}),I.jsx("span",{className:"font-semibold",children:i.filter($=>["requested","assigned","accepted","enroute","arrived"].includes($.status)).length})]}),I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),I.jsx("span",{children:""})]}),I.jsx("span",{className:"font-semibold",children:i.filter($=>$.status==="completed").length})]}),I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),I.jsx("span",{children:""})]}),I.jsx("span",{className:"font-semibold",children:ie.length})]})]})})]})]})}),I.jsx(Qc,{value:"drivers",className:"space-y-4",children:I.jsxs(Rn,{className:"glass card-hover",children:[I.jsxs(Mr,{children:[I.jsx(Ar,{children:""}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:e.length>0?I.jsx("div",{className:"space-y-3",children:e.map($=>{const te=i.filter(Ie=>Ie.driverPhone===$.phone),fe=te.filter(Ie=>Ie.status==="completed"),pe=fe.reduce((Ie,Ge)=>Ie+(Ge.estimatedPrice||0),0);return I.jsx("div",{className:"p-4 bg-background/20 rounded-lg border border-border/50",children:I.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[I.jsxs("div",{children:[I.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[I.jsx(ly,{className:"w-4 h-4"}),I.jsx("span",{className:"font-semibold",children:$.name}),I.jsx(va,{className:Yc($.status),size:"sm",children:Zl($.status)})]}),I.jsx("p",{className:"text-sm text-muted-foreground",children:bj($.phone)}),$.vehicle&&I.jsxs("p",{className:"text-sm text-muted-foreground",children:[$.vehicle.plate," - ",$.vehicle.model]})]}),I.jsxs("div",{className:"text-center",children:[I.jsx("p",{className:"text-lg font-semibold",children:te.length}),I.jsx("p",{className:"text-xs text-muted-foreground",children:""})]}),I.jsxs("div",{className:"text-center",children:[I.jsx("p",{className:"text-lg font-semibold",children:fe.length}),I.jsx("p",{className:"text-xs text-muted-foreground",children:""})]}),I.jsxs("div",{className:"text-center",children:[I.jsx("p",{className:"text-lg font-semibold text-green-400",children:dl(pe)}),I.jsx("p",{className:"text-xs text-muted-foreground",children:""})]})]})},$.phone)})}):I.jsxs("div",{className:"text-center py-8",children:[I.jsx(gl,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),I.jsx("p",{className:"text-muted-foreground",children:""})]})})]})}),I.jsx(Qc,{value:"orders",className:"space-y-4",children:I.jsxs(Rn,{className:"glass card-hover",children:[I.jsxs(Mr,{children:[I.jsx(Ar,{children:""}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:oe.length>0?I.jsxs("div",{className:"space-y-3",children:[oe.map($=>I.jsx("div",{className:"p-4 bg-background/20 rounded-lg border border-border/50",children:I.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[I.jsxs("div",{children:[I.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[I.jsx(va,{className:Yc($.status),size:"sm",children:Zl($.status)}),I.jsx("span",{className:"text-sm text-muted-foreground",children:Xp($.createdAt)})]}),I.jsxs("p",{className:"text-xs text-muted-foreground",children:["",$.id.slice(-8)]})]}),I.jsxs("div",{className:"space-y-1",children:[I.jsxs("div",{className:"flex items-center gap-1 text-sm min-w-0",children:[I.jsx(Do,{className:"w-3 h-3 text-green-500"}),I.jsx("span",{className:"truncate",children:$.pickup})]}),I.jsxs("div",{className:"flex items-center gap-1 text-sm min-w-0",children:[I.jsx(lh,{className:"w-3 h-3 text-red-500"}),I.jsx("span",{className:"truncate",children:$.dropoff})]})]}),I.jsxs("div",{className:"space-y-1",children:[I.jsxs("div",{className:"text-sm",children:[I.jsx("span",{className:"text-muted-foreground",children:""}),$.passengerPhone]}),I.jsxs("div",{className:"text-sm",children:[I.jsx("span",{className:"text-muted-foreground",children:""}),$.driverName]})]}),I.jsxs("div",{className:"text-right",children:[I.jsx("p",{className:"font-semibold text-green-400",children:dl($.estimatedPrice)}),I.jsx("p",{className:"text-xs text-muted-foreground",children:$.status==="completed"?"":""})]})]})},$.id)),i.length>10&&I.jsx("div",{className:"text-center pt-4",children:I.jsxs("p",{className:"text-sm text-muted-foreground",children:[" 10  ",i.length," "]})})]}):I.jsxs("div",{className:"text-center py-8",children:[I.jsx(Xl,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),I.jsx("p",{className:"text-muted-foreground",children:""})]})})]})}),I.jsx(Qc,{value:"realtime",className:"space-y-4",children:I.jsxs("div",{className:"grid xl:grid-cols-3 gap-6",children:[I.jsxs(Rn,{className:"glass card-hover xl:col-span-1",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(wp,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsx("span",{children:""}),I.jsx("span",{className:"font-semibold text-green-400",children:re.length})]}),I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsx("span",{children:""}),I.jsx("span",{className:"font-semibold text-blue-400",children:e.filter($=>$.status==="idle").length})]}),I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsx("span",{children:""}),I.jsx("span",{className:"font-semibold text-orange-400",children:i.filter($=>["requested","assigned","accepted","enroute","arrived"].includes($.status)).length})]}),I.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/20 rounded-lg",children:[I.jsx("span",{children:""}),I.jsx("span",{className:"font-semibold text-purple-400",children:ie.length})]})]})})]}),I.jsxs(Rn,{className:"glass card-hover xl:col-span-2",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(Do,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:I.jsx(j6,{drivers:re,orders:i.filter($=>["requested","assigned","accepted","enroute","arrived"].includes($.status))})})]}),I.jsxs(Rn,{className:"glass card-hover xl:col-span-3",children:[I.jsxs(Mr,{children:[I.jsxs(Ar,{className:"flex items-center gap-2",children:[I.jsx(up,{className:"w-5 h-5"}),""]}),I.jsx(Rr,{children:""})]}),I.jsx(Ln,{children:I.jsxs("div",{className:"space-y-3",children:[e.filter($=>$.status==="idle").length===0&&I.jsxs("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx(up,{className:"w-4 h-4 text-yellow-500"}),I.jsx("span",{className:"text-sm",children:""})]}),I.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),i.filter($=>["requested","assigned","accepted","enroute","arrived"].includes($.status)).length>5&&I.jsxs("div",{className:"p-3 bg-orange-500/10 border border-orange-500/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx(up,{className:"w-4 h-4 text-orange-500"}),I.jsx("span",{className:"text-sm",children:""})]}),I.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),e.filter($=>$.status==="offline").length>e.length*.5&&I.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx(up,{className:"w-4 h-4 text-red-500"}),I.jsx("span",{className:"text-sm",children:""})]}),I.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),e.filter($=>$.status==="idle").length>0&&i.filter($=>["requested","assigned","accepted","enroute","arrived"].includes($.status)).length===0&&e.filter($=>$.status==="offline").length<=e.length*.5&&I.jsxs("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:[I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx(cu,{className:"w-4 h-4 text-green-500"}),I.jsx("span",{className:"text-sm",children:""})]}),I.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]})]})})]})]})})]})]})})}function j6({drivers:t,orders:e}){const i=se.useMemo(()=>{const v=(t||[]).filter(c=>c.lat&&c.lng).map(c=>({id:`driver-${c.phone}`,position:{lat:Number(c.lat),lng:Number(c.lng)},label:` ${c.name}`})),g=(e||[]).flatMap(c=>{const A=[];return c.pickup_lat&&c.pickup_lng&&A.push({id:`order-${c.id}-pickup`,position:{lat:Number(c.pickup_lat),lng:Number(c.pickup_lng)},label:""}),c.dropoff_lat&&c.dropoff_lng&&A.push({id:`order-${c.id}-dropoff`,position:{lat:Number(c.dropoff_lat),lng:Number(c.dropoff_lng)},label:""}),A});return[...v,...g]},[t,e]),l=se.useMemo(()=>(e||[]).filter(v=>v.pickup_lat&&v.pickup_lng&&v.dropoff_lat&&v.dropoff_lng).map(v=>({id:`poly-${v.id}`,path:[{lat:Number(v.pickup_lat),lng:Number(v.pickup_lng)},{lat:Number(v.dropoff_lat),lng:Number(v.dropoff_lng)}],color:"#22c55e"})),[e]),f=se.useMemo(()=>{const v=(t||[]).find(c=>c.lat&&c.lng);if(v)return{lat:Number(v.lat),lng:Number(v.lng)};const g=(e||[]).find(c=>c.pickup_lat&&c.pickup_lng);return g?{lat:Number(g.pickup_lat),lng:Number(g.pickup_lng)}:{lat:25.033964,lng:121.564468}},[t,e]);return I.jsx("div",{className:"w-full h-[480px] border rounded overflow-hidden",children:I.jsx(lw,{center:f,markers:i,polylines:l,zoom:12})})}function B6(){const[t,e]=se.useState([]),[i,l]=se.useState(!1),[f,v]=se.useState(""),[g,c]=se.useState(1),A=20,{toast:N}=sc(),Z=vh(),W=async()=>{l(!0);try{const{data:J}=await Os("list-users",{page:g,pageSize:A,keyword:f});e((J==null?void 0:J.users)||[])}catch(J){N({title:"",description:J.message,variant:"destructive"})}finally{l(!1)}};se.useEffect(()=>{W()},[g]);const K=async J=>{try{await Os("update-user-role",{userId:J.id,newRole:"driver"}),N({title:"",description:`${J.display_name||J.name} `,variant:"success"}),W()}catch(ce){N({title:"",description:ce.message,variant:"destructive"})}};return I.jsx("div",{className:"p-4",children:I.jsxs(Rn,{className:"glass",children:[I.jsxs(Mr,{children:[I.jsx(Ar,{children:""}),I.jsx(Rr,{children:""})]}),I.jsxs(Ln,{children:[I.jsxs("div",{className:"flex gap-2 mb-4",children:[I.jsx(nr,{value:f,onChange:J=>v(J.target.value),placeholder:""}),I.jsx(Cn,{onClick:()=>{c(1),W()},children:""}),I.jsx(Cn,{variant:"outline",onClick:()=>Z("/admin"),children:""})]}),i?I.jsx("p",{children:"..."}):I.jsx("div",{className:"space-y-2",children:t.map(J=>I.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md bg-background/30",children:[I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx(va,{children:J.role}),I.jsxs("div",{children:[I.jsx("div",{className:"font-medium",children:J.display_name||J.name||J.phone}),I.jsx("div",{className:"text-xs text-muted-foreground",children:J.phone})]})]}),I.jsx("div",{className:"flex items-center gap-2",children:I.jsx(Cn,{size:"sm",onClick:()=>K(J),disabled:J.role==="driver",children:""})})]},J.id))})]})]})})}function fd({children:t,role:e,allowedRoles:i}){const{user:l}=_l(),f="true".toLowerCase(),v=f==="true"||f==="1"||f==="yes";if(!l)return v?t:I.jsx(ep,{to:"/login",replace:!0});if(!(Array.isArray(i)&&i.length>0?l.role==="super_admin"?!0:i.includes(l.role):l.role==="super_admin"?!0:e?l.role===e:!0))switch(l.role){case"passenger":case"passenger":return I.jsx(ep,{to:"/passenger",replace:!0});case"driver":return I.jsx(ep,{to:"/driver",replace:!0});case"admin":return I.jsx(ep,{to:"/admin",replace:!0});default:return I.jsx(ep,{to:"/login",replace:!0})}return t}function F6(){const{user:t}=_l(),[e,i]=se.useState("checking"),[l,f]=se.useState("..."),v=async()=>{var A;i("checking"),f("...");try{const N=await Os("get-driver-status",{}),Z=((A=N==null?void 0:N.data)==null?void 0:A.stats)||(N==null?void 0:N.stats)||null;Z&&(t==null?void 0:t.role)==="admin"?f(` ${Z.total} ${Z.idle} ${Z.busy} ${Z.offline}`):f(""),i("ok")}catch(N){try{const Z=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",W="http://localhost:3002";if(!(W?`${W}/drivers/status`:""))throw new Error(" URL");const ce=await fetch("http://localhost:3001/api/health");if(!ce.ok)throw new Error(` API  (${ce.status})`);const ie=await ce.json(),oe=(ie==null?void 0:ie.data)||null;oe?((t==null?void 0:t.role)==="admin"?f(` ${oe.total} ${oe.idle} ${oe.busy} ${oe.offline}`):f(""),i("ok")):(i("error"),f("Supabase  API "))}catch(Z){i("error"),f(`${N.message||""}${Z.message||""}`)}}};se.useEffect(()=>{v()},[]);const g=e==="ok"?"bg-green-600/40":e==="error"?"bg-red-600/40":"bg-yellow-600/40",c=e==="ok"?"border-green-500/50":e==="error"?"border-red-500/50":"border-yellow-500/50";return I.jsx("div",{className:`w-full p-2 text-sm text-white ${g} border-b ${c}`,children:I.jsxs("div",{className:"container mx-auto flex items-center justify-between",children:[I.jsx("span",{children:l}),I.jsx("button",{onClick:v,className:"px-3 py-1 rounded bg-black/30 hover:bg-black/40 border border-white/20",children:""})]})})}const U6=!1;function V6(){return U6?null:I.jsx("div",{className:"w-full p-2 text-sm text-white bg-yellow-600/40 border-b border-yellow-500/50",children:I.jsx("div",{className:"container mx-auto flex items-center justify-between",children:I.jsx("span",{children:"Airtable config missing: API Key/Base ID not set, features disabled"})})})}function $6(){const{toasts:t}=sc();return I.jsxs(yI,{children:[t.map(function({id:e,title:i,description:l,action:f,...v}){return I.jsxs(xI,{...v,children:[I.jsxs("div",{className:"grid gap-1",children:[i&&I.jsx(wI,{children:i}),l&&I.jsx(TI,{children:l})]}),f,I.jsx(bI,{})]},e)}),I.jsx(vI,{})]})}function Z6(){return I.jsx(yI,{children:I.jsx(BO,{children:I.jsx(VO,{children:I.jsxs("div",{className:"min-h-screen bg-gradient-dark",children:[I.jsx(F6,{}),I.jsx(V6,{}),I.jsxs(oD,{children:[I.jsx(ll,{path:"/",element:I.jsx(xP,{})}),I.jsx(ll,{path:"/login",element:I.jsx(xP,{})}),I.jsx(ll,{path:"/register",element:I.jsx(s6,{})}),I.jsx(ll,{path:"/passenger",element:I.jsx(fd,{allowedRoles:["passenger","driver","admin"],children:I.jsx(A6,{})})}),I.jsx(ll,{path:"/driver",element:I.jsx(fd,{role:"driver",children:I.jsx(M6,{})})}),I.jsx(ll,{path:"/passenger/ride",element:I.jsx(fd,{allowedRoles:["passenger","admin"],children:I.jsx(D6,{})})}),I.jsx(ll,{path:"/driver/orders",element:I.jsx(fd,{role:"driver",children:I.jsx(N6,{})})}),I.jsx(ll,{path:"/admin",element:I.jsx(fd,{role:"admin",children:I.jsx(O6,{})})}),I.jsx(ll,{path:"/admin/users",element:I.jsx(fd,{role:"admin",children:I.jsx(B6,{})})})]}),I.jsx($6,{})]})})})})}OE(document.getElementById("root")).render(I.jsx(se.StrictMode,{children:I.jsx(cD,{children:I.jsx(Z6,{})})}));
